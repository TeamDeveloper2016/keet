<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de SAKBE
-->
<process>
	<dml> 
    <unit id="VistaCombustiblesDto">
      <select id="lazy">
        select
          tc_sakbe_combustibles.id_combustible as id_key,
          tc_sakbe_combustibles.id_empresa,
				  tc_mantic_empresas.nombre as empresa,  
          tc_sakbe_combustibles.consecutivo,
          tc_sakbe_combustibles.ticket,
          tc_sakbe_combustibles.lugar,
          tc_sakbe_combustibles.litros,
          tc_sakbe_combustibles.precio_litro,
          tc_sakbe_combustibles.total,
          tc_sakbe_tipos_combustibles.nombre as combustible,
          tc_sakbe_combustibles_estatus.nombre as estatus,
          tc_sakbe_combustibles.fecha,
          tc_sakbe_combustibles.saldo,
          tc_mantic_tipos_medios_pagos.nombre as medio,
          round(100- (tc_sakbe_combustibles.saldo* 100/ tc_sakbe_combustibles.litros), 0) as porcentaje,
          tc_sakbe_combustibles_estatus.id_combustible_estatus,
          tc_sakbe_combustibles_estatus.estatus_asociados,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as usuario,
          case 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 1 then 'circulo-azul' 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 2 then 'circulo-verde' 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 3 then 'circulo-amarillo' 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 4 then 'circulo-lila' 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 5 then 'circulo-rojo' 
            when tc_sakbe_combustibles_estatus.id_combustible_estatus= 6 then 'circulo-gris' 
            else 'circulo-cafe' 
          end as semaforo,
          tc_sakbe_combustibles.registro
        from
          tc_sakbe_combustibles
        inner join
          tc_sakbe_combustibles_estatus on tc_sakbe_combustibles.id_combustible_estatus= tc_sakbe_combustibles_estatus.id_combustible_estatus
        inner join
          tc_sakbe_tipos_combustibles on tc_sakbe_combustibles.id_tipo_combustible= tc_sakbe_tipos_combustibles.id_tipo_combustible
        inner join
          tc_mantic_tipos_medios_pagos on tc_sakbe_combustibles.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
				inner join 
					tc_mantic_empresas on tc_sakbe_combustibles.id_empresa= tc_mantic_empresas.id_empresa
        inner join
					tc_janal_usuarios on tc_sakbe_combustibles.id_usuario= tc_janal_usuarios.id_usuario          
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        left join (
				  select
				    tc_sakbe_combustible_ausencias.id_repartidor,
				    tc_sakbe_combustible_ausencias.id_ausente,
				    max(tc_sakbe_combustible_ausencias.limite) as limite
				  from
				    tc_sakbe_combustible_ausencias
				  group by
				    tc_sakbe_combustible_ausencias.id_repartidor,
				    tc_sakbe_combustible_ausencias.id_ausente
				) as tt_sakbe_combustible_ausencias	 on tc_sakbe_combustibles.id_usuario= tt_sakbe_combustible_ausencias.id_ausente 
        where
          ({isAdministrador} or tc_sakbe_combustibles.id_usuario= {idUsuario} or (tt_sakbe_combustible_ausencias.id_repartidor= {idUsuario} and date_format(now(), '%Y%m%d')&lt;= date_format(tt_sakbe_combustible_ausencias.limite, '%Y%m%d')))
          and {condicion}        
        {sortOrder}
      </select>  
      <select id="row">
        select      
          tc_sakbe_maquinarias.id_maquinaria as id_key,
          tc_sakbe_maquinarias.*
        from      
          tc_sakbe_maquinarias
        inner join
          tr_sakbe_maquinaria_desarrollo on tc_sakbe_maquinarias.id_maquinaria= tr_sakbe_maquinaria_desarrollo.id_maquinaria
        where      
          tr_sakbe_maquinaria_desarrollo.id_desarrollo = {idDesarrollo}
      </select>
			<select id="evidencias">
        select
          tc_sakbe_combustibles_archivos.id_combustible_archivo as id_key,
          tc_sakbe_combustibles_archivos.id_combustible_archivo as id,
          -1 as id_archivo,
          tc_sakbe_combustibles_archivos.*,
          tc_mantic_tipos_archivos.nombre as tipo,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
        from
          tc_sakbe_combustibles_archivos
        inner join 
          tc_janal_usuarios on tc_sakbe_combustibles_archivos.id_usuario= tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_mantic_tipos_archivos on tc_sakbe_combustibles_archivos.id_tipo_archivo= tc_mantic_tipos_archivos.id_tipo_archivo
        where
          id_combustible= {idCombustible}        
      </select>
			<select id="constatar">
        select
          tc_sakbe_suministros_archivos.id_suministro_archivo as id_key,
          tc_sakbe_suministros_archivos.id_suministro_archivo as id,
          -1 as id_archivo,
          tc_sakbe_suministros_archivos.*,
          tc_mantic_tipos_archivos.nombre as tipo,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
        from
          tc_sakbe_suministros_archivos
        inner join 
          tc_janal_usuarios on tc_sakbe_suministros_archivos.id_usuario= tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_mantic_tipos_archivos on tc_sakbe_suministros_archivos.id_tipo_archivo= tc_mantic_tipos_archivos.id_tipo_archivo
        where
          id_suministro= {idSuministro}        
      </select>
			<select id="desarrollos">
				select
          tc_keet_desarrollos.id_desarrollo as id_key,
          tc_keet_desarrollos.clave,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.registro,
          tc_keet_desarrollos.descripcion,
          tc_mantic_clientes.id_cliente,
          tc_mantic_clientes.razon_social,
          concat(tc_mantic_domicilios.calle, ', ', tc_mantic_domicilios.numero_exterior, if(tc_mantic_domicilios.numero_interior is null, '', concat(',', tc_mantic_domicilios.numero_interior)), if(tc_mantic_domicilios.codigo_postal is NULL, '', concat(', C.P.', tc_mantic_domicilios.codigo_postal))) domicilio,
					tc_mantic_clientes.id_empresa
        from
          tc_keet_desarrollos
        inner join 
          tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
          {condicion}
        group by
          tc_keet_desarrollos.id_desarrollo
		    order by
		      tc_keet_desarrollos.nombres
			</select>	   
      <select id="maquinarias">
        select      
          tc_sakbe_maquinarias.id_maquinaria as id_key,
          tc_sakbe_maquinarias.id_maquinaria,
          tc_sakbe_maquinarias.clave,
          tc_sakbe_maquinarias.nombre,
          tc_sakbe_maquinarias.marca,
          tc_sakbe_maquinarias.litros,
          tc_sakbe_maquinarias.rendimiento
        from      
          tc_sakbe_maquinarias
        inner join
          tr_sakbe_maquinaria_desarrollo on tc_sakbe_maquinarias.id_maquinaria= tr_sakbe_maquinaria_desarrollo.id_maquinaria
        where 
          tr_sakbe_maquinaria_desarrollo.id_desarrollo= {idDesarrollo}
      </select>
      <select id="combustibles">
        select      
          tc_sakbe_combustibles.id_combustible as id_key,
          tc_sakbe_combustibles.*
        from      
          tc_sakbe_combustibles
        where      
          consecutivo like '%{comodin}%'
          or ticket like '%{comodin}%'
          or lugar like '%{comodin}%'
          or litros= '{comodin}'
          or total= '{comodin}'
      </select>
      <select id="suministros">
        select      
          tc_sakbe_maquinarias.id_maquinaria as id_key,
          tc_sakbe_maquinarias.id_maquinaria,
          tc_sakbe_maquinarias.clave,
          tc_sakbe_maquinarias.nombre,
          tc_sakbe_maquinarias.marca,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_sakbe_suministros.litros,
          tc_sakbe_suministros_estatus.id_suministro_estatus,
          tc_sakbe_suministros_estatus.estatus_asociados,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as usuario,
          tc_sakbe_suministros.registro
        from      
          tc_sakbe_suministros
        inner join
          tc_sakbe_suministros_estatus on tc_sakbe_suministros.id_suministro_estatus= tc_sakbe_suministros_estatus.id_suministro_estatus
        inner join
          tc_sakbe_maquinarias on tc_sakbe_suministros.id_maquinaria= tc_sakbe_maquinarias.id_maquinaria
        inner join
          tr_sakbe_maquinaria_desarrollo on tc_sakbe_maquinarias.id_maquinaria= tr_sakbe_maquinaria_desarrollo.id_maquinaria
        inner join
          tc_keet_desarrollos on tr_sakbe_maquinaria_desarrollo.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
					tc_janal_usuarios on tc_sakbe_suministros.id_usuario= tc_janal_usuarios.id_usuario          
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona        
        where
          {condicion}        
        {sortOrder}
      </select>  
    </unit>    
	</dml>    
</process>
