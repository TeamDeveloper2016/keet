<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de KEET
-->
<process>
	<dml> 
    <unit id="VistaReportesDto">
			<select id="lazy">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_mantic_empresas.id_empresa,
  tc_mantic_empresas.nombre as empresa, 
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.no_viviendas,
  tc_keet_contratos_estatus.nombre as estatus,
  tc_keet_contratos.costo,
  tc_keet_contratos.registro
from 
  tc_keet_contratos
inner join
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
where        
  {condicion}
{sortOrder}
			</select>	
			<select id="procesos">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_mantic_empresas.id_empresa,
  tc_mantic_empresas.nombre as empresa, 
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.no_viviendas,
  sum(if(tc_keet_contratos_lotes.arranque&gt;= str_to_date('{inicio}', '%Y%m%d') and tc_keet_contratos_lotes.arranque&lt;= str_to_date('{termino}', '%Y%m%d'), 1, 0)) as inicios,
  sum(if(tc_keet_contratos_lotes.entrega&gt;= str_to_date('{inicio}', '%Y%m%d') and tc_keet_contratos_lotes.entrega&lt;= str_to_date('{termino}', '%Y%m%d'), 1, 0)) as terminos,
  sum(if(tc_keet_contratos_lotes.arranque&gt;= str_to_date('{inicio}', '%Y%m%d') and tc_keet_contratos_lotes.arranque&lt;= str_to_date('{termino}', '%Y%m%d'), 1, if((tc_keet_contratos_lotes.entrega&gt;= str_to_date('{inicio}', '%Y%m%d') and tc_keet_contratos_lotes.entrega&lt;= str_to_date('{termino}', '%Y%m%d')) or tc_keet_contratos_lotes.entrega is not null, 0, 1))) as proceso,
  sum(if(tc_keet_contratos_lotes.arranque is not null and tc_keet_contratos_lotes.entrega is null, 1, 0)) as ainicios,
  sum(if(tc_keet_contratos_lotes.arranque is not null and tc_keet_contratos_lotes.entrega is not null, 1, 0)) as aterminos,
  sum(if(tc_keet_contratos_lotes.arranque is not null and tc_keet_contratos_lotes.entrega is null, 1, 0)) as aproceso
from 
  tc_keet_contratos
inner join
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
where        
  {condicion}
group by
  tc_keet_contratos.id_contrato  
{sortOrder}
			</select>	
			<select id="presupuesto">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_mantic_empresas.id_empresa,
  tc_mantic_empresas.nombre as empresa, 
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.no_viviendas,
  tc_keet_contratos.costo,
  sum(ifnull(tc_keet_estimaciones.importe, 0)) as ejecutado,
  abs(tc_keet_contratos.costo- sum(ifnull(tc_keet_estimaciones.importe, 0))) as ejercer,
  if(tc_keet_contratos.costo= 0, 0, (sum(ifnull(tc_keet_estimaciones.importe, 0))* 100)/ tc_keet_contratos.costo) as pejecutado,
  if(tc_keet_contratos.costo&lt;= 0, 0, if(sum(ifnull(tc_keet_estimaciones.importe, 0))* 100/ tc_keet_contratos.costo &gt;100, 0, 100- sum(ifnull(tc_keet_estimaciones.importe, 0))* 100/ tc_keet_contratos.costo)) as pejercer
from 
  tc_keet_contratos
inner join
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
left join
  tc_keet_estimaciones on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
where        
  {condicion}
group by
  tc_keet_contratos.id_contrato  
{sortOrder}
			</select>	
			<select id="control">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_keet_contratos.id_contrato,
  tc_mantic_empresas.id_empresa,
  tc_mantic_empresas.nombre as empresa, 
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.no_viviendas,
  tc_keet_contratos.costo,
  tc_keet_contratos.destajos,
  tc_keet_contratos.subcontratados,
  tc_keet_contratos.por_el_dia,
  tc_keet_contratos.administrativos,
  tc_keet_contratos.materiales,
  tc_keet_contratos.maquinaria,
  tc_keet_contratos.indirecto
from 
  tc_keet_contratos
inner join
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
inner join
  tc_keet_estimaciones on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
where        
  {condicion}
group by
  tc_keet_contratos.id_contrato  
{sortOrder}
			</select>	
    </unit>  
    <unit id="VistaFacturasDto">
			<select id="row">
select
  tc_mantic_notas_entradas.id_nota_entrada as id_key,
  tc_mantic_notas_entradas.id_nota_entrada,
  tc_mantic_notas_entradas.id_proveedor,
  ifnull(tc_keet_notas_facturas.factura, '') as factura,
  ifnull(tc_keet_notas_facturas.rfc, '') as rfc,
  tc_mantic_notas_archivos.nombre,
  tc_mantic_notas_archivos.archivo,
  tc_mantic_notas_archivos.alias,
  tc_mantic_notas_entradas.registro
from
  tc_mantic_notas_entradas
inner join 
  tc_mantic_notas_archivos on tc_mantic_notas_entradas.id_nota_entrada= tc_mantic_notas_archivos.id_nota_entrada and tc_mantic_notas_archivos.id_tipo_archivo= 1 and tc_mantic_notas_archivos.id_principal= 1 and tc_mantic_notas_archivos.id_eliminado= 2
left join        
  tc_keet_notas_facturas on tc_mantic_notas_entradas.id_nota_entrada= tc_keet_notas_facturas.id_nota_entrada
where
  (tc_mantic_notas_entradas.id_nota_entrada= {idNotaEntrada} or {idNotaEntrada}= -1)
order by  
  tc_mantic_notas_entradas.id_nota_entrada        
      </select>  
			<select id="parche">
select
  tc_mantic_notas_entradas.id_nota_entrada as id_key,
  tc_mantic_notas_entradas.id_nota_entrada,
  tc_mantic_notas_entradas.id_proveedor,
  ifnull(tc_keet_notas_facturas.factura, '') as factura,
  ifnull(tc_keet_notas_facturas.rfc, '') as rfc,
  tc_mantic_notas_archivos.nombre,
  tc_mantic_notas_archivos.archivo,
  tc_mantic_notas_archivos.alias,
  tc_mantic_notas_entradas.registro
from
  tc_mantic_notas_entradas
inner join 
  tc_mantic_notas_archivos on tc_mantic_notas_entradas.id_nota_entrada= tc_mantic_notas_archivos.id_nota_entrada and tc_mantic_notas_archivos.id_tipo_archivo= 1 and tc_mantic_notas_archivos.id_principal= 1 and tc_mantic_notas_archivos.id_eliminado= 2
left join        
  tc_keet_notas_facturas on tc_mantic_notas_entradas.id_nota_entrada= tc_keet_notas_facturas.id_nota_entrada
where
  tc_mantic_notas_entradas.id_proveedor= 34
  and date_format(tc_mantic_notas_entradas.fecha_factura, '%Y%m')= '202409'
order by  
  tc_mantic_notas_entradas.id_nota_entrada        
      </select>  
			<select id="exists">
select
  tc_mantic_notas_entradas.id_nota_entrada as id_key,
  tc_mantic_notas_entradas.id_nota_entrada,
  tc_keet_notas_facturas.factura,
  tc_keet_notas_facturas.rfc
from
  tc_mantic_notas_entradas
inner join 
  tc_keet_notas_facturas on tc_mantic_notas_entradas.id_nota_entrada= tc_keet_notas_facturas.id_nota_entrada
where
  tc_mantic_notas_entradas.id_nota_entrada= {idNotaEntrada}
order by  
  tc_mantic_notas_entradas.id_nota_entrada        
      </select>  
    </unit>  
    <unit id="VistaCostosDto">
			<select id="desglose">
select
  tc_keet_nominas_frentes.id_nomina,
  tc_keet_nominas_frentes.id_desarrollo,
  tc_keet_nominas_frentes.id_contrato,
  tc_keet_nominas_frentes.porcentaje,
  if(tc_keet_nominas_frentes.id_contrato is null, {total}, tc_keet_nominas_frentes.porcentaje*{total}/100) as total
from
  tc_keet_nominas_frentes
where   
  tc_keet_nominas_frentes.id_nomina= {idNomina}
  and tc_keet_nominas_frentes.id_desarrollo= {idDesarrollo}
order by
  tc_keet_nominas_frentes.id_nomina,
  tc_keet_nominas_frentes.id_desarrollo,
  tc_keet_nominas_frentes.id_contrato        
      </select>  
			<select id="contratos">
select
  tc_keet_nominas_frentes.id_nomina,
  tc_keet_nominas_frentes.id_desarrollo,
  tc_keet_nominas_frentes.id_contrato,
  tc_keet_nominas_frentes.porcentaje,
  if(tc_keet_nominas_frentes.id_contrato is null, tc_keet_nominas_grupos.total, tc_keet_nominas_frentes.porcentaje*tc_keet_nominas_grupos.total/100) as total
from
  tc_keet_nominas_frentes
inner join
  tc_keet_nominas_grupos on tc_keet_nominas_frentes.id_nomina= tc_keet_nominas_grupos.id_nomina and tc_keet_nominas_frentes.id_desarrollo= tc_keet_nominas_grupos.id_desarrollo
where   
  tc_keet_nominas_frentes.id_nomina= {idNomina}
  and tc_keet_nominas_frentes.id_desarrollo= {idDesarrollo}
order by
  tc_keet_nominas_frentes.id_nomina,
  tc_keet_nominas_frentes.id_desarrollo,
  tc_keet_nominas_frentes.id_contrato        
      </select>  
			<select id="desarrollo">
select 
  tc_keet_proyectos.id_desarrollo as id_key,
  tc_keet_proyectos.id_desarrollo
from
  tc_keet_contratos
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
where
  tc_keet_contratos.id_contrato= {idContrato}
			</select>      
      <select id="lazy">
select
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_empresas.nombre as empresa, 
  tc_keet_desarrollos.id_desarrollo,        
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.no_viviendas,
  tc_keet_contratos.costo,
  count(distinct(tc_keet_estimaciones.id_estimacion)) as estimaciones,
  ifnull(sum(if(tc_keet_estimaciones.id_extra= 2, tc_keet_estimaciones.importe, 0)), 0) as estimado,
  ifnull(sum(if(tc_keet_estimaciones.id_extra= 1, tc_keet_estimaciones.importe, 0)), 0) as extras,
  ifnull(tt_keet_estimaciones_detalles.retenciones, 0) as retenciones,
  ifnull(tt_keet_nominas_contratos.por_el_dia, 0) as por_el_dia,
  ifnull(round(ifnull(sum(if(tc_keet_estimaciones.id_extra= 2, tc_keet_estimaciones.importe, 0)), 0)* 100/ tc_keet_contratos.costo, 2), 0) as porcentaje,
  ifnull(tt_mantic_ordenes_compras.materiales, 0)+ ifnull(tt_keet_destajos_realizados.destajos, 0) as egresos,
  ifnull(round(ifnull(ifnull(sum(if(tc_keet_estimaciones.id_extra= 2, tc_keet_estimaciones.importe, 0)), 0)* 100/ tc_keet_contratos.costo, 0)- ((ifnull(tt_mantic_ordenes_compras.materiales, 0)+ ifnull(tt_keet_destajos_realizados.destajos, 0)+ ifnull(tt_keet_nominas_contratos.por_el_dia, 0))/ tc_keet_contratos.costo* 100), 2),0) as desviacion,
  tt_keet_contratos_lotes.iniciadas,
  tt_keet_contratos_lotes.en_proceso,
  tt_keet_contratos_lotes.terminadas,
  tt_keet_contratos_lotes.otros,
  tc_keet_contratos.registro
from
  tc_keet_contratos
inner join
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
left join
  tc_keet_estimaciones on tc_keet_contratos.id_contrato= tc_keet_estimaciones.id_contrato and tc_keet_estimaciones.id_estimacion_estatus= 2
left join (
  select
    tc_keet_estimaciones_detalles.id_estimacion,
    sum(tc_keet_estimaciones_detalles.importe) as retenciones
  from  
    tc_keet_estimaciones_detalles 
  inner join
    tc_keet_estimaciones on tc_keet_estimaciones_detalles.id_estimacion= tc_keet_estimaciones.id_estimacion
  group by   
    tc_keet_estimaciones_detalles.id_estimacion
) as tt_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tt_keet_estimaciones_detalles.id_estimacion     
left join (
  select
    tc_keet_contratos_lotes.id_contrato,
		sum(case when tc_keet_contratos_lotes.id_contrato_lote_estatus= 1 then 1 else 0 end) as iniciadas,
		sum(case when tc_keet_contratos_lotes.id_contrato_lote_estatus= 2 then 1 else 0 end) as en_proceso,
		sum(case when tc_keet_contratos_lotes.id_contrato_lote_estatus= 4 then 1 else 0 end) as terminadas,
		sum(case when (tc_keet_contratos_lotes.id_contrato_lote_estatus= 3 or tc_keet_contratos_lotes.id_contrato_lote_estatus= 5 or tc_keet_contratos_lotes.id_contrato_lote_estatus= 6) then 1 else 0 end) as otros
  from  
    tc_keet_contratos_lotes 
  group by   
    tc_keet_contratos_lotes.id_contrato 
  order by  
    tc_keet_contratos_lotes.id_contrato desc
) as tt_keet_contratos_lotes on tc_keet_contratos.id_contrato= tt_keet_contratos_lotes.id_contrato
left join (
	select
		tt_keet_contratos_destajos.id_contrato,
		sum(tt_keet_contratos_destajos.destajos) as destajos
	from (
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_contratistas.costo) as destajos
		from
			tc_keet_contratos_destajos_contratistas
		inner join
			tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
		union all   
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_proveedores.costo) as destajos
		from
			tc_keet_contratos_destajos_proveedores
		inner join
			tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
	) as tt_keet_contratos_destajos
	group by 
		tt_keet_contratos_destajos.id_contrato
) as tt_keet_destajos_realizados on tc_keet_contratos.id_contrato= tt_keet_destajos_realizados.id_contrato        
left join (
	select
		tc_mantic_ordenes_compras.id_contrato,
		sum(tc_mantic_ordenes_compras.total) as materiales
	from
		tc_mantic_ordenes_compras
	where
		tc_mantic_ordenes_compras.id_orden_estatus in (3,4,5,6,7)
	group by  
		tc_mantic_ordenes_compras.id_contrato
) as tt_mantic_ordenes_compras on tc_keet_contratos.id_contrato= tt_mantic_ordenes_compras.id_contrato        
left join (
	select
		tc_keet_nominas_contratos.id_contrato,
		sum(tc_keet_nominas_contratos.total) as por_el_dia
	from
		tc_keet_nominas_contratos
	group by  
		tc_keet_nominas_contratos.id_contrato
) as tt_keet_nominas_contratos on tc_keet_contratos.id_contrato= tt_keet_nominas_contratos.id_contrato        
where
  tc_keet_contratos.id_contrato in ({condicion})
group by 
  tc_keet_contratos.id_contrato
order by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.clave desc
      </select>
      <select id="egresos">
select
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_desarrollos.id_desarrollo,        
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.no_viviendas,
  ifnull(tt_mantic_ordenes_compras.materiales, 0) as materiales,
  ifnull(tt_keet_destajos_realizados.destajos, 0)+ ifnull(tt_keet_nominas_contratos.por_el_dia, 0) as destajos
from
  tc_keet_contratos
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
left join (
	select
		tt_keet_contratos_destajos.id_contrato,
		sum(tt_keet_contratos_destajos.destajos) as destajos
	from (
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_contratistas.costo) as destajos
		from
			tc_keet_contratos_destajos_contratistas
		inner join
			tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
		union all   
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_proveedores.costo) as destajos
		from
			tc_keet_contratos_destajos_proveedores
		inner join
			tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
	) as tt_keet_contratos_destajos
	group by 
		tt_keet_contratos_destajos.id_contrato
) as tt_keet_destajos_realizados on tc_keet_contratos.id_contrato= tt_keet_destajos_realizados.id_contrato        
left join (
	select
		tc_mantic_ordenes_compras.id_contrato,
		sum(tc_mantic_ordenes_compras.total) as materiales
	from
		tc_mantic_ordenes_compras
	where
		tc_mantic_ordenes_compras.id_orden_estatus in (3,4,5,6,7)
	group by  
		tc_mantic_ordenes_compras.id_contrato
) as tt_mantic_ordenes_compras on tc_keet_contratos.id_contrato= tt_mantic_ordenes_compras.id_contrato
left join (
	select
		tc_keet_nominas_contratos.id_contrato,
		sum(tc_keet_nominas_contratos.total) as por_el_dia
	from
		tc_keet_nominas_contratos
	group by  
		tc_keet_nominas_contratos.id_contrato
) as tt_keet_nominas_contratos on tc_keet_contratos.id_contrato= tt_keet_nominas_contratos.id_contrato
where
  tc_keet_contratos.id_contrato in ({condicion})
group by 
  tc_keet_contratos.id_contrato
order by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.clave desc
      </select>
      <select id="manoObra">
select
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_desarrollos.id_desarrollo,        
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.no_viviendas,
  ifnull(tt_keet_nominas_contratos.por_el_dia, 0) as por_el_dia,
  ifnull(tt_keet_destajos_realizados.destajos, 0) as destajos
from
  tc_keet_contratos
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
left join (
	select
		tt_keet_contratos_destajos.id_contrato,
		sum(tt_keet_contratos_destajos.destajos) as destajos
	from (
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_contratistas.costo) as destajos
		from
			tc_keet_contratos_destajos_contratistas
		inner join
			tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
		union all   
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_proveedores.costo) as destajos
		from
			tc_keet_contratos_destajos_proveedores
		inner join
			tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		group by 
			 tc_keet_contratos_lotes.id_contrato
	) as tt_keet_contratos_destajos
	group by 
		tt_keet_contratos_destajos.id_contrato
) as tt_keet_destajos_realizados on tc_keet_contratos.id_contrato= tt_keet_destajos_realizados.id_contrato        
left join (
	select
		tc_keet_nominas_contratos.id_contrato,
		sum(tc_keet_nominas_contratos.total) as por_el_dia
	from
		tc_keet_nominas_contratos
	group by  
		tc_keet_nominas_contratos.id_contrato
) as tt_keet_nominas_contratos on tc_keet_contratos.id_contrato= tt_keet_nominas_contratos.id_contrato        
where
  tc_keet_contratos.id_contrato in ({condicion})
group by 
  tc_keet_contratos.id_contrato
order by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.clave desc
      </select>
			<select id="desarrollos">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_clientes.id_cliente,
  tc_keet_desarrollos.id_desarrollo,
  tc_mantic_empresas.nombre as empresa,  
  tc_keet_desarrollos.nombres as desarrollo,
  tc_mantic_clientes.razon_social,
  ifnull(tc_keet_contratos.costo- tc_keet_contratos.fondo_garantia, 0) as total,
  ifnull(tc_keet_contratos.costo, 0) as valor,
  tc_keet_contratos_estatus.nombre as estatus,
  tc_keet_contratos.*
from
  tc_keet_contratos
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join
  tc_mantic_clientes on tc_keet_proyectos.id_cliente= tc_mantic_clientes.id_cliente
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
where
  tc_keet_desarrollos.id_desarrollo in ({idDesarrollo})
  and {condicion}
order by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.clave desc 
			</select>      
			<select id="ponderados">      
select
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_desarrollos.id_desarrollo,        
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.no_viviendas,
  ifnull(tt_keet_nominas_contratos.por_el_dia, 0) as por_el_dia,
  ifnull(tt_keet_destajos_realizados.destajos, 0) as destajos,
  (ifnull(tt_keet_nominas_contratos.por_el_dia, 0)+ ifnull(tt_keet_destajos_realizados.destajos, 0)) as costo,
  tc_keet_contratos.id_contrato_estatus,
  tc_keet_contratos.registro
from
  tc_keet_contratos
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
left join (
	select
		tc_keet_contratos_lotes.id_contrato,
		sum(tc_keet_contratos_destajos_contratistas.costo) as destajos
	from
		tc_keet_contratos_destajos_contratistas
	inner join
		tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
	inner join
		tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
	where
		tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}
	group by 
		 tc_keet_contratos_lotes.id_contrato
) as tt_keet_destajos_realizados on tc_keet_contratos.id_contrato= tt_keet_destajos_realizados.id_contrato        
left join (
	select
		tc_keet_nominas_contratos.id_contrato,
		ifnull(sum(tc_keet_nominas_contratos.total), 0) as por_el_dia
	from
		tc_keet_nominas_contratos
	where
		tc_keet_nominas_contratos.id_nomina= {idNomina}
		and tc_keet_nominas_contratos.id_contrato is not null
	group by  
		tc_keet_nominas_contratos.id_contrato
) as tt_keet_nominas_contratos on tc_keet_contratos.id_contrato= tt_keet_nominas_contratos.id_contrato        
where
  tc_keet_contratos.id_contrato_estatus in (5, 6, 7, 8, 9)
  and (tt_keet_nominas_contratos.por_el_dia> 0
  or tt_keet_destajos_realizados.destajos> 0)
  and {condicion}
group by 
  tc_keet_contratos.id_contrato
order by
  tc_keet_desarrollos.nombres,
  tc_keet_contratos.clave asc       
			</select> 
			<select id="estimaciones"> 
select
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_desarrollos.id_desarrollo,        
  tc_keet_desarrollos.nombres as desarrollo,
  ifnull(sum(tc_keet_estimaciones.importe), 0) as estimado,
  ifnull(sum(tt_keet_destajos_realizados.destajos), 0) as destajos,
  ifnull(sum(tt_mantic_ordenes_compras.materiales), 0) as materiales,
  ifnull(tt_keet_nominas_grupos.por_el_dia, 0) as por_el_dia
from
  tc_keet_contratos
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
left join
  tc_keet_estimaciones on tc_keet_contratos.id_contrato= tc_keet_estimaciones.id_contrato and tc_keet_estimaciones.id_extra= 2 and tc_keet_estimaciones.id_estimacion_estatus= 2
left join (
  select
    tc_keet_estimaciones_detalles.id_estimacion,
    sum(tc_keet_estimaciones_detalles.importe) as retenciones
  from  
    tc_keet_estimaciones_detalles 
  inner join
    tc_keet_estimaciones on tc_keet_estimaciones_detalles.id_estimacion= tc_keet_estimaciones.id_estimacion and tc_keet_estimaciones.id_extra= 2
  group by   
    tc_keet_estimaciones_detalles.id_estimacion
) as tt_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tt_keet_estimaciones_detalles.id_estimacion     
left join (
	select
		tt_keet_contratos_destajos.id_contrato,
		sum(tt_keet_contratos_destajos.destajos) as destajos
	from (
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_contratistas.costo) as destajos
		from
			tc_keet_contratos_destajos_contratistas
		inner join
			tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
    where
      tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}    
		group by 
			 tc_keet_contratos_lotes.id_contrato
		union all   
		select
			tc_keet_contratos_lotes.id_contrato,
			sum(tc_keet_contratos_destajos_proveedores.costo) as destajos
		from
			tc_keet_contratos_destajos_proveedores
		inner join
			tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
		inner join
			tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
    where
      tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina}    
		group by 
			 tc_keet_contratos_lotes.id_contrato
	) as tt_keet_contratos_destajos
	group by 
		tt_keet_contratos_destajos.id_contrato
) as tt_keet_destajos_realizados on tc_keet_contratos.id_contrato= tt_keet_destajos_realizados.id_contrato        
left join (
	select
		tc_mantic_ordenes_compras.id_contrato,
		sum(tc_mantic_ordenes_compras.total) as materiales
	from
		tc_mantic_ordenes_compras
	where
		tc_mantic_ordenes_compras.id_orden_estatus in (3,4,5,6,7)
	group by  
		tc_mantic_ordenes_compras.id_contrato
) as tt_mantic_ordenes_compras on tc_keet_contratos.id_contrato= tt_mantic_ordenes_compras.id_contrato        
left join (
	select
		tc_keet_nominas_grupos.id_desarrollo,
		sum(tc_keet_nominas_grupos.total) as por_el_dia
	from
		tc_keet_nominas_grupos
	where
		tc_keet_nominas_grupos.id_nomina= {idNomina}
		and tc_keet_nominas_grupos.id_desarrollo in ({condicion})
	group by  
		tc_keet_nominas_grupos.id_nomina
) as tt_keet_nominas_grupos on tc_keet_desarrollos.id_desarrollo= tt_keet_nominas_grupos.id_desarrollo        
where
  tc_keet_desarrollos.id_desarrollo in ({condicion})
group by 
  tc_keet_desarrollos.id_desarrollo
			</select> 
    </unit>    
    <unit id="VistaBoletasDto">
      <select id="folio">
select 
  tc_keet_boletas.id_boleta as id_key,
  tc_keet_boletas.consecutivo,
  concat(tc_mantic_empresas.clave, '-', tc_keet_boletas.consecutivo) as codigo_barra,
  tc_keet_boletas.registro,
  tc_keet_boletas_detalles.id_boleta_detalle,
  tc_keet_boletas_detalles.id_boleta,
  tc_keet_boletas_detalles.id_articulo,
  tc_keet_boletas_detalles.codigo,
  tc_keet_boletas_detalles.nombre,
  tc_keet_boletas_detalles.cantidad,
  tc_keet_boletas_detalles.costo,
  tc_keet_boletas_detalles.precio,
  tc_mantic_personas.cuenta,
  tc_keet_boletas.id_boleta_estatus,
  'VALE DE ALMACEN' as tipo_venta,
  'CONSECUTIVO' as leyenda_venta,
  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as entregado,
  concat(tt_mantic_personas.nombres, ' ', tt_mantic_personas.paterno, ' ', tt_mantic_personas.materno) as usuario,
  tc_keet_boletas.observaciones
from 
  tc_keet_boletas 
inner join 
  tc_keet_boletas_detalles on tc_keet_boletas.id_boleta= tc_keet_boletas_detalles.id_boleta
inner join 
  tc_keet_boletas_estatus on tc_keet_boletas.id_boleta_estatus= tc_keet_boletas_estatus.id_boleta_estatus
inner join				
  tc_mantic_empresas on tc_keet_boletas.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tr_mantic_empresa_personal on tc_keet_boletas.id_solicito= tr_mantic_empresa_personal.id_empresa_persona
inner join				
  tc_mantic_personas on tc_mantic_personas.id_persona= tr_mantic_empresa_personal.id_persona			
inner join 
  tc_janal_usuarios on tc_keet_boletas.id_usuario= tc_janal_usuarios.id_usuario
inner join				
  tc_mantic_personas as tt_mantic_personas on tt_mantic_personas.id_persona= tc_janal_usuarios.id_persona
where
  tc_keet_boletas.id_boleta= {idBoleta}
group by
  tc_keet_boletas.id_boleta,
  tc_keet_boletas_detalles.id_boleta_detalle
order by 
  tc_keet_boletas.id_boleta,
  tc_keet_boletas_detalles.id_boleta_detalle asc
      </select>
      <select id="lazy">
select
  tc_keet_boletas.id_boleta as id_key,
  tc_keet_boletas.id_boleta,
  tc_keet_boletas.id_empresa,  
  tc_mantic_empresas.nombre as empresa,  
  tc_keet_boletas.consecutivo,  													
  tc_mantic_almacenes.nombre as almacen,
  tc_keet_boletas.id_boleta_estatus,
  tc_keet_boletas_estatus.nombre as estatus,
  tc_keet_boletas_estatus.estatus_asociados, 
  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre,
  count(tc_keet_boletas_detalles.id_boleta_detalle) as articulos,
  tc_keet_boletas.registro
from 
  tc_keet_boletas						
left join 
  tc_keet_boletas_detalles on tc_keet_boletas.id_boleta = tc_keet_boletas_detalles.id_boleta
inner join 
  tc_mantic_empresas on tc_keet_boletas.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_boletas_estatus on tc_keet_boletas.id_boleta_estatus=tc_keet_boletas_estatus.id_boleta_estatus
inner join 
  tc_mantic_almacenes on tc_keet_boletas.id_almacen= tc_mantic_almacenes.id_almacen
inner join 
  tr_mantic_empresa_personal on tc_keet_boletas.id_solicito= tr_mantic_empresa_personal.id_empresa_persona
inner join				
  tc_mantic_personas on tc_mantic_personas.id_persona= tr_mantic_empresa_personal.id_persona			
where
  tc_keet_boletas.id_empresa in ({idEmpresa})
  and {condicion}
group by 
  tc_keet_boletas.id_boleta
{sortOrder}
      </select>
      <select id="detalle">
select      
  tc_keet_boletas_detalles.id_boleta_detalle as id_comodin,
  tc_keet_boletas_detalles.id_boleta_detalle,
  tc_keet_boletas_detalles.id_boleta,
  tc_keet_boletas_detalles.id_articulo,
  ifnull(tc_keet_boletas_detalles.codigo, tc_mantic_articulos_codigos.codigo) as codigo,
  tc_keet_boletas_detalles.nombre,
  tc_keet_boletas_detalles.cantidad,
  tc_keet_boletas_detalles.costo,
  tc_keet_boletas_detalles.precio,
  tc_keet_boletas_detalles.registro
from      
  tc_keet_boletas_detalles
inner join
  tc_mantic_articulos on tc_keet_boletas_detalles.id_articulo= tc_mantic_articulos.id_articulo
left join
  tc_mantic_articulos_codigos on tc_keet_boletas_detalles.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
where      
  tc_keet_boletas_detalles.id_boleta = {idBoleta}
order by
  tc_keet_boletas_detalles.registro
      </select>
    </unit>      
		<unit id="VistaProcesosDto">
      <select id="lazy">
select
  tc_keet_sub_procesos.id_sub_proceso as id_key,
  tc_keet_procesos.id_proceso,
  tc_keet_procesos.nombre as proceso,
  tc_keet_sub_procesos.nombre as sub_proceso,
  tc_keet_sub_procesos.registro
from      
  tc_keet_procesos 
inner join
  tc_keet_sub_procesos on tc_keet_procesos.id_proceso= tc_keet_sub_procesos.id_proceso
where
  {condicion}        
{sortOrder}        
      </select>
      <select id="seguimiento">
select 
	tc_keet_contratos_lotes.id_contrato_lote as id_key,
	tc_keet_contratos_lotes.id_contrato_lote,
  tc_keet_contratos_lotes.id_contrato,
  tc_keet_prototipos.id_prototipo,
	ifnull(tt_keet_entregas.id_entrega, -1) as id_entrega,
	ifnull(tt_keet_entregas.id_paquete, -1) as id_paquete,
	ifnull(tt_keet_entregas.id_completo, -1) as id_completo,
	tc_keet_contratos.clave as clave_contrato, 
	tc_keet_contratos.nombre as nombre_contrato, 
	tc_keet_contratos.etapa as etapa_contrato,
	concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
	tc_keet_prototipos.nombre as prototipo,
	tc_keet_contratos_lotes.clave,
  tc_keet_contratos_lotes.manzana,
  tc_keet_contratos_lotes.lote,
  tc_keet_contratos_lotes.inicio,
  tc_keet_contratos_lotes.termino,
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  concat(tt_mantic_personas.nombres,' ', ifnull(tt_mantic_personas.paterno, ''),' ', ifnull(tt_mantic_personas.materno, '')) as autorizo,
  concat(ta_mantic_personas.nombres,' ', ifnull(ta_mantic_personas.paterno, ''),' ', ifnull(ta_mantic_personas.materno, '')) as recibio,
  ifnull(tt_keet_entregas.fecha, now()) as fecha
from 
	tc_keet_contratos
inner join 
	tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
	tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
left join
(
  select  
    tc_keet_entregas.id_entrega,
    tc_keet_entregas.id_contrato_lote,
    tc_keet_entregas.id_paquete,
    tc_keet_entregas.id_completo,
    tc_keet_entregas.fecha,
    tc_keet_entregas.id_autoriza,
    tc_keet_entregas.id_recibe
  from  
    tc_keet_entregas
  inner join  
    tc_keet_paquetes on tc_keet_entregas.id_paquete= tc_keet_paquetes.id_paquete
  where  
    tc_keet_paquetes.id_proceso= {idProceso}
    and tc_keet_paquetes.id_sub_proceso= {idSubProceso}
) as tt_keet_entregas on tc_keet_contratos_lotes.id_contrato_lote= tt_keet_entregas.id_contrato_lote 
left join
  tr_mantic_empresa_personal on tt_keet_entregas.id_autoriza= tr_mantic_empresa_personal.id_empresa_persona
left join
  tr_mantic_empresa_personal as tt_mantic_empresa_personal on tt_keet_entregas.id_recibe= tt_mantic_empresa_personal.id_empresa_persona
left join
	tc_mantic_personas as tt_mantic_personas on tr_mantic_empresa_personal.id_persona= tt_mantic_personas.id_persona
left join
	tc_mantic_personas as ta_mantic_personas on tt_mantic_empresa_personal.id_persona= ta_mantic_personas.id_persona
where
  tc_keet_contratos.id_empresa in ({sucursales})
  and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 6)
  and {condicion}
group by
  tc_keet_contratos_lotes.id_contrato_lote	
order by
	tc_keet_contratos.clave desc, 
	tc_keet_contratos_lotes.orden	        
      </select>  
      <select id="lotes">
select 
	tc_keet_contratos_lotes.id_contrato_lote as id_key,
	tc_keet_contratos.clave as clave_contrato, 
	tc_keet_contratos.nombre as nombre_contrato, 
	tc_keet_contratos.etapa as etapa_contrato,
	concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
	tc_keet_prototipos.nombre as prototipo,
	tc_keet_contratos_lotes.*,
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo
from 
	tc_keet_contratos
inner join 
	tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
	tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
where
  tc_keet_contratos.id_empresa in ({sucursales})
  and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 6)
  and {condicion}
group by
  tc_keet_contratos_lotes.id_contrato_lote	
order by
	tc_keet_contratos.clave desc, 
	tc_keet_contratos_lotes.orden				
      </select>
      <select id="desarrollos">
select
  tc_keet_procesos.id_proceso as id_key,
  tc_keet_procesos.*
from
  tc_keet_paquetes
inner join
  tc_keet_procesos on tc_keet_paquetes.id_proceso= tc_keet_procesos.id_proceso
where                        
  tc_keet_paquetes.id_desarrollo= {idDesarrollo}
group by 
  tc_keet_procesos.id_proceso
order by  
  tc_keet_procesos.nombre        
      </select>  
      <select id="procesos">
select
  tc_keet_procesos.id_proceso as id_key,
  tc_keet_procesos.*
from
  tc_keet_paquetes
inner join
  tc_keet_procesos on tc_keet_paquetes.id_proceso= tc_keet_procesos.id_proceso
where                        
  tc_keet_paquetes.id_desarrollo= {idDesarrollo}
  and tc_keet_paquetes.id_prototipo= {idPrototipo}
group by 
  tc_keet_procesos.id_proceso
order by  
  tc_keet_procesos.nombre
      </select>
      <select id="paquetes">
select
  tc_keet_entregas.id_entrega as id_key,
  tc_keet_entregas.id_entrega,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
  tc_keet_procesos.id_proceso,
  tc_keet_procesos.nombre as proceso,
  tc_keet_sub_procesos.id_sub_proceso,
  tc_keet_sub_procesos.nombre as paquete,
  tc_keet_entregas.consecutivo,
  tc_keet_entregas.id_autoriza,
  tc_keet_entregas.id_recibe,
  tc_keet_entregas.id_completo,
  tc_keet_entregas.id_usuario,
  tc_keet_entregas.registro,
  concat(tt_mantic_personas.nombres,' ', ifnull(tt_mantic_personas.paterno, ''),' ', ifnull(tt_mantic_personas.materno, '')) as autorizo,
  concat(ta_mantic_personas.nombres,' ', ifnull(ta_mantic_personas.paterno, ''),' ', ifnull(ta_mantic_personas.materno, '')) as recibio,
  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario,
  datediff(now(), tc_keet_entregas.registro) as dias      
from
 tc_keet_entregas
inner join
  tc_keet_contratos_lotes on tc_keet_entregas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
left join
  tc_keet_paquetes on tc_keet_entregas.id_paquete= tc_keet_paquetes.id_paquete
left join
  tc_keet_procesos on tc_keet_paquetes.id_proceso= tc_keet_procesos.id_proceso
left join
  tc_keet_sub_procesos on tc_keet_paquetes.id_sub_proceso= tc_keet_sub_procesos.id_sub_proceso 
inner join
  tr_mantic_empresa_personal on tc_keet_entregas.id_autoriza= tr_mantic_empresa_personal.id_empresa_persona
inner join
  tr_mantic_empresa_personal as tt_mantic_empresa_personal on tc_keet_entregas.id_recibe= tt_mantic_empresa_personal.id_empresa_persona
inner join
  tc_janal_usuarios on tc_keet_entregas.id_usuario= tc_janal_usuarios.id_usuario
inner join
	tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
inner join
	tc_mantic_personas as tt_mantic_personas on tr_mantic_empresa_personal.id_persona= tt_mantic_personas.id_persona
inner join
	tc_mantic_personas as ta_mantic_personas on tt_mantic_empresa_personal.id_persona= ta_mantic_personas.id_persona
where                    
  tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
  and tc_keet_entregas.id_paquete {condicion}
group by 
  tc_keet_contratos_lotes.id_contrato_lote,
  tc_keet_entregas.id_entrega
order by  
  tc_keet_entregas.consecutivo desc        
      </select>
      <select id="detalle">
select
  tc_keet_entregas_detalles.id_entrega_detalle as id_key,
  tc_keet_entregas_detalles.cantidad as cantidades,
  tc_keet_entregas_detalles.total as totales,        
  tc_keet_entregas_detalles.*
from        
  tc_keet_entregas
inner join              
  tc_keet_entregas_detalles on tc_keet_entregas.id_entrega= tc_keet_entregas_detalles.id_entrega
where
  tc_keet_entregas_detalles.id_entrega= {idEntrega}
{sortOrder}        
      </select>
      <select id="igual">
select      
  truncate(rand()*(-10000-1)+1, 0) as id_key,
  tc_keet_paquetes.id_paquete,
  0 as cuantos,
  -1 as id_entrega,
  tc_keet_paquetes_detalles.id_articulo,
	tc_keet_paquetes_detalles.codigo,
	tc_keet_paquetes_detalles.nombre,
	tc_keet_paquetes_detalles.cantidad,
  2 as id_completo,
  tc_keet_paquetes_detalles.cantidad as total,
  -1 as id_recibe 
from         
  tc_keet_paquetes
inner join
  tc_keet_paquetes_detalles on tc_keet_paquetes.id_paquete= tc_keet_paquetes_detalles.id_paquete
where 
  tc_keet_paquetes.id_desarrollo= {idDesarrollo}
  and tc_keet_paquetes.id_prototipo= {idPrototipo}
  and tc_keet_paquetes.id_proceso= {idProceso}
  and tc_keet_paquetes.id_sub_proceso= {idSubProceso}
order by
  tc_keet_paquetes_detalles.id_paquete_detalle
      </select>
    </unit>  
		<unit id="VistaPaquetesDto">
      <select id="lazy">
select
  tc_keet_paquetes.id_paquete as id_key,
  tc_keet_paquetes.id_paquete,
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_prototipos.id_prototipo,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_procesos.id_proceso,  
  tc_keet_procesos.nombre as proceso,
  tc_keet_sub_procesos.id_sub_proceso,  
  tc_keet_sub_procesos.nombre as sub_proceso,
  count(tc_keet_paquetes_detalles.id_paquete_detalle) as total,
  tc_keet_paquetes.registro
from      
  tc_keet_paquetes
inner join
  tc_keet_desarrollos on  tc_keet_paquetes.id_desarrollo = tc_keet_desarrollos.id_desarrollo
inner join
  tc_keet_prototipos on tc_keet_paquetes.id_prototipo= tc_keet_prototipos.id_prototipo  
inner join
  tc_keet_procesos on tc_keet_paquetes.id_proceso= tc_keet_procesos.id_proceso  
left join  
 tc_keet_paquetes_detalles on tc_keet_paquetes.id_paquete= tc_keet_paquetes_detalles.id_paquete
inner join
  tc_keet_sub_procesos on tc_keet_paquetes.id_sub_proceso= tc_keet_sub_procesos.id_sub_proceso
where
  {condicion}        
group by 
  tc_keet_paquetes.id_paquete
{sortOrder}        
      </select>
      <select id="prototipos">
select
  tc_keet_prototipos.id_prototipo as id_key,
  tc_keet_prototipos.id_prototipo,
  tc_keet_prototipos.clave,
  tc_keet_prototipos.nombre
from
  tc_keet_prototipos
inner join
 tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
inner join
 tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
where
  tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
group by
  tc_keet_prototipos.id_prototipo
order by  
  tc_keet_prototipos.nombre       
      </select>
      <select id="modelos">
select
  tc_keet_prototipos.id_prototipo as id_key,
  tc_keet_proyectos.id_desarrollo,
  tc_keet_prototipos.id_prototipo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_prototipos.clave,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_paquetes.id_paquete
from
  tc_keet_prototipos
inner join
 tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
inner join
 tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
left join
 tc_keet_paquetes on tc_keet_desarrollos.id_desarrollo= tc_keet_paquetes.id_desarrollo and tc_keet_prototipos.id_prototipo= tc_keet_paquetes.id_prototipo
where
  tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
  and (tc_keet_paquetes.id_paquete is null or tc_keet_paquetes.id_sub_proceso!= {idSubProceso})
group by
  tc_keet_prototipos.id_prototipo
order by  
  tc_keet_prototipos.nombre       
      </select>
      <select id="desarrollos">
select      
  tc_keet_desarrollos.id_desarrollo id_key,
  tc_keet_desarrollos.*
from      
  tc_keet_desarrollos
inner join
  tc_keet_contratos_personal on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
where 
  tc_keet_contratos_personal.id_empresa_persona= {idEmpresaPersona}  
  or {idEmpresaPersona}= -1
group by
  tc_keet_desarrollos.id_desarrollo
order by        
  tc_keet_desarrollos.nombres
        </select>      
    </unit>  
		<unit id="VistaContratosMaterialesDto">
      <select id="lazy">
select
  tc_keet_contratos_materiales.id_contrato_material as id_key,
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave as clave_contrato,
  tc_keet_contratos.nombre as contrato,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_contratos_materiales.codigo,
  tc_keet_contratos_materiales.nombre,
  tc_keet_contratos_materiales.cantidad,
  tc_keet_contratos_materiales.precio_unitario,
  tc_keet_contratos_materiales.expansion,
  tc_keet_contratos_materiales.registro
from
  tc_keet_contratos_materiales
inner join
  tc_keet_contratos on tc_keet_contratos_materiales.id_contrato= tc_keet_contratos.id_contrato
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_keet_prototipos on tc_keet_contratos_materiales.id_prototipo = tc_keet_prototipos.id_prototipo
where
  {condicion}
{sortOrder} 
      </select>
      <select id="codigos">
select        
 tc_keet_ordenes_codigos.id_orden_codigo as id_key,
 tc_keet_ordenes_codigos.id_orden_codigo,
 tc_keet_ordenes_codigos.id_orden_compra,
 tc_mantic_empresas.nombre as empresa,
 tc_keet_ordenes_codigos.codigo,
 tc_keet_ordenes_codigos.utilizado,
 tc_mantic_ordenes_compras.consecutivo,
 concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
from
  tc_keet_ordenes_codigos
left join
  tc_mantic_ordenes_compras on tc_keet_ordenes_codigos.id_orden_compra= tc_mantic_ordenes_compras.id_orden_compra
left join
  tc_mantic_empresas on tc_mantic_ordenes_compras.id_empresa= tc_mantic_empresas.id_empresa
left join
  tc_janal_usuarios on tc_keet_ordenes_codigos.id_usuario = tc_janal_usuarios.id_usuario
left join
	tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
where
  {condicion}
{sortOrder} 
      </select>
      <select id="row">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_empresas.nombre as empresa,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_proyectos.id_desarrollo,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.no_viviendas
from 
  tc_keet_contratos
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa = tc_mantic_empresas.id_empresa
where
  tc_keet_contratos.id_contrato_estatus&lt; 8
  and tc_keet_contratos.id_empresa= {idEmpresa}
  and tc_keet_desarrollos.id_internos= 2
order by 
  tc_keet_contratos.id_empresa,
  tc_keet_desarrollos.id_desarrollo, 
  tc_keet_contratos.id_contrato
      </select>  
      <select id="prototipos">
select
 tc_keet_contratos.id_contrato,
 tc_keet_contratos_lotes.id_prototipo,
 tc_keet_prototipos.nombre as prototipo,
 count(*) as cantidad
from 
 tc_keet_contratos
inner join
 tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join
 tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
where
 tc_keet_contratos.id_contrato= {idContrato}
group by 
 tc_keet_contratos.id_contrato,
 tc_keet_contratos_lotes.id_prototipo
order by
 tc_keet_prototipos.nombre        
      </select> 
      <select id="general"> 
select
 tt_keet_contratos_lotes.id_articulo as id_key,
 tc_keet_contratos.id_contrato,
 tc_keet_contratos.nombre as contrato,
 tc_keet_contratos.clave,
 ifnull(tt_keet_ordenes_materiales.id_orden_compra, -1) as id_orden_compra,
 sum(tt_keet_contratos_lotes.factor) as factor,
 tt_keet_contratos_lotes.id_articulo,
 tt_keet_contratos_lotes.codigo,
 tt_keet_contratos_lotes.nombre,
 sum(tt_keet_contratos_lotes.cantidad) as cantidad,
 sum(tt_keet_contratos_lotes.cuantos) as cuantos,
 tt_keet_contratos_lotes.precio_unitario,
 tt_keet_contratos_lotes.costo,
 ifnull(tt_keet_ordenes_materiales.cantidad, 0) as comprados,
 sum(tt_keet_contratos_lotes.cantidad)- ifnull(tt_keet_ordenes_materiales.cantidad, 0) as diferencia,
 0 as total
from 
 tc_keet_contratos
inner join (
 select
   tc_keet_contratos_lotes.id_contrato,
   tc_keet_contratos_lotes.id_prototipo,
   count(tc_keet_contratos_lotes.id_prototipo) as factor,
   tc_keet_contratos_materiales.id_articulo,
   tc_keet_contratos_materiales.codigo,
   tc_keet_contratos_materiales.nombre,
   sum(tc_keet_contratos_materiales.cantidad) as cantidad,
   sum(tc_keet_contratos_materiales.cantidad) as cuantos,
   tc_keet_contratos_materiales.precio_unitario,
   tc_keet_contratos_materiales.precio_unitario as costo
 from
   tc_keet_contratos_lotes
 inner join
   tc_keet_contratos_materiales on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos_materiales.id_contrato and tc_keet_contratos_lotes.id_prototipo= tc_keet_contratos_materiales.id_prototipo
 where
   tc_keet_contratos_lotes.id_contrato= {idContrato}
   and tc_keet_contratos_materiales.id_articulo in ({articulos})     
 group by
   tc_keet_contratos_lotes.id_prototipo,
   tc_keet_contratos_materiales.id_articulo
) as tt_keet_contratos_lotes on tc_keet_contratos.id_contrato= tt_keet_contratos_lotes.id_contrato
inner join
 tc_keet_prototipos on tt_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
left join (
 select
   tc_keet_contratos_lotes.id_contrato,
   tc_keet_ordenes_materiales.id_orden_compra,     
   tc_keet_ordenes_materiales.id_articulo,
   sum(tc_keet_ordenes_materiales.cantidad) as cantidad
 from
   tc_keet_ordenes_materiales
 inner join
   tc_keet_contratos_lotes on tc_keet_ordenes_materiales.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
 where   
   tc_keet_contratos_lotes.id_contrato= {idContrato}
   and tc_keet_ordenes_materiales.id_articulo in ({articulos})
 group by
   tc_keet_ordenes_materiales.id_articulo
) as tt_keet_ordenes_materiales on tt_keet_contratos_lotes.id_contrato= tt_keet_ordenes_materiales.id_contrato and tt_keet_contratos_lotes.id_articulo= tt_keet_ordenes_materiales.id_articulo
where
 tc_keet_contratos.id_contrato= {idContrato}
 and tt_keet_contratos_lotes.id_articulo in ({articulos})
 and {condicion}
group by
 tt_keet_contratos_lotes.id_articulo
order by 
 tt_keet_contratos_lotes.nombre
      </select> 
      <select id="individual"> 
select
 tt_keet_contratos_lotes.id_articulo as id_key,
 tc_keet_contratos.id_contrato,
 tc_keet_contratos.nombre as contrato,
 tc_keet_contratos.clave,
 ifnull(tt_keet_ordenes_materiales.id_orden_compra, -1) as id_orden_compra,
 tt_keet_contratos_lotes.id_prototipo,
 tc_keet_prototipos.nombre as prototipo,        
 tt_keet_contratos_lotes.id_contrato_lote,
 concat('M', tt_keet_contratos_lotes.manzana, 'L', tt_keet_contratos_lotes.lote) as lote,        
 sum(tt_keet_contratos_lotes.factor) as factor,
 tt_keet_contratos_lotes.id_articulo,
 tt_keet_contratos_lotes.codigo,
 tt_keet_contratos_lotes.nombre,
 sum(tt_keet_contratos_lotes.cantidad) as cantidad,
 sum(tt_keet_contratos_lotes.cuantos) as cuantos,
 tt_keet_contratos_lotes.precio_unitario,
 tt_keet_contratos_lotes.costo,
 ifnull(tt_keet_ordenes_materiales.cantidad, 0) as comprados,
 sum(tt_keet_contratos_lotes.cantidad)- ifnull(tt_keet_ordenes_materiales.cantidad, 0) as diferencia,
 0 as total
from 
 tc_keet_contratos
inner join (
 select
   tc_keet_contratos_lotes.id_contrato,
   tc_keet_contratos_lotes.id_prototipo,
   tc_keet_contratos_lotes.id_contrato_lote,
   count(tc_keet_contratos_lotes.id_prototipo) as factor,
   tc_keet_contratos_materiales.id_articulo,
   tc_keet_contratos_materiales.codigo,
   tc_keet_contratos_materiales.nombre,
   sum(tc_keet_contratos_materiales.cantidad) as cantidad,
   sum(tc_keet_contratos_materiales.cantidad) as cuantos,
   tc_keet_contratos_materiales.precio_unitario,
   tc_keet_contratos_materiales.precio_unitario as costo,
   tc_keet_contratos_lotes.manzana,
   tc_keet_contratos_lotes.lote
 from
   tc_keet_contratos_lotes
 inner join
   tc_keet_contratos_materiales on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos_materiales.id_contrato and tc_keet_contratos_lotes.id_prototipo= tc_keet_contratos_materiales.id_prototipo
 where
   tc_keet_contratos_lotes.id_contrato= {idContrato}
   and tc_keet_contratos_materiales.id_articulo in ({articulos})             
 group by
   tc_keet_contratos_lotes.id_contrato_lote,
   tc_keet_contratos_materiales.id_articulo
) as tt_keet_contratos_lotes on tc_keet_contratos.id_contrato= tt_keet_contratos_lotes.id_contrato
inner join
 tc_keet_prototipos on tt_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
left join (
 select
   tc_keet_contratos_lotes.id_contrato,
   tc_keet_ordenes_materiales.id_orden_compra,
   tc_keet_ordenes_materiales.id_contrato_lote,
   tc_keet_ordenes_materiales.id_articulo,
   sum(tc_keet_ordenes_materiales.cantidad) as cantidad
 from
   tc_keet_ordenes_materiales
 inner join
   tc_keet_contratos_lotes on tc_keet_ordenes_materiales.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
 where   
   tc_keet_contratos_lotes.id_contrato= {idContrato}
   and tc_keet_ordenes_materiales.id_articulo in ({articulos})     
 group by
   tc_keet_contratos_lotes.id_contrato_lote,
   tc_keet_ordenes_materiales.id_articulo
) as tt_keet_ordenes_materiales on tt_keet_contratos_lotes.id_contrato= tt_keet_ordenes_materiales.id_contrato and tt_keet_contratos_lotes.id_contrato_lote= tt_keet_ordenes_materiales.id_contrato_lote and tt_keet_contratos_lotes.id_articulo= tt_keet_ordenes_materiales.id_articulo
where
 tc_keet_contratos.id_contrato= {idContrato}
 and tt_keet_contratos_lotes.id_articulo in ({articulos})        
 and {condicion}
group by
 tt_keet_contratos_lotes.id_contrato_lote,        
 tt_keet_contratos_lotes.id_articulo
order by 
 tt_keet_contratos_lotes.nombre,
 concat('M', tt_keet_contratos_lotes.manzana, 'L', tt_keet_contratos_lotes.lote)        
      </select> 
      <select id="contratos">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_empresas.nombre as empresa,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_proyectos.id_desarrollo,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.no_viviendas
from 
  tc_keet_contratos
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa = tc_mantic_empresas.id_empresa
inner join		
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join (
  select
    tc_keet_contratos_lotes_proveedores.id_contrato_lote
  from          
    tc_keet_contratos_lotes_proveedores    
  inner join
    tc_keet_contratos_destajos_proveedores on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor and tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina}
  group by
    tc_keet_contratos_lotes_proveedores.id_contrato_lote
  union all  
  select
    tc_keet_contratos_lotes_contratistas.id_contrato_lote
  from          
    tc_keet_contratos_lotes_contratistas    
  inner join
    tc_keet_contratos_destajos_contratistas on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista= tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista and tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}
  group by
    tc_keet_contratos_lotes_contratistas.id_contrato_lote
) tt_keet_destajos_desarrollos on tc_keet_contratos_lotes.id_contrato_lote= tt_keet_destajos_desarrollos.id_contrato_lote
where
  tc_keet_contratos.id_empresa= {idEmpresa}
  and tc_keet_desarrollos.id_internos= 2
group by 
  tc_keet_contratos.id_empresa,
  tc_keet_desarrollos.id_desarrollo, 
  tc_keet_contratos.id_contrato
order by 
  tc_keet_contratos.id_empresa,
  tc_keet_desarrollos.id_desarrollo, 
  tc_keet_contratos.id_contrato
      </select>  
      <select id="destajos">
select
  id_key,
  id_desarrollo,
  id_contrato,
  semana,
  sum(importe) as importe
from (			
  select 
    tc_keet_contratos_lotes.id_contrato as id_key, 
    tc_keet_proyectos.id_desarrollo,
    tc_keet_contratos_lotes.id_contrato,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt;10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
    sum(tc_keet_contratos_destajos_proveedores.costo) as importe
  from
    tc_keet_contratos_destajos_proveedores 
  inner join
    tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor     
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
  inner join
    tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
  inner join
    tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina     
  inner join
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
  where 
    tc_keet_nominas.id_nomina= {idNomina} 
    and tc_keet_proyectos.id_empresa= {idEmpresa}
    and tc_keet_desarrollos.id_internos= 2
  group by
    tc_keet_proyectos.id_empresa, 
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato
  union all
  select 
    tc_keet_contratos_lotes.id_contrato as id_key, 
    tc_keet_proyectos.id_desarrollo,
    tc_keet_contratos_lotes.id_contrato,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt;10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
    sum(tc_keet_contratos_destajos_contratistas .costo) as importe
  from
    tc_keet_contratos_destajos_contratistas  
  inner join
    tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
  inner join
    tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
  inner join
    tc_keet_nominas on tc_keet_contratos_destajos_contratistas .id_nomina= tc_keet_nominas.id_nomina     
  inner join
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
  where 
    tc_keet_nominas.id_nomina= {idNomina} 
    and tc_keet_proyectos.id_empresa= {idEmpresa}
    and tc_keet_desarrollos.id_internos= 2
  group by
    tc_keet_proyectos.id_empresa, 
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato
) as tt_temporal
group by
   id_desarrollo,
   id_contrato      
order by
   id_desarrollo,
   id_contrato
      </select>  
      <select id="personalPorDiaObra">  
select
  id_key,
  id_desarrollo,
  desarrollo,
  nomina,
  sum(por_dia) as por_dia,
  sum(por_obra) as por_obra     
from (      
  select
    tc_keet_desarrollos.id_desarrollo as id_key,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    if(tc_keet_nominas_periodos.ejercicio is null,'1900-1',concat(tc_keet_nominas_periodos.ejercicio,'-', if(tc_keet_nominas_periodos.orden&lt; 9, concat('0', tc_keet_nominas_periodos.orden), tc_keet_nominas_periodos.orden))) as nomina,
    if(position(concat('|',tr_mantic_empresa_personal.id_puesto,'|') in '{puestosPorDia}')&gt; 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0) as por_dia,
    if(position(concat('|',tr_mantic_empresa_personal.id_puesto,'|') in '{puestosPorObra}')&gt; 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto,0) as por_obra         
  from
    tc_keet_nominas_desarrollos         
  inner join
    tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
  inner join  
    tc_keet_nominas on tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
  inner join 
    tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
  inner join
    tr_mantic_empresa_personal on tc_keet_nominas_desarrollos.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
  inner join 
    tc_keet_nominas_personas on tc_keet_nominas_desarrollos.id_nomina= tc_keet_nominas_personas.id_nomina and tc_keet_nominas_desarrollos.id_empresa_persona= tc_keet_nominas_personas.id_empresa_persona
  inner join 
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
  where
    tc_keet_nominas.id_empresa= {idEmpresa}
    and tc_keet_nominas.id_nomina in ({idNomina})
    and tr_mantic_empresa_personal.id_contratista is null
    and tc_mantic_personas.id_tipo_persona!= 1
    and tr_mantic_empresa_personal.id_puesto in ({personal})
    and tc_keet_nominas_personas.neto&gt; 0
  group by
    tc_keet_desarrollos.id_desarrollo
) as tt_keet_salarios
group by
  id_desarrollo          
order by
  id_desarrollo
      </select>  
    </unit>  
		<unit id="VistaCostosContratosDto">
      <select id="lazy">
        select
          tc_keet_contratos.id_contrato as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
          tc_keet_contratos.etapa,
          tc_keet_nominas_contratos_costos.porcentaje_dia,
          tc_keet_nominas_contratos_costos.porcentaje_obra,
          sum(tc_keet_nominas_contratos_costos.por_dia) as por_dia,
          sum(tc_keet_nominas_contratos_costos.por_obra) as por_obra,
          sum(tc_keet_nominas_contratos_costos.total) as total,
          tc_keet_contratos.por_el_dia,
          (tc_keet_contratos.por_el_dia- sum(tc_keet_nominas_contratos_costos.total)) as diferencia,        
          ifnull((tc_keet_contratos.por_el_dia- sum(tc_keet_nominas_contratos_costos.total)), 0) as costos        
        from
          tc_keet_nominas_contratos_costos
        inner join
          tc_keet_contratos on tc_keet_nominas_contratos_costos.id_contrato= tc_keet_contratos.id_contrato    
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        where
          {condicion}
        group by
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_contratos.id_contrato
        {sortOrder}
      </select>
      <select id="desarrollos">
        select
          tc_keet_nominas_desarrollos.id_nomina_desarrollo as id_key,
          tc_keet_nominas.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden) as semana,
          tc_keet_nominas_desarrollos.id_desarrollo,
          tc_keet_desarrollos.nombres as desarrollo,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorDia}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as por_dia,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorDia}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as por_dia_costo,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorObra}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as por_obra,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorObra}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as por_obra_costo,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorDia}{puestosPorObra}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as total,
          sum(if(position(concat('|', tr_mantic_empresa_personal.id_puesto, '|') in '{puestosPorDia}{puestosPorObra}')> 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0)) as total_costo
        from
          tc_keet_nominas_desarrollos
        inner join  
          tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join  
          tc_keet_nominas on tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
        inner join 
          tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
        inner join
          tr_mantic_empresa_personal on tc_keet_nominas_desarrollos.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
        inner join 
          tc_keet_nominas_personas on tc_keet_nominas_desarrollos.id_nomina= tc_keet_nominas_personas.id_nomina and tc_keet_nominas_desarrollos.id_empresa_persona= tc_keet_nominas_personas.id_empresa_persona
        inner join 
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        where
          tc_keet_nominas.id_nomina= {idNomina}
          and tr_mantic_empresa_personal.id_contratista is null
          and tc_mantic_personas.id_tipo_persona!= 1        
        group by
          tc_keet_nominas_desarrollos.id_desarrollo
        {sortOrder}
      </select>  
      <select id="contratos">  
        select
          ifnull(tc_keet_nominas_contratos_costos.id_nomina_contrato_costo, -1) as id_key,
          ifnull(tc_keet_nominas_contratos_costos.id_nomina_contrato_costo, -1) as id_nomina_contrato_costo,
          tc_keet_contratos.id_contrato,
          tc_keet_desarrollos.id_desarrollo,
          ifnull(concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden), '{semana}') as semana,
          ifnull(tt_keet_desarrollos_contratos.id_nomina, -1) as id_nomina,        
          ifnull(tt_keet_desarrollos_contratos.id_nomina, -1) as nomina,        
					tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_contratos.clave,
				  tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  ifnull(tc_keet_nominas_contratos_costos.porcentaje_dia, 0) as porcentaje_dia,
				  ifnull(tc_keet_nominas_contratos_costos.por_dia, 0) as por_dia,
				  ifnull(tc_keet_nominas_contratos_costos.porcentaje_obra, 0) as porcentaje_obra,
				  ifnull(tc_keet_nominas_contratos_costos.por_obra, 0) as por_obra,
 				  ifnull(tc_keet_nominas_contratos_costos.total, 0) as total,
				  ifnull(tc_keet_nominas_contratos_costos.id_usuario, -1) as id_usuario,
				  ifnull(tc_keet_nominas_contratos_costos.registro, now()) as registro
        from 
          tc_keet_contratos 
        left join (
					select
            tc_keet_contratos_destajos_contratistas.id_nomina,
            tc_keet_contratos_lotes.id_contrato
          from
            tc_keet_contratos_destajos_contratistas
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
          inner join
						tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          where
            tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}
          group by
					  tc_keet_contratos_destajos_contratistas.id_nomina,
            tc_keet_contratos_lotes.id_contrato                 
          union all
					select
					  tc_keet_contratos_destajos_proveedores.id_nomina,
            tc_keet_contratos_lotes.id_contrato
          from
            tc_keet_contratos_destajos_proveedores
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
          inner join
					  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          where
            tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina}
          group by
    				tc_keet_contratos_destajos_proveedores.id_nomina,
            tc_keet_contratos_lotes.id_contrato          
        ) as tt_keet_desarrollos_contratos on tc_keet_contratos.id_contrato= tt_keet_desarrollos_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
			  inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				left join
				  tc_keet_nominas_contratos_costos on tc_keet_contratos.id_contrato= tc_keet_nominas_contratos_costos.id_contrato and tc_keet_nominas_contratos_costos.id_nomina= {idNomina}
        left join  
          tc_keet_nominas on tt_keet_desarrollos_contratos.id_nomina= tc_keet_nominas.id_nomina
        left join 
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        where
          tc_keet_contratos.id_contrato_estatus&lt;= 8
        group by
  				tt_keet_desarrollos_contratos.id_nomina,
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_contratos.id_contrato          
        order by  
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_contratos.id_contrato           
      </select>  
    </unit>  
		<unit id="VistaEstimacionesDto">
      <select id="lazy">
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_keet_estimaciones.id_estimacion,
          tc_keet_estimaciones.id_empresa,
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_mantic_clientes.id_cliente,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
          tc_keet_contratos.etapa,
          tc_keet_estimaciones.consecutivo,
          tc_keet_estimaciones.folio,
          tc_keet_estimaciones.importe as total,
          tc_keet_estimaciones.saldo,
          tc_keet_estimaciones_estatus.id_estimacion_estatus,
          tc_mantic_empresas.nombre as empresa,
          tc_mantic_clientes.razon_social,
          tc_keet_estimaciones_estatus.nombre as estatus,
          tc_keet_estimaciones_estatus.estatus_asociados,
          tc_keet_estimaciones.registro,
          tc_keet_estimaciones.id_venta
        from
          tc_keet_estimaciones
        inner join
          tc_mantic_empresas on tc_keet_estimaciones.id_empresa= tc_mantic_empresas.id_empresa
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
          tc_mantic_clientes on tc_keet_proyectos.id_cliente= tc_mantic_clientes.id_cliente
        inner join
          tc_keet_estimaciones_estatus on tc_keet_estimaciones.id_estimacion_estatus= tc_keet_estimaciones_estatus.id_estimacion_estatus
        where
          tc_mantic_empresas.id_empresa in ({idEmpresa})
				  and {condicion}
        {sortOrder}
      </select>
      <select id="anticipo">
        select
          sum(tc_keet_estimaciones_detalles.importe) as total
        from
          tc_keet_estimaciones_detalles
        inner join
          tc_keet_estimaciones on tc_keet_estimaciones_detalles.id_estimacion= tc_keet_estimaciones.id_estimacion
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        where
          tc_keet_contratos.id_contrato= {idContrato}
          and tc_keet_estimaciones.id_estimacion!= {idEstimacion}
          and tc_keet_estimaciones_detalles.id_tipo_retencion= 1
        group by
          tc_keet_contratos.id_contrato
      </select>
      <select id="clientes">
        select
          tc_mantic_clientes.id_cliente as id_key,
          tc_keet_proyectos.id_cliente,
          tc_mantic_clientes.razon_social,
          count(*) as contratos,
          sum(tc_keet_contratos.costo) as total,
          sum(tc_keet_contratos.anticipo) as anticipo,
          ifnull(tt_keet_estimaciones.importe, 0) as estimaciones,
          abs(sum(tc_keet_contratos.costo)- ifnull(tt_keet_estimaciones.importe, 0)) as saldo,
          ifnull(tt_keet_retenciones.amortizacion, 0) as amortizacion,
          ifnull(tt_keet_retenciones.fondo_garantia, 0) as fondo_garantia,
          ifnull(tt_keet_retenciones.retenciones, 0) as retenciones
        from
          tc_mantic_clientes         
        inner join
          tc_keet_proyectos on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente         
        inner join
          tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto         
        inner join 
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        left join (
          select
            tc_mantic_clientes.id_cliente,    
            sum(tc_keet_estimaciones.importe) as importe,
            sum(tc_keet_estimaciones.saldo) as saldo
         from    
           tc_keet_estimaciones 
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        group by
           tc_mantic_clientes.id_cliente
        ) as tt_keet_estimaciones on tc_mantic_clientes.id_cliente= tt_keet_estimaciones.id_cliente
        left join (
        select
          tc_mantic_clientes.id_cliente,    
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as amortizacion,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
        from    
          tc_keet_estimaciones 
        inner join
          tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        group by
           tc_mantic_clientes.id_cliente
        ) tt_keet_retenciones on tc_mantic_clientes.id_cliente= tt_keet_retenciones.id_cliente
        where
          tc_keet_contratos.id_empresa in ({idEmpresa})
          and {condicion}
        group by
          tc_keet_proyectos.id_cliente        
      </select>
      <select id="contratos">
        select
          tc_keet_contratos.id_contrato as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_proyectos.id_cliente,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos.id_contrato_estatus,
          sum(tc_keet_contratos.costo) as total,
          sum(tc_keet_contratos.anticipo) as anticipo,
          ifnull(tt_keet_estimaciones.importe, 0) as estimaciones,
          abs(sum(tc_keet_contratos.costo)- ifnull(tt_keet_estimaciones.importe, 0)) as saldo,
          ifnull(tt_keet_retenciones.amortizacion, 0) as amortizacion,
          ifnull(tt_keet_retenciones.fondo_garantia, 0) as fondo_garantia,
          ifnull(tt_keet_retenciones.retenciones, 0) as retenciones,
          tc_keet_contratos.registro
        from
          tc_keet_contratos
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        inner join 
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        left join (
          select
            tc_keet_contratos.id_contrato,    
            sum(tc_keet_estimaciones.importe) as importe,
            sum(tc_keet_estimaciones.saldo) as saldo
         from    
           tc_keet_estimaciones 
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        where
          tc_mantic_clientes.id_cliente= {idCliente}
        group by
           tc_keet_contratos.id_contrato
        ) as tt_keet_estimaciones on tc_keet_contratos.id_contrato= tt_keet_estimaciones.id_contrato
        left join (
        select
          tc_keet_contratos.id_contrato,    
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as amortizacion,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
        from    
          tc_keet_estimaciones 
        inner join
          tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        where
          tc_mantic_clientes.id_cliente= {idCliente}
        group by
           tc_keet_contratos.id_contrato
        ) tt_keet_retenciones on tc_keet_contratos.id_contrato= tt_keet_retenciones.id_contrato
        where
          tc_keet_contratos.id_empresa in ({idEmpresa})
          and tc_mantic_clientes.id_cliente= {idCliente}
          and {condicion}
        group by
         tc_keet_contratos.id_contrato,
         tc_mantic_clientes.id_cliente
        {sortOrder}     
      </select>
      <select id="estimacion">
			  select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_keet_estimaciones.id_estimacion,
          tc_keet_proyectos.id_cliente,
          tc_keet_estimaciones.consecutivo,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
          concat(tc_keet_series.clave, tc_mantic_facturas.folio) as folio,
          tc_mantic_ventas.total as factura,
          tc_keet_estimaciones.facturar,
          sum(tc_keet_estimaciones.importe) as total,
          sum(tc_keet_estimaciones.saldo) as saldo,
          ifnull(tt_keet_retenciones.amortizacion, 0) as amortizacion,
          ifnull(tt_keet_retenciones.fondo_garantia, 0) as fondo_garantia,
          ifnull(tt_keet_retenciones.retenciones, 0) as retenciones,
          tc_keet_estimaciones.id_estimacion_estatus
        from
          tc_keet_estimaciones
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        left join
          tc_mantic_ventas on tc_keet_estimaciones.id_venta= tc_mantic_ventas.id_venta
        left join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        left join
          tc_keet_series on tc_mantic_facturas.id_serie= tc_keet_series.id_serie
        left join (
          select
            tc_keet_estimaciones.id_estimacion, 
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as amortizacion,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
          from    
            tc_keet_estimaciones 
          inner join
            tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
          where
            tc_keet_estimaciones.id_contrato= {idContrato}
          group by
            tc_keet_estimaciones.id_estimacion
         ) tt_keet_retenciones on tc_keet_estimaciones.id_estimacion= tt_keet_retenciones.id_estimacion
         where
           tc_keet_estimaciones.id_empresa in ({idEmpresa})
           and tc_keet_estimaciones.id_contrato= {idContrato}
         group by
           tc_keet_estimaciones.registro desc        
      </select>
      <select id="saldos">
			  select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_mantic_clientes.id_cliente,
          tc_mantic_clientes.razon_social,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.nombre as contrato,
          tc_keet_contratos.costo,
          tc_keet_contratos.anticipo,
          tc_keet_contratos.fondo_garantia as fondo,
          tc_keet_estimaciones.id_estimacion,
          tc_keet_estimaciones.consecutivo,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
          concat(tc_keet_series.clave, tc_mantic_facturas.folio) as folio,
          tc_mantic_ventas.total as factura,
          tc_keet_estimaciones.facturar,
          sum(tc_keet_estimaciones.importe) as estimado,
          sum(tc_keet_estimaciones.saldo) as saldo,
          ifnull(tt_keet_retenciones.amortizacion, 0) as amortizacion,
          ifnull(tt_keet_retenciones.fondo_garantia, 0) as fondo_garantia,
          ifnull(tt_keet_retenciones.retenciones, 0) as retenciones,
          tc_keet_estimaciones.id_estimacion_estatus
        from
          tc_keet_estimaciones
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_mantic_clientes on tc_keet_proyectos.id_cliente = tc_mantic_clientes.id_cliente
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        left join
          tc_mantic_ventas on tc_keet_estimaciones.id_venta= tc_mantic_ventas.id_venta
        left join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        left join
          tc_keet_series on tc_mantic_facturas.id_serie= tc_keet_series.id_serie
        left join (
          select
            tc_keet_estimaciones.id_estimacion,    
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as amortizacion,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
          from    
            tc_keet_estimaciones 
          inner join
            tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
          group by
            tc_keet_estimaciones.id_estimacion
        ) tt_keet_retenciones on tc_keet_estimaciones.id_estimacion= tt_keet_retenciones.id_estimacion
        where
          tc_keet_estimaciones.id_empresa in ({idEmpresa})
          and {condicion}
        group by
          tc_mantic_clientes.id_cliente,
          tc_keet_contratos.id_contrato,
          tc_keet_estimaciones.id_estimacion
        {sortOrder}        
      </select>
      <select id="garantias">
        select
          tc_keet_contratos.id_contrato as id_key, 
          tc_keet_contratos.id_contrato, 
          tc_keet_desarrollos.nombres as desarrollo,
          tc_keet_contratos.clave, 
          tc_keet_contratos.nombre, 
          tc_keet_contratos.etapa,
          tc_keet_contratos.fondo_garantia,
          tc_keet_contratos.inicio,
          tc_keet_contratos.termino,
          tc_keet_contratos.vence
        from
          tc_keet_contratos
        inner join 
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        left join
          tc_keet_contratos_vecimientos on tc_keet_contratos.id_contrato= tc_keet_contratos_vecimientos.id_contrato
        where
          date_format(tc_keet_contratos.vence, '%Y%m%d')&lt;= '{fecha}'
          and tc_keet_contratos_vecimientos.id_contrato_vencimiento is null
        order by
          tc_keet_contratos.registro desc
      </select>
      <select id="semana">
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_keet_estimaciones.id_estimacion,
          tc_keet_estimaciones.importe,
          tc_keet_estimaciones.facturar,
          (tc_keet_estimaciones.importe- sum(tc_keet_estimaciones_detalles.importe)) as estimado,
          concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as semana,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
          if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.porcentaje, 0) as porcentaje_anticipo,
          if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.porcentaje, 0) as porcentaje_fondo,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as anticipo,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
          sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
        from
          tc_keet_estimaciones
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        inner join
          tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
        inner join (
          select
            max(tc_keet_estimaciones.id_estimacion) as id_estimacion
          from
            tc_keet_estimaciones
          where
            tc_keet_estimaciones.id_contrato= {idContrato}
        ) as tt_keet_periodos on tc_keet_estimaciones.id_estimacion= tt_keet_periodos.id_estimacion
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
        group by
          tc_keet_estimaciones.id_estimacion
        order by
          tc_keet_nominas_periodos.id_nomina_periodo desc
      </select>  
      <select id="semanas">  
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_keet_estimaciones.id_estimacion,
          concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as semana,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
          tc_keet_estimaciones.importe as estimado,
          tc_keet_estimaciones.facturar as facturado,
          sum(tc_mantic_clientes_deudas.importe- tc_mantic_clientes_deudas.saldo) as pagado
        from
          tc_keet_estimaciones
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        left join
          tc_mantic_clientes_deudas on tc_keet_estimaciones.id_venta= tc_mantic_clientes_deudas.id_venta
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
        group by
          tc_keet_estimaciones.id_estimacion
        order by
          tc_keet_nominas_periodos.id_nomina_periodo desc        
      </select>  
      <select id="acumulado">  
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          tc_keet_estimaciones.id_estimacion,
          tc_keet_estimaciones.id_contrato,
          tc_keet_contratos.costo,
          sum(tc_keet_estimaciones.importe) as estimado,
          (tc_keet_contratos.costo- sum(tc_keet_estimaciones.importe)- ifnull(tt_keet_retenciones.anticipo, 0)- ifnull(tt_keet_retenciones.fondo_garantia, 0)) as por_estimar,
          round(sum(tc_keet_estimaciones.importe)* 100/ tc_keet_contratos.costo, 2) as porcentaje_estimado,
          sum(tc_keet_estimaciones.facturar) as facturado,
          ifnull(tt_keet_retenciones.anticipo, 0) as anticipo,
          (tc_keet_contratos.anticipo- ifnull(tt_keet_retenciones.anticipo, 0)) as por_anticipo,
          round(ifnull(ifnull(tt_keet_retenciones.anticipo, 0)* 100/ tc_keet_contratos.anticipo, 2), 0) as porcentaje_anticipado,
          ifnull(tt_keet_retenciones.fondo_garantia, 0) as fondo_garantia,
          (tc_keet_contratos.fondo_garantia- ifnull(tt_keet_retenciones.fondo_garantia, 0)) as por_fondo,
          round(ifnull(ifnull(tt_keet_retenciones.fondo_garantia, 0)* 100/ tc_keet_contratos.fondo_garantia, 2), 0) as porcentaje_fondeado,
          ifnull(tt_keet_retenciones.retenciones, 0) as retenciones,
          sum(ifnull(tc_mantic_clientes_deudas.importe, 0)- ifnull(tc_mantic_clientes_deudas.saldo, 0)) as pagado
        from
          tc_keet_estimaciones
        inner join
          tc_keet_contratos on tc_keet_estimaciones.id_contrato= tc_keet_contratos.id_contrato
        inner join (
					select
            tc_keet_estimaciones.id_contrato, 
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 1, tc_keet_estimaciones_detalles.importe, 0)) as anticipo,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion= 2, tc_keet_estimaciones_detalles.importe, 0)) as fondo_garantia,
            sum(if(tc_keet_estimaciones_detalles.id_tipo_retencion!= 1 and tc_keet_estimaciones_detalles.id_tipo_retencion!= 2, tc_keet_estimaciones_detalles.importe, 0)) as retenciones 
          from    
            tc_keet_estimaciones 
          inner join
            tc_keet_estimaciones_detalles on tc_keet_estimaciones.id_estimacion= tc_keet_estimaciones_detalles.id_estimacion
          where
            tc_keet_estimaciones.id_contrato= {idContrato}
          group by
            tc_keet_estimaciones.id_contrato
         ) tt_keet_retenciones on tc_keet_estimaciones.id_contrato= tt_keet_retenciones.id_contrato 
        left join
          tc_mantic_clientes_deudas on tc_keet_estimaciones.id_venta= tc_mantic_clientes_deudas.id_venta
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
        group by
          tc_keet_estimaciones.id_contrato
        order by
          tc_keet_estimaciones.registro         
      </select>  
      <select id="pagado">  
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          'FACTURADO' as category,
          concat(tc_keet_nominas_periodos.orden, '-', tc_keet_nominas_periodos.ejercicio) as serie,
          tc_keet_estimaciones.facturar as value
        from
          tc_keet_estimaciones
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
        union all  
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          'PAGADO' as category,
          concat(tc_keet_nominas_periodos.orden, '-', tc_keet_nominas_periodos.ejercicio) as serie,
          (tc_mantic_clientes_deudas.importe- tc_mantic_clientes_deudas.saldo) as value
        from
          tc_keet_estimaciones
        inner join
          tc_keet_nominas on tc_keet_estimaciones.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        left join
          tc_mantic_clientes_deudas on tc_keet_estimaciones.id_venta= tc_mantic_clientes_deudas.id_venta
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
        order by
          category,
          serie        
      </select>  
      <select id="vencido">  
        select
          tc_keet_estimaciones.id_estimacion as id_key,
          sum(tc_mantic_clientes_deudas.saldo) as vencido
        from
          tc_keet_estimaciones
        left join
          tc_mantic_ventas on tc_keet_estimaciones.id_venta= tc_mantic_ventas.id_venta
        left join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        left join
          tc_mantic_clientes_deudas on tc_keet_estimaciones.id_venta= tc_mantic_clientes_deudas.id_venta
        where  
          tc_keet_estimaciones.id_contrato= {idContrato}
          and (datediff(now(), tc_mantic_facturas.timbrado)+ 1)&gt; 11        
          and tc_mantic_clientes_deudas.saldo&gt; 0
      </select>  
			<select id="importados">
select
  tc_keet_estimaciones_archivos.id_estimacion_archivo as id_key,
  tc_keet_estimaciones_archivos.id_estimacion,
  tc_keet_estimaciones_archivos.id_tipo_archivo,
  tc_mantic_tipos_archivos.nombre as tipo,
  tc_keet_estimaciones_archivos.nombre,
  tc_keet_estimaciones_archivos.alias,
  tc_keet_estimaciones_archivos.ruta,
  tc_keet_estimaciones_archivos.id_principal,
  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as usuario,
  tc_keet_estimaciones_archivos.observaciones,
  tc_keet_estimaciones_archivos.registro
from
  tc_keet_estimaciones_archivos
inner join
  tc_mantic_tipos_archivos on tc_keet_estimaciones_archivos.id_tipo_archivo= tc_mantic_tipos_archivos.id_tipo_archivo
inner join
  tc_janal_usuarios on tc_keet_estimaciones_archivos.id_usuario= tc_janal_usuarios.id_usuario          
inner join
  tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
where
  tc_keet_estimaciones_archivos.id_estimacion= {idEstimacion}
order by
  tc_keet_estimaciones_archivos.id_tipo_archivo, tc_keet_estimaciones_archivos.registro desc			
      </select>
		</unit>
		<unit id="VistaAnticiposPagosDto">
			<select id="lazy">
				select
					tc_keet_anticipos_pagos.id_anticipo_pago as id_key,
				  tc_keet_anticipos.consecutivo as prestamo,
					tc_keet_anticipos_pagos.consecutivo,
					tc_keet_anticipos_pagos.pago,
					tc_keet_anticipos_pagos.abono,
					tc_keet_anticipos_pagos.abono as abonos,
					tc_keet_anticipos_pagos.cambio,
				  tc_keet_anticipos.saldo,
					tc_keet_anticipos_pagos.observaciones,
					tc_keet_anticipos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
				from
					tc_keet_anticipos_pagos
				inner join 
				  tc_keet_anticipos on tc_keet_anticipos_pagos.id_anticipo= tc_keet_anticipos.id_anticipo
				inner join 
					tc_janal_usuarios on tc_keet_anticipos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_anticipos_pagos.id_anticipo= {idAnticipo}
				{sortOrder}
			</select>
			<select id="persona">
				select
					tc_keet_anticipos_pagos.id_anticipo_pago as id_key,
				  tc_keet_anticipos.consecutivo as prestamo,
					tc_keet_anticipos_pagos.consecutivo,
					tc_keet_anticipos_pagos.pago,
					tc_keet_anticipos_pagos.abono,
					tc_keet_anticipos_pagos.abono as abonos,
					tc_keet_anticipos_pagos.cambio,
				  tc_keet_anticipos.saldo,
					tc_keet_anticipos_pagos.observaciones,
					tc_keet_anticipos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
				from
					tc_keet_anticipos_pagos
				inner join 
				  tc_keet_anticipos on tc_keet_anticipos_pagos.id_anticipo= tc_keet_anticipos.id_anticipo
				inner join 
					tc_janal_usuarios on tc_keet_anticipos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_anticipos.id_moroso= {idMoroso}
				{sortOrder}	
			</select>
		</unit>	    
		<unit id="VistaAnticiposDto">
			<select id="lazy">
				select
					tc_keet_anticipos.id_anticipo as id_key,
				  tc_keet_anticipos.id_moroso,
					tc_keet_anticipos.consecutivo as folio,
					tc_keet_anticipos.importe,
					tc_keet_anticipos.fondo_garantia,
					tc_keet_anticipos.subtotal,
					tc_keet_anticipos.iva,
					tc_keet_anticipos.total,
					tc_keet_anticipos.saldo,
					tc_keet_morosos.saldo as saldo_total,
					tc_keet_morosos.limite,
					tc_keet_morosos.disponible,
					tc_mantic_proveedores.razon_social as deudor,
					ifnull(tc_keet_anticipos_pagos.numero_pagos, 0) as numero_pagos,
          tc_keet_anticipos.semanas,
					tc_keet_anticipos_estatus.nombre as estatus,
          tc_keet_anticipos.id_afecta_nomina,
				  tc_keet_anticipos_estatus.id_anticipo_estatus,
          sum(if(tc_keet_anticipos_lotes.id_pagado= 1, 1, 0)) as pagados
				from
				  tc_keet_anticipos
				inner join 
				  tc_keet_morosos on tc_keet_anticipos.id_moroso= tc_keet_morosos.id_moroso
				inner join 
				  tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
				left join 
				  (select count(*) numero_pagos, id_anticipo from tc_keet_anticipos_pagos group by id_anticipo) tc_keet_anticipos_pagos on tc_keet_anticipos.id_anticipo= tc_keet_anticipos_pagos.id_anticipo
				inner join 
				  tc_keet_anticipos_estatus on tc_keet_anticipos.id_anticipo_estatus= tc_keet_anticipos_estatus.id_anticipo_estatus
				left join
				  tc_keet_anticipos_lotes on tc_keet_anticipos.id_anticipo= tc_keet_anticipos_lotes.id_anticipo
				where
				  {condicion}	
				group by
				  tc_keet_anticipos.id_anticipo
        {sortOrder}	
			</select>
			<select id="byIdAnticipo">
				select 
				  tc_keet_anticipos.id_anticipo as id_key,
          tc_keet_anticipos.importe as prestamo,
          tc_keet_anticipos.consecutivo,
          tc_keet_anticipos.saldo,
          ifnull(tc_keet_anticipos_pagos.numero_pagos, 0) as pagos,
				  tc_keet_morosos.limite,
				  tc_mantic_proveedores.razon_social as empleado,
				  tc_keet_morosos.disponible,
				  date(tc_mantic_proveedores.registro) as ingreso,
				  1 as numero_prestamos,
				  tc_keet_morosos.id_proveedor
				from
				  tc_keet_anticipos
        inner join 
				  tc_keet_morosos on tc_keet_morosos.id_moroso= tc_keet_anticipos.id_moroso
        inner join 
				  tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
        left join 
				  (select count(*) numero_pagos, id_anticipo from tc_keet_anticipos_pagos group by id_anticipo) tc_keet_anticipos_pagos on tc_keet_anticipos.id_anticipo= tc_keet_anticipos_pagos.id_anticipo
				where
				  tc_keet_anticipos.id_anticipo= {idAnticipo}
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_morosos.id_moroso as id_key,
          tc_mantic_proveedores.id_proveedor,
          -1 as id_departamento,
          tc_mantic_proveedores.razon_social as empleado,
          tc_keet_anticipos.consecutivo,
          sum(tc_keet_anticipos.importe) as prestamo,
          tc_keet_morosos.saldo,
          sum(ifnull(tc_keet_anticipos_pagos.numero_pagos, 0)) as pagos,
				  count(*) as numero_prestamos
				from
				  tc_keet_anticipos
        inner join 
				  tc_keet_morosos on tc_keet_morosos.id_moroso= tc_keet_anticipos.id_moroso
        inner join 
				  tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
        left join 
				  (select count(*) numero_pagos, id_anticipo from tc_keet_anticipos_pagos group by id_anticipo) tc_keet_anticipos_pagos on tc_keet_anticipos.id_anticipo= tc_keet_anticipos_pagos.id_anticipo
        where
          tc_keet_anticipos.id_anticipo_estatus in (1,2)
          and tc_keet_morosos.id_moroso= {idMoroso}
        group by
          tc_keet_morosos.id_moroso,
          tc_mantic_proveedores.razon_social,
          tc_keet_morosos.saldo		
			</select>      
    </unit>      
		<unit id="VistaMorososDto">
			<select id="byEmpresa">
				select 
				  tc_keet_morosos.id_moroso id_key,
				  tc_mantic_proveedores.razon_social as deudor,
				  tc_keet_deudores.disponible
				from
				  tc_keet_morosos
        inner join 
				  tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_proveedores.id_empresa in ({sucursales})
			</select>      
			<select id="complete">
				select 
				  tc_keet_morosos.id_moroso as id_key,
				  tc_mantic_proveedores.razon_social as deudor,
				  tc_keet_morosos.disponible
				from
				  tc_keet_morosos
        inner join 
				  tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_proveedores.id_empresa in ({sucursales})
				  and tc_mantic_proveedores.id_activo= 1 
				  and tc_mantic_proveedores.id_subcontratista= 1
				  and (tc_mantic_proveedores.razon_social regexp '{deudor}.*'
				  or tc_mantic_proveedores.rfc regexp '{deudor}.*'
          or tc_mantic_proveedores.nombre_comercial regexp '{deudor}.*')
			</select>      
			<select id="byIdDeudor">
				select 
				  tc_keet_morosos.id_moroso id_key,
          tc_mantic_proveedores.id_proveedor,
          group_concat(distinct tc_keet_proveedores_departamentos.id_departamento separator ', ') as id_departamento, 
				  tc_keet_morosos.limite,
				  tc_mantic_proveedores.razon_social as deudor,
				  tc_keet_morosos.disponible,
				  date(tc_mantic_proveedores.registro) as ingreso
				from
				  tc_keet_morosos
				inner join 
          tc_mantic_proveedores on tc_keet_morosos.id_proveedor= tc_mantic_proveedores.id_proveedor
				left join 
          tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
				where
				  tc_keet_morosos.id_moroso= {idMoroso}
        group by
          tc_keet_morosos.id_proveedor 
			</select>      
    </unit>  
		<unit id="VistaAnticiposDto">
			<select id="importados">
				select
					tc_keet_anticipos_archivos.id_anticipo_archivo as id_key,
					tc_keet_anticipos_archivos.nombre,
					tc_keet_anticipos_archivos.archivo,
					tc_keet_anticipos_archivos.ruta,
					tc_keet_anticipos_archivos.alias,
					tc_keet_anticipos_archivos.observaciones,
					tc_keet_anticipos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario,
          tc_keet_anticipos_pagos.consecutivo,
          tc_keet_anticipos_pagos.abono
				from
					tc_keet_anticipos_archivos
				inner join
          tc_keet_anticipos_pagos on tc_keet_anticipos_pagos.id_anticipo_pago= tc_keet_anticipos_archivos.id_anticipo_pago
				inner join 
					tc_janal_usuarios on tc_keet_anticipos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_anticipos_pagos.id_anticipo= {idAnticipo}
        order by
          tc_keet_anticipos_pagos.registro, 
					tc_keet_anticipos_archivos.registro
			</select>      
			<select id="pagos">
				select 
					tc_keet_incidentes.id_incidente as id_key,
          tc_keet_incidentes.* 
        from
          tc_keet_incidentes
        inner join
          tc_keet_anticipos on tc_keet_incidentes.id_anticipo= tc_keet_anticipos.id_anticipo  
        where
          tc_keet_incidentes.id_anticipo= {idAnticipo}
          and {condicion}
        order by
          tc_keet_incidentes.orden
      </select>  
			<select id="principal">
				select 
					tc_keet_incidentes.id_incidente as id_key,
					tc_keet_incidentes.consecutivo,
					tc_keet_incidentes.id_proveedor, 
					tc_keet_incidentes.id_tipo_incidente, 
					tc_keet_incidentes.inicio,
					tc_keet_incidentes.termino,
					tc_keet_incidentes.ejercicio,
					tc_keet_incidentes.orden,
					tc_keet_incidentes.id_incidente_estatus,
					tc_keet_incidentes.observaciones,
					tc_keet_incidentes.id_usuario,
					tc_keet_incidentes.registro,	
					tc_mantic_proveedores.razon_social as nombre,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_usuario,
					tc_mantic_tipos_incidentes.nombre as tipo_incidente,
					tc_keet_incidentes_estatus.nombre as estatus,
					tc_keet_incidentes_estatus.estatus_asociados,
				  tc_keet_desarrollos.id_desarrollo,
					tc_keet_desarrollos.clave as clave_desarrollo,
					tc_keet_desarrollos.nombres as nombre_desarrollo,
					tc_keet_desarrollos.descripcion as descripcion_desarrollo
				from 
					tc_keet_incidentes				
				inner join
					tc_mantic_proveedores on tc_keet_incidentes.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tc_mantic_tipos_incidentes on tc_keet_incidentes.id_tipo_incidente = tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tc_keet_incidentes_estatus on tc_keet_incidentes_estatus.id_incidente_estatus = tc_keet_incidentes.id_incidente_estatus
				inner join 
					tc_janal_usuarios on tc_keet_incidentes.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_mantic_personas.id_persona = tc_mantic_personas.id_persona
				left join 
					tc_keet_desarrollos on tc_keet_incidentes.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where 
					{condicion}
				  and tc_mantic_proveedores.id_empresa in ({idEmpresa})
				{sortOrder}				
			</select>      
    </unit>  
		<unit id="VistaSeguimientoDto">
      <select id="unico">
select
  tc_keet_contratos_lotes.id_contrato_lote as id_key,
  tc_keet_contratos_lotes.id_contrato_lote,
  tc_keet_contratos_lotes.inicio,
  tc_keet_contratos_lotes.termino,
  tc_keet_contratos_lotes.dias_construccion,
  tc_keet_contratos.id_empresa,
  tc_keet_contratos.ejercicio,
  tc_keet_contratos.orden,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre,
  tc_keet_contratos.orden as contrato,
  tc_keet_contratos.nombre as serie,
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos_lotes.manzana,
  tc_keet_contratos_lotes.lote,
  tc_keet_contratos_lotes.latitud,
  tc_keet_contratos_lotes.longitud,
  tc_keet_contratos_lotes.orden as secuencia,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as codigo,
  tc_keet_prototipos.nombre as prototipo
from
  tc_keet_contratos
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
where
  tc_keet_desarrollos.id_desarrollo= '{idDesarrollo}'
  and tc_keet_contratos_lotes.manzana= '{manzana}'
  and tc_keet_contratos_lotes.lote= '{lote}'
group by 
  tc_keet_contratos.id_contrato
      </select>
      <select id="cuadras">
select
  (cast(rand()* 60 as unsigned) + 1) as id_key,
  manzana
from (
  select
    distinct(tc_keet_contratos_lotes.manzana) as manzana
  from
    tc_keet_contratos
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
  where
    tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
    and tc_keet_contratos.id_contrato_estatus&lt; 10
    and tc_keet_contratos_lotes.manzana!= '0'
  group by
    tc_keet_contratos_lotes.manzana
  order by   
    tc_keet_contratos_lotes.manzana
) as tt_keet_manzanas             
      </select>
      <select id="casas">
select
  (cast(rand()* 60 as unsigned) + 1) as id_key,
  lote
from (
  select
    distinct(tc_keet_contratos_lotes.lote) as lote
  from
    tc_keet_contratos
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
  where
    tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
    and tc_keet_contratos_lotes.manzana= {manzana}
    and tc_keet_contratos.id_contrato_estatus&lt; 10
    and tc_keet_contratos_lotes.lote!= '0'
  group by
    tc_keet_contratos_lotes.lote
  order by   
    tc_keet_contratos_lotes.lote
) as tt_keet_lotes    
      </select>
			<select id="pagado">
				select
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as serie,
					sum(round(tc_keet_contratos_destajos_contratistas.costo, 2)) as value
				from
					tc_keet_contratos_destajos_contratistas
				inner join
					tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
		    inner join
		      tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
		    inner join
		      tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
		    inner join
		      tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
		    inner join
		      tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
          tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden)= '{nomina}'
          and tc_keet_desarrollos.descripcion= '{sueldos}' 
          and tr_mantic_empresa_personal.id_puesto= 6
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tc_keet_contratos_lotes_contratistas.id_empresa_persona
        order by
          tc_mantic_personas.paterno, tc_mantic_personas.materno, tc_mantic_personas.nombres
      </select>  
			<select id="personalDepartamento">
				select
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.contratacion as fecha,
					tr_mantic_empresa_personal.sueldo_semanal as importe
				from
					tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
          and tc_keet_departamentos.nombre = '{departamento}'
        group by 
          tr_mantic_empresa_personal.id_empresa_persona
        order by 
          tc_keet_departamentos.nombre
      </select>  
			<select id="personalDestajos">
				select
				  tc_keet_nominas_detalles.id_nomina_detalle as id_key,
					tc_keet_nominas_conceptos.id_tipo_concepto,
					tc_keet_nominas_detalles.nombre,
					round(tc_keet_nominas_detalles.valor, 2) as importe,
				  tc_keet_nominas_detalles.fecha
				from
					tc_keet_nominas_detalles
				inner join
					tc_keet_nominas_personas on tc_keet_nominas_detalles.id_nomina_persona = tc_keet_nominas_personas.id_nomina_persona
				inner join
          tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_nominas on tc_keet_nominas_personas.id_nomina= tc_keet_nominas.id_nomina
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join
					tc_keet_nominas_conceptos on tc_keet_nominas_detalles.id_nomina_concepto = tc_keet_nominas_conceptos.id_nomina_concepto
				inner join
					tc_keet_tipos_conceptos on tc_keet_nominas_conceptos.id_tipo_concepto = tc_keet_tipos_conceptos.id_tipo_concepto
				where
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden)= '{nomina}'
          and concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, ''))= '{destajos}'
          and tc_keet_nominas_detalles.valor!= 0
      </select>  
			<select id="personalContratista">
        select  
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as contratista,
				  concat(tt_mantic_personas.nombres, ' ', ifnull(tt_mantic_personas.paterno, ''), ' ', ifnull(tt_mantic_personas.materno, '')) as nombre,
				  ifnull(tt_mantic_empresa_personal.contratacion, tt_mantic_empresa_personal.ingreso) as fecha
        from  
          tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tr_mantic_empresa_personal as tt_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tt_mantic_empresa_personal.id_contratista and tt_mantic_empresa_personal.id_empresa= 1 and tt_mantic_empresa_personal.id_activo= 1
				inner join
					tc_mantic_personas as tt_mantic_personas on tt_mantic_empresa_personal.id_persona= tt_mantic_personas.id_persona and tt_mantic_personas.id_tipo_persona!= 1
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_puesto= 6
          and tr_mantic_empresa_personal.id_activo= 1
          and tt_mantic_empresa_personal.id_seguro= 2
          and concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, ''))= '{contratista}'
        order by
          tc_mantic_personas.curp, tt_mantic_personas.curp
      </select>  
			<select id="personalDesarrollo">
				select
					if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as desarrollo, 
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre,
          ifnull(tr_mantic_empresa_personal.contratacion, tr_mantic_empresa_personal.ingreso) as fecha
				from
					tr_mantic_empresa_personal
				left join
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				left join
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
          and tr_mantic_empresa_personal.id_seguro= 2
          and ((tc_keet_desarrollos.descripcion is null and 'SIN DESARROLLO'= '{desarrollo}') or tc_keet_desarrollos.descripcion= '{desarrollo}')
        order by
          tc_keet_desarrollos.descripcion, tc_mantic_personas.curp        
      </select>  
			<select id="nombresDesarrollos">
        select
          ifnull(tc_keet_desarrollos.id_desarrollo, 0) as id_key,
          if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as nombre, 
          count(*) as empleados,
          tc_keet_desarrollos.clave
        from
          tr_mantic_empresa_personal
        left join
          tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
        inner join
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        left join
          tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
          {condicion}
        group by
          tc_keet_desarrollos.descripcion
      </select>  
			<select id="nombresContratistas">
        select  
          tr_mantic_empresa_personal.id_empresa_persona as id_key,
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre,
				  count(*) as empleados
        from  
          tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tr_mantic_empresa_personal as tt_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tt_mantic_empresa_personal.id_contratista and tt_mantic_empresa_personal.id_empresa= 1 and tt_mantic_empresa_personal.id_activo= 1
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_puesto= 6
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tr_mantic_empresa_personal.id_empresa_persona             
      </select>  
			<select id="departamento">
				select
				  upper(tc_keet_departamentos.nombre) as serie,
					count(*) as value
				from
					tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tc_keet_departamentos.nombre
        order by 
          tc_keet_departamentos.nombre        
      </select>  
			<select id="destajos">
        select
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as category,
          concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as serie,
          round(sum(tc_keet_nominas_personas.neto), 2) as value
        from
          tc_keet_nominas_personas
        inner join
          tc_keet_nominas on tc_keet_nominas_personas.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        inner join
          tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
        inner join
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        where 
          tc_keet_nominas_personas.id_nomina in ({nominas})
          and tr_mantic_empresa_personal.id_puesto= 6
          and {condicion}
        group by
          tc_keet_nominas_periodos.id_nomina_periodo, tc_keet_nominas_personas.id_empresa_persona
        order by  
          tc_keet_nominas_periodos.id_nomina_periodo desc        
      </select>  
			<select id="sueldos">
        select
         concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as category,
         if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as serie, 
         round(sum(tc_keet_nominas_personas.neto), 2) as value
        from
          tc_keet_nominas_personas
        inner join
          tc_keet_nominas on tc_keet_nominas_personas.id_nomina= tc_keet_nominas.id_nomina
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        left join
          tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tc_keet_nominas_personas.id_empresa_persona
        left join
          tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        where 
          tc_keet_nominas_personas.id_nomina in ({nominas})
          and {condicion}
        group by
          tc_keet_nominas_periodos.id_nomina_periodo, tc_keet_desarrollos.id_desarrollo
        order by  
          tc_keet_nominas_periodos.id_nomina_periodo desc        
      </select>  
			<select id="empleadores">
        select  
				  if(tt_mantic_empresa_personal.id_seguro= 1, 'CON SEGURO', 'SIN SEGURO') as category,
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as serie,
				  count(*) as value
        from  
          tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tr_mantic_empresa_personal as tt_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tt_mantic_empresa_personal.id_contratista and tt_mantic_empresa_personal.id_empresa= 1 and tt_mantic_empresa_personal.id_activo= 1
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_puesto= 6
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tt_mantic_empresa_personal.id_seguro, tr_mantic_empresa_personal.id_empresa_persona        
			</select>
			<select id="movimientos">
        select
          if(tc_mantic_incidentes.id_tipo_incidente= 10 or tc_mantic_incidentes.id_tipo_incidente= 12, 'ALTA', 'BAJA') as serie,
          count(*) as value
        from
          tc_mantic_incidentes
        inner join 
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_mantic_incidentes.id_empresa_persona
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tc_mantic_incidentes.id_tipo_incidente in (10, 11, 12)
          and date_format(tc_mantic_incidentes.inicio, '%Y%m%d')&gt;= '{inicio}'
          and date_format(tc_mantic_incidentes.inicio, '%Y%m%d')&lt;= '{termino}' 
        group by
          serie
      </select>  
			<select id="desarrollos">
				select
				  if(tr_mantic_empresa_personal.id_seguro= 1, 'CON SEGURO', 'SIN SEGURO') as category,
					if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as serie, 
					count(*) as value
				from
					tr_mantic_empresa_personal
				left join
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				left join
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tr_mantic_empresa_personal.id_seguro, tc_keet_desarrollos.descripcion
      </select>  
			<select id="personal">
        select
          if(tr_mantic_empresa_personal.id_seguro= 1, 'CON SEGURO', 'SIN SEGURO') as serie,
          count(*) as value
        from
          tr_mantic_empresa_personal
        where
          tr_mantic_empresa_personal.id_empresa= 1
          and tr_mantic_empresa_personal.id_activo= 1
        group by
          tr_mantic_empresa_personal.id_seguro        
      </select>  
      
      <select id="rubros">
        select
          tc_keet_rubros.id_rubro,
          tc_keet_rubros.codigo
        from  
          tc_keet_puntos_paquetes     
        inner join
          tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo     
        inner join
          tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo     
        inner join
          tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro     
        where
          tc_keet_puntos_grupos.id_departamento in ({idDepartamento})           
          and tc_keet_puntos_grupos.id_extra= 2     
        group by
          tc_keet_rubros.codigo        
      </select>  
      <select id="contratistas">
        select
          tc_keet_estaciones.id_estacion as id_key,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.id_estacion,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.entrega,
          tc_keet_estaciones.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus,
          tc_keet_estaciones.costo as importe,
          tc_keet_estaciones.anticipo as retencion,
          tc_keet_contratos.id_empresa,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.ejercicio,
          tc_keet_contratos.orden as orden_contrato,
          tc_keet_contratos_lotes.orden,
          tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
          tt_destajo_nomina.id_nomina,
          tt_keet_rubros.id_punto_grupo,
          tt_keet_rubros.descripcion,
          concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden) as semana,
          if(substring(tc_keet_estaciones.codigo, 1, 1)= '#', 4, if(tt_destajo_nomina.id_nomina is null, 3, if(concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden)= '{semana}', 1, 2))) as actual
        from
          tc_keet_estaciones         
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
        inner join
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        inner join (
					select
						tc_keet_rubros.id_rubro,
            tc_keet_puntos_grupos.id_punto_grupo,
						tc_keet_rubros.codigo,
						tc_keet_puntos_grupos.descripcion
					from  
						tc_keet_puntos_paquetes     
					inner join
						tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo     
					inner join
						tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo     
					inner join
						tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro     
					where
						tc_keet_puntos_grupos.id_departamento in ({idDepartamento})           
						and (tc_keet_rubros.nombre like upper('%{nombreConcepto}%') or tc_keet_rubros.codigo like upper('%{nombreConcepto}%'))            
						and tc_keet_puntos_grupos.id_extra= 2     
					group by
						tc_keet_rubros.codigo        
        ) as tt_keet_rubros on tc_keet_estaciones.codigo = tt_keet_rubros.codigo 
        left join (
          select 
            id_estacion,
            max(id_nomina) as id_nomina
          from (   
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_contratistas
            union all  
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_proveedores
           ) as tt_estacion_nomina
           group by
             id_estacion
         ) as tt_destajo_nomina on tc_keet_estaciones.id_estacion= tt_destajo_nomina.id_estacion
        left join
          tc_keet_nominas on tc_keet_nominas.id_nomina= tt_destajo_nomina.id_nomina
        left join 
          tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
        where
          tc_keet_estaciones.clave like '{clave}%'              
          and tc_keet_estaciones.nivel&gt;= 5            
          and tc_keet_estaciones.nivel&lt;= 6         
          and tc_keet_contratos_lotes.entrega is null
          and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idFigura}
          and tc_keet_estaciones.id_estacion_estatus in ({estatus})           
          and tc_keet_estaciones.costo&gt; 0  
          and {condicion}
        group by
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_estaciones.codigo         
        order by
          tc_keet_contratos_lotes.orden,
          tc_keet_estaciones.clave        
      </select>
      <select id="proveedores">
        select
          tc_keet_estaciones.id_estacion as id_key,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.id_estacion,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.entrega,
          tc_keet_estaciones.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus,
          tc_keet_estaciones.costo as importe,
          tc_keet_estaciones.anticipo as retencion,
          tc_keet_contratos.id_empresa,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.ejercicio,
          tc_keet_contratos.orden as orden_contrato,
          tc_keet_contratos_lotes.orden,
          tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor,
          tt_destajo_nomina.id_nomina,
          tt_keet_rubros.id_punto_grupo,
          tt_keet_rubros.descripcion,
          concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden) as semana,
          if(substring(tc_keet_estaciones.codigo, 1, 1)= '#', 4, if(tt_destajo_nomina.id_nomina is null, 3, if(concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden)= '{semana}', 1, 2))) as actual
        from
          tc_keet_estaciones         
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
        inner join
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        inner join (
					select
						tc_keet_rubros.id_rubro,
            tc_keet_puntos_grupos.id_punto_grupo,
						tc_keet_rubros.codigo,
						tc_keet_rubros.descripcion
					from  
						tc_keet_puntos_paquetes     
					inner join
						tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo     
					inner join
						tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo     
					inner join
						tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro     
					where
						tc_keet_puntos_grupos.id_departamento in ({idDepartamento})           
						and (
							tc_keet_rubros.nombre like upper('%{nombreConcepto}%') or tc_keet_rubros.codigo like upper('%{nombreConcepto}%')
						)            
						and tc_keet_puntos_grupos.id_extra= 2     
					group by
						tc_keet_rubros.codigo        
        ) as tt_keet_rubros on tc_keet_estaciones.codigo= tt_keet_rubros.codigo 
        left join (
          select 
            id_estacion,
            max(id_nomina) as id_nomina
          from (   
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_contratistas
            union all  
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_proveedores
           ) tt_estacion_nomina
           group by
             id_estacion
         ) tt_destajo_nomina on tc_keet_estaciones.id_estacion= tt_destajo_nomina.id_estacion
        left join
          tc_keet_nominas on tc_keet_nominas.id_nomina= tt_destajo_nomina.id_nomina
        left join 
          tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
        where
          tc_keet_estaciones.clave like '{clave}%'              
          and tc_keet_estaciones.nivel&gt;= 5            
          and tc_keet_estaciones.nivel&lt;= 6         
          and tc_keet_contratos_lotes.entrega is null
          and tc_keet_contratos_lotes_proveedores.id_proveedor= {idFigura}
          and tc_keet_estaciones.id_estacion_estatus in ({estatus})           
          and tc_keet_estaciones.costo&gt; 0  
          and {condicion}
        group by
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_estaciones.codigo         
        order by
          tc_keet_contratos_lotes.orden,
          tc_keet_estaciones.clave        
      </select>
      <select id="control">
        select
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.entrega,
          tc_keet_estaciones.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus,
          tt_destajo_nomina.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden) as semana,
          if(substring(tc_keet_estaciones.codigo, 1, 1)= '#', 4, if(tt_destajo_nomina.id_nomina is null, 3, if(concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden)= '{semana}', 1, 2))) as actual
        from
          tc_keet_estaciones         
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        inner join
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        left join (
          select 
            id_estacion,
            max(id_nomina) as id_nomina
          from (   
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_contratistas
            union all  
            select
              id_estacion,
              id_nomina
            from                       
              tc_keet_contratos_destajos_proveedores
           ) tt_estacion_nomina
           group by
             id_estacion
         ) tt_destajo_nomina on tc_keet_estaciones.id_estacion= tt_destajo_nomina.id_estacion
        left join
          tc_keet_nominas on tc_keet_nominas.id_nomina= tt_destajo_nomina.id_nomina
        left join 
          tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
        where
          tc_keet_estaciones.clave like '{clave}%'              
          and tc_keet_estaciones.nivel&gt;= 5            
          and tc_keet_estaciones.nivel&lt;= 6         
        group by
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_estaciones.codigo         
        order by
          tc_keet_contratos_lotes.orden,
          tc_keet_estaciones.clave
      </select>  
      <select id="codigos">
        select
         tc_keet_estaciones.id_estacion as id_key,
         min(tc_keet_estaciones.clave) as consecutivo,
         tc_keet_estaciones.codigo,
         tc_keet_estaciones.nombre
        from
          tc_keet_estaciones
        where
         tc_keet_estaciones.clave like '{clave}%'   
         and tc_keet_estaciones.nivel&gt;= 5 
         and tc_keet_estaciones.nivel&lt;= 6
        group by
         tc_keet_estaciones.codigo
        order by
         consecutivo        
      </select>        
      <select id="lotes">
        select
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.entrega,
          tc_keet_estaciones.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus,
          count(*)
        from
          tc_keet_estaciones
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        inner join    
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        where
          tc_keet_estaciones.clave like '{clave}%'   
          and tc_keet_estaciones.nivel&gt;= 5 
          and tc_keet_estaciones.nivel&lt;= 6
        group by
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_estaciones.codigo
        order by
          convert(tc_keet_contratos_lotes.manzana, unsigned integer),
          convert(tc_keet_contratos_lotes.lote, unsigned integer),
          tc_keet_estaciones.clave;
      </select>        
    </unit>  
		<unit id="VistaTableroDto">
      <select id="notificar">
      select
       *
      from
        (select 
            tc_mantic_personas.id_persona as id_key, 
            tc_keet_contratos_lotes_contratistas.id_empresa_persona, 
            1 as id_tipo_figura,
            tc_keet_nominas.id_nomina,
            concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as nomina,
            tc_keet_nominas_periodos.inicio,
            tc_keet_nominas_periodos.termino,
  				  tc_keet_departamentos.nombre as departamento,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_desarrollos.nombres as desarrollo,
            concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as contratista,
            sum(tc_keet_contratos_destajos_contratistas.costo) as total
          from
            tc_keet_contratos_destajos_contratistas 
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
          inner join
            tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
          inner join
            tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
          inner join
            tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          inner join
            tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
          inner join
            tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
          left join
            tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
          left join
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
          where 
            tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
            and tc_keet_nominas.id_nomina= {idNomina}
            and tr_mantic_empresa_personal.id_activo= 1
          group by
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_contratos_lotes_contratistas.id_empresa_persona
          union all
          select 
            tc_keet_contratos_lotes_proveedores.id_proveedor as id_key, 
            tc_keet_contratos_lotes_proveedores.id_proveedor as id_empresa_persona, 
            2 as id_tipo_figura,
            tc_keet_nominas.id_nomina,
            concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as nomina,
            tc_keet_nominas_periodos.inicio,
            tc_keet_nominas_periodos.termino,
  				  tc_keet_departamentos.nombre as departamento,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_mantic_proveedores.razon_social as contratista,
            sum(tc_keet_contratos_destajos_proveedores.costo) as total
          from
            tc_keet_contratos_destajos_proveedores 
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor     
          inner join
            tc_mantic_proveedores on tc_mantic_proveedores.id_proveedor= tc_keet_contratos_lotes_proveedores.id_proveedor
          inner join
            tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
          inner join
            tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
          inner join
            tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion     
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          inner join
            tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
          inner join
            tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_proveedores_departamentos.id_departamento
          left join
            tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina     
          left join
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
          where 
            tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
            and tc_keet_nominas.id_nomina= {idNomina}
            and tc_mantic_proveedores.id_activo= 1
          group by
            tc_keet_desarrollos.id_desarrollo,
            tc_mantic_proveedores.id_proveedor
        ) as principal
      order by
        id_desarrollo,	  
        contratista
      </select>
			<select id="costoPersona">
				select 
				  tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_key, 
          ifnull(concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt;10, '0', ''), tc_keet_nominas_periodos.orden), '{nomina}') as category,
				  {corte} as serie,
				  sum(tc_keet_contratos_destajos_contratistas.costo) as value
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				group by
				  category, serie        
      </select>  
			<select id="costoContratoPersona">
				select 
				  tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_key, 
          tc_keet_contratos.nombre as category,
				  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as serie,
				  sum(tc_keet_contratos_destajos_contratistas.costo) as value
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and tc_keet_contratos.nombre= '{contrato}'
				group by
				  category, serie        
      </select>  
			<select id="costoProveedor">
				select 
				  tc_keet_contratos_lotes_proveedores.id_proveedor as id_key, 
          ifnull(concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt;10, '0', ''), tc_keet_nominas_periodos.orden), '{nomina}') as category,
				  {corte} as serie,
				  sum(tc_keet_contratos_destajos_proveedores.costo) as value
				from
				  tc_keet_contratos_destajos_proveedores 
        inner join
          tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor     
        inner join
          tc_mantic_proveedores on tc_mantic_proveedores.id_proveedor= tc_keet_contratos_lotes_proveedores.id_proveedor
        inner join
          tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_proveedores_departamentos.id_departamento
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				group by
				  category, serie        
      </select>  
			<select id="costoContratoProveedor">
				select 
				  tc_keet_contratos_lotes_proveedores.id_proveedor as id_key, 
          ifnull(concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt;10, '0', ''), tc_keet_nominas_periodos.orden), '{nomina}') as category,
				 tc_mantic_proveedores.razon_social as serie,
				  sum(tc_keet_contratos_destajos_proveedores.costo) as value
				from
				  tc_keet_contratos_destajos_proveedores 
        inner join
          tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor     
        inner join
          tc_mantic_proveedores on tc_mantic_proveedores.id_proveedor= tc_keet_contratos_lotes_proveedores.id_proveedor
        inner join
          tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_proveedores_departamentos.id_departamento
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
          tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and tc_keet_contratos.nombre= '{contrato}'
				group by
				  category, serie        
      </select>  
			<select id="periodo">
				select      
					tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,	
				  if(date_format(tc_keet_contratos_destajos_contratistas.registro, '%H')&gt;= 8 and date_format(tc_keet_contratos_destajos_contratistas.registro, '%H')&lt;= 18, 'NORMAL', 'FUERA') as category,
				  date_format(tc_keet_contratos_destajos_contratistas.registro, '%d/%m/%Y') as serie,
				  count(*) as value
        from      
          tc_keet_contratos_destajos_contratistas
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join  
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join 
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
					tc_janal_usuarios on tc_keet_contratos_destajos_contratistas.id_usuario= tc_janal_usuarios.id_usuario          
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        where 
          tc_keet_desarrollos.nombres= '{desarrollo}'
          and date_format(tc_keet_contratos_destajos_contratistas.registro, '%Y%m%d')&gt;= '{fecha}'
          and tc_mantic_personas.id_persona= {idPersona}
        group by
          category, serie        
      </select>  
			<select id="horarios">			
				select      
					tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,	
				  if(date_format(tc_keet_contratos_destajos_contratistas.registro, '%H')&gt;= 8 and date_format(tc_keet_contratos_destajos_contratistas.registro, '%H')&lt;= 18, 'NORMAL', 'FUERA') as category,
				  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as serie,
				  count(*) as value
        from      
          tc_keet_contratos_destajos_contratistas
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join  
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join 
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        inner join
					tc_janal_usuarios on tc_keet_contratos_destajos_contratistas.id_usuario= tc_janal_usuarios.id_usuario          
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        where 
          tc_keet_desarrollos.nombres= '{desarrollo}'
          and date_format(tc_keet_contratos_destajos_contratistas.registro, '%Y%m%d')= '{fecha}'
          and {condicion}
        group by
          category, serie        
      </select>  
			<select id="residenteDesarrollo">			
				select      
					tc_keet_contratos_personal.id_desarrollo as id_key,									
					tc_keet_contratos_personal.id_desarrollo
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
				  tr_mantic_empresa_personal.id_activo= 1
				  and tc_mantic_puestos.nombre like 'RESIDENTE%'
				  and tc_keet_contratos_personal.id_empresa_persona= {idEmpresaPersona}  
        group by
          tc_keet_contratos_personal.id_desarrollo     
      </select>  	
			<select id="georreferencia">				
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_contratos_lotes.inicio,
          tc_keet_contratos_lotes.termino,
          tc_keet_contratos_lotes.dias_construccion,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.nombre,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos.orden as orden_contrato,
					tc_keet_contratos_lotes.orden,
					tc_keet_contratos_lotes.orden as secuencia,
					tc_keet_contratos_lotes.latitud,
					tc_keet_contratos_lotes.longitud,
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_prototipos.nombre as prototipo
				from 
					tc_keet_contratos_lotes
				inner join 
					tc_keet_contratos on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
				where				  
					tc_keet_desarrollos.nombres= '{desarrollo}' 
          and tc_keet_contratos.nombre= '{contrato}'
				  and tc_keet_contratos_lotes.latitud is not null and tc_keet_contratos_lotes.longitud is not null
          and {condicion}
				order by
				  tc_keet_contratos_lotes.manzana, tc_keet_contratos_lotes.lote
			</select>      
      <select id="contrato">
        select
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_contratos_lotes.inicio,
          tc_keet_contratos_lotes.termino,
          tc_keet_contratos_lotes.dias_construccion,
          tc_keet_contratos.id_empresa,
          tc_keet_contratos.ejercicio,
          tc_keet_contratos.orden,
          tc_keet_contratos.orden as contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos.nombre as serie,
          tc_keet_desarrollos.id_desarrollo,
          tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					tc_keet_contratos_lotes.latitud,
					tc_keet_contratos_lotes.longitud,
          tc_keet_contratos_lotes.orden as secuencia,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as codigo,
          tc_keet_prototipos.nombre as prototipo
        from
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
        where
          tc_keet_desarrollos.nombres= '{desarrollo}'
          and tc_keet_contratos.nombre= '{contrato}'
          and {condicion}
      </select>       
      <select id="detalleLotes">
        select
          tc_keet_estaciones.id_estacion as id_key,
          '{lote}' as lote,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.descripcion,
          tc_keet_estaciones.nivel,
          round(tc_keet_estaciones.costo, 2) as costo,
          round(tc_keet_estaciones.cargo, 2) as cargo,
          round(ifnull(tc_keet_estaciones.cargo* 100/ tc_keet_estaciones.costo, 0), 2) as porcentaje,
          tc_keet_estaciones_estatus.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus,
          if(tc_keet_estaciones.entrega is null, 0, if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, 1, if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 2, 3))) as semaforo,
          if(tc_keet_estaciones.entrega is null, 'NO HA INICIADO', if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, concat('TERMINO ', timestampdiff(day, tc_keet_estaciones.inicio, tc_keet_estaciones.entrega), ' DIAS ANTES'), if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 'TERMINO EN TIEMPO', concat('TERMINO ', timestampdiff(day, tc_keet_estaciones.termino, tc_keet_estaciones.entrega), ' DIAS DESPUÉS')))) as dias
        from 
          tc_keet_estaciones
        inner join
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        where
          tc_keet_estaciones.clave like '{clave}%'
          and tc_keet_estaciones.nivel>= 5
          and tc_keet_estaciones.costo> 0
          and {condicion}
        order by
          tc_keet_estaciones.clave
      </select>  
      <select id="contratos">
        select
          tc_keet_contratos.id_contrato as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.id_empresa,
          tc_keet_contratos.ejercicio,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos.orden
        from
          tc_keet_contratos
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        where
          tc_keet_proyectos.id_desarrollo= {idDesarrollo}
        order by
          tc_keet_contratos.clave desc       
      </select>  
      <select id="unicas">
        select
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos_lotes.manzana
        from
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        where
          tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        group by
          tc_keet_contratos_lotes.manzana
        order by
          tc_keet_contratos_lotes.manzana
      </select>  
      <select id="manzanas">
        select
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos_lotes.manzana
        from
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        where
          tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        group by
          tc_keet_contratos.id_contrato,
          tc_keet_contratos_lotes.manzana
        order by
          tc_keet_contratos.nombre, 
          tc_keet_contratos_lotes.manzana
      </select>  
      <select id="contratados">
select
  tc_keet_contratos_lotes_estatus.nombre as category,
  tc_keet_contratos.nombre as serie,
  count(*) as value,
  tc_keet_contratos.id_empresa,
  tc_keet_contratos.ejercicio,
  tc_keet_contratos.orden,
  tc_keet_contratos.clave,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.id_contrato as id_key
from
  tc_keet_contratos
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join
  tc_keet_contratos_lotes_estatus on tc_keet_contratos_lotes.id_contrato_lote_estatus= tc_keet_contratos_lotes_estatus.id_contrato_lote_estatus
where
  tc_keet_desarrollos.nombres= '{desarrollo}'
  and tc_keet_contratos.nombre not like '%MUESTRA%'
  and tc_keet_contratos.id_contrato_estatus&lt; 10
group by
  category, serie with rollup         
      </select>
      <select id="avance">
select
  tt_keet_estaciones.*,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as serie,
  tc_keet_contratos.nombre
from 
 (select
   tc_keet_estaciones_estatus.nombre as category,
   count(*) as value,
   convert(substring(tc_keet_estaciones.clave, 1, 3), signed) as id_empresa,
   convert(substring(tc_keet_estaciones.clave, 4, 4), signed) as ejercicio,
   convert(substring(tc_keet_estaciones.clave, 8, 3), signed) as contrato,
   convert(substring(tc_keet_estaciones.clave, 11, 3), signed) as lote
  from 
    tc_keet_estaciones
  inner join
    tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
  where
    tc_keet_estaciones.clave like '{clave}%'    
    and tc_keet_estaciones.nivel= 6
  group by
    substring(tc_keet_estaciones.clave, 1, 13), 
    tc_keet_estaciones_estatus.nombre
  ) as tt_keet_estaciones
inner join
  tc_keet_contratos on tt_keet_estaciones.id_empresa= tc_keet_contratos.id_empresa and tt_keet_estaciones.ejercicio= tc_keet_contratos.ejercicio and tt_keet_estaciones.contrato= tc_keet_contratos.orden
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato and tt_keet_estaciones.lote= tc_keet_contratos_lotes.orden
order by
  tt_keet_estaciones.category, serie
      </select> 
    </unit>  
		<unit id="VistaIngresosDto">
      <select id="detalle">
        select
          tc_mantic_ventas.id_venta as id_key,
          tt_mantic_facturas.timbrado as fecha_pago,
          tt_mantic_tipos_monedas.siglas as moneda_pago,
          tc_mantic_ventas.total as monto_pago,
          tt_mantic_facturas.folio as folio_fiscal,
          tt_mantic_facturas.sello_sat,
          ' ' as no_operacion,
          ' ' as rfc_ordenante,
          ' ' as banco_ordenante,
          ' ' as cuenta_ordenante,
          ' ' as rfc_beneficiario,
          ' ' as banco_beneficiario,
          ' ' as cuenta_beneficiario,
          concat(tc_mantic_tipos_medios_pagos.clave, ' ', tc_mantic_tipos_medios_pagos.nombre) as forma_pago, 
          tc_mantic_facturas.folio_fiscal as id_documento,
          tc_keet_series.nombre as serie,
          tc_mantic_facturas.folio,
          tc_mantic_tipos_monedas.siglas as moneda,
          tc_mantic_tipos_pagos.clave as metodo_pago,
          tc_keet_ventas_pagos.parcialidad,
          tc_keet_ventas_pagos.saldo,
          tc_keet_ventas_pagos.pagado,
          tc_keet_ventas_pagos.insoluto,
          tc_mantic_ventas.tipo_de_cambio,
          tc_mantic_ventas.total as total_final,
          tc_keet_ventas_pagos.registro
        from
          tc_mantic_ventas
        inner join
          tc_keet_ventas_pagos on tc_mantic_ventas.id_venta= tc_keet_ventas_pagos.id_venta
        inner join
          tc_mantic_ventas as tt_mantic_ventas on tc_keet_ventas_pagos.id_detalle= tt_mantic_ventas.id_venta
        inner join
          tc_mantic_facturas on tt_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        inner join
          tc_mantic_facturas as tt_mantic_facturas on tc_mantic_ventas.id_factura= tt_mantic_facturas.id_factura
        inner join
          tc_keet_series on tc_keet_series.id_serie= tc_mantic_facturas.id_serie
        inner join
          tc_mantic_tipos_monedas on tt_mantic_ventas.id_tipo_moneda= tc_mantic_tipos_monedas.id_tipo_moneda
        inner join
          tc_mantic_tipos_monedas as tt_mantic_tipos_monedas on tc_mantic_ventas.id_tipo_moneda= tt_mantic_tipos_monedas.id_tipo_moneda
        inner join
          tc_mantic_tipos_pagos on tc_mantic_ventas.id_tipo_pago= tc_mantic_tipos_pagos.id_tipo_pago
        inner join
          tc_mantic_tipos_medios_pagos on tc_mantic_ventas.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
        where
          tc_keet_ventas_pagos.id_venta= {idVenta}
        order by
          tc_keet_ventas_pagos.registro        
      </select>
			<select id="encontrado">
        select
          tc_keet_ventas_pagos.id_venta_pago as id_key,
          tt_mantic_ventas.ticket,
          concat(tt_keet_series.nombre, '-', tt_mantic_facturas.folio) complemento,
          concat(tc_keet_series.nombre, '-', tc_mantic_facturas.folio) factura,
          tc_keet_ventas_pagos.parcialidad,
          tc_keet_ventas_pagos.pagado,
          tc_mantic_facturas.timbrado
        from  
          tc_keet_ventas_pagos
        inner join 
        (select
          tc_keet_ventas_pagos.id_detalle
        from
          tc_keet_ventas_pagos
        inner join
          tc_mantic_ventas on tc_keet_ventas_pagos.id_venta= tc_mantic_ventas.id_venta
        inner join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        where
          tc_mantic_ventas.id_venta= {idVenta}
          and tc_mantic_facturas.id_factura_estatus= 2) 
          as tt_keet_temporales on tc_keet_ventas_pagos.id_detalle= tt_keet_temporales.id_detalle
        inner join
          tc_mantic_ventas on tc_keet_ventas_pagos.id_detalle= tc_mantic_ventas.id_venta
        inner join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        inner join
          tc_keet_series on tc_mantic_facturas.id_serie= tc_keet_series.id_serie
				inner join
					tc_mantic_ventas as tt_mantic_ventas on tc_keet_ventas_pagos.id_venta= tt_mantic_ventas.id_venta         
				inner join
					tc_mantic_facturas as tt_mantic_facturas on tt_mantic_ventas.id_factura= tt_mantic_facturas.id_factura         
				inner join
					tc_keet_series as tt_keet_series on tt_mantic_facturas.id_serie= tt_keet_series.id_serie         
        where
          tc_keet_ventas_pagos.id_venta> {idVenta}
          and tt_mantic_facturas.id_factura_estatus= 2
        order by
          tc_mantic_ventas.ticket, tc_mantic_facturas.folio, tc_mantic_ventas.registro desc
      </select>  
			<select id="existe">
        select
          tc_keet_ventas_pagos.id_venta_pago as id_key,
          tc_mantic_ventas.ticket,
          concat(tc_keet_series.nombre, '-', tc_mantic_facturas.folio) complemento,
          concat(tt_keet_series.nombre, '-', tt_mantic_facturas.folio) factura,
          tc_keet_ventas_pagos.parcialidad,
          tc_keet_ventas_pagos.pagado,
          tc_mantic_facturas.timbrado         
        from
          tc_keet_ventas_pagos         
        inner join
          tc_mantic_ventas on tc_keet_ventas_pagos.id_venta= tc_mantic_ventas.id_venta         
        inner join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura         
        inner join
          tc_keet_series on tc_mantic_facturas.id_serie= tc_keet_series.id_serie         
        inner join
          tc_mantic_ventas as tt_mantic_ventas on tc_keet_ventas_pagos.id_detalle= tt_mantic_ventas.id_venta         
        inner join
          tc_mantic_facturas as tt_mantic_facturas on tt_mantic_ventas.id_factura= tt_mantic_facturas.id_factura         
        inner join
          tc_keet_series as tt_keet_series on tt_mantic_facturas.id_serie= tt_keet_series.id_serie         
        where
          tc_keet_ventas_pagos.id_detalle= {idVenta}
          and tc_mantic_facturas.id_factura_estatus= 2         
        order by
          tc_mantic_ventas.registro desc
      </select>  
			<select id="complemento">
        select 
				  tc_mantic_articulos_codigos.id_articulo_codigo as id_key,
				  tc_mantic_articulos.id_articulo,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and (tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1) and ((upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and (tc_mantic_articulos_codigos.id_proveedor = {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1)) or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  ' ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
					tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  0 as porcentajes,
				  ' ' as archivo,
				  0 as stock,
          0 as cantidad
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa								
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and tc_mantic_articulos.id_articulo_tipo= {idArticuloTipo}
				  and tc_mantic_articulos.id_vigente= 1
				  and upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' 
          and tc_mantic_articulos_codigos.id_proveedor is null
      </select>  
			<select id="documentos">
        select
          tc_mantic_ventas.id_venta as id_key,
          tc_mantic_ventas.id_cliente,
          tc_mantic_facturas.folio_fiscal as id,
          tc_keet_series.nombre as serie,
          tc_mantic_facturas.folio,
          tc_mantic_tipos_pagos.clave as metodo_pago,
          tc_mantic_tipos_monedas.siglas as moneda,
          tc_mantic_ventas.tipo_de_cambio,
          tc_keet_ventas_pagos.id_venta,
          tc_keet_ventas_pagos.id_detalle,
          tc_keet_ventas_pagos.parcialidad,
          tc_mantic_ventas.total as global,
          tc_keet_ventas_pagos.saldo,
          tc_keet_ventas_pagos.pagado,
          tc_keet_ventas_pagos.insoluto,
          tc_keet_ventas_pagos.id_usuario,
          tc_keet_ventas_pagos.registro
        from
          tc_mantic_ventas
        inner join
          tc_keet_ventas_pagos on tc_mantic_ventas.id_venta= tc_keet_ventas_pagos.id_venta
        inner join
          tc_mantic_ventas as tt_mantic_ventas on tc_keet_ventas_pagos.id_detalle= tt_mantic_ventas.id_venta
        inner join
          tc_mantic_facturas on tt_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        inner join
          tc_keet_series on tc_keet_series.id_serie= tc_mantic_facturas.id_serie
        inner join
          tc_mantic_tipos_monedas on tc_mantic_ventas.id_tipo_moneda= tc_mantic_tipos_monedas.id_tipo_moneda
        inner join
          tc_mantic_tipos_pagos on tc_mantic_ventas.id_tipo_pago= tc_mantic_tipos_pagos.id_tipo_pago
        where
          tc_keet_ventas_pagos.id_venta= {idVenta}
      </select>  
			<select id="facturas">
        select
          tc_mantic_ventas.id_venta as id_key,
          tc_mantic_ventas.id_venta as id_detalle,
          tc_mantic_ventas.id_cliente,
          tc_mantic_facturas.folio_fiscal as id,
          tc_keet_series.nombre as serie,
          tc_mantic_facturas.folio,
          tc_mantic_tipos_pagos.clave as metodo_pago,
          tc_mantic_tipos_monedas.siglas as moneda,
          tc_mantic_ventas.tipo_de_cambio,
          ifnull(tc_keet_ventas_pagos.saldo, tc_mantic_ventas.saldo) as saldo,
          ifnull(tc_keet_ventas_pagos.saldo, tc_mantic_ventas.saldo) as importe,
          tc_mantic_ventas.total,
          tc_mantic_ventas.total as global,
          tc_mantic_ventas.diferencia
        from
          tc_mantic_ventas
        inner join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        inner join
          tc_keet_series on tc_keet_series.id_serie= tc_mantic_facturas.id_serie
        inner join
          tc_mantic_tipos_monedas on tc_mantic_ventas.id_tipo_moneda= tc_mantic_tipos_monedas.id_tipo_moneda
        inner join
          tc_mantic_tipos_pagos on tc_mantic_ventas.id_tipo_pago= tc_mantic_tipos_pagos.id_tipo_pago
        left join
          tc_keet_ventas_pagos on tc_mantic_ventas.id_venta= tc_keet_ventas_pagos.id_detalle and tc_keet_ventas_pagos.id_venta= {idVenta}
        where
          tc_mantic_ventas.id_cliente= {idCliente}
          and tc_mantic_ventas.saldo> 0    
          and tc_mantic_ventas.id_tipo_comprobante!= 3
          and tc_mantic_facturas.id_factura_estatus= 2
        order by
          tc_mantic_ventas.registro desc
      </select>  
			<select id="detalle">
        select      
          ifnull(tc_keet_ventas_parciales.id_venta_parcial, convert(tc_keet_contratos_lotes.id_contrato_lote, unsigned integer)* -1) as id_key,
          tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_ventas_parciales.id_venta_parcial,
          tc_keet_ventas_parciales.id_venta,
          tc_keet_ventas_parciales.permiso,
          tc_keet_ventas_parciales.codigo_postal,
          tc_keet_ventas_parciales.id_localidad,
          tc_keet_ventas_parciales.colonia,
          tc_keet_ventas_parciales.calle,
          tc_keet_ventas_parciales.numero_exterior,
          tc_keet_ventas_parciales.numero_interior,
          tc_keet_ventas_parciales.referencia,
          tc_keet_ventas_parciales.id_usuario,
          tc_keet_ventas_parciales.registro,
          tc_keet_contratos_lotes.clave as clave_lote,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_contratos_lotes.calle as calle_lote,
          tc_keet_contratos_lotes.numero as numero_lote,
          upper(tc_janal_entidades.descripcion) as entidad,
          upper(tc_janal_municipios.descripcion) as municipio,
          upper(tc_janal_localidades.descripcion) as localidad         
        from
          tc_keet_contratos_lotes          
        inner join
          tc_keet_ventas_parciales on tc_keet_contratos_lotes.id_contrato_lote= tc_keet_ventas_parciales.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo         
        inner join
          tc_janal_localidades on tc_keet_ventas_parciales.id_localidad = tc_janal_localidades.id_localidad         
        inner join
          tc_janal_municipios on tc_janal_localidades.id_municipio = tc_janal_municipios.id_municipio         
        inner join
          tc_janal_entidades on tc_janal_municipios.id_entidad = tc_janal_entidades.id_entidad         
        where
          tc_keet_contratos_lotes.id_contrato= {idContrato}  
        order by
          tc_keet_ventas_parciales.registro
      </select>  
			<select id="lotes">
        select      
          ifnull(tc_keet_ventas_parciales.id_venta_parcial, tc_keet_contratos_lotes.id_contrato_lote* -1) as id_key,
          tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_ventas_parciales.id_venta_parcial,
          tc_keet_ventas_parciales.id_venta,
          tc_keet_ventas_parciales.permiso,
          tc_keet_ventas_parciales.codigo_postal,
          tc_keet_ventas_parciales.id_localidad,
          tc_keet_ventas_parciales.colonia,
          tc_keet_ventas_parciales.calle,
          tc_keet_ventas_parciales.numero_exterior,
          tc_keet_ventas_parciales.numero_interior,
          tc_keet_ventas_parciales.referencia,
          tc_keet_ventas_parciales.id_usuario,
          tc_keet_ventas_parciales.registro,
          tc_keet_contratos_lotes.clave as clave_lote,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote,
          tc_keet_contratos_lotes.calle as calle_lote,
          tc_keet_contratos_lotes.numero as numero_lote,
          upper(tc_janal_entidades.descripcion) as entidad,
          upper(tc_janal_municipios.descripcion) as municipio,
          upper(tc_janal_localidades.descripcion) as localidad         
        from
          tc_keet_contratos_lotes          
        left join
          tc_keet_ventas_parciales on tc_keet_contratos_lotes.id_contrato_lote= tc_keet_ventas_parciales.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo         
        left join
          tc_janal_localidades on tc_keet_ventas_parciales.id_localidad = tc_janal_localidades.id_localidad         
        left join
          tc_janal_municipios on tc_janal_localidades.id_municipio = tc_janal_municipios.id_municipio         
        left join
          tc_janal_entidades on tc_janal_municipios.id_entidad = tc_janal_entidades.id_entidad         
        where
          tc_keet_contratos_lotes.id_contrato= {idContrato}  
        order by
          tc_keet_ventas_parciales.registro
      </select>  
			<select id="lazy">
        select
          tc_mantic_ventas.id_venta as id_key,
          tc_mantic_ventas.id_empresa,
          tc_mantic_ventas.id_desarrollo,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_mantic_ventas.id_cliente,
          tc_mantic_ventas.id_contrato,
          tc_mantic_ventas.consecutivo,
          tc_mantic_facturas.folio as factura,
          tc_mantic_ventas.id_extra,
          if(tc_mantic_ventas.id_extra= 1, "ADITIVAS", "NORMAL") as tipo,
          tc_mantic_ventas.total,
          tc_mantic_ventas.id_venta_estatus,
          tc_mantic_empresas.nombre as empresa,
          tc_mantic_clientes.razon_social,
          tc_mantic_ventas_estatus.nombre as estatus,
          tc_mantic_ventas_estatus.estatus_asociados,
          tc_keet_tipos_comprobantes.nombre as comprobante,
          tc_keet_series.nombre as serie,
          tc_mantic_facturas.timbrado,
          tc_mantic_facturas.cancelada,
          tc_mantic_ventas.registro
        from
          tc_mantic_ventas
        inner join
          tc_mantic_empresas on tc_mantic_ventas.id_empresa= tc_mantic_empresas.id_empresa
        inner join
          tc_keet_desarrollos on tc_mantic_ventas.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
          tc_mantic_clientes on tc_mantic_ventas.id_cliente= tc_mantic_clientes.id_cliente
        inner join
          tc_mantic_ventas_estatus on tc_mantic_ventas.id_venta_estatus= tc_mantic_ventas_estatus.id_venta_estatus
        inner join
          tc_keet_tipos_comprobantes on tc_mantic_ventas.id_tipo_comprobante= tc_keet_tipos_comprobantes.id_tipo_comprobante
        left join
          tc_keet_series on tc_mantic_ventas.id_serie= tc_keet_series.id_serie
        left join
          tc_mantic_facturas on tc_mantic_ventas.id_factura= tc_mantic_facturas.id_factura
        where
          tc_mantic_empresas.id_empresa in ({idEmpresa})
				  and {condicion}
        {sortOrder}
      </select>
      <select id="articulos">
        select 
          tc_mantic_articulos.id_articulo as id_key,
          tc_mantic_articulos.id_articulo,
          tc_mantic_articulos.nombre,
          tc_mantic_articulos.sat,
          tc_mantic_articulos.cantidad,
          tc_mantic_articulos.stock,
          tc_mantic_articulos.iva,
          tc_mantic_articulos.precio,
          tc_mantic_articulos.precio as costo,
          tc_mantic_articulos.descuento,
          tc_mantic_articulos.extra,
          tc_mantic_articulos_codigos.codigo,
          (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
          tc_mantic_unidades_medidas.nombre as unidad_medida
        from
          tc_mantic_articulos  
        inner join
          tc_mantic_articulos_codigos on tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
        inner join
          tr_mantic_empaque_unidad_medida	on tc_mantic_articulos.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
        inner join
          tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque= tc_mantic_empaques.id_empaque
        inner join
          tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
        where
          tc_mantic_articulos.id_articulo_tipo= {idArticuloTipo}
          and {condicion}
        order by
          tc_mantic_articulos.id_articulo
      </select>  
      <select id="proyecto">
				select
					tc_keet_notas_directos.id_nota_directo as id_key,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_clientes.razon_social as cliente,
					concat(tc_keet_contratos.clave, '-', tc_keet_contratos.etapa) as contrato,
					tc_keet_notas_directos.*
				from
				  tc_keet_notas_directos
				inner join  
					tc_keet_desarrollos on tc_keet_notas_directos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_mantic_clientes on tc_keet_notas_directos.id_cliente= tc_mantic_clientes.id_cliente
				inner join 
					tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_notas_directos.id_contrato
				where
					tc_keet_notas_directos.id_nota_entrada= {idNotaEntrada}
				order by
					tc_keet_notas_directos.registro      
      </select>      
      <select id="empleado">
				select
					tc_keet_notas_manos_obras.id_nota_mano_obra as id_key,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as empleado,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_clientes.razon_social as cliente,
					concat(tc_keet_contratos.clave, '-', tc_keet_contratos.etapa) as contrato,
					tc_keet_notas_manos_obras.*
				from
				  tc_keet_notas_manos_obras
				inner join  
					tc_keet_desarrollos on tc_keet_notas_manos_obras.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_mantic_clientes on tc_keet_notas_manos_obras.id_cliente= tc_mantic_clientes.id_cliente
				left join 
					tc_keet_contratos on tc_keet_notas_manos_obras.id_contrato= tc_keet_contratos.id_contrato
				inner join  
					tr_mantic_empresa_personal on tc_keet_notas_manos_obras.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tc_keet_notas_manos_obras.id_nota_entrada= {idNotaEntrada}
				order by
					tc_keet_notas_manos_obras.registro 
      </select>
			<select id="persona">
				select
					tr_mantic_empresa_personal.id_empresa_persona as id_key,
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
					tc_mantic_personas.apodo,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as empleado,
					tc_mantic_puestos.nombre as puesto,
					tc_keet_contratistas_departamentos.id_departamento,
					tc_keet_departamentos.nombre as departamento
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
          and concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) regexp '{nombre}.*'
        group by
          tr_mantic_empresa_personal.id_empresa_persona
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
      <select id="clientes">
        select
          tc_keet_desarrollos.id_cliente as id_key,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.id_cliente,
          tc_mantic_clientes.clave,
          tc_mantic_clientes.razon_social
        from
          tc_keet_desarrollos 
        inner join
          tc_mantic_clientes on tc_keet_desarrollos.id_cliente= tc_mantic_clientes.id_cliente
        where
          tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
          and tc_mantic_clientes.id_cliente> 0
      </select>  
    </unit>    
		<unit id="VistaControlesLotesDto">
			<select id="detalle">
        select
          tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente as id_key,
          tc_keet_contratos_destajos_residentes.id_control,
          tc_keet_controles.codigo,
          tc_keet_controles.nombre,
          tc_keet_contratos_destajos_residentes.id_contrato_lote_residente,
          tc_keet_contratos_destajos_residentes.porcentaje,
          tc_keet_contratos_destajos_residentes.costo,
          tc_keet_contratos_destajos_residentes.id_control_estatus,
          tc_keet_contratos_destajos_residentes.semana,
          tc_keet_contratos_destajos_residentes.periodo,
          tc_keet_contratos_destajos_residentes.id_usuario,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as residente,
          tc_keet_contratos_destajos_residentes.registro,
          tc_keet_contratos_lotes_residentes.id_contrato_lote,
          tc_keet_contratos_lotes_residentes.id_empresa_persona,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos_lotes.latitud,
          tc_keet_contratos_lotes.longitud,
          tc_keet_contratos_lotes.id_contrato
        from
          tc_keet_contratos_destajos_residentes  
        inner join
          tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control= tc_keet_controles.id_control
        inner join
          tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= tc_keet_contratos_lotes_residentes.id_contrato_lote_residente
        inner join 
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_janal_usuarios on tc_keet_contratos_destajos_residentes.id_usuario= tc_janal_usuarios.id_usuario
        inner join
          tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
        where
           tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}        
        {sortOrder}
      </select>
			<select id="exportar">
				select
				  tc_keet_controles.id_control as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_controles.codigo,
					tc_keet_controles.nombre,
					tc_keet_controles.cantidad,
					tc_keet_controles.costo as "costo s/iva",
					tc_mantic_unidades_medidas.nombre as "unidad medida",
				  date_format(tc_keet_controles.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_controles.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_controles
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_controles.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_controles.clave like '{clave}%'
					and tc_keet_controles.nivel> 4
				order by
					tc_keet_controles.clave
			</select>	
			<select id="estaciones">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_controles
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_controles.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_controles.clave like '{clave}%'
				order by
					tc_keet_controles.clave
			</select>	
			<select id="estacion">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*
				from 
					tc_keet_controles
				where
					tc_keet_controles.clave= '{clave}'
				  and tc_keet_controles.nivel= 5
				order by
					tc_keet_controles.clave
			</select>	
			<select id="concepto">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*
				from 
					tc_keet_controles
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.codigo= '{codigo}'
				  and tc_keet_controles.nivel= 6
				order by
					tc_keet_controles.clave
			</select>	      
    </unit>  
		<unit id="VistaComprasAlmacenDto">
			<select id="residentes">
				select
					tc_keet_gastos.id_gasto as id_key,
          tc_keet_gastos.id_empresa_persona,
          sum(tc_keet_gastos.importe) as gasto
				from
					tc_keet_gastos
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas_cierres.id_caja_chica= tc_keet_cajas_chicas.id_caja_chica
				inner join
				  tc_keet_nominas on tc_keet_nominas.id_nomina_periodo= tc_keet_cajas_chicas_cierres.id_nomina_periodo	
				where
				  tc_keet_nominas.id_nomina= {idNomina}
          and tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus= 3
				group by
					tc_keet_gastos.id_empresa_persona        
      </select>  
			<select id="compras">
				select
					tc_keet_gastos_detalles.id_articulo as id_key,
					tc_mantic_empresas.nombre as empresa,
					replace(tc_keet_gastos_detalles.nombre, '"', '\\"') as category,
          tc_keet_desarrollos.nombres as serie,
					sum(tc_keet_gastos_detalles.{columna}) as value,
				  sum(tc_keet_gastos_detalles.{columna}) as {columna}
				from
					tc_keet_gastos
				inner join
					tc_keet_gastos_detalles on tc_keet_gastos.id_gasto= tc_keet_gastos_detalles.id_gasto
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas_cierres.id_caja_chica= tc_keet_cajas_chicas.id_caja_chica
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_gastos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				group by
					tc_mantic_empresas.nombre,
          tc_keet_desarrollos.nombres,
					tc_keet_gastos_detalles.nombre
				order by
					tc_keet_gastos_detalles.{columna} desc
			</select>			
			<select id="analisis">
				select
					tc_keet_temporal.id_material as id_key,
					tc_keet_temporal.empresa,
					replace(tc_keet_temporal.serie, '"', '\\"') as category,
          tc_keet_temporal.desarrollo as serie,
					sum(tc_keet_temporal.value) as value,
					sum(tc_keet_temporal.{columna}) as {columna}
				from (  
				select
					tc_keet_vales_detalles.id_material,
					tc_mantic_empresas.nombre as empresa,
          tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales_detalles.nombre as serie,
					tc_keet_vales_detalles.{columna} as value,
					tc_keet_vales_detalles.{columna}
				from
					tc_keet_vales
				inner join
					tc_keet_vales_detalles on tc_keet_vales.id_vale= tc_keet_vales_detalles.id_vale
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_vales.id_tipo_vale= {idTipoVale}
					and tc_keet_vales.id_vale_contratista= 1
					and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				union all
				select
					tc_keet_vales_detalles.id_material,
					tc_mantic_empresas.nombre as empresa,
          tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales_detalles.nombre as serie,
					tc_keet_vales_detalles.{columna} as value,
					tc_keet_vales_detalles.{columna}
				from
					tc_keet_vales
				inner join
					tc_keet_vales_detalles on tc_keet_vales.id_vale= tc_keet_vales_detalles.id_vale
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_vales.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_vales.id_tipo_vale= {idTipoVale}
					and tc_keet_vales.id_vale_contratista= 2
					and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				) as tc_keet_temporal  
				group by
					tc_keet_temporal.empresa,
          tc_keet_temporal.desarrollo,
					tc_keet_temporal.serie
				order by
					tc_keet_temporal.value desc
			</select>
			<select id="lazy">
				select
				  tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_mantic_empresas.nombre as empresa,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre as material,
					sum(tc_keet_vales_detalles.cantidad) as cantidad,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) almacenista,
					tc_keet_vales.id_vale_estatus
				from
					tc_keet_vales_detalles
				inner join 
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo= tc_mantic_articulos.id_articulo  
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_keet_vales on tc_keet_vales_detalles.id_vale= tc_keet_vales.id_vale and tc_keet_vales.id_vale_contratista= 1
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				inner join
					tc_janal_usuarios on tc_keet_vales.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				where
				  tc_mantic_empresas.id_empresa in ({idEmpresa})
					and tc_keet_vales_detalles.id_tipo_entrega in (2, 4)
					and tc_keet_vales_detalles.entregado is null
					and tc_keet_vales.id_vale_estatus= 5
				  and {condicion}
				group by
					tc_mantic_empresas.nombre,
					tc_keet_desarrollos.nombres,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre
				{sortOrder}		
			</select>
			<select id="detalle">
				select
				  tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_mantic_empresas.nombre as empresa,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales.consecutivo,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre as material,
					sum(tc_keet_vales_detalles.cantidad) as cantidad,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) almacenista,
					tc_keet_contratos.clave as contrato,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
					tc_keet_contratos.etapa,
					tc_keet_vales.id_vale_estatus,
					tc_keet_vales.registro
				from
					tc_keet_vales_detalles
				inner join 
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo= tc_mantic_articulos.id_articulo  
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_keet_vales on tc_keet_vales_detalles.id_vale= tc_keet_vales.id_vale and tc_keet_vales.id_vale_contratista= 1
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				inner join
					tc_janal_usuarios on tc_keet_vales.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				where
					tc_keet_vales_detalles.id_tipo_entrega in (2, 4)
					and tc_keet_vales_detalles.entregado is null
					and tc_keet_vales.id_vale_estatus= 5
					and tc_mantic_articulos.id_articulo= {idArticulo}
				group by
					tc_mantic_empresas.nombre,
					tc_keet_desarrollos.nombres,
					tc_keet_vales.consecutivo,
					tc_mantic_articulos.id_articulo,
					tc_keet_contratos.clave,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote)
				{sortOrder}
			</select>
			<select id="precios">
				select
					tc_keet_articulos_proveedores.id_articulo_proveedor as id_key,
					tc_mantic_proveedores.rfc,
					tc_mantic_proveedores.razon_social as "razon social",
					tc_mantic_articulos_codigos.codigo as clave,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 2 and tc_mantic_articulos_codigos.id_proveedor= tc_keet_articulos_proveedores.id_proveedor limit 0, 1) as auxiliar,
					tc_mantic_articulos.nombre as material,
					tc_keet_articulos_proveedores.precio_base as "precio base",
					tc_keet_articulos_proveedores.precio_lista as "precio lista",
					tc_keet_articulos_proveedores.precio_especial as "precio especial"
				from
					tc_keet_articulos_proveedores
				inner join
					tc_mantic_articulos on tc_keet_articulos_proveedores.id_articulo= tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_mantic_proveedores on tc_keet_articulos_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_proveedores.id_proveedor= {idProveedor}
				order by
					tc_mantic_proveedores.rfc, tc_mantic_articulos_codigos.codigo			  
			</select>
			<select id="convenios">
				select
					tr_keet_articulo_preveedor_cliente.id_articulo_proveedor_cliente as id_key,
					tc_mantic_proveedores.rfc as "rfc proveedor",
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_clientes.rfc as "rfc cliente",
					tc_mantic_clientes.razon_social as cliente,
					tc_mantic_articulos_codigos.codigo as clave,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 2 and tc_mantic_articulos_codigos.id_proveedor= tr_keet_articulo_preveedor_cliente.id_proveedor limit 0, 1) as auxiliar,
					tc_mantic_articulos.nombre as material,
					tr_keet_articulo_preveedor_cliente.precio_convenio as "precio convenio"
				from
					tr_keet_articulo_preveedor_cliente
				inner join
					tc_mantic_articulos on tr_keet_articulo_preveedor_cliente.id_articulo= tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_mantic_proveedores on tr_keet_articulo_preveedor_cliente.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join
					tc_mantic_clientes on tr_keet_articulo_preveedor_cliente.id_cliente= tc_mantic_clientes.id_cliente
				where
				  tc_mantic_proveedores.id_proveedor= {idProveedor}
				  and tc_mantic_clientes.id_cliente= {idCliente}
				order by
					tc_mantic_proveedores.rfc, tc_mantic_articulos_codigos.codigo				
			</select>
		</unit>		
		<unit id="VistaValesArchivosDto">
			<select id="importados">
				select 
					tc_keet_vales_archivos.id_vale_archivo as id_key,
					tc_keet_vales_archivos.id_vale,
					tc_keet_vales_archivos.id_tipo_archivo,
					tc_keet_vales_archivos.nombre,
					tc_keet_vales_archivos.archivo,
					tc_keet_vales_archivos.ruta,
					tc_keet_vales_archivos.alias,
					tc_keet_vales_archivos.tamanio,
					tc_keet_vales_archivos.observaciones,
					tc_keet_vales_archivos.id_usuario,
					tc_keet_vales_archivos.registro,
					tc_keet_vales_archivos.eliminado,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_usuario
				from 
					tc_keet_vales_archivos
				inner join
					tc_janal_usuarios on tc_keet_vales_archivos.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
				where 
					tc_keet_vales_archivos.id_vale= {idVale}
			</select>
		</unit>
		<unit id="VistaValesDetallesDto">
			<select id="resumen">				
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo 
				from
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					id_vale= {idVale}
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre
			</select>
			<select id="entrega">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo 				
				from
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale} and entregado is null and id_tipo_entrega=4
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre
				) principal
			</select>
		</unit>
		<unit id="VistaValesEspecialesDto">
			<select id="detalle">
				select
					tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_keet_vales_detalles.id_vale_detalle as id_comodin,
          tc_keet_vales_detalles.*,
          tc_keet_vales_detalles.cantidad as cuantos,
          tc_keet_vales_detalles.cantidad as inicial,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
					tc_mantic_articulos.menudeo,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from 
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where  
					tc_keet_vales_detalles.id_vale = {idVale}
				order by
					tc_keet_vales_detalles.registro
			</select>
		</unit>
		<unit id="VistaNominaConsultasDto">
			<select id="anticiposContratistas">				
        select
          tc_keet_prestamos_lotes.id_prestamo,
          sum(tc_keet_contratos_destajos_contratistas.anticipo) as anticipo
        from
          tc_keet_contratos_destajos_contratistas
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista= tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        left join
          tc_keet_prestamos_lotes on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_prestamos_lotes.id_estacion and tc_keet_prestamos_lotes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        where
          tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}
          and tc_keet_prestamos_lotes.id_prestamo is not null
        group by
          tc_keet_prestamos_lotes.id_prestamo        
      </select>  
			<select id="anticiposProveedores">
        select
          tc_keet_anticipos_lotes.id_anticipo,
          sum(tc_keet_contratos_destajos_proveedores.anticipo) as anticipo 
        from
          tc_keet_contratos_destajos_proveedores
        inner join
          tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        left join
          tc_keet_anticipos_lotes on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_anticipos_lotes.id_estacion and tc_keet_anticipos_lotes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        where
          tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina}
          and tc_keet_anticipos_lotes.id_anticipo is not null
        group by
          tc_keet_anticipos_lotes.id_anticipo        
      </select>  
			<select id="residentesTipoContacto">				
				select      
					tr_mantic_persona_tipo_contacto.id_persona_tipo_contacto as id_key,									
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as residente, 
          tc_keet_desarrollos.nombres as desarrollo,
          tr_mantic_persona_tipo_contacto.*
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tr_mantic_persona_tipo_contacto on tc_mantic_personas.id_persona = tr_mantic_persona_tipo_contacto.id_persona
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join	
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tr_mantic_empresa_personal.id_activo= 1
          and tc_keet_contratos_personal.id_desarrollo= {idDesarrollo} 
          and tc_mantic_puestos.nombre like 'RESIDENTE%'
        union all   
				select      
					tr_mantic_persona_tipo_contacto.id_persona_tipo_contacto as id_key,									
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as residente, 
          tc_keet_desarrollos.nombres as desarrollo,
          tr_mantic_persona_tipo_contacto.*
        from      
          tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_contratos_personal on tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona
				inner join 
					tr_mantic_persona_tipo_contacto on tc_mantic_personas.id_persona = tr_mantic_persona_tipo_contacto.id_persona
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				inner join	
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tr_mantic_empresa_personal.id_activo= 1
          and tc_keet_contratos_personal.id_desarrollo= {idDesarrollo} 
          and tc_mantic_puestos.id_puesto in (8, 10)
			</select>
			<select id="totalDestajoContratista">
       select
          tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_key,
          sum(tc_keet_contratos_destajos_contratistas.costo) as total
        from
          tc_keet_contratos_destajos_contratistas      
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista       
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona     
        where
          tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}       
          and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus= 3
      </select> 
			<select id="personas">
				select
				  principal.*,
          tc_keet_desarrollos.nombres as desarrollo,
				  concat(if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')))) as contratista
				from(
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tc_keet_nominas.id_nomina,
					tr_mantic_empresa_personal.id_empresa_persona,
				  tc_keet_nominas_personas.id_nomina_persona,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.id_puesto,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.clave,
          tr_mantic_empresa_personal.id_activo,
          if(tr_mantic_empresa_personal.id_activo= 1, "SI", "NO") as activo,
          tr_mantic_empresa_personal.id_nomina as id_pago,
          if(tr_mantic_empresa_personal.id_nomina= 1, "SI", "NO") as depositar,
          ifnull(tc_keet_personas_bancos.cuenta, '-') as cuenta,
          ifnull(tc_mantic_bancos.nombre, '-') as banco,
					tr_mantic_empresa_personal.id_seguro,
					tr_mantic_empresa_personal.nss,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.apodo,
					tc_mantic_personas.id_persona,
					tc_keet_nominas_personas.percepciones,
					tc_keet_nominas_personas.deducciones,
					tc_keet_nominas_personas.neto as pago,
					tc_keet_nominas_personas.neto,
					tr_mantic_empresa_personal.id_contratista
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
        left join
          tc_keet_nominas_desarrollos on tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina and tr_mantic_empresa_personal.id_empresa_persona= tc_keet_nominas_desarrollos.id_empresa_persona
        left join
          tc_keet_personas_bancos on tc_keet_personas_bancos.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona and tc_keet_personas_bancos.id_principal= 1
        left join
          tc_mantic_bancos on tc_keet_personas_bancos.id_banco= tc_mantic_bancos.id_banco
				where
					{condicion}
				) as principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
        left join
          tc_keet_nominas_desarrollos on principal.id_nomina= tc_keet_nominas_desarrollos.id_nomina and principal.id_empresa_persona= tc_keet_nominas_desarrollos.id_empresa_persona
        left join
          tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        group by
					id_nomina_persona,
					id_nomina,
					id_empresa_persona
        {sortOrder}
			</select>
			<select id="calculada">
				select
				  principal.*,
          tc_keet_desarrollos.nombres as desarrollo,
				  concat(if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')))) as contratista
				from(
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tc_keet_nominas.id_nomina,
					tr_mantic_empresa_personal.id_empresa_persona,
				  tc_keet_nominas_personas.id_nomina_persona,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.id_puesto,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.clave,
          tr_mantic_empresa_personal.id_activo,
          if(tr_mantic_empresa_personal.id_activo= 1, "SI", "NO") as activo,
          tr_mantic_empresa_personal.id_nomina as id_pago,
          if(tr_mantic_empresa_personal.id_nomina= 1, "SI", "NO") as depositar,
          ifnull(tc_keet_personas_bancos.cuenta, '-') as cuenta,
          ifnull(tc_mantic_bancos.nombre, '-') as banco,
					tr_mantic_empresa_personal.id_seguro,
					tr_mantic_empresa_personal.nss,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.apodo,
					tc_mantic_personas.id_persona,
					tc_keet_nominas_personas.percepciones,
					tc_keet_nominas_personas.deducciones,
					tc_keet_nominas_personas.neto as pago,
					tc_keet_nominas_personas.neto,
					tr_mantic_empresa_personal.id_contratista,
          tc_keet_contratos_personal.id_desarrollo     
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
        left join
          tc_keet_contratos_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_personal.id_empresa_persona
        left join
          tc_keet_personas_bancos on tc_keet_personas_bancos.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona and tc_keet_personas_bancos.id_principal= 1
        left join
          tc_mantic_bancos on tc_keet_personas_bancos.id_banco= tc_mantic_bancos.id_banco
				where
					{condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
        left join
          tc_keet_contratos_personal on principal.id_empresa_persona= tc_keet_contratos_personal.id_empresa_persona and principal.id_desarrollo= tc_keet_contratos_personal.id_desarrollo        
        left join
          tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo        
        group by
					id_nomina_persona,
					id_nomina,
					id_empresa_persona
        {sortOrder}
			</select>
			<select id="proveedores">
				select
					tc_keet_nominas_proveedores.id_nomina_proveedor as id_key,
  				concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as nombre_empresa,  
					departamentos.id_departamentos,
					departamentos.departamento,
					tc_keet_nominas_proveedores.id_nomina_proveedor,
				  tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.clave,
					tc_mantic_proveedores.razon_social as nombre_completo,
					tc_mantic_proveedores.rfc,
					tc_keet_nominas_proveedores.subtotal,
					tc_keet_nominas_proveedores.iva,
					tc_keet_nominas_proveedores.total
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_proveedores on tc_keet_nominas.id_nomina= tc_keet_nominas_proveedores.id_nomina
				inner join 
					tc_mantic_proveedores on tc_keet_nominas_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join ( 
					select 
						tc_keet_proveedores_departamentos.id_proveedor,
						concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
						group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
					from
						tc_keet_proveedores_departamentos
					inner join
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					group by
						tc_keet_proveedores_departamentos.id_proveedor				  
				) as departamentos on tc_mantic_proveedores.id_proveedor= departamentos.id_proveedor
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					{condicion}	
				{sortOrder}			
			</select>
			<select id="nominas">
        select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_tipos_nominas.nombre, '[', tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden, ']') as nomina,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino,
          tc_keet_nominas.id_nomina_estatus
				from
					tc_keet_nominas
				inner join 
					tc_keet_tipos_nominas on tc_keet_nominas.id_tipo_nomina= tc_keet_tipos_nominas.id_tipo_nomina
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas_periodos.ejercicio&gt;= {anterior}
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
				  tc_keet_nominas.id_tipo_nomina, tc_keet_nominas_periodos.ejercicio desc, tc_keet_nominas_periodos.orden desc				
			</select>
			<select id="persona">
				select
				  tc_keet_nominas_detalles.id_nomina_detalle as id_key,
				  '{nomina}' as nomina,
				  '{nombreCompleto}' as "nombre completo",
					tc_keet_nominas_conceptos.id_tipo_concepto,
				  tc_keet_tipos_conceptos.nombre as concepto,
					tc_keet_nominas_conceptos.orden,
					tc_keet_nominas_detalles.clave,
					tc_keet_nominas_detalles.nombre,
					tc_keet_nominas_detalles.nombre as detalle,
					tc_keet_nominas_detalles.formula,
					tc_keet_nominas_detalles.valor,
				  tc_keet_nominas_detalles.fecha
				from
					tc_keet_nominas_detalles
				inner join
					tc_keet_nominas_personas on tc_keet_nominas_detalles.id_nomina_persona = tc_keet_nominas_personas.id_nomina_persona
				inner join
					tc_keet_nominas_conceptos on tc_keet_nominas_detalles.id_nomina_concepto = tc_keet_nominas_conceptos.id_nomina_concepto
				inner join
					tc_keet_tipos_conceptos on tc_keet_nominas_conceptos.id_tipo_concepto = tc_keet_tipos_conceptos.id_tipo_concepto
				where
					tc_keet_nominas_personas.id_nomina= {idNomina}
					and tc_keet_nominas_personas.id_empresa_persona= {idEmpresaPersona}
          and tc_keet_nominas_detalles.valor!= 0
				{sortOrder}				
			</select>			
			<select id="proveedor">
				select
					tc_keet_nominas_rubros.id_nomina_rubro as id_key,
          tc_keet_nominas.id_nomina,
				  tc_keet_contratos.consecutivo,
				  concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as nomina,
				  '{nombreCompleto}' as "razon social",
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave as contrato,
				  tc_keet_contratos.etapa,
					tc_keet_nominas_rubros.lote,
					tc_keet_nominas_rubros.codigo,
					tc_keet_nominas_rubros.nombre as concepto,
          tc_keet_nominas_rubros.fondo_garantia,
					tc_keet_nominas_rubros.subtotal,
					tc_keet_nominas_rubros.iva,
					tc_keet_nominas_rubros.total,
				  tc_keet_nominas_rubros.total as costo,
          tc_keet_nominas_rubros.anticipo,
					tc_keet_nominas_rubros.registro     
        from
          tc_keet_nominas_rubros     
        inner join
          tc_keet_nominas_proveedores on tc_keet_nominas_rubros.id_nomina_proveedor = tc_keet_nominas_proveedores.id_nomina_proveedor     
			  inner join
				  tc_keet_contratos_lotes on tc_keet_nominas_rubros.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        left join
          tc_keet_nominas on tc_keet_nominas_proveedores.id_nomina= tc_keet_nominas.id_nomina
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        where
          (tc_keet_nominas_proveedores.id_nomina&gt;= ({idNomina}- {factor}) and tc_keet_nominas_proveedores.id_nomina&lt;= {idNomina})      
          and tc_keet_nominas_proveedores.id_proveedor= {idProveedor}	
				{sortOrder}			
			</select>	
			<select id="destajo">
				select 
				  tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
          tc_keet_nominas.id_nomina,
				  concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as nomina,
				  '{nombreCompleto}' as "nombre completo",
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre as concepto,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
				  tc_keet_contratos_destajos_contratistas.costo,
				  tc_keet_contratos_destajos_contratistas.costo as total,
				  tc_keet_contratos_destajos_contratistas.anticipo,
				  tc_keet_contratos_destajos_contratistas.anticipo as retencion,
				  tc_keet_contratos_destajos_contratistas.registro
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
    		inner join
		      tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				inner join
					tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina&gt;= ({idNomina}- {factor}) and tc_keet_contratos_destajos_contratistas.id_nomina&lt;= {idNomina})
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}	
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
          and {condicion}
				{sortOrder}			
			</select>
      <select id="exportar">
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tr_mantic_empresa_personal.id_empresa_persona,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_mantic_empresas.nombre as sucursal,  
					tr_mantic_empresa_personal.clave,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.rfc,
					tc_mantic_personas.curp,
					if(tr_mantic_empresa_personal.id_activo= 1, "SI", "NO") as activo,
					tc_keet_nominas_personas.neto as total
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					(tc_keet_nominas.id_nomina=  {idNomina} {loNuevo})
					and tr_mantic_empresa_personal.id_puesto= 6        
      </select>  
      <select id="monitoreo">
select 
  tr_mantic_empresa_personal.id_empresa_persona,
  tc_keet_desarrollos.id_desarrollo,
  concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
  tr_mantic_empresa_personal.clave,
  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
  tc_mantic_puestos.nombre as puesto,
  tc_mantic_personas.rfc,
  tc_mantic_personas.curp,
  if(tr_mantic_empresa_personal.id_activo= 1, "SI", "NO") as activo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.nombre as contrato,
  sum(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo) as total
from
  tc_keet_contratos_destajos_contratistas 
inner join
  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
inner join
  tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
inner join 
  tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
inner join
  tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
inner join
  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
inner join
  tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
inner join
  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
inner join
  tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
inner join
  tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
inner join
  tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
left join
  tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
left join
  tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
where 
  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevo})
  and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
  and tr_mantic_empresa_personal.id_puesto= {idPuesto}
group by
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato,
    tr_mantic_empresa_personal.id_empresa_persona
order by
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato,
    tr_mantic_empresa_personal.id_empresa_persona
      </select>
			<select id="lotesResumen">
        select 
          tt_keet_temporal.manzana,
          tt_keet_temporal.numero,
          tt_keet_temporal.lote
        from (
				select 
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote as numero,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
          tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        union all 
        select 
          tc_keet_contratos_lotes.manzana,
          tc_keet_contratos_lotes.lote as numero,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
          tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        ) as tt_keet_temporal
        group by
          tt_keet_temporal.lote  
        order by
          convert(tt_keet_temporal.manzana, unsigned integer),
          convert(tt_keet_temporal.numero, unsigned integer)
      </select>  
			<select id="historial">
        select
          tt_keet_semanas.id_key,
          tt_keet_semanas.orden,
          tt_keet_semanas.id_persona,
          tt_keet_semanas.razon_social,
          tt_keet_semanas.clave,
          tt_keet_semanas.contrato,
          tt_keet_semanas.etapa,
          tt_keet_semanas.prototipo,
          tt_keet_semanas.codigo,
          tt_keet_semanas.nombre,
          tt_keet_semanas.concepto,
          tt_keet_semanas.registro,
          tt_keet_semanas.pagar,
          tt_keet_semanas.valor,
          tt_keet_semanas.costo,
          tt_keet_semanas.anticipo,
          {maximo}
        from (
				select
          tt_keet_temporal.id_key,
          max(tt_keet_temporal.orden) as orden,
          tt_keet_temporal.id_persona,
          tt_keet_temporal.razon_social,
          tt_keet_temporal.clave,
          tt_keet_temporal.contrato,
          tt_keet_temporal.etapa,
          tt_keet_temporal.prototipo,
          tt_keet_temporal.codigo,
          tt_keet_temporal.nombre,
          tt_keet_temporal.concepto,
          tt_keet_temporal.registro,
          tt_keet_temporal.valor,
          tt_keet_temporal.costo,
          tt_keet_temporal.anticipo,
          max(tt_keet_temporal.porcentaje) as pagar,
          {semana}
        from (
				select 
				  convert(concat('1', tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista), unsigned integer) as id_key,
          tc_keet_rubros.orden,
          tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_persona,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as razon_social,          
				  tc_keet_contratos.clave,
				  tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
          tc_keet_prototipos.nombre as prototipo,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  ifnull(tc_keet_estaciones.descripcion, tc_keet_estaciones.nombre) as concepto,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
          tc_keet_estaciones.costo as valor,
				  tc_keet_contratos_destajos_contratistas.costo,
          tc_keet_contratos_destajos_contratistas.anticipo,
          tc_keet_contratos_destajos_contratistas.registro
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        union all 
        select 
				  convert(concat('2', tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor), unsigned integer) as id_key,
          tc_keet_rubros.orden,
          tc_keet_contratos_lotes_proveedores.id_proveedor as id_persona,
          tc_mantic_proveedores.razon_social,
				  tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
          tc_keet_prototipos.nombre as prototipo,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_rubros.nombre as concepto,
				  tc_keet_contratos_destajos_proveedores.porcentaje,
          tc_keet_estaciones.costo as valor,
				  tc_keet_contratos_destajos_proveedores.costo,
          tc_keet_contratos_destajos_proveedores.anticipo,
				  tc_keet_contratos_destajos_proveedores.registro
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        ) as tt_keet_temporal
        group by
          tt_keet_temporal.lote,
          tt_keet_temporal.codigo
        ) as tt_keet_semanas
        group by
          tt_keet_semanas.codigo
        {sortOrder}
      </select>        
			<select id="costoResumen">
        select 
          sum(tt_keet_temporal.costo) as total
        from (
				select 
				  (tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo) as costo
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevoPersona}) 
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        union all 
        select 
				  (tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo) as costo
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} {loNuevoProveedor}) 
          and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        ) as tt_keet_temporal
      </select>  
			<select id="destajoResumen">
        select 
          tt_keet_temporal.*
        from (
				select 
				  convert(concat('1', tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista), unsigned integer) as id_key,
          tc_keet_estaciones.clave as orden,
          tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_persona,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as razon_social,          
				  tc_keet_contratos_destajos_contratistas.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  ifnull(tc_keet_estaciones.descripcion, tc_keet_estaciones.nombre) as concepto,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
				  tc_keet_contratos_destajos_contratistas.costo,
				  tc_keet_contratos_destajos_contratistas.anticipo,
          0 as garantia,
          0 as subtotal,
          0 as iva,
				  (tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo) as total,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_contratos_destajos_contratistas.registro,
          0 as fondo_garantia,
          concat(tt_mantic_personas.nombres,' ', ifnull(tt_mantic_personas.paterno, ''),' ', ifnull(tt_mantic_personas.materno, '')) as usuario
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join 
          tc_janal_usuarios on tc_keet_contratos_destajos_contratistas.id_usuario = tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas as tt_mantic_personas on tc_janal_usuarios.id_persona = tt_mantic_personas.id_persona
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevoPersona}) 
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        group by
          id_key  
        union all 
        select 
				  convert(concat('2', tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor), unsigned integer) as id_key,
          tc_keet_estaciones.clave as orden,
          tc_keet_contratos_lotes_proveedores.id_proveedor as id_persona,
          tc_mantic_proveedores.razon_social,
          tc_keet_contratos_destajos_proveedores.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_rubros.nombre as concepto,
				  tc_keet_contratos_destajos_proveedores.porcentaje,
				  tc_keet_contratos_destajos_proveedores.costo,
          tc_keet_contratos_destajos_proveedores.anticipo,
				  round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100), 2) as garantia,
          round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)), 2) as subtotal,
				  round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 0.16), 2) as iva,
				  round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 1.16), 2) as total,
          tc_keet_prototipos.nombre as prototipo,
				  tc_keet_contratos_destajos_proveedores.registro,
				  tc_mantic_proveedores.fondo_garantia,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
				from
				  tc_keet_contratos_destajos_proveedores 
        inner join 
          tc_janal_usuarios on tc_keet_contratos_destajos_proveedores.id_usuario = tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} {loNuevoProveedor}) 
          and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        group by
          id_key  
        ) as tt_keet_temporal
        {sortOrder}	                    
      </select>  
			<select id="costoPersona">
				select 
				  sum(costo) as total,
          sum(anticipo) as anticipo
        from (
          select 
            tc_keet_contratos_destajos_contratistas.costo,
            tc_keet_contratos_destajos_contratistas.anticipo
          from
            tc_keet_contratos_destajos_contratistas 
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
          inner join
            tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
          inner join
            tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          inner join
            tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
          left join
            tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
          left join
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
          where 
            (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevo}) 
            and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
            and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}		
            and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
            and {condicion}
          group by
            tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista,
            tc_keet_contratos_destajos_contratistas.id_nomina,
            tc_keet_contratos.consecutivo
        ) as tt_keet_costos
      </select>        
			<select id="destajoPersona">
				select 
				  tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
				  tc_keet_contratos_destajos_contratistas.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  ifnull(tc_keet_estaciones.descripcion, tc_keet_estaciones.nombre) as concepto,
          ifnull(tc_keet_estaciones.id_estacion_estatus, 0) as id_estacion_estatus,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
				  tc_keet_contratos_destajos_contratistas.costo,
				  tc_keet_contratos_destajos_contratistas.costo as total,
				  tc_keet_contratos_destajos_contratistas.anticipo,
				  tc_keet_contratos_destajos_contratistas.anticipo as retencion,
          tc_keet_prototipos.nombre as prototipo,
				  tc_keet_contratos_destajos_contratistas.registro,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
				from
				  tc_keet_contratos_destajos_contratistas 
        inner join 
          tc_janal_usuarios on tc_keet_contratos_destajos_contratistas.id_usuario = tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
        inner join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
        inner join
          tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
        inner join
          tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
        inner join
          tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
        left join
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina     
        left join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo      
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and tc_keet_contratos_destajos_contratistas.porcentaje &gt; 0
          and {condicion}
        group by
				  tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista,
				  tc_keet_contratos_destajos_contratistas.id_nomina,
				  tc_keet_contratos.consecutivo
				{sortOrder}			
			</select>
			<select id="costoResidente">
				select 
				  sum(tc_keet_contratos_destajos_residentes.costo) as total
				from
				  tc_keet_contratos_destajos_residentes 
				inner join
				  tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= tc_keet_contratos_lotes_residentes.id_contrato_lote_residente
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control= tc_keet_controles.id_control
				inner join
				  tc_keet_rubros on tc_keet_controles.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_residentes.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_residentes.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_residentes.id_control_estatus in (2, 3)
				  and tc_keet_contratos_lotes_residentes.id_empresa_persona= {idEmpresaPersona}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
      </select>  
			<select id="destajoResidente">
				select 
				  tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente as id_key,
				  tc_keet_contratos_destajos_residentes.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_controles.codigo,
				  tc_keet_rubros.nombre,
				  ifnull(tc_keet_controles.descripcion, tc_keet_controles.nombre) as concepto,
				  tc_keet_contratos_destajos_residentes.porcentaje,
				  tc_keet_contratos_destajos_residentes.costo,
				  tc_keet_contratos_destajos_residentes.costo as total,
          tc_keet_prototipos.nombre as prototipo,
				  tc_keet_contratos_destajos_residentes.registro
				from
				  tc_keet_contratos_destajos_residentes 
				inner join
				  tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= tc_keet_contratos_lotes_residentes.id_contrato_lote_residente
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control= tc_keet_controles.id_control
				inner join
				  tc_keet_rubros on tc_keet_controles.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_residentes.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_residentes.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_residentes.id_control_estatus in (2, 3)
				  and tc_keet_contratos_lotes_residentes.id_empresa_persona= {idEmpresaPersona}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
        group by
				  tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente,
				  tc_keet_contratos_destajos_residentes.id_nomina,
				  tc_keet_contratos.consecutivo
				{sortOrder}			
			</select>
			<select id="costoProveedor">
				select 
				  sum(costo) as total,
          sum(anticipo) as anticipo
        from (
          select 
            tc_keet_contratos_destajos_proveedores.costo,
            tc_keet_contratos_destajos_proveedores.anticipo
          from
            tc_keet_contratos_destajos_proveedores 
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
          inner join 
            tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          left join 
            tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
          left join 
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
          where 
            (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} {loNuevo}) 
            and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
            and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}		
            and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
            and {condicion}
          group by
            tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor,
            tc_keet_contratos_destajos_proveedores.id_nomina,
            tc_keet_contratos.consecutivo
        ) as tt_keet_costos
			</select>				
			<select id="destajoProveedor">
        select 
				  tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor as id_key,
				  tc_keet_contratos_destajos_proveedores.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_rubros.nombre as concepto,
          ifnull(tc_keet_estaciones.id_estacion_estatus, 0) as id_estacion_estatus,
				  tc_keet_contratos_destajos_proveedores.porcentaje,
				  tc_keet_contratos_destajos_proveedores.costo,
				  tc_keet_contratos_destajos_proveedores.anticipo,
				  round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100), 2) as garantia,
          round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)), 2) as subtotal,
				  round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 0.16), 2) as iva,
				  round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 1.16), 2) as total,
          tc_keet_prototipos.nombre as prototipo,
				  tc_keet_contratos_destajos_proveedores.registro,
				  tc_mantic_proveedores.fondo_garantia,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
				from
				  tc_keet_contratos_destajos_proveedores 
        inner join 
          tc_janal_usuarios on tc_keet_contratos_destajos_proveedores.id_usuario = tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} {loNuevo}) 
          and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and tc_keet_contratos_destajos_proveedores.porcentaje &gt; 0
          and {condicion}
        group by
				  tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor,
				  tc_keet_contratos_destajos_proveedores.id_nomina,
				  tc_keet_contratos.consecutivo
				{sortOrder}			
			</select>				
		</unit>
		<unit id="VistaNominaDto">
			<select id="exportarCalculada">
select
 tt_keet_empleados.*
from (
  select
    tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as percepciones,
    0 as deducciones,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as neto
  from
    tc_keet_nominas         
  inner join
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo         
  inner join
    tc_keet_contratos_destajos_contratistas on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_contratistas.id_nomina         
  inner join
    tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista         
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote         
  inner join
    tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato         
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto         
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
  inner join
    tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona         
  inner join
   (select
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|',group_concat(tc_keet_departamentos.id_departamento separator '|'),'|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento           
    from
      tc_keet_contratistas_departamentos           
    inner join 
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento           
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona               
    ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona          
  inner join
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona         
  inner join
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto         
  where
    tc_keet_nominas.id_nomina= {idNomina}         
    and tc_mantic_puestos.id_puesto= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tr_mantic_empresa_personal.id_empresa_persona 
  union all
  select
    tc_keet_nominas_personas.id_nomina_persona as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    tc_keet_nominas_personas.percepciones,
    tc_keet_nominas_personas.deducciones,
    tc_keet_nominas_personas.neto
  from
    tc_keet_nominas
  inner join 
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
  inner join 
    tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
  inner join 
    tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
  inner join 
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
  inner join 
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
  inner join
    tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
  inner join ( 
    select 
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
    from
      tc_keet_contratistas_departamentos
    inner join
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona				  
  ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona	
  left join
    tc_keet_contratos_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_personal.id_empresa_persona
  inner join
    tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo        
  where
    tc_keet_nominas.id_nomina= {idNomina}
    and tc_mantic_puestos.id_puesto!= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tr_mantic_empresa_personal.id_empresa_persona 
) as tt_keet_empleados		
order by
  tt_keet_empleados.desarrollo,
  tt_keet_empleados.orden,
  tt_keet_empleados.nombre        
      </select> 
			<select id="exportarCalculadaPagos">
select
 tt_keet_empleados.*
from (
  select
    tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    tc_keet_contratos.nombre as contrato,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    tc_mantic_tipos_medios_pagos.nombre as medio,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as percepciones,
    0 as deducciones,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as neto
  from
    tc_keet_nominas         
  inner join
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo         
  inner join
    tc_keet_contratos_destajos_contratistas on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_contratistas.id_nomina         
  inner join
    tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista         
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote         
  inner join
    tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato         
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto         
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
  inner join
    tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona         
  inner join 
    tc_mantic_tipos_medios_pagos on tr_mantic_empresa_personal.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
  inner join
   (select
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|',group_concat(tc_keet_departamentos.id_departamento separator '|'),'|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento           
    from
      tc_keet_contratistas_departamentos           
    inner join 
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento           
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona               
    ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona          
  inner join
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona         
  inner join
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto         
  where
    tc_keet_nominas.id_nomina= {idNomina}         
    and tc_mantic_puestos.id_puesto= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato,
    tr_mantic_empresa_personal.id_empresa_persona 
  union all
  select
    tc_keet_nominas_personas.id_nomina_persona as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    ' ' as contrato,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    tc_mantic_tipos_medios_pagos.nombre as medio,
    tc_keet_nominas_personas.percepciones,
    tc_keet_nominas_personas.deducciones,
    tc_keet_nominas_personas.neto
  from
    tc_keet_nominas
  inner join 
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
  inner join 
    tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
  inner join 
    tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
  inner join 
    tc_mantic_tipos_medios_pagos on tr_mantic_empresa_personal.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
  inner join 
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
  inner join 
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
  inner join
    tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
  inner join ( 
    select 
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
    from
      tc_keet_contratistas_departamentos
    inner join
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona				  
  ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona	
  left join
    tc_keet_contratos_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_personal.id_empresa_persona
  left join
    tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo        
  where
    tc_keet_nominas.id_nomina= {idNomina}
    and tc_mantic_puestos.id_puesto!= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tr_mantic_empresa_personal.id_empresa_persona 
) as tt_keet_empleados		
order by
  tt_keet_empleados.desarrollo,
  tt_keet_empleados.contrato,
  tt_keet_empleados.orden,
  tt_keet_empleados.nombre        
      </select> 
			<select id="exportarEmpleados">
        select
         tt_keet_empleados.*
        from (
          select
            tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista as id_key,
            concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_mantic_puestos.id_puesto,
            tc_mantic_puestos.nombre as puesto,
            tr_mantic_empresa_personal.id_empresa_persona,
            tt_keet_departamentos.departamento,
            tr_mantic_empresa_personal.clave,
            concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
            tc_mantic_puestos.orden,
            sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as percepciones,
            0 as deducciones,
            sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as neto
          from
            tc_keet_nominas         
          inner join
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo         
          inner join
            tc_keet_contratos_destajos_contratistas on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_contratistas.id_nomina         
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista         
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote         
          inner join
            tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato         
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto         
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
          inner join
            tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona         
          inner join
           (select
              tc_keet_contratistas_departamentos.id_empresa_persona,
              concat('|',group_concat(tc_keet_departamentos.id_departamento separator '|'),'|') as id_departamentos,
              group_concat(tc_keet_departamentos.nombre separator ', ') as departamento           
            from
              tc_keet_contratistas_departamentos           
            inner join 
              tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento           
            group by
              tc_keet_contratistas_departamentos.id_empresa_persona               
            ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona          
          inner join
            tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona         
          inner join
            tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto         
          where
            tc_keet_nominas.id_nomina= {idNomina}         
            and tc_mantic_puestos.id_puesto= 6
          group by
            tc_keet_desarrollos.id_desarrollo,
            tr_mantic_empresa_personal.id_empresa_persona 
          union all
          select
            tc_keet_nominas_personas.id_nomina_persona as id_key,
            concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_mantic_puestos.id_puesto,
            tc_mantic_puestos.nombre as puesto,
            tr_mantic_empresa_personal.id_empresa_persona,
            tt_keet_departamentos.departamento,
            tr_mantic_empresa_personal.clave,
            concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
            tc_mantic_puestos.orden,
            tc_keet_nominas_personas.percepciones,
            tc_keet_nominas_personas.deducciones,
            tc_keet_nominas_personas.neto
          from
            tc_keet_nominas
          inner join 
            tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
          inner join 
            tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
          inner join 
            tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
          inner join 
            tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
          inner join 
            tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
          inner join ( 
            select 
              tc_keet_contratistas_departamentos.id_empresa_persona,
              concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
              group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
            from
              tc_keet_contratistas_departamentos
            inner join
              tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
            group by
              tc_keet_contratistas_departamentos.id_empresa_persona				  
          ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona	
          inner join 
            tc_keet_nominas_desarrollos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_nominas_desarrollos.id_empresa_persona and tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
          inner join 
            tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo and tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
          where
            tc_keet_nominas.id_nomina= {idNomina}
            and tc_mantic_puestos.id_puesto!= 6
          group by
            tc_keet_desarrollos.id_desarrollo,
            tr_mantic_empresa_personal.id_empresa_persona 
        ) as tt_keet_empleados		
        order by
          tt_keet_empleados.desarrollo,
          tt_keet_empleados.orden,
          tt_keet_empleados.nombre        
      </select> 
			<select id="exportarEmpleadosPagos">
select
 tt_keet_empleados.*
from (
  select
    tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    tc_keet_contratos.nombre as contrato,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    tc_mantic_tipos_medios_pagos.nombre as medio,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as percepciones,
    0 as deducciones,
    sum(round(tc_keet_contratos_destajos_contratistas.costo- tc_keet_contratos_destajos_contratistas.anticipo)) as neto
  from
    tc_keet_nominas         
  inner join
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo         
  inner join
    tc_keet_contratos_destajos_contratistas on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_contratistas.id_nomina         
  inner join
    tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista         
  inner join
    tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote         
  inner join
    tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato         
  inner join
    tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto         
  inner join
    tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
  inner join
    tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona         
  inner join 
    tc_mantic_tipos_medios_pagos on tr_mantic_empresa_personal.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
  inner join
   (select
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|',group_concat(tc_keet_departamentos.id_departamento separator '|'),'|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento           
    from
      tc_keet_contratistas_departamentos           
    inner join 
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento           
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona               
    ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona          
  inner join
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona         
  inner join
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto         
  where
    tc_keet_nominas.id_nomina= {idNomina}         
    and tc_mantic_puestos.id_puesto= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_contratos.id_contrato,
    tr_mantic_empresa_personal.id_empresa_persona 
  union all
  select
    tc_keet_nominas_personas.id_nomina_persona as id_key,
    concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_desarrollos.nombres as desarrollo,
    ' ' as contrato,
    tc_mantic_puestos.id_puesto,
    tc_mantic_puestos.nombre as puesto,
    tr_mantic_empresa_personal.id_empresa_persona,
    tt_keet_departamentos.departamento,
    tr_mantic_empresa_personal.clave,
    concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre,
    tc_mantic_puestos.orden,
    tc_mantic_tipos_medios_pagos.nombre as medio,
    tc_keet_nominas_personas.percepciones,
    tc_keet_nominas_personas.deducciones,
    tc_keet_nominas_personas.neto
  from
    tc_keet_nominas
  inner join 
    tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
  inner join 
    tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
  inner join 
    tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
  inner join 
    tc_mantic_tipos_medios_pagos on tr_mantic_empresa_personal.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
  inner join 
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
  inner join 
    tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
  inner join ( 
    select 
      tc_keet_contratistas_departamentos.id_empresa_persona,
      concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
      group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
    from
      tc_keet_contratistas_departamentos
    inner join
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona				  
  ) as tt_keet_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tt_keet_departamentos.id_empresa_persona	
  inner join 
    tc_keet_nominas_desarrollos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_nominas_desarrollos.id_empresa_persona and tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
  inner join 
    tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo and tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
  where
    tc_keet_nominas.id_nomina= {idNomina}
    and tc_mantic_puestos.id_puesto!= 6
  group by
    tc_keet_desarrollos.id_desarrollo,
    tr_mantic_empresa_personal.id_empresa_persona 
) as tt_keet_empleados		
order by
  tt_keet_empleados.desarrollo,
  tt_keet_empleados.orden,
  tt_keet_empleados.nombre        
      </select> 
      <select id="exportarProveedores">
        select
          tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_key,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
          tc_keet_desarrollos.nombres as desarrollo,
          tt_keet_departamentos.departamento,
          tc_mantic_proveedores.clave,
          tc_mantic_proveedores.razon_social as nombre,
          sum(round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100),2)) as garantia,
          sum(round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)), 2)) as subtotal,
          sum(round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 0.16), 2)) as iva,
          sum(round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 1.16), 2)) as total
        from
          tc_keet_nominas
        inner join 
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        inner join	
          tc_keet_contratos_destajos_proveedores on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_proveedores.id_nomina
        inner join
          tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
        inner join 
          tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
        inner join 
          tc_keet_contratos_lotes	on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        inner join 
          tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        inner join 
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join 
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join ( 
          select 
            tc_keet_proveedores_departamentos.id_proveedor,
            concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
            group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
          from
            tc_keet_proveedores_departamentos
          inner join
            tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
          group by
            tc_keet_proveedores_departamentos.id_proveedor				  
        ) as tt_keet_departamentos on tc_mantic_proveedores.id_proveedor= tt_keet_departamentos.id_proveedor
        where
          tc_keet_nominas.id_nomina= {idNomina} 
        group by
          tc_keet_desarrollos.id_desarrollo,
          tc_mantic_proveedores.id_proveedor
        order by
          tc_keet_desarrollos.nombres,
          tc_mantic_proveedores.razon_social        
      </select> 
      <select id="exportarProveedoresPagos">
select
  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_key,
  concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.nombre as contrato,
  tt_keet_departamentos.departamento,
  tc_mantic_proveedores.clave,
  tc_mantic_proveedores.razon_social as nombre,
  tc_mantic_tipos_medios_pagos.nombre as medio,
  sum(round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100),2)) as garantia,
  sum(round((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)), 2)) as subtotal,
  sum(round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 0.16), 2)) as iva,
  sum(round((((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)- ((tc_keet_contratos_destajos_proveedores.costo- tc_keet_contratos_destajos_proveedores.anticipo)* (tc_mantic_proveedores.fondo_garantia/100)))* 1.16), 2)) as total
from
  tc_keet_nominas
inner join 
  tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
inner join	
  tc_keet_contratos_destajos_proveedores on tc_keet_nominas.id_nomina= tc_keet_contratos_destajos_proveedores.id_nomina
inner join
  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
inner join 
  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
inner join 
	tc_mantic_tipos_medios_pagos on tc_mantic_proveedores.id_tipo_medio_pago= tc_mantic_tipos_medios_pagos.id_tipo_medio_pago
inner join 
  tc_keet_contratos_lotes	on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
inner join 
  tc_keet_contratos on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
inner join 
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join ( 
  select 
    tc_keet_proveedores_departamentos.id_proveedor,
    concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
    group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
  from
    tc_keet_proveedores_departamentos
  inner join
    tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  group by
    tc_keet_proveedores_departamentos.id_proveedor				  
) as tt_keet_departamentos on tc_mantic_proveedores.id_proveedor= tt_keet_departamentos.id_proveedor
where
  tc_keet_nominas.id_nomina= {idNomina} 
group by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.id_contrato,
  tc_mantic_proveedores.id_proveedor
order by
  tc_keet_desarrollos.nombres,
  tc_mantic_proveedores.razon_social        
      </select> 
			<select id="personalEnDesarrollo">
select
  tt_keet_salarios.id_key,
  tt_keet_salarios.id_desarrollo,
  ifnull(min(tt_keet_salarios.nomina), 0) as minimo,
  ifnull(max(tt_keet_salarios.nomina), 0) as maximo,
  ifnull(sum(tt_keet_salarios.por_dia), 0) as por_dia,
  ifnull(sum(tt_keet_salarios.por_obra), 0) as por_obra     
from (      
  select
    tc_keet_nominas_desarrollos.id_nomina_desarrollo as id_key,
    tc_keet_desarrollos.id_desarrollo,
    if(tc_keet_nominas_periodos.ejercicio is null,'1900-1',concat(tc_keet_nominas_periodos.ejercicio,'-', if(tc_keet_nominas_periodos.orden&lt; 9, concat('0', tc_keet_nominas_periodos.orden), tc_keet_nominas_periodos.orden))) as nomina,
    if(position(concat('|',tr_mantic_empresa_personal.id_puesto,'|') in '{puestosPorDia}')&gt; 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto, 0) as por_dia,
    if(position(concat('|',tr_mantic_empresa_personal.id_puesto,'|') in '{puestosPorObra}')&gt; 0 and tr_mantic_empresa_personal.id_contratista is null, tc_keet_nominas_personas.neto,0) as por_obra         
  from
    tc_keet_nominas_desarrollos         
  inner join
    tc_keet_desarrollos on tc_keet_nominas_desarrollos.id_desarrollo= tc_keet_desarrollos.id_desarrollo         
  inner join  
    tc_keet_nominas on tc_keet_nominas.id_nomina= tc_keet_nominas_desarrollos.id_nomina
  inner join 
    tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
  inner join
    tr_mantic_empresa_personal on tc_keet_nominas_desarrollos.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
  inner join 
    tc_keet_nominas_personas on tc_keet_nominas_desarrollos.id_nomina= tc_keet_nominas_personas.id_nomina and tc_keet_nominas_desarrollos.id_empresa_persona= tc_keet_nominas_personas.id_empresa_persona
  inner join 
    tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
  where
    tc_keet_nominas_desarrollos.id_desarrollo= {idDesarrollo}
    and tc_keet_nominas.id_nomina in ({nominas})
    and tr_mantic_empresa_personal.id_contratista is null
    and tc_mantic_personas.id_tipo_persona!= 1
    and tr_mantic_empresa_personal.id_puesto in ({personal})
    and tc_keet_nominas_personas.neto&gt; 0
  group by
    tc_keet_desarrollos.id_desarrollo,
    tc_keet_nominas.id_nomina,
    tr_mantic_empresa_personal.id_empresa_persona
) as tt_keet_salarios
			</select>
			<select id="contratos">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_contratos.id_empresa,
  tc_mantic_empresas.nombre as empresa,  
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_mantic_clientes.razon_social as cliente,
  tc_keet_contratos.ejercicio,
  tc_keet_contratos.orden,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.etapa
from
  tc_keet_contratos_lotes 
inner join
  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join
  tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
where 
  tc_keet_contratos.id_contrato_estatus&lt;= {idContratoEstatus}
  and (tc_keet_contratos_lotes.id_contrato= {idContrato} or {idContrato}= -1)
group by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.id_contrato
order by
  tc_keet_desarrollos.id_desarrollo,
  tc_keet_contratos.id_contrato        
			</select>
			<select id="listado">
        select
          tt_keet_contratos.id_key,
          tt_keet_contratos.id_nomina,
          tt_keet_contratos.id_desarrollo,
          tt_keet_contratos.desarrollo,
          tt_keet_contratos.id_contrato,
          tt_keet_contratos.clave,
  				tt_keet_contratos.contrato,
	  			tt_keet_contratos.etapa,
          sum(tt_keet_contratos.costo- tt_keet_contratos.anticipo) as costo,
          tt_keet_contratos.total,
          tt_keet_contratos.destajos,
          tt_keet_contratos.subcontratados,
          tt_keet_contratos.por_el_dia  
       from (        
          select 
            tc_keet_contratos.id_contrato as id_key,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_contratos_destajos_contratistas.id_nomina,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.id_contrato,
            tc_keet_contratos.id_empresa,
            tc_keet_contratos.ejercicio,
            tc_keet_contratos.orden,
            tc_keet_contratos.clave,
						tc_keet_contratos.nombre as contrato,
						tc_keet_contratos.etapa,
            sum(tc_keet_contratos_destajos_contratistas.costo) as costo, 
            sum(tc_keet_contratos_destajos_contratistas.anticipo) as anticipo,
            tc_keet_contratos.costo as total,
            tc_keet_contratos.destajos,
            tc_keet_contratos.subcontratados,
            tc_keet_contratos.por_el_dia  
          from
            tc_keet_contratos_destajos_contratistas 
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
          where 
            tc_keet_contratos_destajos_contratistas.id_nomina{operador}= {idNomina}
            and tc_keet_contratos.id_contrato_estatus&lt;= {idContratoEstatus}
            and tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
            and (tc_keet_contratos_lotes.id_contrato= {idContrato} or {idContrato}= -1)
          group by
            tc_keet_contratos_lotes.id_contrato
          union all  
          select 
            tc_keet_contratos.id_contrato as id_key,
            tc_keet_desarrollos.id_desarrollo,
            tc_keet_contratos_destajos_proveedores.id_nomina,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.id_contrato,
            tc_keet_contratos.id_empresa,
            tc_keet_contratos.ejercicio,
            tc_keet_contratos.orden,
            tc_keet_contratos.clave,
						tc_keet_contratos.nombre as contrato,
						tc_keet_contratos.etapa,
            sum(tc_keet_contratos_destajos_proveedores.costo) as costo, 
            sum(tc_keet_contratos_destajos_proveedores.anticipo) as anticipo,
            tc_keet_contratos.costo as total,
            tc_keet_contratos.destajos,
            tc_keet_contratos.subcontratados,
            tc_keet_contratos.por_el_dia  
          from
            tc_keet_contratos_destajos_proveedores 
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
          where 
            tc_keet_contratos_destajos_proveedores.id_nomina{operador}= {idNomina}
            and tc_keet_contratos.id_contrato_estatus&lt;= {idContratoEstatus}
            and tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
            and (tc_keet_contratos_lotes.id_contrato= {idContrato} or {idContrato}= -1)
          group by
            tc_keet_contratos_lotes.id_contrato
        ) as tt_keet_contratos
        group by
          id_desarrollo,
          id_contrato
        order by
          id_desarrollo,
          id_contrato        
			</select>
			<select id="estimados">
select
  tc_keet_estaciones.id_estacion as id_key,
  tc_keet_contratos.id_contrato,
  tc_keet_contratos.id_contrato_estatus,
  concat('M',tc_keet_contratos_lotes.manzana,'L',tc_keet_contratos_lotes.lote) as lote,
  tc_keet_estaciones.codigo,
  tc_keet_estaciones.nombre,
  ifnull(tt_destajo_nomina.id_nomina, 0) as id_nomina,
  ifnull(tt_destajo_nomina.id_tipo, 1) as id_tipo,
  ifnull(tc_keet_rubros.id_extra,-1) as id_extra,
  ifnull(tt_destajo_nomina.porcentaje, 0) as porcentaje,
  ifnull(tt_destajo_nomina.costo, tc_keet_estaciones.costo) as costo,
  tc_keet_estaciones.costo as estimado,
  ifnull(tt_destajo_nomina.anticipo, 0) as anticipo,
  concat(tc_keet_nominas_periodos.ejercicio,'-',tc_keet_nominas_periodos.orden) as semana,
  if(tt_destajo_nomina.id_nomina is null, 1, 2) as actual         
from
  tc_keet_estaciones                  
inner join
  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo         
inner join
  tc_keet_contratos on tc_keet_contratos.id_empresa= convert(substring(tc_keet_estaciones.clave, 1, 3), unsigned integer) and substring(tc_keet_estaciones.clave, 4, 4)= tc_keet_contratos.ejercicio and substring(tc_keet_estaciones.clave, 8, 3)= tc_keet_contratos.orden
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.orden= substring(tc_keet_estaciones.clave,11,3)
left join
(select
  tt_estacion_nomina.id_estacion,
  tt_estacion_nomina.id_contrato_lote,
  tt_estacion_nomina.id_tipo,
  max(tt_estacion_nomina.id_nomina) as id_nomina,
  sum(tt_estacion_nomina.porcentaje) as porcentaje,
  sum(tt_estacion_nomina.costo) as costo,
  sum(tt_estacion_nomina.anticipo) as anticipo           
from
  (select
    tc_keet_contratos_destajos_contratistas.id_estacion,
    tc_keet_contratos_lotes_contratistas.id_contrato_lote,
    1 as id_tipo,
    tc_keet_contratos_destajos_contratistas.id_nomina,
    sum(tc_keet_contratos_destajos_contratistas.porcentaje) as porcentaje,
    sum(tc_keet_contratos_destajos_contratistas.costo) as costo,
    sum(tc_keet_contratos_destajos_contratistas.anticipo) as anticipo
  from
    tc_keet_contratos_destajos_contratistas              
  inner join
    tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista             
  where
    (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} or {idNomina}= -1) and tc_keet_contratos_destajos_contratistas.id_nomina is not null and tc_keet_contratos_destajos_contratistas.costo&gt; 0
  group by
    tc_keet_contratos_destajos_contratistas.id_estacion,
    tc_keet_contratos_lotes_contratistas.id_contrato_lote,
    id_tipo
  union all             
  select
    tc_keet_contratos_destajos_proveedores.id_estacion,
    tc_keet_contratos_lotes_proveedores.id_contrato_lote,
    2 as id_tipo,
    tc_keet_contratos_destajos_proveedores.id_nomina,
    sum(tc_keet_contratos_destajos_proveedores.porcentaje) as porcentaje,
    sum(tc_keet_contratos_destajos_proveedores.costo) as costo,
    sum(tc_keet_contratos_destajos_proveedores.anticipo) as anticipo
  from
    tc_keet_contratos_destajos_proveedores             
  inner join
    tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor             
  where
    (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} or {idNomina}= -1)  and tc_keet_contratos_destajos_proveedores.id_nomina is not null and tc_keet_contratos_destajos_proveedores.costo&gt; 0 
  group by
    tc_keet_contratos_destajos_proveedores.id_estacion,
    tc_keet_contratos_lotes_proveedores.id_contrato_lote,
    id_tipo
) tt_estacion_nomina           
group by
  id_estacion,
  id_tipo,
  id_nomina) as tt_destajo_nomina on tc_keet_estaciones.id_estacion= tt_destajo_nomina.id_estacion         
left join
  tc_keet_nominas on tt_destajo_nomina.id_nomina= tc_keet_nominas.id_nomina
left join
  tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
where
  tc_keet_estaciones.clave like '{clave}%'              
  and tc_keet_estaciones.nivel&gt;= 5            
  and tc_keet_estaciones.nivel&lt;= 6         
  and tc_keet_contratos.id_contrato_estatus&lt;= {idContratoEstatus}
  and (tc_keet_contratos.id_contrato= {idContrato} or {idContrato}= -1)
group by
  tc_keet_estaciones.id_estacion,
  tc_keet_contratos_lotes.manzana,
  tc_keet_contratos_lotes.lote,
  tc_keet_estaciones.codigo         
order by
  tc_keet_contratos_lotes.orden,
  tc_keet_estaciones.clave
      </select>  
			<select id="destajos">
select
  tc_keet_contratos_lotes.id_contrato_lote as id_key,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
  tc_keet_estaciones.codigo,
  tc_keet_estaciones.nombre,
  ifnull(tt_destajo_nomina.id_nomina, -1) as id_nomina,
  ifnull(tt_destajo_nomina.id_tipo, 1) as id_tipo,
  ifnull(tt_destajo_nomina.porcentaje, 0) as porcentaje,
  ifnull(tt_destajo_nomina.costo, 0) as costo,
  ifnull(tt_destajo_nomina.anticipo, 0) as anticipo,
  concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden) as semana,
  if(substring(tc_keet_estaciones.codigo, 1, 1)= '#', 4, if(tt_destajo_nomina.id_nomina is null, 3, if(concat(tc_keet_nominas_periodos.ejercicio, '-',  tc_keet_nominas_periodos.orden)= '{semana}', 1, 2))) as actual,
  ifnull(tc_keet_rubros.id_extra, -1) as id_extra
from
  tc_keet_estaciones         
inner join
  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
inner join
  tc_keet_contratos on tc_keet_contratos.id_empresa= convert(substring(tc_keet_estaciones.clave, 1, 3), unsigned integer) and tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.orden= substring(tc_keet_estaciones.clave,11,3)
left join (
  select 
    tt_estacion_nomina.id_estacion,
    tt_estacion_nomina.id_contrato_lote,
    tt_estacion_nomina.id_tipo,
    max(tt_estacion_nomina.id_nomina) as id_nomina,
    sum(tt_estacion_nomina.porcentaje) as porcentaje,
    sum(tt_estacion_nomina.costo) as costo,
    sum(tt_estacion_nomina.anticipo) as anticipo
  from (      
    select 
      tc_keet_contratos_destajos_contratistas.id_estacion, 
      tc_keet_contratos_lotes_contratistas.id_contrato_lote,
      1 as id_tipo, 
      tc_keet_contratos_destajos_contratistas.id_nomina, 
      sum(tc_keet_contratos_destajos_contratistas.porcentaje) as porcentaje, 
      sum(tc_keet_contratos_destajos_contratistas.costo) as costo, 
      sum(tc_keet_contratos_destajos_contratistas.anticipo) as anticipo 
    from 
      tc_keet_contratos_destajos_contratistas 
    inner join
      tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
    where 
      (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} or {idNomina}= -1) and tc_keet_contratos_destajos_contratistas.id_nomina is not null and tc_keet_contratos_destajos_contratistas.costo&gt; 0
    group by
      tc_keet_contratos_destajos_contratistas.id_estacion,
      tc_keet_contratos_lotes_contratistas.id_contrato_lote,
      id_tipo
    union all
    select 
      tc_keet_contratos_destajos_proveedores.id_estacion, 
      tc_keet_contratos_lotes_proveedores.id_contrato_lote,
      2 as id_tipo, 
      tc_keet_contratos_destajos_proveedores.id_nomina, 
      sum(tc_keet_contratos_destajos_proveedores.porcentaje) as porcentaje, 
      sum(tc_keet_contratos_destajos_proveedores.costo) as costo, 
      sum(tc_keet_contratos_destajos_proveedores.anticipo) as anticipo 
    from 
      tc_keet_contratos_destajos_proveedores
    inner join
      tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
    where 
      (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} or {idNomina}= -1)  and tc_keet_contratos_destajos_proveedores.id_nomina is not null and tc_keet_contratos_destajos_proveedores.costo&gt; 0 
    group by
      tc_keet_contratos_destajos_proveedores.id_estacion,
      tc_keet_contratos_lotes_proveedores.id_contrato_lote,
      id_tipo
  ) tt_estacion_nomina
  where
    tt_estacion_nomina.id_nomina is not null
  group by
    id_estacion, id_tipo, id_nomina
) as tt_destajo_nomina on tc_keet_estaciones.id_estacion= tt_destajo_nomina.id_estacion
left join
  tc_keet_nominas on tc_keet_nominas.id_nomina= tt_destajo_nomina.id_nomina         
left join 
  tc_keet_nominas_periodos on tc_keet_nominas_periodos.id_nomina_periodo= tc_keet_nominas.id_nomina_periodo
where
  tc_keet_estaciones.clave like '{clave}%'              
  and tc_keet_estaciones.nivel&gt;= 5            
  and tc_keet_estaciones.nivel&lt;= 6         
  and (tc_keet_nominas.id_nomina= {idNomina} or {idNomina}= -1 or tc_keet_nominas.id_nomina is not null)
  and tc_keet_contratos.id_contrato_estatus&lt;= {idContratoEstatus}
  and (tc_keet_contratos.id_contrato= {idContrato} or {idContrato}= -1)
group by
  tc_keet_estaciones.id_estacion,
  tc_keet_contratos_lotes.manzana,
  tc_keet_contratos_lotes.lote,
  tc_keet_estaciones.codigo         
order by
  tc_keet_contratos_lotes.orden,
  tc_keet_estaciones.clave
      </select>  
			<select id="lazy">
				select
					tc_keet_nominas.id_nomina as id_key,
					tc_keet_nominas.id_nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
          tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_tipos_nominas.nombre as tipo,
					tc_keet_nominas_periodos.corte,
					tc_keet_nominas.id_nomina_estatus,
					tc_keet_nominas_estatus.nombre as estatus,
					tc_keet_nominas.proveedores,
					tc_keet_nominas.total,
					tc_keet_nominas.personas,
					tc_keet_nominas.neto,
				  (tc_keet_nominas.neto+ tc_keet_nominas.total) as global,
				  tc_keet_nominas_estatus.estatus_asociados
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_tipos_nominas on tc_keet_nominas.id_tipo_nomina= tc_keet_tipos_nominas.id_tipo_nomina
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
				  tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				  and {condicion}
				{sortOrder}
			</select>
			<select id="movimientos">
        select
          tt_keet_temporal.*
        from (        
          select 
            convert(concat('1', tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista), unsigned integer) as id_key,
            1 as id_tipo_proceso,
            tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_persona_reprocesar,
            concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
            tc_keet_proyectos.id_desarrollo,
            tc_keet_contratos.consecutivo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.clave,
            tc_keet_contratos.nombre as contrato,
            tc_keet_contratos.etapa,
            concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
            tc_keet_prototipos.nombre as prototipo,
            tc_keet_estaciones.codigo,
            tc_keet_rubros.nombre,
            ifnull(tc_keet_estaciones.descripcion, tc_keet_estaciones.nombre) as concepto,
            tc_keet_contratos_destajos_contratistas.porcentaje,
            tc_keet_contratos_destajos_contratistas.costo,
            0 as garantia,
            0 as iva,
            tc_keet_contratos_destajos_contratistas.costo as total,
            tc_keet_contratos_destajos_contratistas.registro,
            0 as fondo_garantia
          from
            tc_keet_contratos_destajos_contratistas 
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
          inner join
            tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
  				inner join 
	  				tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
          inner join
            tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          inner join
            tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo and tc_keet_puntos_grupos.id_departamento= tc_keet_contratistas_departamentos.id_departamento         
          where 
            tc_keet_contratos_destajos_contratistas.id_nomina is null
            and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
          union all  
          select 
            convert(concat('2', tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor), unsigned integer) as id_key,
            2 as id_tipo_proceso,
            tc_keet_contratos_lotes_proveedores.id_proveedor as id_persona_reprocesar,
            tc_mantic_proveedores.razon_social as nombre_completo,
            tc_keet_proyectos.id_desarrollo,
            tc_keet_contratos.consecutivo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.clave,
            tc_keet_contratos.nombre as contrato,
            tc_keet_contratos.etapa,
            concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
            tc_keet_prototipos.nombre as prototipo,
            tc_keet_estaciones.codigo,
            tc_keet_rubros.nombre,
            tc_keet_rubros.nombre as concepto,
            tc_keet_contratos_destajos_proveedores.porcentaje,
            tc_keet_contratos_destajos_proveedores.costo,
            round(tc_keet_contratos_destajos_proveedores.costo* (tc_mantic_proveedores.fondo_garantia/100), 2) as garantia,
            round((tc_keet_contratos_destajos_proveedores.costo* (1- (tc_mantic_proveedores.fondo_garantia/100))* 0.16), 2) as iva,
            round((tc_keet_contratos_destajos_proveedores.costo* (1- (tc_mantic_proveedores.fondo_garantia/100)))* 1.16, 2) as total,
            tc_keet_contratos_destajos_proveedores.registro,
            tc_mantic_proveedores.fondo_garantia          
          from
            tc_keet_contratos_destajos_proveedores 
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          inner join
            tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
          inner join
            tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
          inner join 
            tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
          where 
            tc_keet_contratos_destajos_proveedores.id_nomina is null
            and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
        ) as tt_keet_temporal
        where
          tt_keet_temporal.porcentaje&gt; 0
        group by
          tt_keet_temporal.id_persona_reprocesar,
          tt_keet_temporal.id_desarrollo,
          tt_keet_temporal.clave,
          tt_keet_temporal.lote,
          tt_keet_temporal.codigo          
        order by
          tt_keet_temporal.id_persona_reprocesar,
          tt_keet_temporal.id_desarrollo,
          tt_keet_temporal.clave,
          tt_keet_temporal.lote,
          tt_keet_temporal.codigo
      </select>  
			<select id="extras">
        select
          tt_keet_temporal.*
        from (        
          select 
            convert(concat('1', tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista), unsigned integer) as id_key,
            1 as tipo,
            tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista as id_contrato_lote_pivote,
            tc_keet_estaciones.id_estacion,
            tc_keet_estaciones.clave as clave_estacion,
            tc_keet_contratos_puntos_contratistas.id_punto_paquete,
            tc_keet_contratos_puntos_contratistas.factor,
            tc_keet_contratos_lotes_contratistas.id_contrato_lote,
            tc_keet_contratos_lotes_contratistas.id_empresa_persona as id_persona,
            concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as razon_social,
            concat(tt_mantic_personas.nombres, ' ', ifnull(tt_mantic_personas.paterno, ' '), ' ', ifnull(tt_mantic_personas.materno, ' ')) as residente,
            tc_keet_proyectos.id_desarrollo,
            tc_keet_contratos.consecutivo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.clave,
            tc_keet_contratos.nombre as contrato,
            tc_keet_contratos.etapa,
            concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
            tc_keet_prototipos.nombre as prototipo,
            tc_keet_estaciones.codigo,
            tc_keet_rubros.nombre,
            ifnull(tc_keet_estaciones.descripcion, tc_keet_estaciones.nombre) as concepto,
            tc_keet_contratos_destajos_contratistas.porcentaje,
            tc_keet_contratos_destajos_contratistas.costo,
            0 as garantia,
            0 as iva,
            tc_keet_contratos_destajos_contratistas.costo as total,
            tc_keet_contratos_destajos_contratistas.registro,
            0 as fondo_garantia,
            tc_keet_contratos_destajos_contratistas.id_nomina,
            tc_keet_contratos_destajos_contratistas.justificacion
          from
            tc_keet_contratos_destajos_contratistas 
          inner join
            tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista= tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
          inner join
            tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista     
          inner join
            tr_mantic_empresa_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_lotes_contratistas.id_empresa_persona
  				inner join 
	  				tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote     
          inner join
            tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato     
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto     
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo     
          inner join
            tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion     
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
  				inner join 
	  				tc_janal_usuarios on tc_keet_contratos_destajos_contratistas.id_usuario= tc_janal_usuarios.id_usuario
  				inner join 
	  				tc_mantic_personas as tt_mantic_personas on tc_janal_usuarios.id_persona= tt_mantic_personas.id_persona
          where 
            tc_keet_rubros.id_extra= 1
            and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
            and concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) regexp '{nombre}.*'
            and {contratistas}
            and {condicion}
          union all  
          select 
            convert(concat('2', tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor), unsigned integer) as id_key,
            2 as tipo,
            tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_contrato_lote_pivote,
            tc_keet_estaciones.id_estacion,
            tc_keet_estaciones.clave as clave_estacion,
            tc_keet_contratos_puntos_proveedores.id_punto_paquete,
            tc_keet_contratos_puntos_proveedores.factor,
            tc_keet_contratos_lotes_proveedores.id_contrato_lote,
            tc_keet_contratos_lotes_proveedores.id_proveedor as id_persona,
            tc_mantic_proveedores.razon_social,
            concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as residente,
            tc_keet_proyectos.id_desarrollo,
            tc_keet_contratos.consecutivo,
            tc_keet_desarrollos.nombres as desarrollo,
            tc_keet_contratos.clave,
            tc_keet_contratos.nombre as contrato,
            tc_keet_contratos.etapa,
            concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
            tc_keet_prototipos.nombre as prototipo,
            tc_keet_estaciones.codigo,
            tc_keet_rubros.nombre,
            tc_keet_rubros.nombre as concepto,
            tc_keet_contratos_destajos_proveedores.porcentaje,
            tc_keet_contratos_destajos_proveedores.costo,
            round(tc_keet_contratos_destajos_proveedores.costo* (tc_mantic_proveedores.fondo_garantia/100), 2) as garantia,
            round((tc_keet_contratos_destajos_proveedores.costo* (1- (tc_mantic_proveedores.fondo_garantia/100))* 0.16), 2) as iva,
            round((tc_keet_contratos_destajos_proveedores.costo* (1- (tc_mantic_proveedores.fondo_garantia/100)))* 1.16, 2) as total,
            tc_keet_contratos_destajos_proveedores.registro,
            tc_mantic_proveedores.fondo_garantia,
            tc_keet_contratos_destajos_proveedores.id_nomina,
            tc_keet_contratos_destajos_proveedores.justificacion      
          from
            tc_keet_contratos_destajos_proveedores 
          inner join
            tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor= tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
          inner join
            tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
          inner join
            tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
          inner join
            tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
          inner join
            tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
          inner join
            tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
          inner join
            tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
          inner join
            tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
          inner join 
            tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
          inner join
            tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
  				inner join 
	  				tc_janal_usuarios on tc_keet_contratos_destajos_proveedores.id_usuario= tc_janal_usuarios.id_usuario
  				inner join 
	  				tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
          where 
            tc_keet_rubros.id_extra= 1
            and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
            and tc_mantic_proveedores.razon_social regexp '{nombre}.*'
            and {subcontratistas}
            and {condicion}
        ) as tt_keet_temporal
        where
          tt_keet_temporal.porcentaje&gt; 0
        group by
          tt_keet_temporal.id_persona,
          tt_keet_temporal.id_desarrollo,
          tt_keet_temporal.clave,
          tt_keet_temporal.lote,
          tt_keet_temporal.codigo          
        {sortOrder}
      </select>  
			<select id="detalle">
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as sucursal,  
				  1 as id_tipo_proceso,
				  tr_mantic_empresa_personal.id_empresa_persona as id_persona_reprocesar,
					'PERSONAL' as tipo,
					tr_mantic_empresa_personal.clave,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.apodo,
					tc_keet_nominas_personas.neto as importe,
					tc_mantic_puestos.id_puesto,
					tc_mantic_personas.id_persona
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_nominas.id_nomina= {idNomina}
					and (upper(concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', ifnull(tc_mantic_personas.materno, ''), ' ', ifnull(tc_mantic_personas.apodo, ''))) regexp '{nombre}.*')
				union all
				select
					tc_keet_nominas_proveedores.id_nomina_proveedor as id_key,
					tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as sucursal,  
				  2 as id_tipo_proceso,
				  tc_mantic_proveedores.id_proveedor as id_persona_reprocesar,
					'SUBCONTRATISTA' as tipo,
					tc_mantic_proveedores.clave,
					tc_mantic_proveedores.razon_social as nombre_completo,
					tc_mantic_proveedores.rfc as apodo,
					tc_keet_nominas_proveedores.total as importe,
					-1 as id_puesto,
					tc_mantic_proveedores.id_proveedor as id_persona
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_proveedores on tc_keet_nominas.id_nomina= tc_keet_nominas_proveedores.id_nomina
				inner join 
					tc_mantic_proveedores on tc_keet_nominas_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_nominas.id_nomina= {idNomina}
					and upper(ifnull(tc_mantic_proveedores.razon_social, '')) regexp '{nombre}.*'
				{sortOrder}
			</select>
			<select id="ejercicios">
				select
					distinct(tc_keet_nominas_periodos.ejercicio) as id_key,
					tc_keet_nominas_periodos.ejercicio
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
				  tc_keet_nominas_periodos.ejercicio desc				
			</select>
			<select id="periodo">
				select
					distinct(tc_keet_nominas_periodos.id_nomina_periodo) as id_key,
          tc_keet_nominas.id_nomina,
					tc_keet_nominas_periodos.*
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
          and tc_keet_nominas.id_tipo_nomina = 1
				order by
				  tc_keet_nominas.id_nomina desc				
			</select>
			<select id="secuencia">
				select
					distinct(tc_keet_nominas_periodos.id_nomina_periodo) as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
          tc_keet_nominas.id_nomina,
					tc_keet_nominas_periodos.*
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (3, 4)
          and tc_keet_nominas.id_tipo_nomina = 1
          and tc_keet_nominas.id_nomina {equals} {idNomina}
				order by
				  tc_keet_nominas.id_nomina {orden}				
			</select>
			<select id="semanas">
				select
					distinct(tc_keet_nominas_periodos.orden) as id_key,
          tc_keet_nominas.id_nomina,
					tc_keet_nominas_periodos.orden as semana,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
          tc_keet_nominas_periodos.inicio as ini,
          tc_keet_nominas_periodos.termino as fin
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
          and (tc_keet_nominas_periodos.ejercicio= {ejercicio} or {ejercicio}= -1)
				order by
				  tc_keet_nominas_periodos.orden desc				
			</select>
			<select id="semana">
				select
					max(tc_keet_nominas_periodos.orden) as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3)
			</select>
			<select id="todos">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
          and tc_mantic_personas.id_tipo_persona!= 2
          and {condicion}
				order by
					tr_mantic_empresa_personal.id_empresa, 
          tr_mantic_empresa_personal.id_empresa_persona
			</select>
			<select id="algunos">
        select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
					tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
          and tc_mantic_personas.id_tipo_persona!= 2
				  and tr_mantic_empresa_personal.id_empresa_persona not in (
				    select
				      tc_keet_nominas_personas.id_empresa_persona
				    from 
				      tc_keet_nominas_personas 
				    where
				      tc_keet_nominas_personas.id_nomina= {idNomina}
				 )
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave	
			</select>
			<select id="persona">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
          and tc_mantic_personas.id_tipo_persona!= 2
				  and tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
			<select id="ultima">
select
  tc_keet_nominas.id_nomina as id_key,
  tc_keet_nominas.id_nomina,
  concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
  concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as semana,
  tc_keet_nominas.id_tipo_nomina,
  tc_keet_nominas.proveedores,
  tc_keet_nominas.personas,
  tc_keet_nominas.total,
  tc_keet_nominas.neto,
  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
  tc_keet_nominas_periodos.*,
  tc_keet_nominas_estatus.id_nomina_estatus,
  tc_keet_nominas_estatus.nombre as estatus,
  tc_keet_nominas.observaciones,
  tc_keet_nominas_periodos.inicio as ini,
  tc_keet_nominas_periodos.termino as fin
from
  tc_keet_nominas
inner join 
  tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
inner join 
  tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
where
  tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
order by
  tc_keet_nominas.id_nomina desc, tc_keet_nominas.id_nomina_estatus desc
			</select>			
			<select id="referencia">
				select      
          tc_keet_nominas.id_nomina as id_key,
          tc_keet_nominas.id_nomina_estatus,
				  tc_keet_nominas_periodos.orden as semana
        from      
          tc_keet_nominas
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        where      
				  tc_keet_nominas.id_empresa in ({sucursales})
          and tc_keet_nominas.id_tipo_nomina = 1
			  order by
				   tc_keet_nominas.id_nomina desc, 
           tc_keet_nominas.id_nomina_estatus desc
			</select>
			<select id="activa">
				select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3)
        order by
          tc_keet_nominas.id_nomina desc          
			</select>
			<select id="anterior">
				select
					-1 as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (4)
        order by
          tc_keet_nominas.id_nomina desc
			</select>
			<select id="nominas">
        select
					tc_keet_nominas.id_nomina as id_key,
          tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas_periodos.ejercicio&gt;= {ejercicio}
					and tc_keet_nominas.id_nomina_estatus in (1,2,3,4)
				order by
				  nombre desc				
			</select>
			<select id="ejercicio">
        select
					tc_keet_nominas.id_nomina as id_key,
					tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas_periodos.ejercicio&gt;= {ejercicio}
					and tc_keet_nominas_periodos.orden= 1
					and tc_keet_nominas.id_nomina_estatus in (4)
				order by
				  nombre desc				
			</select>
			<select id="nomina">
        select
					tc_keet_nominas.id_nomina as id_key,
				  tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_tipo_nomina,
				  tc_keet_nominas.proveedores,
				  tc_keet_nominas.personas,
				  tc_keet_nominas.total,
				  tc_keet_nominas.neto,
				  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
					tc_keet_nominas_periodos.*,
				  tc_keet_nominas_estatus.id_nomina_estatus,
				  tc_keet_nominas_estatus.nombre as estatus,
				  tc_keet_nominas.observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_nomina= {idNomina}
			</select>
			<select id="pagos">
select
  tc_keet_nominas.id_nomina as id_key,
  tc_keet_nominas.id_nomina,
  tc_keet_nominas.id_tipo_nomina,
  tc_keet_nominas.proveedores,
  tc_keet_nominas.personas,
  tc_keet_nominas.total,
  tc_keet_nominas.neto,
  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
  concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
  tc_keet_nominas_periodos.*,
  tc_keet_nominas_estatus.id_nomina_estatus,
  tc_keet_nominas_estatus.nombre as estatus,
  tc_keet_nominas.observaciones
from
  tc_keet_nominas
inner join 
  tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
inner join 
  tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
where
  tc_keet_nominas.id_nomina&lt;= {idNomina}
order by  
  tc_keet_nominas.id_nomina desc
			</select>
			<select id="pagadas">
        select
					tc_keet_nominas.id_nomina as id_key,
				  tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_tipo_nomina,
				  tc_keet_nominas.proveedores,
				  tc_keet_nominas.personas,
				  tc_keet_nominas.total,
				  tc_keet_nominas.neto,
				  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as semana,
					tc_keet_nominas_periodos.*,
				  tc_keet_nominas_estatus.id_nomina_estatus,
				  tc_keet_nominas_estatus.nombre as estatus,
				  tc_keet_nominas.observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_nomina&gt;= {idNomina}
          and tc_keet_nominas.id_nomina_estatus= 4
       order by
          tc_keet_nominas.id_nomina  
			</select>
			<select id="complemento">
        select
					-1 as id_key,
				  tc_keet_nominas.id_nomina,
				  2 as id_tipo_nomina,
					tc_keet_nominas_periodos.*,
				  1 as id_nomina_estatus,
				  'INICIADA' as estatus,
				  ' ' as observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (4)
			</select>
			<select id="proveedor">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor,
          tc_mantic_proveedores.fondo_garantia,
				  tc_mantic_proveedores.clave
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					(tc_keet_contratos_destajos_proveedores.id_nomina is null or tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina})
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
			<select id="proveedores">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor,
          tc_mantic_proveedores.fondo_garantia,
				  tc_mantic_proveedores.clave
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					(tc_keet_contratos_destajos_proveedores.id_nomina is null or tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina})
          and tc_keet_contratos_destajos_proveedores.costo> 0
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
      <select id="incidentes">
select
  tc_mantic_incidentes.*
from 
  tc_mantic_incidentes
inner join
  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente and tc_mantic_tipos_incidentes.id_afecta_nomina= 1
where
  (tc_mantic_incidentes.id_nomina is null or tc_mantic_incidentes.id_nomina= {idNomina})
  and tc_mantic_incidentes.id_incidente_estatus in (2, 3)
  and tc_mantic_incidentes.id_empresa_persona= {idEmpresaPersona}
order by
  tc_mantic_incidentes.id_tipo_incidente, 
  tc_mantic_incidentes.inicio desc
			</select>			
      <select id="aplicar">
select
  tc_mantic_incidentes.*
from 
  tc_mantic_incidentes
inner join
  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente 
where
  tc_mantic_incidentes.id_nomina is null
  and tc_mantic_incidentes.id_incidente_estatus= 2
  and tc_mantic_tipos_incidentes.id_afecta_nomina= 2
union all
select
  tc_mantic_incidentes.*
from 
  tc_mantic_incidentes
where
  tc_mantic_incidentes.id_nomina= {idNomina}
  and tc_mantic_incidentes.id_incidente_estatus in (2, 3)
			</select>	
      <select id="anticipos">
			  select
				  tc_keet_incidentes.*
				from 
				  tc_keet_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_keet_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente 
			  where
				  tc_keet_incidentes.id_nomina is null
				  and tc_keet_incidentes.id_incidente_estatus= 2
				  and tc_mantic_tipos_incidentes.id_afecta_nomina= 2
			  union all
 			  select
				  tc_keet_incidentes.*
				from 
				  tc_keet_incidentes
			  where
				  tc_keet_incidentes.id_nomina= {idNomina}
				  and tc_keet_incidentes.id_incidente_estatus= 2			
			</select>	
			<select id="contratista">
        select 
				  tc_keet_contratos_destajos_contratistas.*
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina is null or tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina})
          and tc_keet_contratos_destajos_contratistas.id_estacion_estatus in (2, 3)
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
			</select>
			<select id="agremiados">
				select 
					{idEmpresaPersona} as id_contratista,
					count(*) as agremiados,
					sum(sueldo_semanal+ sobre_sueldo) as salarios
				from
					tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				where
					tr_mantic_empresa_personal.id_contratista= {idEmpresaPersona}
					and tr_mantic_empresa_personal.id_activo= 1
					and tr_mantic_empresa_personal.id_empresa_persona!= {idEmpresaPersona}				
			</select>	
      <select id="subContratista">
         select 
				  tc_keet_contratos_destajos_proveedores.*
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina is null or tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina})
          and tc_keet_contratos_destajos_proveedores.id_estacion_estatus in (2, 3)
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
			</select>
			<select id="personalPorDia">
				select
					count(*) as tuplas
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
          and tr_mantic_empresa_personal.id_contratista is null 
          and tr_mantic_empresa_personal.id_puesto!= 6
      </select>  
			<select id="ordinaria">
        select
          sum(tuplas) as tuplas
        from (				
				select
					count(*) as tuplas
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
        union all
        select
					count(distinct(tc_keet_contratos_lotes_proveedores.id_proveedor)) as tuplas
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					(tc_keet_contratos_destajos_proveedores.id_nomina is null or tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina})
				) total				
			</select>	
			<select id="complementaria">
        select
          sum(total) as tuplas
        from (				
        select
					count(*) as total
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona not in (
				    select
				      tc_keet_nominas_personas.id_empresa_persona
				    from 
				      tc_keet_nominas_personas 
				    where
				      tc_keet_nominas_personas.id_nomina= {idNomina}
				)        
			  union all
        select
					count(distinct(tc_keet_contratos_lotes_proveedores.id_proveedor)) as total
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				) total				
			</select>
			<select id="rubros">
				select 
				  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_key,
				  tc_keet_rubros.id_rubro,
				  tc_keet_contratos_lotes.id_contrato_lote,
 				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  '00111100' as sat,
				  tc_keet_estaciones.nombre,
				  max(tc_keet_contratos_destajos_proveedores.porcentaje) as cantidad,
				  round(sum(tc_keet_contratos_destajos_proveedores.costo), 2) as destajo,
				  round(sum(tc_keet_contratos_destajos_proveedores.anticipo), 2) as anticipo,
				  0 as fondo_garantia,
				  0 as subtotal,
				  0 as iva,
				  0 as total
			  from
				  tc_keet_contratos_lotes_proveedores
			  inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
			  inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
			  inner join
			    tc_keet_contratos_destajos_proveedores on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor
			  inner join	 
			    tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion 
        inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
			  where 
			    tc_keet_contratos_destajos_proveedores.id_nomina is null
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}		
          and tc_keet_contratos_destajos_proveedores.costo> 0
        group by
				  tc_keet_rubros.id_rubro,
				  tc_keet_contratos_lotes.id_contrato_lote
		    order by
			    lote, tc_keet_estaciones.codigo				
			</select>					
		</unit>
		<unit id="VistaContratosLotesMaterialesDto">
			<select id="estaciones">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*,
					tc_mantic_unidades_medidas.nombre as medida
				from 
					tc_keet_materiales
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_materiales.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'
				order by
					tc_keet_materiales.clave
			</select>	
			<select id="material">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where
					tc_keet_materiales.clave like '{clave}%'
				  and tc_keet_materiales.codigo= '{codigo}'
				  and tc_keet_materiales.nivel= 7
				order by
					tc_keet_materiales.clave
			</select>		
      <select id="estacion">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where
					tc_keet_materiales.clave= '{clave}'
				  and tc_keet_materiales.nivel= {nivel}
				order by
					tc_keet_materiales.clave
			</select>		
			<select id="exportar">
				select
				  tc_keet_materiales.id_material as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_keet_materiales.costo as "costo s/iva",
					tc_mantic_unidades_medidas.clave as "unidad medida",
				  date_format(tc_keet_materiales.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_materiales.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_materiales
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_materiales.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'
					and tc_keet_materiales.nivel> 4
				order by
					tc_keet_materiales.clave
			</select>	
			<select id="buscar">
				select
					tc_keet_temporal.*
				from (
				select
				 1000+ tc_keet_partidas.id_partida as id_key,
				 tc_keet_partidas.codigo,
				 5 as nivel,
				 2 as ultimo
				from
					tc_keet_partidas
				union all
				select
				 2000+ tc_keet_rubros.id_rubro as id_key,
				 tc_keet_rubros.codigo,
				 6 as nivel,
				 2 as ultimo
				from
					tc_keet_rubros
				union all
        select
				 3000+ tc_mantic_articulos.id_articulo as id_key,
				 tc_mantic_articulos_codigos.codigo,
				 7 as nivel,
				 1 as ultimo
				from
          tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo				
				) as tc_keet_temporal
				where
					tc_keet_temporal.codigo= '{codigo}'
			</select>													
		</unit>
		<unit id="VistaContratosLotesDto">
			<select id="buscar">
				select
					tc_keet_temporal.*
				from (
				select
				 1000+ tc_keet_partidas.id_partida as id_key,
				 tc_keet_partidas.codigo,
				 5 as nivel,
				 2 as ultimo
				from
					tc_keet_partidas
				union all
				select
				 2000+ tc_keet_rubros.id_rubro as id_key,
				 tc_keet_rubros.codigo,
				 6 as nivel,
				 1 as ultimo
				from
					tc_keet_rubros
				) as tc_keet_temporal
				where
					tc_keet_temporal.codigo= '{codigo}'
			</select>	
			<select id="estaciones">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_estaciones
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_estaciones.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_estaciones.clave like '{clave}%'
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="ultima">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_estaciones
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_estaciones.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_estaciones.clave like '{clave}%'
				order by
					tc_keet_estaciones.clave desc
			</select>	
			<select id="estacion">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*
				from 
					tc_keet_estaciones
				where
					tc_keet_estaciones.clave= '{clave}'
				  and tc_keet_estaciones.nivel= 5
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="concepto">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*
				from 
					tc_keet_estaciones
				where
					tc_keet_estaciones.clave like '{clave}%'
				  and tc_keet_estaciones.codigo= '{codigo}'
				  and tc_keet_estaciones.nivel= {nivel}
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="contratos">
        select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.id_contrato,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.nombre,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato
				from 
					tc_keet_contratos
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				where
				  tc_keet_contratos.id_empresa in ({sucursales})
				  and tc_keet_contratos.ejercicio>= {ejercicio}
				  and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2)
        group by
          tc_keet_contratos.id_contrato
 				order by
				  tc_keet_contratos.ejercicio desc, 
          tc_keet_contratos.clave desc, 
          tc_keet_contratos_lotes.orden	        
      </select>
			<select id="lotes">
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.nombre,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.orden
				from 
					tc_keet_contratos
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				where
				  tc_keet_contratos.id_empresa in ({sucursales})
				  and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 6)
          and tc_keet_contratos.id_contrato= {idContrato}
				order by
				  tc_keet_contratos.ejercicio desc, 
          tc_keet_contratos.clave desc, 
          tc_keet_contratos_lotes.orden				
			</select>
			<select id="lote">
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
				  tc_keet_contratos_lotes.id_estacion,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.inicio,
					tc_keet_contratos_lotes.termino,
					tc_keet_contratos_lotes.orden,
				  tc_keet_prototipos.nombre as prototipo
				from 
					tc_keet_contratos
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join
				  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				where
				  tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
				order by
				  tc_keet_contratos.ejercicio desc, tc_keet_contratos.clave, tc_keet_contratos_lotes.orden				
			</select>
			<select id="exportar">
				select
				  tc_keet_estaciones.id_estacion as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_estaciones.codigo,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.cantidad,
					tc_keet_estaciones.costo as "costo s/iva",
					tc_mantic_unidades_medidas.nombre as "unidad medida",
				  date_format(tc_keet_estaciones.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_estaciones.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_estaciones
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_estaciones.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_estaciones.clave like '{clave}%'
					and tc_keet_estaciones.nivel> 4
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="principal">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.nombre,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", ifnull(tc_mantic_domicilios.numero_exterior, ' ')) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
          tc_keet_contratos.id_contrato_estatus&lt; 8
					and {condicion}
				order by 
					tc_keet_desarrollos.nombres, 
          tc_keet_contratos.registro desc
			</select>
			<select id="referencia">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.nombre,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", ifnull(tc_mantic_domicilios.numero_exterior, ' ')) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
					{condicion}
				order by 
					tc_keet_desarrollos.nombres, 
          tc_keet_contratos.registro desc
			</select>
			<select id="getCoordenadasDesarrollo">
				select 
					tc_keet_desarrollos.id_desarrollo id_key,
					tc_keet_desarrollos.latitud,
          tc_keet_desarrollos.longitud
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where
					tc_keet_proyectos.id_proyecto= {idProyecto}
			</select>
			<select id="residentes">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.nombre,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", ifnull(tc_mantic_domicilios.numero_exterior, ' ')) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente				
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo				
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}												
				where
          tc_keet_contratos.id_contrato_estatus&lt; 8
					and {condicion}
				order by 
					tc_keet_desarrollos.nombres, tc_keet_contratos.registro desc
			</select>
		</unit>
		<unit id="VistaDiasFeriadosDto">
			<select id="lazy">
				select
					tc_keet_dias_festivos.id_dia_festivo AS id_key,
					tc_keet_dias_festivos.*,
					tc_mantic_empresas.nombre 
				from
					tc_keet_dias_festivos
				inner join 
					tc_mantic_empresas on tc_keet_dias_festivos.id_empresa= tc_mantic_empresas.id_empresa
				where 
					{condicion}
				and 
					tc_keet_dias_festivos.id_empresa in ({idEmpresa})				
				{sortOrder}
			</select>
		</unit>
		<unit id="VistaIncidenciasDto">
      <select id="faltas">
				select
				  tc_mantic_incidentes.id_incidente as id_key,
				  tc_keet_desarrollos.nombres as desarrollo,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as empleado,
          date_format(tc_mantic_incidentes.inicio, '%d/%m/%Y') as fecha,
          tc_mantic_incidentes_estatus.nombre as estatus,
          date_format(tc_mantic_incidentes.registro, '%d/%m/%Y %H%i%S') as registro
				from 
				  tc_mantic_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente and tc_mantic_tipos_incidentes.id_afecta_nomina= 1
				inner join 
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				inner join
					tc_keet_desarrollos on tc_mantic_incidentes.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_incidentes_estatus on tc_mantic_incidentes.id_incidente_estatus= tc_mantic_incidentes_estatus.id_incidente_estatus
			  where
				  (tc_mantic_incidentes.id_nomina is null or tc_mantic_incidentes.id_nomina= -1)
				  and tc_mantic_incidentes.id_incidente_estatus= 2
				  and tc_mantic_incidentes.id_tipo_incidente= 1
			  order by
				  tc_keet_desarrollos.nombres, 
          tc_mantic_personas.paterno,
          tc_mantic_personas.materno,
          tc_mantic_personas.nombres 
      </select>
			<select id="movimientos">				
				select
					tc_mantic_incidentes_bitacora.id_incidente_bitacora as id_key,
					tc_mantic_incidentes.consecutivo,
					0 as importe,
					tc_mantic_incidentes_bitacora.justificacion,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre,
				  tc_mantic_incidentes_estatus.nombre as estatus,
					tc_mantic_incidentes_bitacora.registro
				from 
					tc_mantic_incidentes_bitacora
				inner join
					tc_mantic_incidentes on tc_mantic_incidentes_bitacora.id_incidente= tc_mantic_incidentes.id_incidente
				inner join
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_bitacora.id_incidente_estatus= tc_mantic_incidentes_estatus.id_incidente_estatus
				inner join
					tc_janal_usuarios on tc_mantic_incidentes_bitacora.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				where
					tc_mantic_incidentes_bitacora.id_incidente= {idIncidente}
				order by
					tc_mantic_incidentes_bitacora.registro desc				
			</select>		
			<select id="importados">
				select 
					tc_mantic_incidentes_archivos.id_incidente_archivo as id_key,
					tc_mantic_incidentes_archivos.nombre,
					tc_mantic_incidentes_archivos.archivo,
					tc_mantic_incidentes_archivos.ruta,
					tc_mantic_incidentes_archivos.alias,
					tc_mantic_incidentes_archivos.observaciones observacion_archivo,
					tc_mantic_incidentes_archivos.registro,
					tc_mantic_incidentes_archivos.id_tipo_archivo,
					tc_mantic_incidentes.consecutivo,					
					tc_mantic_incidentes.inicio,
					tc_mantic_incidentes.termino,
					tc_mantic_incidentes.ejercicio,					
					tc_mantic_incidentes.orden,					
					tc_mantic_incidentes.observaciones,
					tc_mantic_incidentes.id_usuario,
					tc_mantic_incidentes.registro registro_incidente,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_mantic_tipos_incidentes.nombre tipo_incidente,
					tc_mantic_incidentes_estatus.nombre estatus,					
					tc_mantic_puestos.nombre puesto				
				from 
					tc_mantic_incidentes_archivos
				inner join 
					tc_mantic_incidentes on tc_mantic_incidentes_archivos.id_incidente = tc_mantic_incidentes.id_incidente				
				inner join
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente = tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_estatus.id_incidente_estatus = tc_mantic_incidentes.id_incidente_estatus
				inner join 
					tc_janal_usuarios on tc_mantic_incidentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				left join 
					tc_keet_contratos_personal on tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona
				where 
					tc_keet_contratos_personal.id_contrato_persona = {idContratoPersona}
				  or tr_mantic_empresa_personal.id_empresa_persona = {idEmpresaPersona}												
			</select>
			<select id="incidencia">
				select
				  tc_mantic_incidentes.id_incidente as id_key,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as empleado,
          tc_mantic_incidentes.inicio as inicio,
          tc_mantic_incidentes.termino as termino,
          tc_mantic_tipos_incidentes.nombre as incidencia
				from 
				  tc_mantic_incidentes
  			inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
			  where
			    tc_mantic_incidentes.id_empresa_persona= {idEmpresaPersona}
			    and tc_mantic_incidentes.id_incidente_estatus in (1, 2, 3, 5, 6)
          and tc_mantic_tipos_incidentes.grupo= 1
			    and date_format(tc_mantic_incidentes.inicio, '%Y%m%d')&gt;= '{inicio}'
			    and date_format(tc_mantic_incidentes.termino, '%Y%m%d')&lt;= '{termino}'        
			</select>
			<select id="incentivo">
				select
				  tc_mantic_incidentes.id_incidente as id_key,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as empleado,
          tc_mantic_incidentes.inicio as inicio,
          tc_mantic_incidentes.termino as termino,
          tc_mantic_tipos_incidentes.nombre as incidencia
				from 
				  tc_mantic_incidentes
  			inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
			  where
			    tc_mantic_incidentes.id_empresa_persona= {idEmpresaPersona}
			    and tc_mantic_incidentes.id_incidente_estatus in (1, 2, 3, 5, 6)
          and tc_mantic_tipos_incidentes.id_tipo_incidente in (1, 2, 3, 4, 5, 6, 9, 15, 16, 17, 22)
			    and date_format(tc_mantic_incidentes.inicio, '%Y%m%d')&gt;= '{inicio}'
			    and date_format(tc_mantic_incidentes.termino, '%Y%m%d')&lt;= '{termino}'        
			</select>
		</unit>
		<unit id="VistaTiposObrasDto">
			<select id="catalogo">
				select
					tc_keet_tipos_obras.id_tipo_obra AS id_key,
					tc_keet_tipos_obras.id_division,
					tc_keet_tipos_obras.clave,
					tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_divisiones.nombre tipo_division
				from
					tc_keet_tipos_obras
				inner join
					tc_keet_divisiones ON tc_keet_tipos_obras.id_division = tc_keet_divisiones.id_division
				order by
					tc_keet_tipos_obras.id_division, tc_keet_tipos_obras.clave
			</select>			
		</unit>
    <unit id="VistaContratosDto">
			<select id="control">
				select 
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.nombre,
          tc_keet_contratos.clave as numero,
          tc_keet_contratos.costo,
          sum(tc_keet_contratos_lotes.costo) as total,
          tc_keet_contratos.materiales,
          tc_keet_contratos.destajos,
          tc_keet_contratos.subcontratados,
          tc_keet_contratos.por_el_dia,
          tc_keet_contratos.administrativos,
          tc_keet_contratos.maquinaria,
          tc_keet_contratos.indirecto,
          tc_keet_contratos.utilidad,
          tc_keet_contratos.no_viviendas as viviendas,
          count(*) as lotes,
          sum(if(tc_keet_contratos_lotes.costo&gt; 0, 1, 0)) as individual,
          count(distinct(tc_keet_contratos_lotes.latitud)) as latitud,
          count(distinct(tc_keet_contratos_lotes.longitud)) as longitud,
          count(distinct(tc_keet_contratos_lotes.inicio)) as inicio,
          count(distinct(tc_keet_contratos_lotes.termino)) as termino,
          datediff(now(), ifnull(
            (select
              min(tc_mantic_ordenes_compras.registro) as registro
            from
              tc_mantic_ordenes_compras
            where  
              tc_mantic_ordenes_compras.id_contrato= tc_keet_contratos.id_contrato
            group by
              tc_mantic_ordenes_compras.id_contrato), now())) as dias,                   
          tc_keet_contratos.id_contrato_estatus
        from 
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        where
          tc_keet_contratos.id_contrato_estatus in ({estatus})
          and tc_keet_contratos.no_viviendas&gt; 1
          and date_format(tc_keet_contratos.registro, '%Y%m%d')&gt;= '{fecha}'
          and {condicion}
        group by
          tc_keet_contratos.id_contrato
        order by
          tc_keet_contratos.id_contrato desc        
      </select>  
			<select id="lazy">
				select 
          tc_keet_contratos.id_contrato id_key,
          tc_keet_contratos.id_contrato,
          tc_mantic_clientes.id_cliente,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre,
          tc_keet_contratos.no_viviendas,
          tc_keet_contratos.etapa,
          tc_mantic_clientes.razon_social,
					tc_keet_contratos_estatus.id_contrato_estatus,
					tc_keet_contratos_estatus.nombre as estatus,
					tc_keet_contratos_estatus.estatus_asociados,
					tc_keet_contratos.registro,
				  tc_keet_proyectos.clave proyecto,
          tc_keet_desarrollos.nombres as desarrollo
        from 
          tc_keet_contratos
        inner join 
					tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
        inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join
          tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
      <select id="detalle">
        select
          tc_keet_estaciones.id_estacion as id_key,
          tc_keet_contratos_lotes.id_contrato_lote,
          tc_keet_contratos_lotes.orden as siguiente,
          tc_keet_estaciones.id_estacion,
          tc_keet_estaciones.clave,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.nombre as contrato,
          tc_keet_contratos.clave as numero,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos.no_viviendas,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.descripcion,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.cantidad,
          tc_keet_estaciones.costo,
          tc_keet_estaciones.nivel,
          tc_keet_estaciones.ultimo,
          tc_keet_estaciones.id_estacion_estatus,
          tc_keet_estaciones_estatus.nombre as estatus
        from
          tc_keet_contratos         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato         
        inner join
          tc_keet_estaciones on substring(tc_keet_estaciones.clave, 1, 3)= tc_keet_contratos.id_empresa 
          and substring(tc_keet_estaciones.clave, 4, 4)= tc_keet_contratos.ejercicio 
          and substring(tc_keet_estaciones.clave, 8, 3)= tc_keet_contratos.orden 
          and substring(tc_keet_estaciones.clave, 11, 3)= tc_keet_contratos_lotes.orden
          and tc_keet_estaciones.nivel= {nivel}
        inner join
          tc_keet_estaciones_estatus on tc_keet_estaciones.id_estacion_estatus= tc_keet_estaciones_estatus.id_estacion_estatus
        where
          (tc_keet_contratos_lotes.id_contrato= {idContrato} or {idContrato}= 0)
           and tc_keet_estaciones.clave like '{clave}%'
        order by
          tc_keet_estaciones.clave        
      </select>
			<select id="contrato">
				select 
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.nombre,
          tc_keet_contratos.clave as numero,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos.no_viviendas,
          tc_keet_contratos.etapa
        from 
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        where
          tc_keet_contratos_lotes.id_contrato= {idContrato}
          and tc_keet_contratos_lotes.orden= {orden}
			</select>	
			<select id="galeria">	
				select 
				  tc_keet_contratos_lotes.id_contrato_lote as id_key,
				  tc_keet_proyectos.id_desarrollo,
				  tc_keet_proyectos.id_cliente,
				  tc_keet_proyectos.etapa,
				  tc_keet_contratos.id_empresa,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.consecutivo,
				  tc_keet_contratos.id_contrato,
				  tc_keet_contratos.id_proyecto,
				  tc_keet_contratos.id_contrato_estatus,
				  tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos_lotes.id_prototipo,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_contratos_lotes.orden,
				  tc_keet_contratos_lotes.latitud,
				  tc_keet_contratos_lotes.longitud,
				  tc_keet_contratos_lotes.id_contrato_lote_estatus
        from 
          tc_keet_contratos
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        where
          tc_keet_contratos_lotes.id_contrato= {idContrato}
          and tc_keet_contratos_lotes.orden= {orden}
			</select>	
			<select id="findDesarrollo">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_clientes.id_cliente,
  tc_keet_desarrollos.id_desarrollo,
  (tc_keet_contratos.id_contrato_estatus* 3) as id_estatus,
  tc_mantic_empresas.nombre as empresa,  
  tc_keet_desarrollos.nombres as desarrollo,
  tc_mantic_clientes.razon_social,
  (tc_keet_contratos.costo- tc_keet_contratos.fondo_garantia) as total,
  tc_keet_contratos.costo as valor,
  tc_keet_contratos_estatus.nombre as estatus,
  tc_keet_contratos.*
from
  tc_keet_contratos
inner join
  tc_keet_contratos_estatus on tc_keet_contratos.id_contrato_estatus= tc_keet_contratos_estatus.id_contrato_estatus
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join
  tc_mantic_clientes on tc_keet_proyectos.id_cliente= tc_mantic_clientes.id_cliente
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
where
  (tc_keet_desarrollos.id_desarrollo= {idDesarrollo} or {idDesarrollo}= -1)
  and {condicion}
order by
  tc_keet_contratos.clave desc 
			</select>
			<select id="desarrollos">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_mantic_clientes.id_cliente,
  tc_keet_desarrollos.id_desarrollo,
  tc_mantic_empresas.nombre as empresa,  
  tc_keet_desarrollos.nombres as desarrollo,
  tc_mantic_clientes.razon_social,
  (tc_keet_contratos.costo- tc_keet_contratos.fondo_garantia) as total,
  tc_keet_contratos.costo as valor,
  tc_keet_contratos_estatus.nombre as estatus,
  tc_keet_contratos.*
from
  tc_keet_contratos
inner join
  tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join
  tc_mantic_clientes on tc_keet_proyectos.id_cliente= tc_mantic_clientes.id_cliente
inner join 
  tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
where
  tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
  and {condicion}
order by
  tc_keet_contratos.clave desc 
			</select>
			<select id="findPrototipos">
select 
  distinct(tc_keet_prototipos.id_prototipo) as id_key,
  tc_keet_prototipos.*
from
  tc_keet_contratos
inner join
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
where
  (tc_keet_contratos.id_contrato= {idContrato} or {idContrato}= -1)
  and {condicion}
order by
  tc_keet_prototipos.nombre
			</select>
			<select id="findCliente">
select 
  tc_keet_contratos.id_contrato as id_key,
  tc_keet_contratos.*
from
  tc_keet_contratos
inner join
  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
inner join
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
where
  tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
  and tc_keet_proyectos.id_cliente= {idCliente}
order by
  tc_keet_contratos.registro desc 
			</select>
			<select id="personalAsignado">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					{campoLlave} as id_key,									
					(select
            group_concat(tc_keet_departamentos.nombre order by tc_keet_departamentos.nombre asc separator ', ')
           from 
						tc_keet_contratistas_departamentos
  				 inner join 
						tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					 where
						tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona 
          ) as departamento, 
					tc_mantic_puestos.nombre as puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.id_seguro,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,
					(select count(*) total from tc_mantic_incidentes where tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona) as total_incidencias,
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
        left join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        left join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
        group by
          id_empresa_persona 
				order by 					
					descripcion
			</select>
			<select id="personalRegistrado">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					{campoLlave} as id_key,									
					(select
            group_concat(tc_keet_departamentos.nombre order by tc_keet_departamentos.nombre asc separator ', ')
           from 
						tc_keet_contratistas_departamentos
  				 inner join 
						tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento and {departamento}
					 where
						tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona 
          ) as departamento, 
					tc_mantic_puestos.nombre as puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.id_seguro,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
        left join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        left join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
        where 
          departamento is not null       
        group by
          id_empresa_persona 
				order by 					
					descripcion
			</select>      
			<select id="personalDisponible">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					(select
            group_concat(tc_keet_departamentos.nombre order by tc_keet_departamentos.nombre asc separator ', ')
           from 
						tc_keet_contratistas_departamentos
  				 inner join 
						tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento and {departamento}
					 where
						tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona 
          ) as departamento, 
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.id_seguro,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista         
        from                				
					tr_mantic_empresa_personal
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_personal where tc_keet_contratos_personal.id_desarrollo= {idDesarrollo})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
        where 
          departamento is not null       
        group by
          id_empresa_persona 
				order by 					
					descripcion				
			</select>
			<select id="consulta">
				select
				  principal.*,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as contratista
			  from (
					select      
						tr_mantic_empresa_personal.id_empresa_persona as id_key,									
						tc_keet_departamentos.nombre as departamento,
						tc_mantic_puestos.nombre puesto,
						tr_mantic_empresa_personal.id_activo,
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
						tr_mantic_empresa_personal.id_puesto,
						tc_keet_contratistas_departamentos.id_departamento,
						tr_mantic_empresa_personal.nss,
						tr_mantic_empresa_personal.id_nomina,
						tr_mantic_empresa_personal.id_seguro,
				    tr_mantic_empresa_personal.id_contratista,
            ifnull(tc_keet_desarrollos.id_desarrollo, -1) as id_desarrollo,
            tc_keet_desarrollos.nombres as desarrollo
					from      
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  				inner join 
	  				tc_keet_tipos_gastos on tc_keet_departamentos.id_tipo_gasto = tc_keet_tipos_gastos.id_tipo_gasto
					inner join	
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
          {union}
            tc_keet_contratos_personal on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratos_personal.id_empresa_persona
          {union}
            tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
					where 
						{condicion}
          group by
            tr_mantic_empresa_personal.id_empresa_persona
					order by 
						tc_mantic_puestos.nombre, tc_mantic_personas.nombres
			  ) as principal
			  left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        {sortOrder}
			</select>
			<select id="totales">
				select
				  floor(rand()*(100- 10+ 1)+10) as id_key,
					tr_mantic_empresa_personal.id_empresa, 
					if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as desarrollo, 
					count(*) as total, 
					sum(if(tr_mantic_empresa_personal.id_activo= 1, 1, 0)) as activos,
					sum(if(tr_mantic_empresa_personal.id_activo= 2, 1, 0)) as no_activos,
          sum(if(tr_mantic_empresa_personal.id_activo= 1 and (tr_mantic_empresa_personal.nss is null or tr_mantic_empresa_personal.nss= ''), 1, 0)) as sin_seguro
				from
					tr_mantic_empresa_personal
				left join
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				left join
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
				  {condicion}
				group by
					tr_mantic_empresa_personal.id_empresa, tc_keet_desarrollos.descripcion
				with rollup
			</select>
			<select id="findContratoPersona">
				select      
					tc_keet_contratos_personal.id_contrato_persona as id_key,									
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,					
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				inner join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tc_keet_contratos_personal.id_contrato_persona= {idContratoPersona}
        group by
          tc_mantic_personas.id_persona
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="findPersonaAdmin">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,									
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					tc_keet_contratos_personal.id_desarrollo,					
					tc_keet_contratos_personal.id_contrato_persona,					
					tc_keet_desarrollos.clave as clave_desarrollo,
					tc_keet_desarrollos.nombres as nombre_desarrollo          
        from                
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				left join 
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				left join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
        group by
          tr_mantic_empresa_personal.id_empresa_persona
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="byEmpresa">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.*
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_keet_proyectos.id_cliente=tc_mantic_clientes.id_cliente
				where
					tc_mantic_clientes.id_empresa in ({sucursales})
			</select>
			<select id="getEstacionPatron">
				select 
					concat(lpad(tc_keet_contratos.id_empresa, 3, '0') ,tc_keet_contratos.ejercicio ,lpad(tc_keet_contratos.orden, 3, '0')) as patron
				from
					tc_keet_contratos
				where
					tc_keet_contratos.id_contrato= {idContrato}
			</select>
			<select id="contratistasAsignado">
select      
  convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
  (select 
    group_concat(tc_keet_departamentos.nombre separator ', ')
  from
    tc_keet_contratistas_departamentos
  inner join
    tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
    and {condicion}
  group by
    tr_mantic_empresa_personal.id_empresa_persona				  
   ) as departamento,
  (select 
    group_concat(tc_keet_departamentos.id_departamento separator ',')
  from
    tc_keet_contratistas_departamentos
  inner join
    tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
  group by
    tr_mantic_empresa_personal.id_empresa_persona				  
  ) as ids_departamento,        
  tr_mantic_empresa_personal.id_activo,
  tr_mantic_empresa_personal.id_nomina,
  tr_mantic_empresa_personal.id_seguro,
  tr_mantic_empresa_personal.nss,
  tc_mantic_personas.nombres,
  tc_mantic_personas.paterno,
  tc_mantic_personas.materno,					
  tc_mantic_personas.rfc,					
  tc_mantic_personas.curp,					          
  1 as tipo,
  tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
  tc_keet_contratos_lotes_contratistas.id_contrato_lote,
  tc_keet_contratos_lotes_contratistas.id_empresa_persona,
  tc_keet_contratos_lotes_contratistas.observaciones,
  tc_keet_contratos_lotes_contratistas.id_trabajo,
  tc_keet_contratos_lotes_contratistas.id_usuario,
  tc_keet_contratos_lotes_contratistas.registro 
from      
  tc_keet_contratos_lotes_contratistas
inner join 
  tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
inner join	
  tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
where 
  tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_contratistas.id_trabajo=2
  and tr_mantic_empresa_personal.id_activo= 1
union
select      
  convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,								
  (select 
    group_concat(tc_keet_departamentos.nombre separator ', ')
  from
    tc_keet_proveedores_departamentos
  inner join
    tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
  group by
    tc_keet_proveedores_departamentos.id_proveedor				  
   ) as departamento,
  (select 
    group_concat(tc_keet_departamentos.id_departamento separator ',')
  from
    tc_keet_proveedores_departamentos
  inner join
    tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
  group by
    tc_keet_proveedores_departamentos.id_proveedor				  
   ) as ids_departamento,        
  tc_mantic_proveedores.id_activo,
  1 as id_nomina,
  1 as id_seguro,
  tc_mantic_proveedores.rfc as nss,
  tc_mantic_proveedores.razon_social as nombres,
  '' as paterno,
  '' as materno,					
  tc_mantic_proveedores.rfc,					
  tc_mantic_proveedores.rfc as curp,					
  2 as tipo,					
  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_contrato_lote_contratista,
  tc_keet_contratos_lotes_proveedores.id_contrato_lote,
  tc_keet_contratos_lotes_proveedores.id_proveedor id_empresa_persona,
  tc_keet_contratos_lotes_proveedores.observaciones,
  tc_keet_contratos_lotes_proveedores.id_trabajo,
  tc_keet_contratos_lotes_proveedores.id_usuario,
  tc_keet_contratos_lotes_proveedores.registro 
from     
  tc_keet_contratos_lotes_proveedores
inner join
  tc_mantic_proveedores	on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
where 
  tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_proveedores.id_trabajo=2
and 					
  tc_mantic_proveedores.id_empresa= {idEmpresa}
  and tc_mantic_proveedores.id_activo= 1
  and {condicionProveedor}
  and tc_mantic_proveedores.id_subcontratista= 1
			</select>
			<select id="contratistasDisponible">
select      					
  convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,					
  tr_mantic_empresa_personal.id_empresa_persona,
  (select 
     group_concat(tc_keet_departamentos.nombre separator ', ')
   from
      tc_keet_contratistas_departamentos
    inner join
      tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
    where 
      tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
      and {condicion}
    group by
      tc_keet_contratistas_departamentos.id_empresa_persona				  
  ) as departamento,
  tc_mantic_puestos.nombre as puesto,
  tr_mantic_empresa_personal.id_activo,
  tr_mantic_empresa_personal.id_nomina,
  tr_mantic_empresa_personal.id_seguro,
  tr_mantic_empresa_personal.nss,
  tc_mantic_personas.nombres,
  tc_mantic_personas.paterno,
  tc_mantic_personas.materno,					
  tc_mantic_personas.rfc,					
  tc_mantic_personas.curp,
  1 as tipo
from                				
  tr_mantic_empresa_personal
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
inner join	
  tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
where 
  tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_lotes_contratistas where tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote})
and 
  tr_mantic_empresa_personal.id_empresa= {idEmpresa}		
  and tr_mantic_empresa_personal.id_activo= 1  		  
  and tc_mantic_puestos.nombre= 'CONTRATISTA'
union
select      
  convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,			
  tc_mantic_proveedores.id_proveedor as id_empresa_persona,	
  (select 
      group_concat(tc_keet_departamentos.nombre separator ', ')
    from
      tc_keet_proveedores_departamentos
    inner join
      tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
    where 
      tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
    group by
      tc_keet_proveedores_departamentos.id_proveedor				  
     ) as departamento,
  'SUBCONTRATISTA' puesto,
  tc_mantic_proveedores.id_activo,
  1 as id_nomina,
  2 as id_seguro,
  tc_mantic_proveedores.rfc as nss,
  tc_mantic_proveedores.razon_social as nombres,
  '' as paterno,
  '' as materno,					
  tc_mantic_proveedores.rfc,					
  tc_mantic_proveedores.rfc as curp,					
  2 as tipo
from                				
  tc_mantic_proveedores				
where 
  tc_mantic_proveedores.id_proveedor not in (select id_proveedor from tc_keet_contratos_lotes_proveedores where tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote})            
  and tc_mantic_proveedores.id_empresa= {idEmpresa}		
  and tc_mantic_proveedores.id_activo= 1		  
  and tc_mantic_proveedores.id_subcontratista= 1
  and {condicionProveedor}
			</select>
			<select id="residentesDisponible">
				select      					
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,					
          tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_empresa_persona,
					(select 
							group_concat(tc_keet_departamentos.nombre separator ', ')
						from
							tc_keet_contratistas_departamentos
						inner join
							tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
						where 
							tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
						group by
							tc_keet_contratistas_departamentos.id_empresa_persona				  
  				) as departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
          concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
					1 tipo
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_lotes_residentes where tc_keet_contratos_lotes_residentes.id_contrato_lote= {idContratoLote})
				  and tr_mantic_empresa_personal.id_empresa= {idEmpresa}				  
				  and {condicion}
					and tc_mantic_puestos.nombre like 'RESIDENTE%'
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="residentesAsignado">
				select      
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					(select 
							group_concat(tc_keet_departamentos.nombre separator ', ')
						from
							tc_keet_contratistas_departamentos
						inner join
							tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
						where 
							tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
						group by
							tc_keet_contratistas_departamentos.id_empresa_persona				  
  				) as departamento,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          
					1 as tipo,
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente,
					tc_keet_contratos_lotes_residentes.id_contrato_lote,
					tc_keet_contratos_lotes_residentes.id_empresa_persona,
					tc_keet_contratos_lotes_residentes.observaciones,
					tc_keet_contratos_lotes_residentes.id_trabajo,
					tc_keet_contratos_lotes_residentes.id_usuario,
					tc_keet_contratos_lotes_residentes.registro 
        from      
          tc_keet_contratos_lotes_residentes
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_lotes_residentes.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_residentes.id_trabajo=2
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>      
			<select id="contratistas">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.id_activo,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp          
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where           
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}				  
				  and {condicion}
					and tc_mantic_puestos.nombre= 'CONTRATISTA'
					and (tc_mantic_personas.nombres like '%{nombreEmpleado}%' or tc_mantic_personas.paterno like '%{nombreEmpleado}%' or tc_mantic_personas.materno  like '%{nombreEmpleado}%')
        group by
         tr_mantic_empresa_personal.id_empresa_persona
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="contratistasSubAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,						
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
						tc_mantic_puestos.nombre as puesto,
            (select 
                group_concat(tc_keet_departamentos.nombre separator ', ')
              from
                tc_keet_contratistas_departamentos
              inner join
                tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
              where 
                tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
              group by
                tc_keet_contratistas_departamentos.id_empresa_persona				  
            ) as departamento,
						tr_mantic_empresa_personal.id_activo,												
						1 as tipo  																																																
					from 
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona 
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento      
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					where 
						tr_mantic_empresa_personal.id_empresa in ({idEmpresa})
            and tr_mantic_empresa_personal.id_activo= 1
				    and {condicion}
					and 
						tc_mantic_puestos.nombre= 'CONTRATISTA'
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    						
						tc_mantic_proveedores.razon_social as nombre_completo,				
						'SUBCONTRATISTA' as puesto,  
						(select 
							group_concat(tc_keet_departamentos.nombre separator ', ')
						from
							tc_keet_proveedores_departamentos
						inner join
							tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
						where 
							tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
						group by
							tc_keet_proveedores_departamentos.id_proveedor				  
						 ) as departamento,
						tc_mantic_proveedores.id_activo,												   										
						2 as tipo  
					from 
						tc_mantic_proveedores
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_mantic_proveedores.id_empresa in ({idEmpresa})
            and tc_mantic_proveedores.id_activo= 1
				    and {condicion}					
				) principal
				group by
					id_key,					
					nombre_completo,
					puesto,
					departamento,						
					id_activo,											
					tipo
				order by 
					tipo, nombre_completo
			</select>	
			<select id="residentesSubAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,						
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
						tc_mantic_puestos.nombre as puesto,
            (select 
                group_concat(tc_keet_departamentos.nombre separator ', ')
              from
                tc_keet_contratistas_departamentos
              inner join
                tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
              where 
                tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
              group by
                tc_keet_contratistas_departamentos.id_empresa_persona				  
            ) as departamento,
						tr_mantic_empresa_personal.id_activo,												
						1 tipo  																																																
					from 
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					where 
						tr_mantic_empresa_personal.id_empresa in ({idEmpresa})
  				  and {condicion}
					  and tc_mantic_puestos.nombre like 'RESIDENTE%'
				) principal
				group by
					id_key,					
					nombre_completo,
					puesto,
					departamento,						
					id_activo,											
					tipo
				order by 
					tipo, nombre_completo
			</select>	
		</unit>
    <unit id="VistaPrototiposDto">
			<select id="departamentos">
				select
					tc_keet_rubros.id_rubro as id_key,  
					tc_keet_rubros.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento
				from 
					tc_keet_rubros
				inner join
					tc_keet_rubros_grupos on tc_keet_rubros.id_rubro = tc_keet_rubros_grupos.id_rubro
				inner join 
					tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo = tc_keet_puntos_grupos.id_punto_grupo
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento				
				order by
				 tc_keet_rubros.id_rubro        
      </select>  
			<select id="lazy">
				select 
          tc_keet_prototipos.id_prototipo as id_key,
          tc_keet_prototipos.clave,
          tc_keet_prototipos.nombre,
          tc_keet_prototipos.descripcion,
          tc_keet_prototipos.metros2,
          tc_mantic_clientes.razon_social,
				  tc_keet_prototipos.id_estacion
        from
          tc_keet_prototipos
        inner 
				  join tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_prototipos.id_cliente
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="constructivosById">
				select      
					tc_keet_prototipos_constructivos.id_prototipo_constructivo id_key,
					tc_keet_prototipos_constructivos.*,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_prototipos_constructivos
				inner join tc_keet_constructivos on tc_keet_prototipos_constructivos.id_constructivo= tc_keet_constructivos.id_constructivo
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          tc_keet_prototipos_constructivos.id_prototipo= {idPrototipo}
			</select>	
			<select id="constructivosSelect">
				select      
					tc_keet_constructivos.id_constructivo id_key,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_constructivos 
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          {condicion}
				order by
				  tc_keet_grupos_constructivos.nombre, tc_keet_constructivos.nombre
			</select>
		  <select id="getPlanosEspecialidades">
				select 
					tc_keet_planos.id_plano id_key,
					tc_keet_planos.nombre descripcion,
					tc_keet_especialidades.nombre grupo 
				from
					tc_keet_planos
				inner join tc_keet_especialidades on tc_keet_planos.id_especialidad= tc_keet_especialidades.id_especialidad
        where
          {condicion}
				order by
					tc_keet_especialidades.nombre, tc_keet_planos.nombre
			</select>		
		  <select id="importados">
				select
					id_prototipo_archivo id_key,
					tc_keet_prototipos_archivos.nombre,
					tc_keet_prototipos_archivos.archivo,
					tc_keet_prototipos_archivos.ruta,
					tc_keet_prototipos_archivos.alias,
					tc_keet_prototipos_archivos.observaciones,
					tc_keet_prototipos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_prototipos_archivos.id_tipo_archivo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_prototipos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_prototipos_archivos.id_usuarios= tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_planos on tc_keet_prototipos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  id_prototipo= {idPrototipo}
			</select>		
		  <select id="getDias">
				select
					tc_keet_prototipos_habiles.id_prototipo_habil id_key,
					tc_keet_nombres_dias.nombre 
				from
				  tc_keet_prototipos_habiles
				inner join 
          tc_keet_nombres_dias on tc_keet_nombres_dias.id_nombre_dia= tc_keet_prototipos_habiles.id_nombre_dia
				where
				  tc_keet_prototipos_habiles.id_prototipo= {idPrototipo}
			</select>		
			<select id="findContrato">
				select 
					tc_keet_prototipos.id_prototipo as id_key,
					tc_keet_prototipos.clave,
					tc_keet_prototipos.nombre,
					tc_keet_prototipos.metros2,
					tc_keet_prototipos.dias_construccion
				from 
					tc_keet_prototipos
				inner join 
					tc_keet_contratos_lotes on tc_keet_prototipos.id_prototipo = tc_keet_contratos_lotes.id_prototipo
				where
					tc_keet_contratos_lotes.id_contrato= {idContrato}
				group by 
					tc_keet_prototipos.id_prototipo,
					tc_keet_prototipos.clave,
					tc_keet_prototipos.nombre,
					tc_keet_prototipos.metros2,
					tc_keet_prototipos.dias_construccion
			</select>
		</unit>
    <unit id="VistaProyectoDto">
			<select id="lazy">
				select 
          tc_keet_proyectos.id_proyecto id_key,
          tc_keet_proyectos.id_proyecto,
          tc_keet_proyectos.clave,
          tc_keet_proyectos.no_viviendas,
          tc_keet_proyectos.etapa,
          tc_mantic_clientes.razon_social,
          tc_keet_desarrollos.nombres desarrollo,
          tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_proyectos_estatus.id_proyecto_estatus,
					tc_keet_proyectos_estatus.nombre as estatus,
					tc_keet_proyectos_estatus.estatus_asociados,
					tc_keet_proyectos.registro
        from 
          tc_keet_proyectos
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join 
					tc_keet_desarrollos on tc_keet_desarrollos.id_desarrollo= tc_keet_proyectos.id_desarrollo
        inner join 
					tc_keet_tipos_obras on tc_keet_tipos_obras.id_tipo_obra= tc_keet_proyectos.id_tipo_obra
        inner join
          tc_keet_proyectos_estatus on tc_keet_proyectos_estatus.id_proyecto_estatus= tc_keet_proyectos.id_proyecto_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="tiposObraPorDivision">
				select 
					tc_keet_tipos_obras.id_tipo_obra id_key,
					tc_keet_tipos_obras.nombre descripcion,
					tc_keet_divisiones.nombre grupo
				from tc_keet_tipos_obras
				inner join tc_keet_divisiones on tc_keet_tipos_obras.id_division= tc_keet_divisiones.id_division
				order by
				  tc_keet_divisiones.nombre, tc_keet_tipos_obras.nombre
			</select>	
		</unit>	
		<unit id="VistaProyectosArchivosDto">
			<select id="importados">
				select
					tc_keet_proyectos_archivos.id_proyecto_archivo id_key,
					tc_keet_proyectos_archivos.nombre,
					tc_keet_proyectos_archivos.archivo,
					tc_keet_proyectos_archivos.ruta,
					tc_keet_proyectos_archivos.alias,
					tc_keet_proyectos_archivos.observaciones,
					tc_keet_proyectos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_proyectos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_proyectos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_proyectos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_proyectos_archivos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_proyectos_generadores.id_proyecto_generador id_key,
					tc_keet_proyectos_generadores.nombre,
					tc_keet_proyectos_generadores.archivo,
					tc_keet_proyectos_generadores.ruta,
					tc_keet_proyectos_generadores.alias,
					tc_keet_proyectos_generadores.observaciones,
					tc_keet_proyectos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_proyectos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_proyectos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_proyectos_generadores.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_proyectos_presupuestos.id_proyecto_presupuesto id_key,
					tc_keet_proyectos_presupuestos.nombre,
					tc_keet_proyectos_presupuestos.archivo,
					tc_keet_proyectos_presupuestos.ruta,
					tc_keet_proyectos_presupuestos.alias,
					tc_keet_proyectos_presupuestos.observaciones,
					tc_keet_proyectos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_proyectos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_proyectos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_proyectos_presupuestos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaNombresDiasDto">
			<select id="dias">
				select      
          tc_keet_nombres_dias.id_nombre_dia as id_key,
					tc_keet_nombres_dias.*
        from      
          tc_keet_nombres_dias
				inner join 
					tc_keet_prototipos_habiles on tc_keet_nombres_dias.id_nombre_dia = tc_keet_prototipos_habiles.id_nombre_dia
        where 
          {condicion} 
			</select>
		</unit>
		<unit id="VistaProveedoresBancosDto">
			<select id="row">
				select 
					principal.*
				from(
				select 
				  tc_keet_proveedores_materiales.id_proveedor_material as id_key,
				  tc_mantic_articulos.id_articulo,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1 and (upper(tc_mantic_articulos.nombre) regexp '{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and (upper(tc_mantic_articulos.nombre) regexp '{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  '   ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
				  tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,
					tc_keet_proveedores_materiales.id_proveedor,
					tc_keet_proveedores_materiales.id_usuario,
					tc_keet_proveedores_materiales.registro,
					tc_keet_proveedores_materiales.id_proveedor_material
				from 
					tc_keet_proveedores_materiales
				inner join 
					tc_mantic_articulos on tc_keet_proveedores_materiales.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					tc_keet_proveedores_materiales.id_proveedor= {idProveedor}
					) principal 			
				order by 
				  nombre	
			</select>
		</unit>
		<unit id="VistaDesarrollosDto">
			<select id="desarrollos">
				select
          tc_keet_desarrollos.id_desarrollo as id_key,
          tc_keet_desarrollos.clave,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.registro,
          tc_keet_desarrollos.descripcion,
          tc_mantic_clientes.id_cliente,
          tc_mantic_clientes.razon_social,
          concat(tc_mantic_domicilios.calle, ', ', tc_mantic_domicilios.numero_exterior, if(tc_mantic_domicilios.numero_interior is null, '', concat(',', tc_mantic_domicilios.numero_interior)), if(tc_mantic_domicilios.codigo_postal is null, '', concat(', C.P.', tc_mantic_domicilios.codigo_postal))) domicilio,
					tc_mantic_clientes.id_empresa
        from
          tc_keet_desarrollos
        inner join 
          tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente
        inner join 
          tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
          {condicion}
        group by
          tc_keet_desarrollos.id_desarrollo
		    order by
		      tc_keet_desarrollos.nombres
			</select>	
			<select id="lazy">
				select
          tc_keet_desarrollos.id_desarrollo as id_key,
					tc_mantic_clientes.id_empresa,
          tc_keet_desarrollos.clave,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.registro,
          tc_keet_desarrollos.descripcion,
          tc_mantic_clientes.id_cliente,
          tc_mantic_clientes.razon_social,
          concat(tc_mantic_domicilios.calle, ', ', tc_mantic_domicilios.numero_exterior, if(tc_mantic_domicilios.numero_interior is null, '', concat(',', tc_mantic_domicilios.numero_interior)), if(tc_mantic_domicilios.codigo_postal is NULL, '', concat(', C.P.', tc_mantic_domicilios.codigo_postal))) domicilio
        from
          tc_keet_desarrollos
        inner join 
          tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente
        inner join 
          tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
        left join 
          tc_keet_proyectos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        left join 
          tc_keet_contratos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				where
          tc_keet_contratos.id_contrato_estatus{operador} {idContratoEstatus}
          and {condicion}
        group by
          tc_keet_desarrollos.id_desarrollo
		    order by
		      tc_keet_desarrollos.nombres
			</select>	
			<select id="residentes">
				select
					tc_keet_desarrollos.id_desarrollo as id_key,
          tc_mantic_clientes.id_empresa,
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_keet_desarrollos.registro,
					tc_keet_desarrollos.descripcion,
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", tc_mantic_domicilios.numero_exterior) domicilio         
				from
					tc_keet_desarrollos         
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}
				inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente         
				inner join
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio     
        inner join 
          tc_keet_proyectos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join 
          tc_keet_contratos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				where
          tc_keet_contratos.id_contrato_estatus{operador} {idContratoEstatus}
				  and	{condicion}      
        group by
          tc_keet_desarrollos.id_desarrollo
				order by
					tc_keet_desarrollos.nombres				
			</select>			
		</unit>
		<unit id="VistaContratosArchivosDto">
			<select id="importados">
				select
					tc_keet_contratos_archivos.id_contrato_archivo id_key,
					tc_keet_contratos_archivos.nombre,
					tc_keet_contratos_archivos.archivo,
					tc_keet_contratos_archivos.ruta,
					tc_keet_contratos_archivos.alias,
					tc_keet_contratos_archivos.observaciones,
					tc_keet_contratos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_contratos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_contratos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_contratos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_contratos_archivos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_contratos_generadores.id_contrato_generador id_key,
					tc_keet_contratos_generadores.nombre,
					tc_keet_contratos_generadores.archivo,
					tc_keet_contratos_generadores.ruta,
					tc_keet_contratos_generadores.alias,
					tc_keet_contratos_generadores.observaciones,
					tc_keet_contratos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_contratos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_contratos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_contratos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_contratos_generadores.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_contratos_presupuestos.id_contrato_presupuesto id_key,
					tc_keet_contratos_presupuestos.nombre,
					tc_keet_contratos_presupuestos.archivo,
					tc_keet_contratos_presupuestos.ruta,
					tc_keet_contratos_presupuestos.alias,
					tc_keet_contratos_presupuestos.observaciones,
					tc_keet_contratos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_contratos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_contratos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_contratos_presupuestos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaEstacionesDto">
			<select id="rubros">
        select
          tc_keet_rubros.id_rubro as id_key,
          tc_keet_rubros.codigo,
          tc_keet_rubros.nombre,
          tc_keet_puntos_grupos.id_departamento,
          tc_keet_departamentos.nombre as departamento
        from
          tc_keet_rubros
        inner join
          tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
        inner join
          tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo
        inner join
          tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
        inner join (
					select
						tc_keet_rubros.id_rubro as id_key,
						tc_keet_puntos_grupos.id_departamento,
						tc_keet_rubros.id_extra
					from
						tc_keet_rubros
					inner join
						tc_keet_rubros_grupos on tc_keet_rubros.id_rubro= tc_keet_rubros_grupos.id_rubro
					inner join
						tc_keet_puntos_grupos on tc_keet_rubros_grupos.id_punto_grupo= tc_keet_puntos_grupos.id_punto_grupo
					inner join
						tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
					where
						tc_keet_rubros.codigo= '{codigo}'
			   ) as tt_keet_rubros on tc_keet_departamentos.id_departamento= tt_keet_rubros.id_departamento and tc_keet_rubros.id_extra= tt_keet_rubros.id_extra
			 where
			   tc_keet_rubros.codigo!= '{codigo}'
         and tc_keet_rubros.codigo not in ({codigos})
			 group by
          tc_keet_puntos_grupos.id_departamento,
          tc_keet_rubros.id_rubro
			 order by
			   tc_keet_rubros.codigo        
      </select>  
			<select id="costos">
        select
          tc_keet_estaciones.id_estacion as id_key,
          tc_keet_estaciones.id_estacion,
          tc_keet_estaciones.id_estacion_estatus,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.costo,
          tc_keet_estaciones.anticipo,
          tc_keet_estaciones.costo as costo_anterior,
          tc_keet_estaciones.anticipo as anticipo_anterior,
          timestampdiff(day, tc_keet_estaciones.inicio, tc_keet_estaciones.termino)+ 1 as dias,
          {idPrototipo} as id_prototipo,
          -1 as id_partida,  
          {idUsuario} as id_usuario,
          timestampdiff(day, tc_keet_estaciones.inicio, tc_keet_estaciones.termino)+ 1 as anterior,
          tc_keet_prototipos.nombre as prototipo,
          0 as orden 
        from
          tc_keet_estaciones
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        where
          tc_keet_estaciones.nivel= 6
          and tc_keet_estaciones.clave like '{clave}%'
          and tc_keet_estaciones.codigo= '{codigo}'
          and tc_keet_estaciones.id_estacion_estatus= 1
        order by
          tc_keet_estaciones.clave        
			</select>
			<select id="estaciones">
        select
          tc_keet_estaciones.id_estacion as id_key,
          tc_keet_estaciones.id_estacion,
          tc_keet_estaciones.id_estacion_estatus,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
          tc_keet_estaciones.nombre,
          tc_keet_estaciones.inicio,
          tc_keet_estaciones.termino,
          tc_keet_estaciones.costo,
          tc_keet_estaciones.anticipo,
          tc_keet_estaciones.costo as costo_anterior,
          tc_keet_estaciones.anticipo as anticipo_anterior,
          timestampdiff(day, tc_keet_estaciones.inicio, tc_keet_estaciones.termino)+ 1 as dias,
          {idPrototipo} as id_prototipo,
          tc_keet_partidas.id_partida,  
          {idUsuario} as id_usuario,
          tc_keet_partidas.dias as anterior,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_partidas.orden 
        from
          tc_keet_estaciones
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        inner join
          tc_keet_partidas on tc_keet_estaciones.codigo= tc_keet_partidas.codigo
        where
          tc_keet_estaciones.nivel= 5
          and tc_keet_estaciones.clave like '{clave}%'
        order by
          tc_keet_partidas.orden        
			</select>
			<select id="prototipo">
        select
          tc_keet_partidas.id_partida as id_key,
          -1 as id_estacion,
          -1 as id_estacion_estatus,
          tc_keet_partidas.codigo,
          tc_keet_partidas.nombre,
          0 as costo,
          0 as anticipo,
          0 as costo_anterior,
          0 as anticipo_anterior,
          tc_keet_partidas.dias as anterior,
          tc_keet_prototipos_dias.*
        from
          tc_keet_prototipos_dias
        left join 
          tc_keet_partidas on tc_keet_prototipos_dias.id_partida= tc_keet_partidas.id_partida
        where
          tc_keet_prototipos_dias.id_prototipo= {idPrototipo}
        order by
         tc_keet_partidas.orden        
			</select>
			<select id="lote">
        select
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_empresa,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.ejercicio,
          tc_keet_contratos.orden,
          tc_keet_contratos.no_viviendas,
          tc_keet_prototipos.id_prototipo,
          tc_keet_desarrollos.nombres as desarrollo,
          tc_mantic_clientes.razon_social as cliente,
          tc_keet_contratos.clave,
          tc_keet_contratos.nombre as contrato,
          tc_keet_contratos.etapa,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos_lotes.inicio,
          tc_keet_contratos_lotes.termino,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_prototipos.dias_construccion
        from 
          tc_keet_contratos_lotes
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
        inner join
          tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        inner join
          tc_mantic_clientes on tc_keet_proyectos.id_cliente= tc_mantic_clientes.id_cliente
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
        where
          tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
        order by
          tc_keet_contratos.id_contrato
      </select>
			<select id="rubros">
        select
          tc_keet_rubros.id_rubro as id_key,
          tc_keet_rubros.*
        from
          tc_keet_rubros
        where
          tc_keet_rubros.codigo not in(
          select
            tc_keet_estaciones.codigo
          from 
            tc_keet_estaciones
          where  
            tc_keet_estaciones.clave like '{clave}%'  
            and tc_keet_estaciones.nivel= 6
          ) and tc_keet_rubros.id_destajo= 1
        order by
          tc_keet_rubros.id_rubro        
      </select>  
			<select id="partidas">
        select
          tc_keet_partidas.id_partida as id_key,
          tc_keet_partidas.*
        from
          tc_keet_partidas
        where
          tc_keet_partidas.codigo not in(
          select
            tc_keet_estaciones.codigo
          from 
            tc_keet_estaciones
          where  
            tc_keet_estaciones.clave like '{clave}%'  
            and tc_keet_estaciones.nivel= 5
          )
          and tc_keet_partidas.id_destajo= 1
        order by
          tc_keet_partidas.codigo
      </select>  
			<select id="lazy">
				select
					tc_keet_estaciones.id_estacion id_key,
          tc_keet_estaciones.nivel,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.descripcion,
					tc_keet_estaciones.inicio,
					tc_keet_estaciones.termino,
					tc_keet_estaciones.cantidad,
					tc_keet_estaciones.costo,
					tc_keet_estaciones.ultimo,		
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
          tc_keet_estaciones
				left join tr_mantic_empaque_unidad_medida on tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida= tc_keet_estaciones.id_empaque_unidad_medida
				left join tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				left join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.nivel = {nivel}
		 	  order by
				  tc_keet_estaciones.clave
			</select>		
		</unit>		
		<unit id="VistaEmpaqueUnidadDto">
			<select id="row">
				select
					tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida id_key,
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
				  tr_mantic_empaque_unidad_medida
				inner join 
          tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				inner 
          join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
		 	  order by
				  tc_mantic_empaques.nombre,
				  tc_mantic_unidades_medidas.nombre
			</select>		
		</unit>	
		<unit id="VistaPrestamosDto">
			<select id="lazy">
				select
					tc_keet_prestamos.id_prestamo as id_key,
				  tc_keet_prestamos.id_deudor,
					tc_keet_prestamos.consecutivo as folio,
					tc_keet_prestamos.importe,
					tc_keet_prestamos.saldo,
					tc_keet_deudores.saldo as saldo_total,
					tc_keet_deudores.limite,
					tc_keet_deudores.disponible,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as deudor,
					ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) as numero_pagos,
          tc_keet_prestamos.semanas,
					tc_keet_prestamos_estatus.nombre estatus,
				  tc_keet_prestamos_estatus.id_prestamo_estatus,
          sum(if(tc_keet_prestamos_lotes.id_pagado= 1, 1, 0)) as pagados
				from
				  tc_keet_prestamos
				inner join 
				  tc_keet_deudores on tc_keet_prestamos.id_deudor= tc_keet_deudores.id_deudor
				inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				inner join 
				  tc_keet_prestamos_estatus on tc_keet_prestamos.id_prestamo_estatus= tc_keet_prestamos_estatus.id_prestamo_estatus
				left join
				  tc_keet_prestamos_lotes on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_lotes.id_prestamo
				where
				  {condicion}	
				group by
				  tc_keet_prestamos.id_prestamo
        {sortOrder}	
			</select>
			<select id="importados">
				select
					tc_keet_prestamos_archivos.id_prestamo_archivo as id_key,
					tc_keet_prestamos_archivos.nombre,
					tc_keet_prestamos_archivos.archivo,
					tc_keet_prestamos_archivos.ruta,
					tc_keet_prestamos_archivos.alias,
					tc_keet_prestamos_archivos.observaciones,
					tc_keet_prestamos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario,
          tc_keet_prestamos_pagos.consecutivo,
          tc_keet_prestamos_pagos.abono
				from
					tc_keet_prestamos_archivos
				inner join
          tc_keet_prestamos_pagos on tc_keet_prestamos_pagos.id_prestamo_pago= tc_keet_prestamos_archivos.id_prestamo_pago
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
        order by
          tc_keet_prestamos_pagos.registro, 
          tc_keet_prestamos_archivos.registro
			</select>
			<select id="byIdPrestamo">
				select 
				  tc_keet_prestamos.id_prestamo as id_key,
          tc_keet_prestamos.importe as prestamo,
          tc_keet_prestamos.consecutivo,
          tc_keet_prestamos.saldo,
          ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) as pagos,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as empleado,
				  tc_keet_deudores.disponible,
				  ifnull(tr_mantic_empresa_personal.ingreso, tr_mantic_empresa_personal.contratacion) as ingreso,
				  1 as numero_prestamos,
				  tc_keet_deudores.id_empresa_persona
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				where
				  tc_keet_prestamos.id_prestamo= {idPrestamo}
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor as id_key,
          tr_mantic_empresa_personal.id_empresa_persona,
          tc_keet_departamentos.id_departamento,
          tc_keet_prestamos.consecutivo,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as empleado,
          sum(tc_keet_prestamos.importe) as prestamo,
          tc_keet_deudores.saldo,
          sum(ifnull(tc_keet_prestamos_pagos.numero_pagos, 0)) as pagos,
				  count(*) as numero_prestamos
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
        where
          tc_keet_prestamos.id_prestamo_estatus in (1, 2)
          and tc_keet_deudores.id_deudor= {idDeudor}
        group by
          tc_keet_deudores.id_deudor,
          tc_mantic_personas.nombres, 
          tc_mantic_personas.paterno, 
          tc_mantic_personas.materno,
          tc_keet_deudores.saldo
			</select>
			<select id="pagos">
				select 
					tc_mantic_incidentes.id_incidente as id_key,
          tc_mantic_incidentes.* 
        from
          tc_mantic_incidentes
        inner join
          tc_keet_prestamos on tc_mantic_incidentes.id_prestamo= tc_keet_prestamos.id_prestamo
        where
          tc_mantic_incidentes.id_prestamo= {idPrestamo}
          and {condicion}
        order by
          tc_mantic_incidentes.orden
      </select>  
		</unit>	
		<unit id="VistaDeudoresDto">
			<select id="byEmpresa">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as deudor,
				  tc_keet_deudores.disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner 
				  join tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
			</select>
			<select id="complete">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
				  and tr_mantic_empresa_personal.id_activo= 1 
				  and tc_mantic_personas.id_tipo_persona!= 1
				  and concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) regexp '{deudor}.*'
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor id_key,
          tr_mantic_empresa_personal.id_empresa_persona,
          tc_keet_departamentos.id_departamento,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as deudor,
				  tc_keet_deudores.disponible,
				  ifnull(tr_mantic_empresa_personal.ingreso, tr_mantic_empresa_personal.contratacion) as ingreso
				from
				  tc_keet_deudores
        inner join 
          tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				where
				 tc_keet_deudores.id_deudor= {idDeudor}
			</select>
		</unit>	
		<unit id="VistaPrestamosPagosDto">
			<select id="lazy">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
		</unit>	
		<unit id="VistaCapturaDestajosDto">
			<select id="anticiposContratista">
        select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.id_estacion,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_estaciones.clave,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					tc_keet_estaciones.anticipo,
					tc_keet_estaciones.anticipo as total,
          tc_keet_estaciones.costo as importe,
          tc_keet_estaciones.anticipo as retencion,
          if(tc_keet_estaciones.entrega is null, 0, if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, 1, if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 2, 3))) as semaforo,
          ifnull(tc_keet_prestamos_lotes.id_prestamo, 0) as id_prestamo,
          ifnull(tc_keet_prestamos_lotes.id_prestamo_lote, -1) as id_prestamo_lote,
          ifnull(tc_keet_prestamos_lotes.id_pagado, 2) as id_pagado,
					principal.*
				from(  
				select
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento in ({idDepartamento})
          and tc_keet_puntos_grupos.id_extra=2
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros.codigo
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        left join
          tc_keet_prestamos_lotes on tc_keet_estaciones.id_estacion = tc_keet_prestamos_lotes.id_estacion and tc_keet_prestamos_lotes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        left join
          tc_keet_contratos_destajos_contratistas on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_contratistas.id_estacion
        left join
          tc_keet_contratos_destajos_proveedores on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_proveedores.id_estacion         
				where
					tc_keet_estaciones.clave like '{clave}%'
				  and tc_keet_estaciones.id_estacion_estatus in ({estatus})
          and tc_keet_estaciones.anticipo&gt; 0
        group by
           tc_keet_estaciones.id_estacion
        order by 
				  tc_keet_estaciones.clave        
      </select>  
			<select id="anticiposProveedor">
        select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.id_estacion,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_estaciones.clave,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					tc_keet_estaciones.anticipo,
					tc_keet_estaciones.anticipo as total,
          tc_keet_estaciones.costo as importe,
          tc_keet_estaciones.anticipo as retencion,
          if(tc_keet_estaciones.entrega is null, 0, if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, 1, if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 2, 3))) as semaforo,
          ifnull(tc_keet_anticipos_lotes.id_anticipo, 0) as id_anticipo,
          ifnull(tc_keet_anticipos_lotes.id_anticipo_lote, -1) as id_anticipo_lote,
          ifnull(tc_keet_anticipos_lotes.id_pagado, 2) as id_pagado,
					principal.*
				from(  
				select
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento in ({idDepartamento})
          and tc_keet_puntos_grupos.id_extra=2
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros.codigo
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
        inner join
          tc_keet_contratos on tc_keet_contratos.ejercicio= convert(substring(tc_keet_estaciones.clave, 4, 4), unsigned integer) and tc_keet_contratos.orden= convert(substring(tc_keet_estaciones.clave, 8, 3), unsigned integer)         
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato and tc_keet_contratos_lotes.orden= convert(substring(tc_keet_estaciones.clave, 11, 3), unsigned integer)         
        left join
          tc_keet_anticipos_lotes on tc_keet_estaciones.id_estacion = tc_keet_anticipos_lotes.id_estacion and tc_keet_anticipos_lotes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
        left join
          tc_keet_contratos_destajos_contratistas on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_contratistas.id_estacion
        left join
          tc_keet_contratos_destajos_proveedores on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_proveedores.id_estacion         
				where
					tc_keet_estaciones.clave like '{clave}%'
				  and tc_keet_estaciones.id_estacion_estatus in ({estatus})
          and tc_keet_estaciones.anticipo&gt; 0
        group by
           tc_keet_estaciones.id_estacion
        order by 
				  tc_keet_estaciones.clave        
      </select>  
			<select id="evidenciaDestajoContratista">
				select 
					tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
					tc_keet_contratos_destajos_contratistas.*
				from 
					tc_keet_contratos_destajos_contratistas
				inner join
					tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
				where
					tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}
				  and tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= {idContratoLoteContratista}
				  and tc_keet_contratos_puntos_contratistas.id_punto_paquete= {idPuntoPaquete}
			</select>
			<select id="evidenciaDestajoProveedor">
				select 
					tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor as id_key,
					tc_keet_contratos_destajos_proveedores.*
				from 
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
				and
					tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= {idContratoLoteProveedor}
				  and tc_keet_contratos_puntos_proveedores.id_punto_paquete= {idPuntoPaquete}
				  and tc_keet_contratos_destajos_proveedores.id_estacion_estatus != {idEstacionEstatus}
			</select>
			<select id="evidenciaDestajoResidente">
				select 
					tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente as id_key,
					tc_keet_contratos_destajos_residentes.*
				from 
					tc_keet_contratos_destajos_residentes
				inner join
					tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
				where
					tc_keet_contratos_destajos_residentes.id_control= {idControl}
				  and tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= {idContratoLoteResidente}
				  and tc_keet_contratos_puntos_residentes.id_punto_paquete= {idPuntoPaquete}
				  and tc_keet_contratos_destajos_residentes.id_control_estatus != {idControlEstatus}
			</select>
			<select id="allImportados">
				select 
					convert(concat(9000,tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo), unsigned integer) as id_key,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_estaciones.clave as consecutivo,
					tc_keet_estaciones.nombre as concepto,					
					tc_mantic_puestos.nombre as puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				union
				select 
					convert(concat(8000,tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo), unsigned integer) as id_key,					
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_estaciones.clave as consecutivo,
					tc_keet_estaciones.nombre as concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 					
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
			</select>
			<select id="allImportadosResidentes">
				select 
					convert(concat(9000,tc_keet_contratos_residentes_archivos.id_contrato_residente_archivo), unsigned integer) as id_key,
					tc_keet_contratos_residentes_archivos.nombre,
					tc_keet_contratos_residentes_archivos.archivo,
					tc_keet_contratos_residentes_archivos.ruta,
					tc_keet_contratos_residentes_archivos.alias,
					tc_keet_contratos_residentes_archivos.observaciones,
					tc_keet_contratos_residentes_archivos.registro,
					tc_keet_contratos_residentes_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_residentes.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_controles.clave as consecutivo,
					tc_keet_controles.nombre as concepto,					
					tc_mantic_puestos.nombre as puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_residentes_archivos
				inner join 
					tc_keet_contratos_destajos_residentes on tc_keet_contratos_residentes_archivos.id_contrato_destajo_residente = tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente
				inner join 
					tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control = tc_keet_controles.id_control
				inner join
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente = tc_keet_contratos_lotes_residentes.id_contrato_lote_residente	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_residentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
			</select>      
			<select id="allImportadosContratoLote">
				select 
					convert(concat(9000,tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo), unsigned integer) as id_key,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_estaciones.clave as consecutivo,
					tc_keet_estaciones.nombre as concepto,					
					tc_mantic_puestos.nombre as puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo} and tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
				union
				select 
					convert(concat(8000,tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo), unsigned integer) as id_key,					
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 					
					tc_keet_proyectos.id_desarrollo= {idDesarrollo} and tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
			</select>
			<select id="importadosContratista">
				select 
					tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo as id_key,
          tc_keet_contratos_contratistas_archivos.codigo,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_estaciones.clave as consecutivo,
					tc_keet_estaciones.nombre as concepto,					
					tc_mantic_puestos.nombre as puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = {idContratoLoteContratista}
				  and tc_keet_estaciones.id_estacion= {idEstacion}												
			</select>
			<select id="importadosProveedor">
				select 
					tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo as id_key,
					tc_keet_contratos_proveedores_archivos.codigo,
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = {idContratoLoteProveedor}
				and 
					tc_keet_estaciones.id_estacion= {idEstacion}												
			</select>
			<select id="importadosResidente">
				select 
					tc_keet_contratos_residentes_archivos.id_contrato_residente_archivo as id_key,
					tc_keet_contratos_residentes_archivos.nombre,
					tc_keet_contratos_residentes_archivos.archivo,
					tc_keet_contratos_residentes_archivos.ruta,
					tc_keet_contratos_residentes_archivos.alias,
					tc_keet_contratos_residentes_archivos.observaciones,
					tc_keet_contratos_residentes_archivos.registro,
					tc_keet_contratos_residentes_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_residentes.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) as nombre_usuario,
					tc_keet_controles.clave as consecutivo,
					tc_keet_controles.nombre as concepto,					
					tc_mantic_puestos.nombre as puesto,
					tc_keet_departamentos.nombre as especialidad				
				from 
					tc_keet_contratos_residentes_archivos
				inner join 
					tc_keet_contratos_destajos_residentes on tc_keet_contratos_residentes_archivos.id_contrato_destajo_residente = tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente
				inner join 
					tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control = tc_keet_controles.id_control
				inner join
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente = tc_keet_contratos_lotes_residentes.id_contrato_lote_residente	
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_residentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente = {idContratoLoteResidente}
				  and tc_keet_controles.id_control= {idControl}												
			</select>      
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
            and {condicion}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
            and {condicion}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>			
			<select id="residentes">
        select 
          tc_keet_departamentos.id_departamento as id_key,
          tc_keet_departamentos.descripcion, 
          tc_keet_departamentos.nombre
        from 
          tc_keet_proyectos
        inner join 
          tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
        inner join 
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
        inner join 
          tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
        inner join 
          tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
        where 
          tc_keet_proyectos.id_desarrollo= {idDesarrollo}
          and {condicion}
        group by 
          tc_keet_departamentos.id_departamento,
          tc_keet_departamentos.descripcion, 
          tc_keet_departamentos.nombre 
  			order by 
					tc_keet_departamentos.nombre
      </select>			
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo, 
						tc_mantic_puestos.nombre puesto,
            tc_mantic_personas.id_persona,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona
					inner join 
						tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} 
            and tc_keet_departamentos.id_departamento={idDepartamento}
            and tr_mantic_empresa_personal.id_activo= 1
            and {condicion}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						'SUBCONTRATISTA' puesto,  
            tc_mantic_proveedores.id_proveedor as id_persona,
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} 
            and tc_keet_departamentos.id_departamento={idDepartamento}
            and tc_mantic_proveedores.id_activo= 1
            and {condicion}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>		
      <select id="residentesAsociados">
        select 
          convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
          concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
          tc_mantic_puestos.nombre puesto,
          1 tipo  
        from 
          tc_keet_proyectos
        inner join 
          tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
        inner join 
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
        inner join 
          tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
        inner join 
          tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
        inner join 
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
        inner join 
          tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
        where 
          tc_keet_proyectos.id_desarrollo= {idDesarrollo} 
          and tc_keet_departamentos.id_departamento= {idDepartamento}
        group by
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno),
          tc_mantic_puestos.nombre
      </select>
			<select id="lotesContratistas">
select 
  tc_keet_contratos_lotes.id_contrato_lote id_key,
  tc_keet_proyectos.id_empresa,
  tc_keet_contratos_lotes.*,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
  tc_keet_contratos.clave clave_contrato,
  tc_keet_contratos.nombre nombre_contrato,
  tc_keet_contratos.etapa etapa_contrato,
  tc_keet_proyectos.clave clave_proyecto,
  tc_keet_proyectos.etapa etapa_proyecto,
  tc_keet_contratos.orden orden_contrato,
  tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_contratos.ejercicio
from 
  tc_keet_proyectos
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 3, 4, 6)
inner join 
  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
where 
  tc_keet_proyectos.id_desarrollo={idDesarrollo} 
  and tc_keet_contratos_lotes_contratistas.id_empresa_persona={idFigura}
  and tc_keet_contratos_lotes.entrega is null
  and tc_keet_contratos.id_contrato_estatus in ({estatus})
  and {condicion}
order by
  convert(tc_keet_contratos_lotes.manzana, unsigned integer),
  convert(tc_keet_contratos_lotes.lote, unsigned integer)
			</select>
			<select id="evidencias">
        select
          tc_keet_contratos_lotes_archivos.id_contrato_lote_archivo as id_key,
          tc_keet_contratos_lotes_archivos.id_contrato_lote_archivo as id,
          -1 as id_archivo,
          tc_keet_contratos_lotes_archivos.*,
          tc_mantic_tipos_archivos.nombre as tipo,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario
        from
          tc_keet_contratos_lotes_archivos
        inner join 
          tc_janal_usuarios on tc_keet_contratos_lotes_archivos.id_usuario= tc_janal_usuarios.id_usuario
        inner join 
          tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
        inner join
          tc_mantic_tipos_archivos on tc_keet_contratos_lotes_archivos.id_tipo_archivo= tc_mantic_tipos_archivos.id_tipo_archivo
        where
          id_contrato_lote= {idContratoLote}        
      </select>
			<select id="lotesDisponibles">
select 
  tc_keet_contratos_lotes.id_contrato_lote id_key,
  tc_keet_proyectos.id_empresa,
  tc_keet_contratos_lotes.*,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
  tc_keet_contratos.clave clave_contrato,
  tc_keet_contratos.nombre nombre_contrato,
  tc_keet_contratos.etapa etapa_contrato,
  tc_keet_proyectos.clave clave_proyecto,
  tc_keet_proyectos.etapa etapa_proyecto,
  tc_keet_contratos.orden orden_contrato,
  tc_keet_prototipos.nombre as prototipo,
  if(tc_keet_contratos_lotes.entrega is null, 2, 1) as entregada,
  tc_keet_contratos.ejercicio
from 
  tc_keet_proyectos
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
where 
  tc_keet_proyectos.id_desarrollo={idDesarrollo} 
  and {condicion}
group by
  tc_keet_contratos_lotes.id_contrato_lote    
order by
  convert(tc_keet_contratos_lotes.manzana, unsigned integer),
  convert(tc_keet_contratos_lotes.lote, unsigned integer)
			</select>
			<select id="lotesPorContrato">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_mantic_empresas.nombre as empresa,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.etapa,
  count(*) as total,
  sum(if(tc_keet_contratos_lotes.entrega is not null and tc_keet_contratos_lotes.arranque is not null, 1, 0)) as entregadas,
  sum(if(tc_keet_contratos_lotes.entrega is null and tc_keet_contratos_lotes.arranque is not null, 1, 0)) as iniciadas,
  sum(if(tc_keet_contratos_lotes.entrega is null and tc_keet_contratos_lotes.arranque is null, 1, 0)) as faltan
from 
  tc_keet_proyectos
inner join 
  tc_mantic_empresas on tc_keet_proyectos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
where 
  tc_keet_proyectos.id_desarrollo={idDesarrollo}         
  and {condicion}
group by
  tc_keet_contratos.id_contrato
order by
  tc_keet_contratos.id_contrato,
  tc_keet_contratos_lotes.orden
      </select>
			<select id="lotesPorDetalle">
select 
  tc_keet_contratos.id_contrato id_key,
  tc_mantic_empresas.nombre as empresa,
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_contratos.clave,
  tc_keet_contratos.nombre as contrato,
  tc_keet_contratos.etapa,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
  tc_keet_prototipos.nombre as prototipo,
  if(tc_keet_contratos_lotes.entrega is null, 'NO', 'SI') as entregada,
  ifnull(date_format(tc_keet_contratos_lotes.arranque, '%d/%m/%Y'), ' ') as inicio,
  ifnull(date_format(tc_keet_contratos_lotes.entrega, '%d/%m/%Y'), ' ') as entrega,
  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as entrego,
  tc_keet_contratos_lotes.recibio,
  tc_keet_contratos_lotes.observaciones
from 
  tc_keet_proyectos
inner join 
  tc_mantic_empresas on tc_keet_proyectos.id_empresa= tc_mantic_empresas.id_empresa
inner join 
  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
left join 
	tc_janal_usuarios on tc_keet_contratos_lotes.id_entrego= tc_janal_usuarios.id_usuario
left join 
	tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
where 
  tc_keet_proyectos.id_desarrollo={idDesarrollo}         
  and {condicion}
group by
  tc_keet_contratos_lotes.id_contrato_lote
order by
  tc_keet_contratos.id_contrato,
  tc_keet_contratos_lotes.orden
      </select>
			<select id="lotesSubContratistas">
select 
  tc_keet_contratos_lotes.id_contrato_lote id_key,
  tc_keet_proyectos.id_empresa,
  tc_keet_contratos_lotes.*,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
  tc_keet_contratos.clave clave_contrato,
  tc_keet_contratos.etapa etapa_contrato,
  tc_keet_proyectos.clave clave_proyecto,
  tc_keet_proyectos.etapa etapa_proyecto,
  tc_keet_contratos.orden orden_contrato,
  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_contratos.ejercicio
from 
  tc_keet_proyectos
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 3, 4, 6) 
inner join 
  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
inner join
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
where 
  tc_keet_proyectos.id_desarrollo={idDesarrollo} 
  and tc_keet_contratos_lotes_proveedores.id_proveedor={idFigura}
  and tc_keet_contratos_lotes.entrega is null
  and tc_keet_contratos.id_contrato_estatus in ({estatus})
  and {condicion}
order by
  convert(tc_keet_contratos_lotes.manzana, unsigned integer),
  convert(tc_keet_contratos_lotes.lote, unsigned integer)
			</select>
			<select id="lotesResidentes">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
          tc_keet_proyectos.id_empresa,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_contratos.nombre,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_contratos.ejercicio
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
          and tc_keet_contratos_lotes_residentes.id_empresa_persona={idFigura}
				  and {condicion}
			</select>
			<select id="conceptos">
select
  tc_keet_estaciones.id_estacion as id_key,
  ifnull(tc_keet_nominas.id_nomina_estatus, -1) as id_nomina_estatus,
  ifnull(tc_keet_contratos_destajos_contratistas.porcentaje, ifnull(tc_keet_contratos_destajos_proveedores.porcentaje, 0)) as porcentaje,
  tc_keet_estaciones.nivel,
  tc_keet_estaciones.clave,
  tc_keet_estaciones.id_empaque_unidad_medida,
  tc_keet_estaciones.id_estacion_estatus,
  tc_keet_estaciones.costo,
  tc_keet_estaciones.anticipo,
  tc_keet_estaciones.costo as importe,
  tc_keet_estaciones.anticipo as retencion,
  ifnull(tc_keet_contratos_contratistas_archivos.codigo, ifnull(tc_keet_contratos_proveedores_archivos.codigo, '0')) as imagen,
  if(tc_keet_estaciones.entrega is null, 0, if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, 1, if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 2, 3))) as semaforo,
  if(tc_keet_estaciones.entrega is null, 'NO HA INICIADO', if(tc_keet_estaciones.entrega&lt; tc_keet_estaciones.inicio, concat('TERMINO ', timestampdiff(day, tc_keet_estaciones.inicio, tc_keet_estaciones.entrega), ' DIAS ANTES'), if(tc_keet_estaciones.entrega&lt;= tc_keet_estaciones.termino, 'TERMINO EN TIEMPO', concat('TERMINO ', timestampdiff(day, tc_keet_estaciones.termino, tc_keet_estaciones.entrega), ' DIAS DESPUÉS')))) as dias,
  principal.*
from(  
select
  tc_keet_puntos_paquetes.id_punto_grupo,  
  tc_keet_puntos_grupos.id_departamento,
  tc_keet_departamentos.nombre departamento,
  tc_keet_puntos_grupos.grupo,
  tc_keet_puntos_grupos.descripcion,
  tc_keet_rubros_grupos.id_rubro_grupo,
  tc_keet_rubros_grupos.id_rubro,
  tc_keet_rubros.codigo,
  tc_keet_rubros.nombre,
  tc_keet_rubros.id_evidencia,
  tc_keet_rubros.criterio,
  tc_keet_rubros.orden
from 
  tc_keet_puntos_paquetes
inner join 
  tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
inner join
  tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
inner join
  tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
inner join
  tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
where
  tc_keet_puntos_grupos.id_departamento in ({idDepartamento})
  and (tc_keet_rubros.nombre like upper('%{nombreConcepto}%') 
  or tc_keet_rubros.codigo like upper('%{nombreConcepto}%')) 
  and tc_keet_puntos_grupos.id_extra=2
group by
  tc_keet_puntos_paquetes.id_punto_grupo,   
  tc_keet_puntos_grupos.id_departamento,
  tc_keet_rubros_grupos.id_rubro_grupo,
  tc_keet_rubros.codigo
) principal
inner join
  tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
left join
  tc_keet_contratos_destajos_contratistas on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_contratistas.id_estacion
left join
  tc_keet_contratos_contratistas_archivos on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista= tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista and tc_keet_contratos_contratistas_archivos.codigo= tc_keet_estaciones.codigo
left join
  tc_keet_contratos_destajos_proveedores on tc_keet_estaciones.id_estacion = tc_keet_contratos_destajos_proveedores.id_estacion         
left join
  tc_keet_contratos_proveedores_archivos on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor= tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor and tc_keet_contratos_proveedores_archivos.codigo= tc_keet_estaciones.codigo     
left join
  tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina or tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
where
  tc_keet_estaciones.clave like '{clave}%'
  and tc_keet_estaciones.id_estacion_estatus in ({estatus})
  and tc_keet_estaciones.costo&gt; 0
group by
   tc_keet_estaciones.id_estacion
order by 
  tc_keet_estaciones.clave
			</select>
			<select id="controles">
				select
					tc_keet_controles.id_control as id_key,
					tc_keet_controles.nivel,
					tc_keet_controles.clave,
					tc_keet_controles.id_empaque_unidad_medida,
					tc_keet_controles.id_control_estatus,
					tc_keet_controles.costo,
					principal.*,
          ifnull(tc_keet_contratos_destajos_residentes.registro, str_to_date('29991231000000', '%Y%m%d%H%i%S')) as registro 
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} 
          and (tc_keet_rubros.nombre like upper('%{nombreConcepto}%') 
          or tc_keet_rubros.codigo like upper('%{nombreConcepto}%'))
          and tc_keet_puntos_grupos.id_extra=2
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
        left join
          tc_keet_contratos_destajos_residentes on tc_keet_controles.id_control= tc_keet_contratos_destajos_residentes.id_control
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.id_control_estatus in ({estatus})
        group by
           tc_keet_controles.id_control        
				order by 
				  tc_keet_controles.clave        
      </select>  
			<select id="conceptosExtras">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.id_estacion,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.descripcion,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
          tc_keet_estaciones.costo as importe,
          ifnull(tc_keet_contratos_destajos_contratistas.justificacion, tc_keet_contratos_destajos_proveedores.justificacion) as justificacion,
          ifnull(tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista, tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor) as id_pivote,
          ifnull(ifnull(tc_keet_contratos_destajos_contratistas.id_nomina, tc_keet_contratos_destajos_proveedores.id_nomina), -1) as id_nomina,
          ifnull(tc_keet_nominas.id_nomina_estatus, -1) as id_nomina_estatus,
					principal.*
				from (  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
          tc_keet_rubros.id_evidencia,
          tc_keet_rubros.criterio,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) as principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
        left join
          tc_keet_contratos_destajos_contratistas on tc_keet_estaciones.id_estacion= tc_keet_contratos_destajos_contratistas.id_estacion
        left join
          tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
        left join
          tc_keet_contratos_destajos_proveedores on tc_keet_estaciones.id_estacion= tc_keet_contratos_destajos_proveedores.id_estacion
        left join
          tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
        left join 
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina or tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				where
					tc_keet_estaciones.clave like '{clave}%'
				  and tc_keet_estaciones.id_estacion_estatus in ({estatus})
          and (tc_keet_contratos_lotes_proveedores.id_proveedor is not null or tc_keet_contratos_lotes_contratistas.id_empresa_persona is not null)
				order by 
				  tc_keet_estaciones.clave
			</select>
			<select id="controlesExtras">
				select
					tc_keet_controles.id_control as id_key,
					tc_keet_controles.nivel,
					tc_keet_controles.clave,
					tc_keet_controles.nombre,
					tc_keet_controles.descripcion,
					tc_keet_controles.id_empaque_unidad_medida,
					tc_keet_controles.id_control_estatus,
					tc_keet_controles.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.id_control_estatus in ({estatus})
				order by 
				  tc_keet_controles.clave        
      </select>  
			<select id="totalTrabajosLotes">
				select sum(total) total from (
				select 
					contratistas.*
				from (					
					select 
						1 llave, 
            count(*) total
					from 
						tc_keet_contratos_destajos_contratistas
					where 
						id_estacion in (
							select
								tc_keet_estaciones.id_estacion
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
								where
									tc_keet_estaciones.clave like '{clave}%'
								and 
									id_estacion_estatus != {estatus}
							)
						and 
							{condicionContratista}
						) contratistas
				union
				select 
					proveedores.*
				from (					
					select 
						2 llave, count(*) total
					from 
						tc_keet_contratos_destajos_proveedores
					where 
						id_estacion in (
							select
								tc_keet_estaciones.id_estacion
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
								where
									tc_keet_estaciones.clave like '{clave}%'
								and 
									id_estacion_estatus != {estatus}
							)
						and 
							{condicionProveedor}
				) proveedores) totales
			</select>
			<select id="totalTrabajosLotesResidente">
				select sum(total) total from (
				select 
					contratistas.*
				from (					
					select 
						1 llave, count(*) total
					from 
						tc_keet_contratos_destajos_residentes
					where 
						id_control in (
							select
								tc_keet_controles.id_control
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_controles on principal.codigo = tc_keet_controles.codigo
								where
									tc_keet_controles.clave like '{clave}%'
								and 
									id_control_estatus != {estatus}
							)
						and 
							{condicion}
						) contratistas
				) totales
			</select>
			<select id="puntosRevision">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden,
          round((tc_keet_puntos_controles.factor* {importe})/ 100, 1) as importe,
          round((tc_keet_puntos_controles.factor* {anticipo})/ 100, 1) as anticipo  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor= tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista= tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="puntosRevisionControl">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="evidenciaDestajoResidentes">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="puntosRevisionRechazos">
				select
					rechazos.id_pivote as id_key,  
					tc_keet_puntos_paquetes.id_punto_paquete,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden,
					rechazos.registro,
					rechazos.observaciones,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as usuario,
          round((tc_keet_puntos_controles.factor* {importe})/ 100, 1) as importe
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				inner join(
					select 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
					from (
            select
						  convert(concat(9000, tc_keet_contratos_rechazos_proveedores.id_contrato_rechazo_proveedor), unsigned integer) as id_pivote,
							tc_keet_contratos_rechazos_proveedores.id_punto_paquete,
							tc_keet_contratos_rechazos_proveedores.registro,
							tc_keet_contratos_rechazos_proveedores.observaciones,
							tc_keet_contratos_rechazos_proveedores.id_usuario       
						from
              tc_keet_contratos_rechazos_proveedores       
						inner join
						  tc_keet_contratos_destajos_proveedores on tc_keet_contratos_rechazos_proveedores.id_contrato_destajo_proveedor= tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
              and tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= {idContratoDestajoProveedor}
						union
						select
							convert(concat(8000, tc_keet_contratos_rechazos_contratistas.id_contrato_rechazo_contratista), unsigned integer) as id_pivote,
							tc_keet_contratos_rechazos_contratistas.id_punto_paquete,
							tc_keet_contratos_rechazos_contratistas.registro,
							tc_keet_contratos_rechazos_contratistas.observaciones,
							tc_keet_contratos_rechazos_contratistas.id_usuario       
						from
							tc_keet_contratos_rechazos_contratistas      
						inner join
						  tc_keet_contratos_destajos_contratistas on tc_keet_contratos_rechazos_contratistas.id_contrato_destajo_contratista= tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
              and tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= {idContratoDestajoContratista}								
					) as general
					group by 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
				) as rechazos on tc_keet_puntos_paquetes.id_punto_paquete = rechazos.id_punto_paquete
				inner join
					tc_janal_usuarios on rechazos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 					 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_rechazos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_rechazos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_rechazos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_rechazos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="puntosRevisionRechazosControl">
				select
					rechazos.id_pivote as id_key,  
					tc_keet_puntos_paquetes.id_punto_paquete,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden,
					rechazos.registro,
					rechazos.observaciones,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				inner join(
					select 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
					from(
						select 
							convert(concat(8000, tc_keet_contratos_rechazos_residentes.id_contrato_rechazo_residente), unsigned integer) as id_pivote,
							id_punto_paquete, registro, observaciones, id_usuario
						from
							tc_keet_contratos_rechazos_residentes
					) general
					group by 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
				) rechazos on tc_keet_puntos_paquetes.id_punto_paquete = rechazos.id_punto_paquete
				inner join
					tc_janal_usuarios on rechazos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 					 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_rechazos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_rechazos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="puntosRechazos">
select
  tc_keet_puntos_paquetes.id_punto_paquete as id_key,
  ifnull(tc_keet_nominas.id_nomina_estatus, -1) as id_nomina_estatus,
  tc_keet_puntos_grupos.grupo,
  tc_keet_puntos_grupos.descripcion,
  tc_keet_puntos_controles.id_punto_control,
  tc_keet_puntos_controles.nombre,
  tc_keet_puntos_controles.factor,
  tc_keet_puntos_controles.orden,
  ifnull(tc_keet_contratos_puntos_proveedores.registro, tc_keet_contratos_puntos_contratistas.registro) as registro             
from
  tc_keet_puntos_paquetes     
inner join
  tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo     
inner join
  tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control         
left join
  tc_keet_contratos_puntos_proveedores on tc_keet_puntos_paquetes.id_punto_paquete= tc_keet_contratos_puntos_proveedores.id_punto_paquete         
left join
  tc_keet_contratos_puntos_contratistas on tc_keet_puntos_paquetes.id_punto_paquete= tc_keet_contratos_puntos_contratistas.id_punto_paquete     
left join
  tc_keet_nominas on tc_keet_contratos_puntos_contratistas.id_nomina= tc_keet_nominas.id_nomina or tc_keet_contratos_puntos_proveedores.id_nomina= tc_keet_nominas.id_nomina
where
  tc_keet_puntos_grupos.id_departamento= {idDepartamento}             
  and tc_keet_puntos_paquetes.id_punto_grupo= {idPuntoGrupo} 
  and (tc_keet_nominas.id_nomina_estatus!= 4 or tc_keet_nominas.id_nomina_estatus is null)
  and (
   concat(tc_keet_puntos_paquetes.id_punto_paquete, '-', tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista) in (
    select
      concat(tc_keet_contratos_puntos_contratistas.id_punto_paquete, '-', tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista)       
    from
      tc_keet_contratos_destajos_contratistas       
    inner join
      tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista       
    inner join
      tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista 
    where
      tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion} and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona})
   or
    concat(tc_keet_puntos_paquetes.id_punto_paquete, '-', tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor) in (
    select
      concat(tc_keet_contratos_puntos_proveedores.id_punto_paquete, '-', tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor)       
    from
      tc_keet_contratos_destajos_proveedores       
    inner join
      tc_keet_contratos_puntos_proveedores on tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor 
    inner join
      tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor 
    where
      tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion} and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor})
)
			</select>
			<select id="puntosRechazosResidentes">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}
					)		
			</select>
			<select id="estatusManzanaLote">
select
  sum(iniciado) as iniciado,
  sum(en_proceso) as en_proceso,
  sum(terminado) as terminado,
  (sum(iniciado)+ sum(en_proceso)+ sum(terminado)) as total
from (
  select 
    case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
    case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
    case when (tc_keet_estaciones.id_estacion_estatus= 3 or tc_keet_estaciones.id_estacion_estatus= 4) then 1 else 0 end terminado  
  from (  
    select
      tc_keet_puntos_paquetes.id_punto_grupo,  
      tc_keet_puntos_grupos.id_departamento,
      tc_keet_puntos_grupos.grupo,
      tc_keet_puntos_grupos.descripcion,
      tc_keet_rubros_grupos.id_rubro_grupo,
      tc_keet_rubros_grupos.id_rubro,
      tc_keet_rubros.codigo,
      tc_keet_rubros.nombre,
      tc_keet_rubros.orden
    from 
      tc_keet_puntos_paquetes
    inner join
      tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
    inner join
      tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
    inner join
      tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
    where
      tc_keet_puntos_grupos.id_departamento={idDepartamento}
    group by
      tc_keet_puntos_paquetes.id_punto_grupo,
      tc_keet_rubros_grupos.id_rubro_grupo,
      tc_keet_rubros_grupos.id_rubro        
  ) as principal
inner join
  tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
where
  tc_keet_estaciones.clave like '{clave}%'
  and tc_keet_estaciones.costo&gt; 0
) as final
			</select>
			<select id="estatusLote">
				select
					sum(iniciado) as iniciado,
					sum(en_proceso) as en_proceso,
					sum(terminado) as terminado,
					(sum(iniciado)+ sum(en_proceso)+ sum(terminado)) as total
				from(
				select 
					case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when (tc_keet_estaciones.id_estacion_estatus= 3 or tc_keet_estaciones.id_estacion_estatus= 4) then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				group by
          tc_keet_puntos_paquetes.id_punto_grupo,
          tc_keet_rubros_grupos.id_rubro_grupo,
          tc_keet_rubros_grupos.id_rubro        
				) as principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
          and tc_keet_estaciones.costo&gt; 0
				) as final
			</select>
			<select id="estatusControlManzanaLote">
				select
					sum(iniciado) as iniciado,
					sum(en_proceso) as en_proceso,
					sum(terminado) as terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) as total
				from(
				select 
					case when tc_keet_controles.id_control_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_controles.id_control_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_controles.id_control_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				) final
			</select>
		</unit>
		<unit id="VistaPuntosControlDto">
			<select id="lazy">
				select 
					tc_keet_puntos_grupos.id_punto_grupo id_key,
					tc_keet_puntos_grupos.descripcion paquete,
					tc_keet_departamentos.descripcion departamento, 
					tc_keet_puntos_grupos.registro,
          ifnull(puntos_control, 0) puntos_control
				from tc_keet_puntos_grupos
					inner join tc_keet_departamentos on tc_keet_departamentos.id_departamento= tc_keet_puntos_grupos.id_departamento
					left join
            (select count(*) puntos_control, id_punto_grupo, group_concat(nombre) nombres from tc_keet_puntos_controles
             inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
             group by id_punto_grupo
            ) tc_keet_puntos_controles on tc_keet_puntos_controles.id_punto_grupo = tc_keet_puntos_grupos.id_punto_grupo
				where
				  {condicion}	
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
			<select id="getOrdenPuntoControl">
				select 
					max(orden)+1 orden
				from
				  tc_keet_puntos_controles
				inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
				where
				  tc_keet_puntos_paquetes.id_punto_grupo= {idPuntoGrupo}
			</select>
			<select id="getPuntoControlByGrupo">
				select 
				  tc_keet_puntos_controles.id_punto_control id_key,
					tc_keet_puntos_controles.*
				from
				  tc_keet_puntos_controles
				inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
				where
				  tc_keet_puntos_paquetes.id_punto_grupo= {idPuntoGrupo}
			</select>
		</unit>	
		<unit id="VistaRubrosDto">
			<select id="lazy">
				select 
					tc_keet_rubros.id_rubro id_key,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					ifnull(tc_keet_rubros_grupos.paquetes, 0) paquetes,
					tc_mantic_empaques.nombre unidad,
					tc_keet_rubros.registro
				from
					tc_keet_rubros
				left join
					(select count(*) paquetes, id_rubro from tc_keet_rubros_grupos group by id_rubro) tc_keet_rubros_grupos  on tc_keet_rubros_grupos.id_rubro= tc_keet_rubros.id_rubro
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_rubros.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				where
				  {condicion}	
				{sortOrder}	
			</select>
			<select id="byDepartamentoExtra">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				  and tc_keet_puntos_grupos.id_extra= {idExtra}	
  				and tc_keet_rubros.id_rubro {cuales} in (
				select					
					principal.id_rubro
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'				
				order by 
				  tc_keet_estaciones.clave)			
			</select>
			<select id="byDepartamentoExtraControles">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				and 
					tc_keet_puntos_grupos.id_extra= {idExtra}	
				and 
				  tc_keet_rubros.id_rubro not in (
				select					
					principal.id_rubro
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_controles.clave like '{clave}%'				
				order by 
				  tc_keet_controles.clave)			
			</select>
			<select id="byRubro">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_rubros.id_rubro= {idRubro}				
			</select>
		</unit>	
		<unit id="VistaGeoreferenciaLotesDto">
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when (tc_keet_estaciones.id_estacion_estatus= 3 or tc_keet_estaciones.id_estacion_estatus= 4) then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
          and tc_keet_estaciones.costo&gt; 0
				)final
			</select>
			<select id="lotes">				
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.orden,
					tc_keet_contratos_lotes.latitud,
					tc_keet_contratos_lotes.longitud
				from 
					tc_keet_contratos_lotes
				inner join 
					tc_keet_contratos on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where				  
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo} and {condicion}
				  and tc_keet_contratos_lotes.latitud is not null and tc_keet_contratos_lotes.longitud is not null
				order by
				  tc_keet_contratos_lotes.manzana, tc_keet_contratos_lotes.lote
			</select>
			<select id="lotesTodos">				
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
 					tc_keet_contratos_lotes.*,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.clave clave_contrato,
          tc_keet_contratos.nombre nombre_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
          tc_keet_prototipos.nombre as prototipo,
          tc_keet_desarrollos.nombres as desarrollo
				from 
					tc_keet_contratos_lotes
				inner join 
					tc_keet_contratos on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
        inner join
          tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where				  
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo} and {condicion}
				order by
				  tc_keet_contratos_lotes.manzana, tc_keet_contratos_lotes.lote
			</select>
      <select id="estatusLoteResidente">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_controles.id_control_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_controles.id_control_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_controles.id_control_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro			
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				)final
			</select>
			<select id="residentes">				
				select      
					tc_keet_contratos_personal.id_contrato_persona as id_key,									
					tc_keet_departamentos.nombre as departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre as puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          					
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and tc_mantic_puestos.nombre like 'RESIDENTE%'			
        group by
          tr_mantic_empresa_personal.id_empresa_persona	
			</select>
			<select id="contactosNotificar">				
select      
  tr_mantic_persona_tipo_contacto.id_persona_tipo_contacto as id_key,				
  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as residente, 					
  tr_mantic_persona_tipo_contacto.*
from      
  tc_keet_contratos_personal
inner join 
  tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
inner join 
  tr_mantic_persona_tipo_contacto on tc_mantic_personas.id_persona = tr_mantic_persona_tipo_contacto.id_persona
inner join	
  tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
where 
  (tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
  and tr_mantic_empresa_personal.id_activo= 1
  and tc_mantic_puestos.nombre like 'RESIDENTE%') 
  or (tc_mantic_personas.id_persona = {idPersona})
			</select>
			<select id="contratistasAsignado">
select      
  convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
  (select 
    group_concat(tc_keet_departamentos.nombre separator ', ')
  from
    tc_keet_contratistas_departamentos
  inner join
    tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
  group by
    tc_keet_contratistas_departamentos.id_empresa_persona				  
   ) as departamento,
  (select 
    group_concat(tc_keet_departamentos.id_departamento separator ',')
  from
    tc_keet_contratistas_departamentos
  inner join
    tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona
  group by
    tc_keet_contratistas_departamentos.id_empresa_persona				  
  ) as ids_departamento,        
  tc_mantic_puestos.nombre as puesto,
  tr_mantic_empresa_personal.id_activo,
  tr_mantic_empresa_personal.id_nomina,
  tr_mantic_empresa_personal.nss,
  tc_mantic_personas.nombres,
  tc_mantic_personas.paterno,
  tc_mantic_personas.materno,					
  tc_mantic_personas.rfc,					
  tc_mantic_personas.curp,					          
  1 as tipo,
  tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
  tc_keet_contratos_lotes_contratistas.id_contrato_lote,
  tc_keet_contratos_lotes_contratistas.id_empresa_persona,
  tc_keet_contratos_lotes_contratistas.observaciones,
  tc_keet_contratos_lotes_contratistas.id_trabajo,
  tc_keet_contratos_lotes_contratistas.id_usuario,
  tc_keet_contratos_lotes_contratistas.registro 
from      
  tc_keet_contratos_lotes_contratistas
inner join 
  tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
inner join	
  tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
where 
  tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote} 
  and tc_keet_contratos_lotes_contratistas.id_trabajo=2
  and tr_mantic_empresa_personal.id_activo= 1				  
union
select      
  convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,								
  (select 
    group_concat(tc_keet_departamentos.nombre separator ', ')
  from
    tc_keet_proveedores_departamentos
  inner join
    tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
  group by
    tc_keet_proveedores_departamentos.id_proveedor				  
   ) as departamento,
  (select 
    group_concat(tc_keet_departamentos.id_departamento separator ',')
  from
    tc_keet_proveedores_departamentos
  inner join
    tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
  where 
    tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
  group by
    tc_keet_proveedores_departamentos.id_proveedor				  
   ) as ids_departamento,
  'SUBCONTRATISTA' as puesto,
  tc_mantic_proveedores.id_activo,
  1 as id_nomina,
  tc_mantic_proveedores.rfc as nss,
  tc_mantic_proveedores.razon_social as nombres,
  '' as paterno,
  '' as materno,					
  tc_mantic_proveedores.rfc,					
  tc_mantic_proveedores.rfc as curp,					
  2 as tipo,					
  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor id_contrato_lote_contratista,
  tc_keet_contratos_lotes_proveedores.id_contrato_lote,
  tc_keet_contratos_lotes_proveedores.id_proveedor as id_empresa_persona,
  tc_keet_contratos_lotes_proveedores.observaciones,
  tc_keet_contratos_lotes_proveedores.id_trabajo,
  tc_keet_contratos_lotes_proveedores.id_usuario,
  tc_keet_contratos_lotes_proveedores.registro 
from     
  tc_keet_contratos_lotes_proveedores
inner join
  tc_mantic_proveedores	on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
where 
  tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote} 
  and tc_keet_contratos_lotes_proveedores.id_trabajo=2				
  and tc_mantic_proveedores.id_activo= 1				  
  and tc_mantic_proveedores.id_subcontratista= 1
			</select>
			<select id="avances">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento				
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.id_estacion_estatus in ({estatus})
				order by 
				  tc_keet_estaciones.clave
			</select>
		</unit>
		<unit id="VistaPartidasDto">
			<select id="lazy">
				select 
					tc_keet_partidas.id_partida id_key,
					tc_keet_partidas.codigo,
					tc_keet_partidas.nombre,
					tc_keet_partidas.registro,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_partidas
				inner join 
					tc_janal_usuarios on tc_keet_partidas.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  {condicion}	
				{sortOrder}	
			</select>
		</unit>	
		<unit id="VistaCapturaMaterialesDto">			
			<select id="conceptosPadre">
				select 
					tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where 
					clave like '{clave}%' and nivel=5
			</select>
			<select id="conceptos">
				select 
					principal.*,
					(select 
						count(*) 
					from 
						tc_keet_vales
					inner join 
						tc_keet_vales_materiales on tc_keet_vales.id_vale = tc_keet_vales_materiales.id_vale
					where 
						tc_keet_vales_materiales.id_material= principal.id_material and tc_keet_vales.id_tipo_vale=1) total_detalle
				from ( 																				
					select
						tc_keet_materiales.id_material as id_key,
						tc_keet_materiales.id_material,
						tc_keet_materiales.nivel,
						tc_keet_materiales.clave,
						tc_keet_materiales.id_empaque_unidad_medida,
						tc_keet_materiales.id_estacion_estatus,
						tc_keet_materiales.costo,
						tc_keet_materiales.codigo,
						tc_keet_materiales.nombre					
					from(
						select
							tc_keet_puntos_paquetes.id_punto_grupo,  
							tc_keet_puntos_grupos.id_departamento,
							tc_keet_departamentos.nombre departamento,
							tc_keet_puntos_grupos.grupo,
							tc_keet_puntos_grupos.descripcion,
							tc_keet_rubros_grupos.id_rubro_grupo,
							tc_keet_rubros_grupos.id_rubro,
							tc_keet_rubros.codigo,
							tc_keet_rubros.nombre,
							tc_keet_rubros.orden
						from
							tc_keet_puntos_paquetes
						inner join
							tc_keet_puntos_grupos ON tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
						inner join
							tc_keet_rubros_grupos ON tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
						inner join
							tc_keet_rubros ON tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
						inner join
							tc_keet_departamentos ON tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
						where
							tc_keet_puntos_grupos.id_departamento= {idDepartamento}
						group by
							tc_keet_puntos_paquetes.id_punto_grupo,   
							tc_keet_puntos_grupos.id_departamento,
							tc_keet_departamentos.nombre,
							tc_keet_puntos_grupos.grupo,
							tc_keet_puntos_grupos.descripcion,
							tc_keet_rubros_grupos.id_rubro_grupo,
							tc_keet_rubros_grupos.id_rubro,
							tc_keet_rubros.codigo,
							tc_keet_rubros.nombre,
							tc_keet_rubros.orden
					) rubros
					inner join	
						tc_keet_materiales on rubros.codigo = tc_keet_materiales.codigo
					where
						tc_keet_materiales.clave like '{clave}%'
					and
						tc_keet_materiales.id_estacion_estatus in ({estatus})
					and 
						tc_keet_materiales.nivel=6
				) principal
				order by 
					principal.clave				
			</select>			
			<select id="conceptosRegistrados">
				select 
					principal.*,
					0 total_detalle
				from ( 
					select
						tc_keet_materiales.id_material as id_key,
						tc_keet_materiales.id_material,
						tc_keet_materiales.nivel,
						tc_keet_materiales.clave,
						tc_keet_materiales.id_empaque_unidad_medida,
						tc_keet_materiales.id_estacion_estatus,
						tc_keet_materiales.costo,
						tc_keet_materiales.codigo,
						tc_keet_materiales.nombre					
					from
						tc_keet_materiales
				  inner join 
						tc_keet_vales_materiales on tc_keet_materiales.id_material = tc_keet_vales_materiales.id_material
					where						
						tc_keet_vales_materiales.id_vale= {idVale}
				) principal
				order by 
				  principal.clave
			</select>			
			<select id="materialesClave">
				select 
					principal.*,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.orden= 2 limit 1, 1) as codigo				  
				from(
					select
						tc_mantic_articulos.id_articulo AS id_key,        
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,
						1 cantidad,        
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre unidad_medida,
						'   ' as origen,
						tc_mantic_articulos.descripcion,				  
						tc_mantic_articulos.precio AS original,
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes
					from
						tc_keet_materiales
					inner join 
						tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
					inner join
						tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
					inner join 
						tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
					inner join 
						tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
					where
						tc_keet_materiales.clave like '{clave}%'				
					  and tc_keet_materiales.nivel=7
					  and tc_mantic_articulos.id_familia in ({familias})				
					group by 
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,					
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre,					
						tc_mantic_articulos.descripcion,
						tc_mantic_articulos.precio,				  
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0'))
				) principal
				order by 
				  nombre
			</select>			
			<select id="materialesVariasClave">
				select 
					principal.*,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.orden= 2 limit 1, 1) as codigo				  
				from(
					select
						tc_mantic_articulos.id_articulo AS id_key,        
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,
						sum(tc_keet_materiales.cantidad) cantidad,        
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre unidad_medida,
						'   ' as origen,
						tc_mantic_articulos.descripcion,				  
						tc_mantic_articulos.precio as original,
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes
					from
						tc_keet_materiales
					inner join 
						tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
					inner join
						tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
					inner join 
						tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
					inner join 
						tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
					where
					  tc_keet_materiales.nivel=7
					  and ({condicion})
					group by 
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,					
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre,					
						tc_mantic_articulos.descripcion,
						tc_mantic_articulos.precio,				  
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0'))
				) principal
				order by 
				  nombre
			</select>			
			<select id="materiales">
				select
					tc_mantic_articulos.id_articulo as id_key,
					tc_keet_materiales.id_material,
					tc_keet_materiales.nivel,
					tc_keet_materiales.clave,
					tc_keet_materiales.id_empaque_unidad_medida,
					tc_keet_materiales.id_estacion_estatus,
					tc_keet_materiales.costo,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.precio,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from
					tc_keet_materiales
				inner join 
					tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'				
				and 
				  tc_keet_materiales.nivel=7
				and 
					tc_keet_materiales.id_material not in (select id_material from tc_keet_vales_detalles where id_material is not null)
				order by 
				  tc_keet_materiales.clave
			</select>			
			<select id="materialesVale">
				select
					tc_mantic_articulos.id_articulo as id_key,
					tc_keet_materiales.id_material,
					tc_keet_materiales.nivel,
					tc_keet_materiales.clave,
					tc_keet_materiales.id_empaque_unidad_medida,
					tc_keet_materiales.id_estacion_estatus,
					tc_keet_materiales.costo,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.precio,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from
					tc_keet_materiales
				inner join 
					tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'				
				and 
				  tc_keet_materiales.nivel=7
				and 
					tc_keet_materiales.id_material not in (select id_material from tc_keet_vales_detalles where id_vale != {idVale} and id_material is not null)
				order by 
				  tc_keet_materiales.clave
			</select>			
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_materiales.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_materiales.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when (tc_keet_materiales.id_estacion_estatus= 3 or tc_keet_materiales.id_estacion_estatus= 4) then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_materiales on principal.codigo = tc_keet_materiales.codigo
				where
					tc_keet_materiales.clave like '{clave}%'
				)final
			</select>
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo, 
						tc_mantic_puestos.nombre as puesto,
						1 as tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo} and tc_keet_departamentos.id_departamento= {idDepartamento}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						'SUBCONTRATISTA' as puesto,  
						2 as tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>
			<select id="lotesContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
          tc_keet_proyectos.id_empresa,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
          tc_keet_prototipos.nombre as prototipo,
					tc_keet_contratos.clave as clave_contrato,
					tc_keet_contratos.etapa as etapa_contrato,
					tc_keet_proyectos.clave as clave_proyecto,
					tc_keet_proyectos.etapa as etapa_proyecto,
					tc_keet_contratos.orden as orden_contrato,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
          tc_keet_contratos.nombre,
          tc_keet_contratos.ejercicio
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.id_contrato_lote_estatus in (1, 2, 3, 4, 6)
				inner join 
					tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
          and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idFigura}
          and tc_keet_contratos.id_contrato_estatus in ({estatus})
				  and {condicion}
			</select>
			<select id="lotesSubContratistas">
select 
  tc_keet_contratos_lotes.id_contrato_lote id_key,
  tc_keet_proyectos.id_empresa,
  tc_keet_contratos_lotes.*,
  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
  tc_keet_prototipos.nombre as prototipo,
  tc_keet_contratos.clave as clave_contrato,
  tc_keet_contratos.etapa as etapa_contrato,
  tc_keet_proyectos.clave as clave_proyecto,
  tc_keet_proyectos.etapa as etapa_proyecto,
  tc_keet_contratos.orden as orden_contrato,
  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor,
  tc_keet_contratos.nombre,
  tc_keet_contratos.ejercicio
from 
  tc_keet_proyectos
inner join 
  tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
inner join 
  tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato and tc_keet_contratos_lotes.id_contrato_estatus in (1, 2, 3, 4, 6)
inner join 
  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo = tc_keet_prototipos.id_prototipo
inner join 
  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
where 
  tc_keet_proyectos.id_desarrollo= {idDesarrollo} 
  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idFigura}
  and tc_keet_contratos.id_contrato_estatus in ({estatus})
  and {condicion}
			</select>						
		</unit>
		<unit id="VistaEntregaMaterialesDto">						
			<select id="resumen">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_vale_detalle AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_keet_vales_detalles.cantidad,
					tc_keet_vales_detalles.surtido,					
					tc_keet_vales_detalles.registro,
					tc_keet_vales_detalles.entregado,
					tc_keet_tipos_entregas.nombre tipo_entrega,
					if(tc_keet_vales_detalles.entregado is null, 'PENDIENTE', 'ENTREGADO') estatus,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from 
					tc_keet_vales_detalles				
				inner join
					tc_keet_tipos_entregas ON tc_keet_vales_detalles.id_tipo_entrega = tc_keet_tipos_entregas.id_tipo_entrega
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale}) principal
				order by
					surtido desc
			</select>
			<select id="evidencia">
				select 
				  principal.*,					
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo,
					sum(tc_keet_vales_detalles.surtido) surtido      
				from
					tc_keet_vales_detalles
				inner join 
					tc_keet_vales_detalles_entrega on tc_keet_vales_detalles.id_vale_detalle = tc_keet_vales_detalles_entrega.id_vale_detalle
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale}
				and
				  tc_keet_vales_detalles.entregado is not null 
				and 
				  tc_keet_vales_detalles.id_tipo_entrega != 4
				and 
					tc_keet_vales_detalles_entrega.clave= '{clave}'
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre) principal
			</select>
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
          inner join
            tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
          inner join
            tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>
			<select id="contratista">
				select 
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					1 tipo  
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        inner join
          tc_keet_contratistas_departamentos on tr_mantic_empresa_personal.id_empresa_persona= tc_keet_contratistas_departamentos.id_empresa_persona         
        inner join
          tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento= tc_keet_departamentos.id_departamento
				where 
					tr_mantic_empresa_personal.id_empresa_persona= {id}
        group by
          tr_mantic_empresa_personal.id_empresa_persona	
			</select>
			<select id="subcontratista">
				select 
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
					tc_mantic_proveedores.razon_social nombre_completo,
					tc_keet_departamentos.id_departamento,
					'SUBCONTRATISTA' puesto,  
					2 tipo  
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
				where 
					tc_mantic_proveedores.id_proveedor={id}
			</select>
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
						tc_keet_departamentos.id_departamento,
						tc_mantic_puestos.nombre puesto,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_contratistas_departamentos on tc_mantic_proveedores.id_empresa_persona = tc_keet_contratistas_departamentos.id_empresa_persona
					inner join 
						tc_keet_departamentos on tc_keet_contratistas_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						tc_keet_departamentos.id_departamento,
						'SUBCONTRATISTA' puesto,  
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>							
			<select id="vales">
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo,
					1 figura,
					tr_mantic_empresa_personal.id_empresa_persona id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = tc_keet_vales.id_contrato_lote_contratista
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					{condicionContratista} and {condicion}
			union
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					tc_mantic_proveedores.razon_social nombre_completo,
					2 figura,
					tc_mantic_proveedores.id_proveedor id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = tc_keet_vales.id_contrato_lote_proveedor
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					{condicionSubcontratista} and {condicion}
			</select>						
			<select id="valesConsecutivo">
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo,
					1 figura,
					tr_mantic_empresa_personal.id_empresa_persona id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = tc_keet_vales.id_contrato_lote_contratista
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					tc_keet_vales.consecutivo like '%{consecutivo}' and {condicion}
			union
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					tc_mantic_proveedores.razon_social nombre_completo,
					2 figura,
					tc_mantic_proveedores.id_proveedor id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = tc_keet_vales.id_contrato_lote_proveedor
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					tc_keet_vales.consecutivo like '%{consecutivo}' and {condicion}
			</select>						
		</unit>
		<unit id="VistaCajaChicaDto">
			<select id="corte">
select
  tc_keet_cajas_chicas_cierres.id_caja_chica_cierre as id_key,
  (select max(tc_keet_cajas_chicas_cierres.id_nomina_periodo) from tc_keet_cajas_chicas_cierres) as ik_nomina_periodo,
  tc_keet_cajas_chicas_cierres.id_nomina_periodo,
  tc_keet_cajas_chicas_cierres.id_caja_chica
from
  tc_keet_cajas_chicas_cierres
where
  tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= {idCajaChicaCierre}
group by  
  tc_keet_cajas_chicas_cierres.id_nomina_periodo
      </select>  
			<select id="findDesarrollo">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				  and tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus in (1,2)
			</select>			
			<select id="findCajaChicaCierre">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= {idCajaChicaCierre}				
			</select>			
		</unit>
		<unit id="VistaGastosDto">
			<select id="importados">
				select
					tc_keet_gastos_archivos.id_gasto_archivo id_key,
					tc_keet_gastos_archivos.nombre,
					tc_keet_gastos_archivos.archivo,
					tc_keet_gastos_archivos.ruta,
					tc_keet_gastos_archivos.alias,
					tc_keet_gastos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_gastos_archivos.id_tipo_archivo,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.importe,
					tc_keet_gastos.articulos,
          concat('{url}', tc_keet_gastos_archivos.ruta, tc_keet_gastos_archivos.archivo) as url
				from
					tc_keet_gastos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_gastos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				inner join
					tc_keet_gastos on tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto
				where
				  tc_keet_gastos_archivos.id_gasto= {idGasto}
			</select>
			<select id="acumulados">
        select
          tc_mantic_personas.id_persona as id_key,
          concat(tc_mantic_personas.nombres, ' ',if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) persona,
          count(*) as gastos,
          sum(if(tc_keet_gastos.id_gasto_estatus!= 3, tc_keet_gastos.importe, 0)) as total,
			    sum(if(tc_keet_gastos.id_gasto_estatus= 3, tc_keet_gastos.importe, 0)) as cancelado
        from
          tc_keet_gastos     
        inner join
          tc_keet_gastos_detalles on tc_keet_gastos.id_gasto = tc_keet_gastos_detalles.id_gasto     
        inner join
          tc_janal_usuarios on tc_keet_gastos.id_usuario= tc_janal_usuarios.id_usuario
        inner join				
          tc_mantic_personas on tc_mantic_personas.id_persona = tc_janal_usuarios.id_persona
        where
          tc_keet_gastos.id_caja_chica_cierre= {idCajaChica}
        group by
          tc_mantic_personas.id_persona    
        order by
          tc_mantic_personas.rfc        
      </select>  
			<select id="gastos">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.id_empresa,
          tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_gastos.id_caja_chica_cierre,
					tc_keet_gastos.id_empresa_persona,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.ejercicio,
					tc_keet_gastos.orden,
					tc_keet_gastos.articulos,
					tc_keet_gastos.importe,
					tc_keet_gastos.id_abono,
					tc_keet_gastos.id_gasto_estatus,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as residente,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_keet_gastos.registro
				from
					tc_keet_gastos
				inner join
					tc_keet_gastos_detalles on tc_keet_gastos.id_gasto= tc_keet_gastos_detalles.id_gasto
        inner join
          tc_janal_usuarios on tc_keet_gastos.id_usuario= tc_janal_usuarios.id_usuario
				inner join				
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas_cierres.id_caja_chica= tc_keet_cajas_chicas.id_caja_chica
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join
					tc_keet_nominas_periodos on tc_keet_cajas_chicas_cierres.id_nomina_periodo = tc_keet_nominas_periodos.id_nomina_periodo
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChica}
				  and {condicion}
				group by 
					tc_keet_gastos.id_gasto
				order by 
				  tc_keet_gastos.consecutivo desc
			</select>
			<select id="gastosConsecutivo">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.id_empresa,
					tc_keet_gastos.id_caja_chica_cierre,
					tc_keet_gastos.id_empresa_persona,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.ejercicio,
					tc_keet_gastos.orden,
					tc_keet_gastos.articulos,
					tc_keet_gastos.importe,
					tc_keet_gastos.id_abono,
					tc_keet_gastos.id_gasto_estatus,
					tc_keet_gastos.registro
				from 
					tc_keet_gastos				
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChica}
				  and tc_keet_gastos.consecutivo like '%{consecutivo}'				
			</select>
			<select id="conceptos">
				select 
					tc_keet_gastos_detalles.id_gasto_detalle as id_key,
					tc_keet_gastos_detalles.nombre,
					tc_keet_gastos_detalles.codigo,
					tc_keet_gastos_detalles.unidad_medida
				from 
					tc_keet_gastos_detalles				
				where 					
					upper(tc_keet_gastos_detalles.nombre) like upper('%{nombre}%')
			</select>
			<select id="cortes">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				order by 
					tc_keet_cajas_chicas_cierres.consecutivo desc
			</select>			
			<select id="findDesarrolloCajaChica">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				and 
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= {idCajaChica}
			</select>	
		</unit>
		<unit id="VistaCierresCajasChicasDto">
			<select id="exportar">
select 
  tc_keet_desarrollos.nombres as desarrollo,
  tc_keet_gastos.consecutivo, 
  concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as residente,
  tc_keet_gastos_detalles.nombre,
  tc_keet_gastos_detalles.importe,
  tc_keet_gastos.registro
from 
  tc_keet_gastos
inner join 		
  tc_keet_gastos_detalles on tc_keet_gastos.id_gasto= tc_keet_gastos_detalles.id_gasto
inner join 
  tr_mantic_empresa_personal on tc_keet_gastos.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
inner join 
  tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
inner join 
  tc_keet_gastos_estatus on tc_keet_gastos.id_gasto_estatus = tc_keet_gastos_estatus.id_gasto_estatus
inner join 
  tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre = tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
inner join
  tc_keet_cajas_chicas on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
inner join
   tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo= tc_keet_desarrollos.id_desarrollo
order by 
  tc_keet_cajas_chicas.id_desarrollo, tc_keet_gastos.consecutivo
      </select>  
			<select id="detalle">
				select 
					tc_keet_gastos_detalles.id_gasto_detalle as id_key,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as residente,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos_detalles.nombre,
					tc_keet_gastos_detalles.importe,
					tc_keet_gastos.registro
				from
				  tc_keet_cajas_chicas_cierres
        inner join
          tc_keet_cajas_chicas on tc_keet_cajas_chicas_cierres.id_caja_chica= tc_keet_cajas_chicas.id_caja_chica
				inner join
					tc_keet_gastos on tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= tc_keet_gastos.id_caja_chica_cierre
				inner join
					tc_keet_gastos_detalles on tc_keet_gastos.id_gasto= tc_keet_gastos_detalles.id_gasto
        inner join
          tc_janal_usuarios on tc_keet_gastos.id_usuario= tc_janal_usuarios.id_usuario
				inner join				
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				where 
					tc_keet_cajas_chicas_cierres.id_nomina_periodo= {idNominaPeriodo}
          and tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				group by 
					tc_keet_gastos_detalles.id_gasto_detalle
				{sortOrder}
      </select>  
			<select id="reponer">
				select
					tc_mantic_empresas.id_empresa as id_key,
					sum(tc_keet_cajas_chicas_cierres.acumulado) as total
				from
					tc_keet_cajas_chicas_cierres
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				inner join
					tc_keet_nominas_periodos on tc_keet_cajas_chicas_cierres.id_nomina_periodo = tc_keet_nominas_periodos.id_nomina_periodo
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_mantic_clientes on tc_keet_desarrollos.id_cliente = tc_mantic_clientes.id_cliente
				inner join 
					tc_mantic_empresas on tc_mantic_clientes.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tc_keet_cajas_chicas_cierres_estatus on tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus = tc_keet_cajas_chicas_cierres_estatus.id_caja_chica_cierre_estatus
				where
					{condicion}
				{sortOrder}        
      </select>  
      <select id="administradores">  
        select
          tr_mantic_persona_tipo_contacto.id_persona_tipo_contacto as id_key,
          tc_mantic_personas.id_persona,
          concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as persona,
          tr_mantic_persona_tipo_contacto.valor
        from
          tc_mantic_personas   
        inner join
          tc_janal_usuarios on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
        inner join
          tr_mantic_persona_tipo_contacto on tc_mantic_personas.id_persona= tr_mantic_persona_tipo_contacto.id_persona
        where
          tr_mantic_persona_tipo_contacto.id_tipo_contacto in (6, 7, 8)  
          and tr_mantic_persona_tipo_contacto.id_preferido= 1
          and tc_janal_usuarios.id_perfil= 5
        order by
          tc_mantic_personas.id_persona,   
          tr_mantic_persona_tipo_contacto.id_tipo_contacto        
      </select>  
      <select id="residentes">  
				select
					tr_mantic_empresa_personal.id_empresa_persona as id_key,
          tc_mantic_personas.id_persona,
					tr_mantic_empresa_personal.id_empresa_persona,
					concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as residente,
          concat(tc_keet_nominas_periodos.ejercicio, '-', tc_keet_nominas_periodos.orden) as nomina,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino,
					sum(tc_keet_gastos.importe) as total
				from
					tc_keet_cajas_chicas_cierres
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				inner join
					tc_keet_nominas_periodos on tc_keet_cajas_chicas_cierres.id_nomina_periodo = tc_keet_nominas_periodos.id_nomina_periodo
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_mantic_clientes on tc_keet_desarrollos.id_cliente = tc_mantic_clientes.id_cliente
				inner join 
					tc_mantic_empresas on tc_mantic_clientes.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tc_keet_cajas_chicas_cierres_estatus on tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus = tc_keet_cajas_chicas_cierres_estatus.id_caja_chica_cierre_estatus
				inner join 
				  tc_keet_gastos on tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= tc_keet_gastos.id_caja_chica_cierre
				inner join 
					tr_mantic_empresa_personal on tc_keet_gastos.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				where
					tc_keet_cajas_chicas_cierres.id_nomina_periodo= {idNominaPeriodo}
          and tc_keet_gastos.id_gasto_estatus in ({idGastoEstatus})
          and {condicion}
        group by
          tr_mantic_empresa_personal.id_empresa_persona           
				{sortOrder}        
      </select>  
			<select id="lazy">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre as id_key,
					tc_keet_nominas_periodos.id_nomina_periodo,
					tc_mantic_empresas.nombre as sucursal,
					tc_keet_desarrollos.id_desarrollo,
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino as final,
					tc_keet_cajas_chicas_cierres.termino,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.saldo as inicial,
					tc_keet_cajas_chicas_cierres.acumulado as gastado,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus,
					tc_keet_cajas_chicas_cierres_estatus.nombre as estatus
				from
					tc_keet_cajas_chicas_cierres
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas.id_caja_chica= tc_keet_cajas_chicas_cierres.id_caja_chica
				inner join
					tc_keet_nominas_periodos on tc_keet_cajas_chicas_cierres.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_mantic_clientes on tc_keet_desarrollos.id_cliente= tc_mantic_clientes.id_cliente
				inner join 
					tc_mantic_empresas on tc_mantic_clientes.id_empresa= tc_mantic_empresas.id_empresa
				inner join
					tc_keet_cajas_chicas_cierres_estatus on tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus= tc_keet_cajas_chicas_cierres_estatus.id_caja_chica_cierre_estatus
				where
					{condicion}
				{sortOrder}
			</select>
			<select id="gastos">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.consecutivo, 
					tc_keet_gastos.importe,
					tc_keet_gastos.articulos,
					tc_keet_gastos.registro,
					tc_keet_gastos.revisado,
					concat(tc_mantic_personas.nombres, ' ', if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) as residente,
					tc_keet_gastos_estatus.nombre as estatus,
					tc_keet_gastos_estatus.id_gasto_estatus,
					if(tc_keet_gastos.id_abono= 1, 'SI', 'NO') as abono,
					tc_keet_cajas_chicas.id_desarrollo,
					ifnull((select concat(ruta, archivo) imagen from tc_keet_gastos_archivos where tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto limit 1), '') as ruta,
					concat('{pathImage}', ifnull((select concat(ruta, archivo) imagen from tc_keet_gastos_archivos where tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto limit 1), '')) as imagen
				from 
					tc_keet_gastos
				inner join 
					tr_mantic_empresa_personal on tc_keet_gastos.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				inner join 
					tc_keet_gastos_estatus on tc_keet_gastos.id_gasto_estatus = tc_keet_gastos_estatus.id_gasto_estatus
				inner join 
				  tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre = tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChicaCierre}
				order by 
				  tc_keet_gastos.consecutivo desc
			</select>			
      <select id="semanas">
				select
					tc_keet_cajas_chicas_cierres.id_nomina_periodo as id_key,
          tc_keet_nominas_periodos.ejercicio,
          tc_keet_nominas_periodos.orden,
          tc_keet_nominas_periodos.inicio,
          tc_keet_nominas_periodos.termino
				from
					tc_keet_cajas_chicas_cierres
				inner join
					tc_keet_nominas_periodos on tc_keet_cajas_chicas_cierres.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
				  tc_keet_nominas_periodos.ejercicio= {ejercicio}
			  group by
			    tc_keet_cajas_chicas_cierres.id_nomina_periodo	   
        order by
          tc_keet_cajas_chicas_cierres.id_nomina_periodo desc   
      </select>
		</unit>
		<unit id="VistaGastosDetallesDto">
			<select id="detalle">
				select
					tc_keet_gastos_detalles.id_gasto_detalle as id_key,
					tc_keet_gastos_detalles.id_gasto_detalle as id_comodin,
          tc_keet_gastos_detalles.*,
          tc_keet_gastos_detalles.cantidad as cuantos,
          tc_keet_gastos_detalles.cantidad as inicial,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
					tc_mantic_articulos.menudeo
				from 
					tc_keet_gastos_detalles
				inner join
					tc_mantic_articulos on tc_keet_gastos_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where  
					tc_keet_gastos_detalles.id_gasto= {idGasto}
				order by
					tc_keet_gastos_detalles.registro
			</select>
			<select id="porNombre">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_almacen= {idAlmacen})) stock
				from(
				select 
				  tc_mantic_articulos.id_articulo as id_key,
				  tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.id_articulo as id_comodin,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1 and (upper(tc_mantic_articulos.nombre) regexp '{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and (upper(tc_mantic_articulos.nombre) regexp '{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  '   ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
				  tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,		
				  concat(tc_mantic_articulos.id_empresa, '/', ifnull(tc_mantic_imagenes.archivo, 'sin-foto.png')) as archivo
				from 
					tc_mantic_articulos
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				left join
				  tc_mantic_imagenes on tc_mantic_articulos.id_imagen= tc_mantic_imagenes.id_imagen
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and tc_mantic_articulos.id_articulo_tipo= 1
				  and tc_mantic_articulos.id_vigente= 1
				  and 
				  (
				    upper(tc_mantic_articulos.nombre) regexp '{codigo}.*'
				  or
				    tc_mantic_articulos.id_articulo= {idArticulo}
				  )) principal 			
				order by 
				  nombre				
			</select>
			<select id="porCodigo">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_almacen= {idAlmacen})) stock
				from(
				select 
				  tc_mantic_articulos_codigos.id_articulo_codigo as id_key,
				  tc_mantic_articulos.id_articulo,
				  tc_mantic_articulos.id_articulo as id_comodin,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and (tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1) and ((upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and (tc_mantic_articulos_codigos.id_proveedor = {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1)) or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  ' ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
					tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,
				  concat(tc_mantic_articulos.id_empresa, '/', ifnull(tc_mantic_imagenes.archivo, 'sin-foto.png')) as archivo
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa								
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				left join
				  tc_mantic_imagenes on tc_mantic_articulos.id_imagen= tc_mantic_imagenes.id_imagen
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and tc_mantic_articulos.id_articulo_tipo= 1
				  and tc_mantic_articulos.id_vigente= 1
				  and (
				      (upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and tc_mantic_articulos_codigos.id_proveedor is null)
				    or
				      (upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and tc_mantic_articulos_codigos.id_proveedor = {idProveedor})
			      or	
				      tc_mantic_articulos.id_articulo= {idArticulo}
				   )) principal 			
				order by 
				  propio
			</select>
		</unit>
		<unit id="VistaRequisicionesDesarrolloDto">
			<select id="generales">
				select
					tc_mantic_requisiciones.id_requisicion as id_key,
					tc_mantic_requisiciones.consecutivo,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_clientes.razon_social as cliente,
					tc_keet_contratos.clave as contrato,
					tc_keet_contratos.etapa,
					tc_keet_prototipos.nombre as prototipo,
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_requisiciones.registro
				from
					tc_mantic_requisiciones
				inner join
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join
					tc_keet_desarrollos on tc_mantic_requisiciones.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_keet_desarrollos.id_cliente= tc_mantic_clientes.id_cliente
				inner join
					tc_keet_contratos on tc_mantic_requisiciones.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_prototipos on tc_mantic_requisiciones.id_prototipo= tc_keet_prototipos.id_prototipo
				where
					tc_mantic_requisiciones.id_requisicion= {idRequisicion}  				
			</select>
			<select id="comparativo">
        select
					tc_mantic_requisiciones_detalles.id_requisicion_detalle as id_key,
					tc_mantic_proveedores.razon_social,
					tc_mantic_requisiciones.consecutivo,  															
					tc_mantic_requisiciones_detalles.codigo,
					tc_mantic_requisiciones_detalles.propio,
					tc_mantic_requisiciones_detalles.nombre,
					tc_mantic_requisiciones_detalles.cantidad,
					tc_mantic_requisiciones_detalles.costo,
					tc_mantic_requisiciones_detalles.iva,
					tc_mantic_requisiciones_detalles.sub_total,
					tc_mantic_requisiciones_detalles.importe,
					tc_mantic_articulos.precio as ultima_compra,
					ifnull(tc_keet_articulos_proveedores.precio_base, 0) as precio_base,
					ifnull(tc_keet_articulos_proveedores.precio_lista, 0) as precio_lista,
					ifnull(tc_keet_articulos_proveedores.precio_especial, 0) as precio_especial,
					if(tc_keet_articulos_proveedores.precio_base is null, 0, tc_mantic_requisiciones_detalles.importe* 100/ tc_keet_articulos_proveedores.precio_base) as porcentaje,
					tc_keet_articulos_proveedores.actualizado,
					ifnull(tr_keet_articulo_proveedor_cliente.precio_convenio, 0) as precio_convenio
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_articulos on tc_mantic_requisiciones_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
			  left join
			    tc_keet_articulos_proveedores on tc_keet_articulos_proveedores.id_articulo = tc_mantic_articulos.id_articulo
			  left join
			    tr_keet_articulo_proveedor_cliente on tc_mantic_requisiciones_detalles.id_articulo = tr_keet_articulo_proveedor_cliente.id_articulo
				where
				  tc_mantic_requisiciones.id_requisicion= {idRequisicion}
				order by
				  tc_mantic_requisiciones_detalles.nombre 
			</select>					
			<select id="exportar">
        select
					tc_mantic_requisiciones_detalles.id_requisicion_detalle as id_key,
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_requisiciones.consecutivo,  															
					tc_mantic_requisiciones_detalles.codigo as "codigo proveedor",
					tc_mantic_requisiciones_detalles.propio as codigo,
					tc_mantic_requisiciones_detalles.nombre,
					tc_mantic_requisiciones_detalles.cantidad,
					tc_mantic_requisiciones_detalles.costo,
					tc_mantic_requisiciones_detalles.iva,
					tc_mantic_requisiciones_detalles.sub_total,
					tc_mantic_requisiciones_detalles.importe as precio
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_requisiciones.id_requisicion= {idRequisicion}
				order by
				  tc_mantic_requisiciones_detalles.nombre  				
			</select>
			<select id="lazy">
        select
					tc_mantic_requisiciones.id_requisicion as id_key,
					tc_mantic_requisiciones.id_empresa,  
					tc_mantic_requisiciones.id_enviar,  
				  tc_mantic_empresas.clave as empresa,  
				  tc_mantic_empresas.nombre as nombre_empresa,  
					tc_mantic_requisiciones.consecutivo,  															
				  tc_mantic_requisiciones_estatus.nombre as estatus,
					tc_mantic_requisiciones.id_requisicion_estatus,
					tc_mantic_requisiciones.registro,
					tc_mantic_requisiciones.observaciones,
					tc_mantic_requisiciones.fecha_pedido,
					tc_mantic_requisiciones.fecha_entregada,
					tc_mantic_requisiciones_estatus.estatus_asociados, 					
					tc_mantic_personas.cuenta,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,
					tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.razon_social proveedor
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_empresas on tc_mantic_requisiciones.id_empresa= tc_mantic_empresas.id_empresa
				inner join 
					tc_mantic_requisiciones_estatus on tc_mantic_requisiciones.id_requisicion_estatus=tc_mantic_requisiciones_estatus.id_requisicion_estatus				
				inner join				
					tc_mantic_personas on tc_mantic_personas.id_persona = tc_mantic_requisiciones.id_solicita
				inner join 
					tc_keet_desarrollos on tc_mantic_requisiciones.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
				where
					{condicion}
				group by 
				  tc_mantic_requisiciones.id_requisicion,
					tc_mantic_requisiciones.id_empresa,  
					tc_mantic_requisiciones.id_enviar,  
				  tc_mantic_empresas.clave,  
				  tc_mantic_empresas.nombre,  
					tc_mantic_requisiciones.consecutivo
				{sortOrder}
			</select>
			<select id="preciosArticulo">
				select
					tc_mantic_articulos.id_articulo AS id_key,
					tc_mantic_articulos.nombre,
					tc_mantic_articulos.precio precio_compra,
					ifnull(tr_keet_articulo_proveedor_cliente.precio_convenio, 0) precio_convenio,
					ifnull(tc_keet_articulos_proveedores.precio_base, 0) precio_base,
					ifnull(tc_keet_articulos_proveedores.precio_lista, 0) precio_lista,
					ifnull(tc_keet_articulos_proveedores.precio_especial, 0) precio_especial,
					ifnull(presupuesto.presupuesto, 0) precio_presupuesto
				from
					tc_mantic_articulos
				left join 
				  (								
						select						        						
							tc_keet_materiales.codigo,
							(tc_keet_materiales.costo / tc_keet_materiales.cantidad) presupuesto						
						from
							tc_keet_materiales
						inner join 
							tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
						inner join
							tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
						inner join 
							tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
						inner join 
							tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
						where
							tc_keet_materiales.clave like '{clave}%'				
						and 
							tc_keet_materiales.nivel=7					
						group by 
							tc_keet_materiales.codigo,
							(tc_keet_materiales.costo / tc_keet_materiales.cantidad) 
					) presupuesto on presupuesto.codigo = tc_mantic_articulos.codigo
				left join
					tr_keet_articulo_proveedor_cliente on tc_mantic_articulos.id_articulo = tr_keet_articulo_proveedor_cliente.id_articulo and tr_keet_articulo_proveedor_cliente.id_proveedor= {idProveedor}
				left join
					tc_keet_articulos_proveedores on tc_mantic_articulos.id_articulo = tc_keet_articulos_proveedores.id_articulo and tc_keet_articulos_proveedores.id_proveedor= {idProveedor}
				where
					tc_mantic_articulos.id_articulo = {idArticulo}
			</select>
		</unit>
		<unit id="VistaTcKeetGastosDto">
			<select id="row">
				select      
          tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.*,
					tc_keet_cajas_chicas_cierres.id_caja_chica
        from      
          tc_keet_gastos
				inner join 
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre = tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
        where 
          {condicion} 
			</select>
		</unit>
		<unit id="VistaFamiliasProveedoresDto">
			<select id="lazy">
        select      
          tc_keet_ordenes_contratos_lotes.id_orden_contrato_lote as id_key,
          tc_mantic_ordenes_compras.consecutivo,
          tc_mantic_ordenes_compras.total,
          tc_mantic_proveedores.razon_social as proveedor,
          tc_keet_contratos.clave as contrato,
          tc_keet_contratos.etapa,
          tc_keet_contratos.no_viviendas,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos_lotes.clave,
          tc_keet_familias.nombre as familia,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) usuario,  
          tc_keet_ordenes_contratos_lotes.registro
        from      
          tc_keet_ordenes_contratos_lotes
        inner join
          tc_mantic_ordenes_compras on tc_keet_ordenes_contratos_lotes.id_orden_compra= tc_mantic_ordenes_compras.id_orden_compra
        inner join
          tc_mantic_proveedores on tc_mantic_ordenes_compras.id_proveedor= tc_mantic_proveedores.id_proveedor
        inner join
          tc_keet_contratos_lotes on tc_keet_ordenes_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
        inner join
          tc_keet_ordenes_familias on tc_mantic_ordenes_compras.id_orden_compra= tc_keet_ordenes_familias.id_orden_compra
        inner join
          tc_keet_familias on tc_keet_ordenes_familias.id_familia = tc_keet_familias.id_familia
        inner join
          tc_janal_usuarios on tc_keet_ordenes_contratos_lotes.id_usuario= tc_janal_usuarios.id_usuario
        inner join
          tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
        where      
          tc_keet_contratos.id_contrato = {idContrato}
        order by
           lote, tc_keet_familias.nombre 
      </select>
      <select id="existe">
        select      
          tc_keet_ordenes_contratos_lotes.id_orden_contrato_lote as id_key
        from      
          tc_keet_ordenes_contratos_lotes
        inner join
          tc_keet_contratos_lotes on tc_keet_ordenes_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
        inner join
          tc_keet_ordenes_familias on tc_keet_ordenes_contratos_lotes.id_orden_compra= tc_keet_ordenes_familias.id_orden_compra
        where      
          tc_keet_contratos.id_contrato = {idContrato}
          and tc_keet_ordenes_familias.id_familia= {idFamilia}
          and tc_keet_ordenes_contratos_lotes.id_contrato_lote= {idContratoLote}
      </select>
			<select id="row">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
      </select>
			<select id="disponibles">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
				and 
					tc_keet_familias.id_familia not in (select id_familia from tc_keet_ordenes_contratos_lotes where id_contrato_lote in ({contratosLotes}))
      </select>
			<select id="byOrdenCompra">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
				and 
					tc_keet_familias.id_familia in (select id_familia from tc_keet_ordenes_contratos_lotes where id_orden_compra = {idOrdenCompra})
      </select>
		</unit>
	</dml>    
</process>
