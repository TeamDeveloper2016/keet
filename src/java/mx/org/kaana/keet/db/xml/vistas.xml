<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de MANTIC
-->
<process>
	<dml> 
		<unit id="VistaNominaDto">
			<select id="lazy">
				select
					tc_keet_nominas.id_nomina as id_key,
					tc_keet_nominas.id_nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
          tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_tipos_nominas.nombre as tipo,
					tc_keet_nominas_periodos.corte,
					tc_keet_nominas.id_nomina_estatus,
					tc_keet_nominas_estatus.nombre as estatus,
					tc_keet_nominas.personas,
					tc_keet_nominas.neto
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_tipos_nominas on tc_keet_nominas.id_tipo_nomina= tc_keet_tipos_nominas.id_tipo_nomina
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					{condicion}
				{sortOrder}
			</select>
			<select id="ejercicios">
				select
					distinct(tc_keet_nominas_periodos.ejercicio) as id_key,
					tc_keet_nominas_periodos.ejercicio
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				order by
				  tc_keet_nominas_periodos.ejercicio desc				
			</select>
			<select id="semanas">
				select
					distinct(tc_keet_nominas_periodos.orden) as id_key,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				order by
				  tc_keet_nominas_periodos.orden asc				
			</select>
			<select id="semana">
				select
					max(tc_keet_nominas_periodos.orden) as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus= 1
			</select>
			<select id="todos">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
			<select id="complementaria">
        select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
					tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona not in (
				    select
				      tc_keet_nominas_personas.id_empresa_persona
				    from 
				      tc_keet_nominas_personas 
				    where
				      tc_keet_nominas_personas.id_nomina= {idNomina}
				 )
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave	
			</select>
			<select id="persona">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
			<select id="nominas">
        select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas_periodos.ejercicio&gt;= {ejercicio}
				order by
				  nombre desc				
			</select>
			<select id="nomina">
        select
					tc_keet_nominas.id_nomina as id_key,
					tc_keet_nominas_periodos.*,
				  tc_keet_nominas_estatus.id_nomina_estatus,
				  tc_keet_nominas_estatus.nombre as estatus,
				  tc_keet_nominas.observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_nomina= {idNomina}
			</select>
			<select id="proveedor">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
			<select id="proveedores">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
      <select id="incidentes">
			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente and tc_mantic_tipos_incidentes.id_afecta_nomina= 1
			  where
				  tc_mantic_incidentes.id_nomina is null
				  and tc_mantic_incidentes.id_incidente_estatus= 2
				  and tc_mantic_incidentes.id_empresa_persona= {idEmpresaPersona}
			  order by
				  tc_mantic_incidentes.id_tipo_incidente, tc_mantic_incidentes.vigencia_inicio desc
			</select>			
      <select id="aplicar">
			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente 
				  and tc_mantic_tipos_incidentes.id_afecta_nomina= 2
			  where
				  tc_mantic_incidentes.id_nomina is null
				  and tc_mantic_incidentes.id_incidente_estatus= 2
			  union all
 			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
			  where
				  tc_mantic_incidentes.id_nomina= {idNomina}
				  and tc_mantic_incidentes.id_incidente_estatus= 2			
			</select>	
			<select id="contratista">
        select 
				  tc_keet_contratos_destajos_contratistas.*
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				where 
				  tc_keet_contratos_destajos_contratistas.id_nomina is null
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
			</select>
			<select id="agremiados">
				select 
					{idEmpresaPersona} as id_contratista,
					count(*) as agremiados,
					sum(sueldo_semanal) as salarios
				from
					tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				where
					tr_mantic_empresa_personal.id_contratista= {idEmpresaPersona}
					and tr_mantic_empresa_personal.id_activo= 1
					and tr_mantic_empresa_personal.id_empresa_persona!= {idEmpresaPersona}				
			</select>	
			<select id="detalle">
				select
					tc_keet_nominas_conceptos.id_tipo_concepto,
					tc_keet_nominas_conceptos.orden,
					tc_keet_nominas_detalles.clave,
					tc_keet_nominas_detalles.nombre,
					tc_keet_nominas_detalles.formula,
					tc_keet_nominas_detalles.valor
				from
					tc_keet_nominas_detalles
				inner join
					tc_keet_nominas_personas on tc_keet_nominas_detalles.id_nomina_persona = tc_keet_nominas_personas.id_nomina_persona
				inner join
					tc_keet_nominas_conceptos on tc_keet_nominas_detalles.id_nomina_concepto = tc_keet_nominas_conceptos.id_nomina_concepto
				where
					tc_keet_nominas_personas.id_nomina= {idNomina}
					and tc_keet_nominas_detalles.id_nomina_persona= {idEmpresaPersona}
				order by
					tc_keet_nominas_detalles.id_nomina_persona, tc_keet_nominas_conceptos.id_tipo_concepto desc, tc_keet_nominas_conceptos.orden				
			</select>	
      <select id="subContratista">
        select 
				  tc_keet_contratos_destajos_contratistas.*
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				where 
				  tc_keet_contratos_destajos_contratistas.id_nomina is null
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
			</select>			
		</unit>
		<unit id="VistaContratosLotesDto">
			<select id="principal">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ",tc_mantic_domicilios.numero_exterior) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
					{condicion}
				order by 
					tc_keet_contratos.clave
			</select>
			<select id="residentes">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ",tc_mantic_domicilios.numero_exterior) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente				
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo				
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}												
				where
					{condicion}
				order by 
					tc_keet_contratos.clave
			</select>
		</unit>
		<unit id="VistaDiasFeriadosDto">
			<select id="lazy">
				select
					tc_keet_dias_festivos.id_dia_festivo AS id_key,
					tc_keet_dias_festivos.*,
					tc_mantic_empresas.nombre 
				from
					tc_keet_dias_festivos
				inner join 
					tc_mantic_empresas on tc_keet_dias_festivos.id_empresa= tc_mantic_empresas.id_empresa
				where 
					{condicion}
				and 
					tc_keet_dias_festivos.id_empresa in ({idEmpresa})				
				{sortOrder}
			</select>
		</unit>
		<unit id="VistaIncidenciasDto">
			<select id="movimientos">
				select
					tc_mantic_incidentes_bitacora.id_incidente_bitacora as id_key,
					tc_mantic_incidentes.consecutivo,
					0 as importe,
					tc_mantic_incidentes_bitacora.justificacion,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre,
				  tc_mantic_incidentes_estatus.nombre as estatus,
					tc_mantic_incidentes_bitacora.registro
				from 
					tc_mantic_incidentes_bitacora
				inner join
					tc_mantic_incidentes on tc_mantic_incidentes_bitacora.id_incidente= tc_mantic_incidentes.id_incidente
				inner join
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_bitacora.id_incidente_estatus= tc_mantic_incidentes_estatus.id_incidente_estatus
				inner join
					tc_janal_usuarios on tc_mantic_incidentes_bitacora.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				where
					tc_mantic_incidentes_bitacora.id_incidente= {idIncidente}
				order by
					tc_mantic_incidentes_bitacora.registro desc				
			</select>		
			<select id="importados">
				select 
					tc_mantic_incidentes_archivos.id_incidente_archivo as id_key,
					tc_mantic_incidentes_archivos.nombre,
					tc_mantic_incidentes_archivos.archivo,
					tc_mantic_incidentes_archivos.ruta,
					tc_mantic_incidentes_archivos.alias,
					tc_mantic_incidentes_archivos.observaciones observacion_archivo,
					tc_mantic_incidentes_archivos.registro,
					tc_mantic_incidentes_archivos.id_tipo_archivo,
					tc_mantic_incidentes.consecutivo,					
					tc_mantic_incidentes.vigencia_inicio,
					tc_mantic_incidentes.vigencia_fin,
					tc_mantic_incidentes.ejercicio,					
					tc_mantic_incidentes.orden,					
					tc_mantic_incidentes.observaciones,
					tc_mantic_incidentes.id_usuario,
					tc_mantic_incidentes.registro registro_incidente,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_mantic_tipos_incidentes.nombre tipo_incidente,
					tc_mantic_incidentes_estatus.nombre estatus,					
					tc_mantic_puestos.nombre puesto				
				from 
					tc_mantic_incidentes_archivos
				inner join 
					tc_mantic_incidentes on tc_mantic_incidentes_archivos.id_incidente = tc_mantic_incidentes.id_incidente				
				inner join
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente = tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_estatus.id_incidente_estatus = tc_mantic_incidentes.id_incidente_estatus
				inner join 
					tc_janal_usuarios on tc_mantic_incidentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				left join 
					tc_keet_contratos_personal on tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona
				where 
					tc_keet_contratos_personal.id_contratos_personal = {idContratoPersona}
				  or tr_mantic_empresa_personal.id_empresa_persona = {idEmpresaPersona}												
			</select>
		</unit>
		<unit id="VistaTiposObrasDto">
			<select id="catalogo">
				select
					tc_keet_tipos_obras.id_tipo_obra AS id_key,
					tc_keet_tipos_obras.id_division,
					tc_keet_tipos_obras.clave,
					tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_divisiones.nombre tipo_division
				from
					tc_keet_tipos_obras
				inner join
					tc_keet_divisiones ON tc_keet_tipos_obras.id_division = tc_keet_divisiones.id_division
				order by
					tc_keet_tipos_obras.id_division, tc_keet_tipos_obras.clave
			</select>			
		</unit>
    <unit id="VistaContratosDto">
			<select id="lazy">
				select 
          tc_keet_contratos.id_contrato id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.no_viviendas,
          tc_keet_contratos.etapa,
          tc_mantic_clientes.razon_social,
					tc_keet_contratos_estatus.id_contrato_estatus,
					tc_keet_contratos_estatus.nombre as estatus,
					tc_keet_contratos_estatus.estatus_asociados,
					tc_keet_contratos.registro,
				  tc_keet_proyectos.clave proyecto
        from 
          tc_keet_contratos
        inner join 
					tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join
          tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="findDesarrollo">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.*
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
			</select>
			<select id="personalAsignado">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					{campoLlave} as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,
					(select count(*) total from tc_mantic_incidentes where tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona) total_incidencias,
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
				order by 					
					descripcion
			</select>
			<select id="personalDisponible">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista         
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_personal where tc_keet_contratos_personal.id_desarrollo= {idDesarrollo})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
				order by 					
					descripcion				
			</select>
			<select id="consulta">
				select
				  principal.*,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as contratista
			  from (
					select      
						tr_mantic_empresa_personal.id_empresa_persona as id_key,									
						tc_keet_departamentos.nombre departamento,
						tc_mantic_puestos.nombre puesto,
						tr_mantic_empresa_personal.id_activo,
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
						tr_mantic_empresa_personal.id_puesto,
						tr_mantic_empresa_personal.id_departamento,
						tr_mantic_empresa_personal.nss,
						tr_mantic_empresa_personal.id_nomina,
				    tr_mantic_empresa_personal.id_contratista
					from      
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					inner join	
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
					where 
						{condicion}
					order by 
						tc_mantic_puestos.nombre, tc_mantic_personas.nombres
			  ) principal
			  left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				order by 
					principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')), principal.nombre_completo, principal.puesto
			</select>
			<select id="totales">
				select
				  floor(rand()*(100- 10+ 1)+10) as id_key,
					tr_mantic_empresa_personal.id_empresa, 
					if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as desarrollo, 
					count(*) as total, 
					sum(if(tr_mantic_empresa_personal.id_activo= 1, 1, 0)) as activos,
					sum(if(tr_mantic_empresa_personal.id_activo= 2, 1, 0)) as no_activos,
          sum(if(tr_mantic_empresa_personal.id_activo= 1 and (tr_mantic_empresa_personal.nss is null or tr_mantic_empresa_personal.nss= ''), 1, 0)) as sin_seguro
				from
					tr_mantic_empresa_personal
				left join
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				left join
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
				  {condicion}
				group by
					tr_mantic_empresa_personal.id_empresa, tc_keet_desarrollos.descripcion
				with rollup
			</select>
			<select id="findContratoPersona">
				select      
					tc_keet_contratos_personal.id_contratos_personal as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,					
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				inner join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tc_keet_contratos_personal.id_contratos_personal= {idContratoPersona}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="findPersonaAdmin">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					tc_keet_contratos_personal.id_desarrollo,					
					tc_keet_contratos_personal.id_contratos_personal,					
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo          
        from                
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				left join 
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				left join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="byEmpresa">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.*
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_keet_proyectos.id_cliente=tc_mantic_clientes.id_cliente
				where
					tc_mantic_clientes.id_empresa in ({sucursales})
			</select>
			<select id="getEstacionPatron">
				select 
					concat(lpad(tc_mantic_clientes.id_empresa, 3, '0') ,tc_keet_contratos.ejercicio ,lpad(tc_keet_contratos.orden, 3, '0')) patron
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_keet_proyectos.id_cliente=tc_mantic_clientes.id_cliente
				where
					tc_keet_contratos.id_contrato = {idContrato}
			</select>
			<select id="contratistasAsignado">
				select contratistas.* from (
				select      
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          
					1 tipo,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote,
					tc_keet_contratos_lotes_contratistas.id_empresa_persona,
					tc_keet_contratos_lotes_contratistas.observaciones,
					tc_keet_contratos_lotes_contratistas.id_trabajo,
					tc_keet_contratos_lotes_contratistas.id_usuario,
					tc_keet_contratos_lotes_contratistas.registro 
        from      
          tc_keet_contratos_lotes_contratistas
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_contratistas.id_trabajo=2
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres) contratistas
				union
				select subcontratistas.* from (
				select      
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,								
					ifnull((select nombre from tc_keet_proveedores_departamentos inner join tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento where tc_keet_proveedores_departamentos.id_proveedor=tc_mantic_proveedores.id_proveedor limit 1), '') departamento,
					'SUBCONTRATISTA' puesto,
					tc_mantic_proveedores.id_activo,
					1 id_nomina,
					tc_mantic_proveedores.rfc nss,
					tc_mantic_proveedores.razon_social nombres,
					'' paterno,
					'' materno,					
					tc_mantic_proveedores.rfc,					
					tc_mantic_proveedores.rfc curp,					
					2 tipo,					
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor id_contrato_lote_contratista,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote,
					tc_keet_contratos_lotes_proveedores.id_proveedor id_empresa_persona,
					tc_keet_contratos_lotes_proveedores.observaciones,
					tc_keet_contratos_lotes_proveedores.id_trabajo,
					tc_keet_contratos_lotes_proveedores.id_usuario,
					tc_keet_contratos_lotes_proveedores.registro 
        from     
					tc_keet_contratos_lotes_proveedores
				inner join
					tc_mantic_proveedores	on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
        where 
          tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_proveedores.id_trabajo=2
				and 					
					tc_mantic_proveedores.id_empresa= {idEmpresa}
				  and tc_mantic_proveedores.id_activo= 1
				  and {condicionProveedor}
					and tc_mantic_proveedores.id_subcontratista= 1
				order by
					tc_mantic_proveedores.razon_social
				) subcontratistas
			</select>
			<select id="contratistasDisponible">
				select contratistas.* from (
				select      					
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,					
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					1 tipo
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_lotes_contratistas where tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
					and tc_mantic_puestos.nombre= 'CONTRATISTA'
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres) contratistas
				union
				select subcontratistas.* from (
				select      
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,			
					tc_mantic_proveedores.id_proveedor id_empresa_persona,	
					ifnull((select nombre from tc_keet_proveedores_departamentos inner join tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento where tc_keet_proveedores_departamentos.id_proveedor=tc_mantic_proveedores.id_proveedor limit 1), '') departamento,				
					'SUBCONTRATISTA' puesto,
					tc_mantic_proveedores.id_activo,
					1 id_nomina,
					tc_mantic_proveedores.rfc nss,
					tc_mantic_proveedores.razon_social nombres,
					'' paterno,
					'' materno,					
					tc_mantic_proveedores.rfc,					
					tc_mantic_proveedores.rfc curp,					
					2 tipo
        from                				
					tc_mantic_proveedores				
        where 
          tc_mantic_proveedores.id_proveedor not in (select id_proveedor from tc_keet_contratos_lotes_proveedores where tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote})            
				and 					
					tc_mantic_proveedores.id_empresa= {idEmpresa}
				  and tc_mantic_proveedores.id_activo= 1
				  and {condicionProveedor}
					and tc_mantic_proveedores.id_subcontratista= 1
				order by
					tc_mantic_proveedores.razon_social
				) subcontratistas
			</select>
			<select id="contratistas">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp          
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where           
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
					and tc_mantic_puestos.nombre= 'CONTRATISTA'
					and
						(tc_mantic_personas.nombres like '%{nombreEmpleado}%' 
					or
						tc_mantic_personas.paterno like '%{nombreEmpleado}%'
					or
						tc_mantic_personas.materno  like '%{nombreEmpleado}%')
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
		</unit>
    <unit id="VistaPrototiposDto">
			<select id="lazy">
				select 
          tc_keet_prototipos.id_prototipo as id_key,
          tc_keet_prototipos.clave,
          tc_keet_prototipos.nombre,
          tc_keet_prototipos.descripcion,
          tc_keet_prototipos.metros2,
          tc_mantic_clientes.razon_social,
				  tc_keet_prototipos.id_estacion
        from
          tc_keet_prototipos
        inner 
				  join tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_prototipos.id_cliente
        where
          {condicion}
				  {sortOrder}
			</select>	
			<select id="constructivosById">
				select      
					tc_keet_prototipos_constructivos.id_prototipo_constructivo id_key,
					tc_keet_prototipos_constructivos.*,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_prototipos_constructivos
				inner join tc_keet_constructivos on tc_keet_prototipos_constructivos.id_constructivo= tc_keet_constructivos.id_constructivo
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          tc_keet_prototipos_constructivos.id_prototipo= {idPrototipo}
			</select>	
			<select id="constructivosSelect">
				select      
					tc_keet_constructivos.id_constructivo id_key,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_constructivos 
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          {condicion}
				order by
				  tc_keet_grupos_constructivos.nombre, tc_keet_constructivos.nombre
			</select>
		  <select id="getPlanosEspecialidades">
				select 
					tc_keet_planos.id_plano id_key,
					tc_keet_planos.nombre descripcion,
					tc_keet_especialidades.nombre grupo 
				from
					tc_keet_planos
				inner join tc_keet_especialidades on tc_keet_planos.id_especialidad= tc_keet_especialidades.id_especialidad
        where
          {condicion}
				order by
					tc_keet_especialidades.nombre, tc_keet_planos.nombre
			</select>		
		  <select id="importados">
				select
					id_prototipo_archivo id_key,
					tc_keet_prototipos_archivos.nombre,
					tc_keet_prototipos_archivos.archivo,
					tc_keet_prototipos_archivos.ruta,
					tc_keet_prototipos_archivos.alias,
					tc_keet_prototipos_archivos.observaciones,
					tc_keet_prototipos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_prototipos_archivos.id_tipo_archivo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_prototipos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_prototipos_archivos.id_usuarios= tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_planos on tc_keet_prototipos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  id_prototipo= {idPrototipo}
			</select>		
		  <select id="getDias">
				select
					id_prototipo_dia id_key,
					nombre 
				 from
					 tc_keet_prototipos_dias
				 inner join tc_keet_nombres_dias on tc_keet_nombres_dias.id_nombre_dia= tc_keet_prototipos_dias.id_nombre_dia
				where
				  id_prototipo= {idPrototipo}
			</select>		
		</unit>
    <unit id="VistaProyectoDto">
			<select id="lazy">
				select 
          tc_keet_proyectos.id_proyecto id_key,
          tc_keet_proyectos.id_proyecto,
          tc_keet_proyectos.clave,
          tc_keet_proyectos.no_viviendas,
          tc_keet_proyectos.etapa,
          tc_mantic_clientes.razon_social,
          tc_keet_desarrollos.nombres desarrollo,
          tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_proyectos_estatus.id_proyecto_estatus,
					tc_keet_proyectos_estatus.nombre as estatus,
					tc_keet_proyectos_estatus.estatus_asociados,
					tc_keet_proyectos.registro
        from 
          tc_keet_proyectos
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join 
					tc_keet_desarrollos on tc_keet_desarrollos.id_desarrollo= tc_keet_proyectos.id_desarrollo
        inner join 
					tc_keet_tipos_obras on tc_keet_tipos_obras.id_tipo_obra= tc_keet_proyectos.id_tipos_obras
        inner join
          tc_keet_proyectos_estatus on tc_keet_proyectos_estatus.id_proyecto_estatus= tc_keet_proyectos.id_proyecto_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="tiposObraPorDivision">
				select 
					tc_keet_tipos_obras.id_tipo_obra id_key,
					tc_keet_tipos_obras.nombre descripcion,
					tc_keet_divisiones.nombre grupo
				from tc_keet_tipos_obras
				inner join tc_keet_divisiones on tc_keet_tipos_obras.id_division= tc_keet_divisiones.id_division
				order by
				  tc_keet_divisiones.nombre, tc_keet_tipos_obras.nombre
			</select>	
		</unit>	
		<unit id="VistaProyectosArchivosDto">
			<select id="importados">
				select
					tc_keet_proyectos_archivos.id_proyecto_archivo id_key,
					tc_keet_proyectos_archivos.nombre,
					tc_keet_proyectos_archivos.archivo,
					tc_keet_proyectos_archivos.ruta,
					tc_keet_proyectos_archivos.alias,
					tc_keet_proyectos_archivos.observaciones,
					tc_keet_proyectos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_proyectos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_proyectos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_proyectos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_proyectos_archivos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_proyectos_generadores.id_proyecto_generador id_key,
					tc_keet_proyectos_generadores.nombre,
					tc_keet_proyectos_generadores.archivo,
					tc_keet_proyectos_generadores.ruta,
					tc_keet_proyectos_generadores.alias,
					tc_keet_proyectos_generadores.observaciones,
					tc_keet_proyectos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_proyectos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_proyectos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_proyectos_generadores.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_proyectos_presupuestos.id_proyecto_presupuesto id_key,
					tc_keet_proyectos_presupuestos.nombre,
					tc_keet_proyectos_presupuestos.archivo,
					tc_keet_proyectos_presupuestos.ruta,
					tc_keet_proyectos_presupuestos.alias,
					tc_keet_proyectos_presupuestos.observaciones,
					tc_keet_proyectos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_proyectos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_proyectos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_proyectos_presupuestos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaNombresDiasDto">
			<select id="dias">
				select      
          tc_keet_nombres_dias.id_nombre_dia as id_key,
					tc_keet_nombres_dias.*
        from      
          tc_keet_nombres_dias
				inner join 
					tc_keet_prototipos_dias on tc_keet_nombres_dias.id_nombre_dia = tc_keet_prototipos_dias.id_nombre_dia
        where 
          {condicion} 
			</select>
		</unit>
		<unit id="VistaProveedoresBancosDto">
			<select id="row">
				select 
					principal.*
				from(
				select 
				  tc_keet_proveedores_materiales.id_proveedor_material as id_key,
				  tc_mantic_articulos.id_articulo,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1 and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  '   ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
				  tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,
					tc_keet_proveedores_materiales.id_proveedor,
					tc_keet_proveedores_materiales.id_usuario,
					tc_keet_proveedores_materiales.registro,
					tc_keet_proveedores_materiales.id_proveedor_material
				from 
					tc_keet_proveedores_materiales
				inner join 
					tc_mantic_articulos on tc_keet_proveedores_materiales.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					tc_keet_proveedores_materiales.id_proveedor= {idProveedor}
					) principal 			
				order by 
				  nombre	
			</select>
		</unit>
		<unit id="VistaDesarrollosDto">
			<select id="lazy">
				select
          tc_keet_desarrollos.id_desarrollo as id_key,
          tc_keet_desarrollos.clave,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.registro,
          tc_keet_desarrollos.descripcion,
          tc_mantic_clientes.razon_social,
          concat(tc_mantic_domicilios.calle, ", ",tc_mantic_domicilios.numero_exterior) domicilio
        from
          tc_keet_desarrollos
        inner join tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente
        inner join tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
          {condicion}
		    order by
		      tc_keet_desarrollos.nombres
			</select>	
			<select id="residentes">
				select
					tc_keet_desarrollos.id_desarrollo as id_key,
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_keet_desarrollos.registro,
					tc_keet_desarrollos.descripcion,
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", tc_mantic_domicilios.numero_exterior) domicilio         
				from
					tc_keet_desarrollos         
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}
				inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente         
				inner join
					tc_mantic_domicilios  on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio     
				where
					{condicion}      
				order by
					tc_keet_desarrollos.nombres				
			</select>			
		</unit>
		<unit id="VistaContratosArchivosDto">
			<select id="importados">
				select
					tc_keet_contratos_archivos.id_contrato_archivo id_key,
					tc_keet_contratos_archivos.nombre,
					tc_keet_contratos_archivos.archivo,
					tc_keet_contratos_archivos.ruta,
					tc_keet_contratos_archivos.alias,
					tc_keet_contratos_archivos.observaciones,
					tc_keet_contratos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_contratos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_contratos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_contratos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_contratos_archivos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_contratos_generadores.id_contrato_generador id_key,
					tc_keet_contratos_generadores.nombre,
					tc_keet_contratos_generadores.archivo,
					tc_keet_contratos_generadores.ruta,
					tc_keet_contratos_generadores.alias,
					tc_keet_contratos_generadores.observaciones,
					tc_keet_contratos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_contratos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_contratos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_contratos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_contratos_generadores.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_contratos_presupuestos.id_contrato_presupuesto id_key,
					tc_keet_contratos_presupuestos.nombre,
					tc_keet_contratos_presupuestos.archivo,
					tc_keet_contratos_presupuestos.ruta,
					tc_keet_contratos_presupuestos.alias,
					tc_keet_contratos_presupuestos.observaciones,
					tc_keet_contratos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_contratos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_contratos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_contratos_presupuestos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaEstacionesDto">
			<select id="lazy">
				select
					tc_keet_estaciones.id_estacion id_key,
          tc_keet_estaciones.nivel,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.descripcion,
					tc_keet_estaciones.inicio,
					tc_keet_estaciones.termino,
					tc_keet_estaciones.cantidad,
					tc_keet_estaciones.costo,
					tc_keet_estaciones.ultimo,		
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
          tc_keet_estaciones
				left join tr_mantic_empaque_unidad_medida on tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida= tc_keet_estaciones.id_empaque_unidad_medida
				left join tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				left join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.nivel = {nivel}
		 	  order by
				  tc_keet_estaciones.clave
			</select>		
		</unit>		
		<unit id="VistaEmpaqueUnidadDto">
			<select id="row">
				select
					tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida id_key,
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
				  tr_mantic_empaque_unidad_medida
				inner join tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				inner join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
		 	  order by
				  tc_mantic_empaques.nombre,
				  tc_mantic_unidades_medidas.nombre
			</select>		
		</unit>	
		<unit id="VistaPrestamosDto">
			<select id="lazy">
				select
					tc_keet_prestamos.id_prestamo id_key,
				  tc_keet_prestamos.id_deudor,
					tc_keet_prestamos.consecutivo folio,
					tc_keet_prestamos.importe,
					tc_keet_prestamos.saldo,
					tc_keet_deudores.saldo saldo_total,
					tc_keet_deudores.limite,
					tc_keet_deudores.disponible,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
					ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) numero_pagos,
					tc_keet_prestamos_estatus.nombre estatus,
				  tc_keet_prestamos_estatus.id_prestamo_estatus
				from
				  tc_keet_prestamos
				inner join 
				  tc_keet_deudores on tc_keet_prestamos.id_deudor= tc_keet_deudores.id_deudor
				inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				inner join 
				  tc_keet_prestamos_estatus on tc_keet_prestamos.id_prestamo_estatus= tc_keet_prestamos_estatus.id_prestamo_estatus
				where
				  {condicion}	
        {sortOrder}	
			</select>
			<select id="importados">
				select
					tc_keet_prestamos_archivos.id_prestamo_archivo id_key,
					tc_keet_prestamos_archivos.nombre,
					tc_keet_prestamos_archivos.archivo,
					tc_keet_prestamos_archivos.ruta,
					tc_keet_prestamos_archivos.alias,
					tc_keet_prestamos_archivos.observaciones,
					tc_keet_prestamos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario,
          tc_keet_prestamos_pagos.consecutivo,
          tc_keet_prestamos_pagos.abono
				from
					tc_keet_prestamos_archivos
				inner join
          tc_keet_prestamos_pagos on tc_keet_prestamos_pagos.id_prestamo_pago= tc_keet_prestamos_archivos.id_prestamo_pago
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
        order by
          tc_keet_prestamos_pagos.registro, tc_keet_prestamos_archivos.registro
			</select>
			<select id="byIdPrestamo">
				select 
				  tc_keet_prestamos.id_prestamo id_key,
          tc_keet_prestamos.importe prestamo,
          tc_keet_prestamos.saldo,
          ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) pagos,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) empleado,
				  disponible,
				  ifnull(tr_mantic_empresa_personal.fecha_ingreso, tr_mantic_empresa_personal.fecha_contratacion) ingreso,
				  1 numero_prestamos
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				where
				  tc_keet_prestamos.id_prestamo= {idPrestamo}
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor id_key,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) empleado,
          sum(tc_keet_prestamos.importe) prestamo,
          tc_keet_deudores.saldo,
          sum(ifnull(tc_keet_prestamos_pagos.numero_pagos, 0)) pagos,
				  count(*) numero_prestamos
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
        where
          tc_keet_prestamos.id_prestamo_estatus in (1,2)
        and
          tc_keet_deudores.id_deudor= {idDeudor}
        group by
          tc_keet_deudores.id_deudor,
          tc_mantic_personas.nombres, tc_mantic_personas.paterno, tc_mantic_personas.materno,
          tc_keet_deudores.saldo
			</select>
		</unit>	
		<unit id="VistaDeudoresDto">
			<select id="byEmpresa">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner 
				  join tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
			</select>
			<select id="complete">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
				  and tr_mantic_empresa_personal.id_activo= 1 
				  and tc_mantic_personas.id_tipo_persona!= 1
				  and concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) regexp '.*{deudor}.*'
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible,
				  ifnull(tr_mantic_empresa_personal.fecha_ingreso, tr_mantic_empresa_personal.fecha_contratacion) ingreso
				from
				  tc_keet_deudores
        inner join tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				 tc_keet_deudores.id_deudor= {idDeudor}
			</select>
		</unit>	
		<unit id="VistaPrestamosPagosDto">
			<select id="lazy">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
		</unit>	
		<unit id="VistaCapturaDestajosDto">
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>			
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
						tc_mantic_puestos.nombre puesto,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						'subcontratista' puesto,  
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>			
			<select id="lotesContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_contratistas.id_empresa_persona={idFigura}
			</select>
			<select id="lotesSubContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_proveedores.id_proveedor={idFigura}
			</select>
			<select id="conceptos">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_rubros.nombre like upper('%{nombreConcepto}%')
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.id_estacion_estatus in ({estatus})
				order by 
				  tc_keet_estaciones.clave
			</select>
			<select id="puntosRevision">
				select
					tc_keet_puntos_paquetes.id_punto_paquete AS id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				AND 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_puntos_proveedores ON tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_puntos_contratistas ON tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_estaciones.id_estacion_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				)final
			</select>
		</unit>
		<unit id="VistaPuntosControlDto">
			<select id="lazy">
				select 
					tc_keet_puntos_controles.id_punto_control id_key,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_grupos.descripcion paquete,
					tc_keet_departamentos.descripcion departamento, 
					tc_keet_puntos_controles.registro
				from tc_keet_puntos_controles
					inner join tc_keet_puntos_paquetes on tc_keet_puntos_paquetes.id_punto_control= tc_keet_puntos_controles.id_punto_control
					inner join tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo= tc_keet_puntos_paquetes.id_punto_grupo
					inner join tc_keet_departamentos on tc_keet_departamentos.id_departamento= tc_keet_puntos_grupos.id_departamento
				where
				  {condicion}	
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
		</unit>	
	</dml>    
</process>
