<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de MANTIC
-->
<process>
	<dml> 
		<unit id="VistaControlesLotesDto">
			<select id="exportar">
				select
				  tc_keet_controles.id_control as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_controles.codigo,
					tc_keet_controles.nombre,
					tc_keet_controles.cantidad,
					tc_keet_controles.costo as "costo s/iva",
					tc_mantic_unidades_medidas.nombre as "unidad medida",
				  date_format(tc_keet_controles.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_controles.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_controles
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_controles.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_controles.clave like '{clave}%'
					and tc_keet_controles.nivel> 4
				order by
					tc_keet_controles.clave
			</select>	
			<select id="estaciones">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_controles
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_controles.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_controles.clave like '{clave}%'
				order by
					tc_keet_controles.clave
			</select>	
			<select id="estacion">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*
				from 
					tc_keet_controles
				where
					tc_keet_controles.clave= '{clave}'
				  and tc_keet_controles.nivel= 5
				order by
					tc_keet_controles.clave
			</select>	
			<select id="concepto">
				select
				  tc_keet_controles.id_control as id_key,
					tc_keet_controles.*
				from 
					tc_keet_controles
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.codigo= '{codigo}'
				  and tc_keet_controles.nivel= 6
				order by
					tc_keet_controles.clave
			</select>	      
    </unit>  
		<unit id="VistaComprasAlmacenDto">
			<select id="compras">
				select
					tc_keet_gastos_detalles.id_articulo as id_key,
					tc_mantic_empresas.nombre as empresa,
					replace(tc_keet_gastos_detalles.nombre, '"', '\\"') as category,
          tc_keet_desarrollos.nombres as serie,
					sum(tc_keet_gastos_detalles.{columna}) as value,
				  sum(tc_keet_gastos_detalles.{columna}) as {columna}
				from
					tc_keet_gastos
				inner join
					tc_keet_gastos_detalles on tc_keet_gastos.id_gasto= tc_keet_gastos_detalles.id_gasto
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas on tc_keet_cajas_chicas_cierres.id_caja_chica= tc_keet_cajas_chicas.id_caja_chica
				inner join
					tc_keet_desarrollos on tc_keet_cajas_chicas.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_gastos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				group by
					tc_mantic_empresas.nombre,
          tc_keet_desarrollos.nombres,
					tc_keet_gastos_detalles.nombre
				order by
					tc_keet_gastos_detalles.{columna} desc
			</select>			
			<select id="analisis">
				select
					tc_keet_temporal.id_material as id_key,
					tc_keet_temporal.empresa,
					replace(tc_keet_temporal.serie, '"', '\\"') as category,
          tc_keet_temporal.desarrollo as serie,
					sum(tc_keet_temporal.value) as value,
					sum(tc_keet_temporal.{columna}) as {columna}
				from (  
				select
					tc_keet_vales_detalles.id_material,
					tc_mantic_empresas.nombre as empresa,
          tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales_detalles.nombre as serie,
					tc_keet_vales_detalles.{columna} as value,
					tc_keet_vales_detalles.{columna}
				from
					tc_keet_vales
				inner join
					tc_keet_vales_detalles on tc_keet_vales.id_vale= tc_keet_vales_detalles.id_vale
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_vales.id_tipo_vale= {idTipoVale}
					and tc_keet_vales.id_vale_contratista= 1
					and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				union all
				select
					tc_keet_vales_detalles.id_material,
					tc_mantic_empresas.nombre as empresa,
          tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales_detalles.nombre as serie,
					tc_keet_vales_detalles.{columna} as value,
					tc_keet_vales_detalles.{columna}
				from
					tc_keet_vales
				inner join
					tc_keet_vales_detalles on tc_keet_vales.id_vale= tc_keet_vales_detalles.id_vale
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_vales.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_vales.id_tipo_vale= {idTipoVale}
					and tc_keet_vales.id_vale_contratista= 2
					and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				  and {condicion}
				) as tc_keet_temporal  
				group by
					tc_keet_temporal.empresa,
          tc_keet_temporal.desarrollo,
					tc_keet_temporal.serie
				order by
					tc_keet_temporal.value desc
			</select>
			<select id="lazy">
				select
				  tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_mantic_empresas.nombre as empresa,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre as material,
					sum(tc_keet_vales_detalles.cantidad) as cantidad,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) almacenista,
					tc_keet_vales.id_vale_estatus
				from
					tc_keet_vales_detalles
				inner join 
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo= tc_mantic_articulos.id_articulo  
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_keet_vales on tc_keet_vales_detalles.id_vale= tc_keet_vales.id_vale and tc_keet_vales.id_vale_contratista= 1
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				inner join
					tc_janal_usuarios on tc_keet_vales.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				where
				  tc_mantic_empresas.id_empresa in ({idEmpresa})
					and tc_keet_vales_detalles.id_tipo_entrega in (2, 4)
					and tc_keet_vales_detalles.entregado is null
					and tc_keet_vales.id_vale_estatus= 5
				  and {condicion}
				group by
					tc_mantic_empresas.nombre,
					tc_keet_desarrollos.nombres,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre
				{sortOrder}		
			</select>
			<select id="detalle">
				select
				  tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_mantic_empresas.nombre as empresa,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_keet_vales.consecutivo,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos_codigos.codigo,
					tc_mantic_articulos.nombre as material,
					sum(tc_keet_vales_detalles.cantidad) as cantidad,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) almacenista,
					tc_keet_contratos.clave as contrato,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
					tc_keet_contratos.etapa,
					tc_keet_vales.id_vale_estatus,
					tc_keet_vales.registro
				from
					tc_keet_vales_detalles
				inner join 
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo= tc_mantic_articulos.id_articulo  
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_keet_vales on tc_keet_vales_detalles.id_vale= tc_keet_vales.id_vale and tc_keet_vales.id_vale_contratista= 1
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_vales.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_empresas on tc_keet_contratos.id_empresa= tc_mantic_empresas.id_empresa
				inner join
					tc_janal_usuarios on tc_keet_vales.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
				where
					tc_keet_vales_detalles.id_tipo_entrega in (2, 4)
					and tc_keet_vales_detalles.entregado is null
					and tc_keet_vales.id_vale_estatus= 5
					and tc_mantic_articulos.id_articulo= {idArticulo}
				group by
					tc_mantic_empresas.nombre,
					tc_keet_desarrollos.nombres,
					tc_keet_vales.consecutivo,
					tc_mantic_articulos.id_articulo,
					tc_keet_contratos.clave,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote)
				{sortOrder}
			</select>
			<select id="precios">
				select
					tc_keet_articulos_proveedores.id_articulo_proveedor as id_key,
					tc_mantic_proveedores.rfc,
					tc_mantic_proveedores.razon_social as "razon social",
					tc_mantic_articulos_codigos.codigo as clave,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 2 and tc_mantic_articulos_codigos.id_proveedor= tc_keet_articulos_proveedores.id_proveedor limit 0, 1) as auxiliar,
					tc_mantic_articulos.nombre as material,
					tc_keet_articulos_proveedores.precio_base as "precio base",
					tc_keet_articulos_proveedores.precio_lista as "precio lista",
					tc_keet_articulos_proveedores.precio_especial as "precio especial"
				from
					tc_keet_articulos_proveedores
				inner join
					tc_mantic_articulos on tc_keet_articulos_proveedores.id_articulo= tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_mantic_proveedores on tc_keet_articulos_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_proveedores.id_proveedor= {idProveedor}
				order by
					tc_mantic_proveedores.rfc, tc_mantic_articulos_codigos.codigo			  
			</select>
			<select id="convenios">
				select
					tr_keet_articulo_preveedor_cliente.id_articulo_proveedor_cliente as id_key,
					tc_mantic_proveedores.rfc as "rfc proveedor",
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_clientes.rfc as "rfc cliente",
					tc_mantic_clientes.razon_social as cliente,
					tc_mantic_articulos_codigos.codigo as clave,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 2 and tc_mantic_articulos_codigos.id_proveedor= tr_keet_articulo_preveedor_cliente.id_proveedor limit 0, 1) as auxiliar,
					tc_mantic_articulos.nombre as material,
					tr_keet_articulo_preveedor_cliente.precio_convenio as "precio convenio"
				from
					tr_keet_articulo_preveedor_cliente
				inner join
					tc_mantic_articulos on tr_keet_articulo_preveedor_cliente.id_articulo= tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1
				inner join
					tc_mantic_proveedores on tr_keet_articulo_preveedor_cliente.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join
					tc_mantic_clientes on tr_keet_articulo_preveedor_cliente.id_cliente= tc_mantic_clientes.id_cliente
				where
				  tc_mantic_proveedores.id_proveedor= {idProveedor}
				  and tc_mantic_clientes.id_cliente= {idCliente}
				order by
					tc_mantic_proveedores.rfc, tc_mantic_articulos_codigos.codigo				
			</select>
		</unit>		
		<unit id="VistaValesArchivosDto">
			<select id="importados">
				select 
					tc_keet_vales_archivos.id_vale_archivo as id_key,
					tc_keet_vales_archivos.id_vale,
					tc_keet_vales_archivos.id_tipo_archivo,
					tc_keet_vales_archivos.nombre,
					tc_keet_vales_archivos.archivo,
					tc_keet_vales_archivos.ruta,
					tc_keet_vales_archivos.alias,
					tc_keet_vales_archivos.tamanio,
					tc_keet_vales_archivos.observaciones,
					tc_keet_vales_archivos.id_usuario,
					tc_keet_vales_archivos.registro,
					tc_keet_vales_archivos.eliminado,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre_usuario
				from 
					tc_keet_vales_archivos
				inner join
					tc_janal_usuarios on tc_keet_vales_archivos.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
				where 
					tc_keet_vales_archivos.id_vale= {idVale}
			</select>
		</unit>
		<unit id="VistaValesDetallesDto">
			<select id="resumen">				
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo 
				from
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					id_vale= {idVale}
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre
			</select>
			<select id="entrega">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo 				
				from
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale} and entregado is null and id_tipo_entrega=4
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre
				) principal
			</select>
		</unit>
		<unit id="VistaValesEspecialesDto">
			<select id="detalle">
				select
					tc_keet_vales_detalles.id_vale_detalle as id_key,
					tc_keet_vales_detalles.id_vale_detalle as id_comodin,
          tc_keet_vales_detalles.*,
          tc_keet_vales_detalles.cantidad as cuantos,
          tc_keet_vales_detalles.cantidad as inicial,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
					tc_mantic_articulos.menudeo,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from 
					tc_keet_vales_detalles
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where  
					tc_keet_vales_detalles.id_vale = {idVale}
				order by
					tc_keet_vales_detalles.registro
			</select>
		</unit>
		<unit id="VistaNominaConsultasDto">
			<select id="personas">
				select
				  principal.*,
				  concat(if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')))) as contratista
				from(
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tc_keet_nominas.id_nomina,
					tr_mantic_empresa_personal.id_empresa_persona,
				  tc_keet_nominas_personas.id_nomina_persona,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
					tc_keet_departamentos.nombre as departamento,
					tc_mantic_puestos.id_puesto,
					tc_mantic_puestos.nombre as puesto,
					tr_mantic_empresa_personal.clave,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina as id_pago,
					tr_mantic_empresa_personal.nss,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.apodo,
					tc_mantic_personas.id_persona,
					tc_keet_nominas_personas.percepciones,
					tc_keet_nominas_personas.deducciones,
					tc_keet_nominas_personas.neto,
					tr_mantic_empresa_personal.id_contratista
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento= tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					{condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
        {sortOrder}
			</select>
			<select id="proveedores">
				select
					tc_keet_nominas_proveedores.id_nomina_proveedor as id_key,
  				concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
					tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as nombre_empresa,  
					departamentos.id_departamentos,
					departamentos.departamento,
					tc_keet_nominas_proveedores.id_nomina_proveedor,
				  tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.clave,
					tc_mantic_proveedores.razon_social as nombre_completo,
					tc_mantic_proveedores.rfc,
					tc_keet_nominas_proveedores.subtotal,
					tc_keet_nominas_proveedores.iva,
					tc_keet_nominas_proveedores.total
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_proveedores on tc_keet_nominas.id_nomina= tc_keet_nominas_proveedores.id_nomina
				inner join 
					tc_mantic_proveedores on tc_keet_nominas_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join ( 
					select 
						tc_keet_proveedores_departamentos.id_proveedor,
						concat('|', group_concat(tc_keet_departamentos.id_departamento separator '|'), '|') as id_departamentos,
						group_concat(tc_keet_departamentos.nombre separator ', ') as departamento
					from
						tc_keet_proveedores_departamentos
					inner join
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					group by
						tc_keet_proveedores_departamentos.id_proveedor				  
				) as departamentos on tc_mantic_proveedores.id_proveedor= departamentos.id_proveedor
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					{condicion}	
				{sortOrder}			
			</select>
			<select id="nominas">
        select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_tipos_nominas.nombre, '[', tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden, ']') as nomina,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino
				from
					tc_keet_nominas
				inner join 
					tc_keet_tipos_nominas on tc_keet_nominas.id_tipo_nomina= tc_keet_tipos_nominas.id_tipo_nomina
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas_periodos.ejercicio&gt;= {anterior}
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
				  tc_keet_nominas.id_tipo_nomina, tc_keet_nominas_periodos.ejercicio desc, tc_keet_nominas_periodos.orden desc				
			</select>
			<select id="persona">
				select
				  tc_keet_nominas_detalles.id_nomina_detalle as id_key,
				  '{nomina}' as nomina,
				  '{nombreCompleto}' as "nombre completo",
					tc_keet_nominas_conceptos.id_tipo_concepto,
				  tc_keet_tipos_conceptos.nombre as concepto,
					tc_keet_nominas_conceptos.orden,
					tc_keet_nominas_detalles.clave,
					tc_keet_nominas_detalles.nombre,
					tc_keet_nominas_detalles.nombre as detalle,
					tc_keet_nominas_detalles.formula,
					tc_keet_nominas_detalles.valor,
				  tc_keet_nominas_detalles.fecha
				from
					tc_keet_nominas_detalles
				inner join
					tc_keet_nominas_personas on tc_keet_nominas_detalles.id_nomina_persona = tc_keet_nominas_personas.id_nomina_persona
				inner join
					tc_keet_nominas_conceptos on tc_keet_nominas_detalles.id_nomina_concepto = tc_keet_nominas_conceptos.id_nomina_concepto
				inner join
					tc_keet_tipos_conceptos on tc_keet_nominas_conceptos.id_tipo_concepto = tc_keet_tipos_conceptos.id_tipo_concepto
				where
					tc_keet_nominas_personas.id_nomina= {idNomina}
					and tc_keet_nominas_personas.id_empresa_persona= {idEmpresaPersona}
				{sortOrder}				
			</select>			
			<select id="proveedor">
				select
					tc_keet_nominas_rubros.id_nomina_rubro as id_key,
				  tc_keet_contratos.consecutivo,
				  '{nomina}' as nomina,
				  '{nombreCompleto}' as "razon social",
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave as contrato,
				  tc_keet_contratos.etapa,
					tc_keet_nominas_rubros.lote,
					tc_keet_nominas_rubros.codigo,
					tc_keet_nominas_rubros.nombre as concepto,
					tc_keet_nominas_rubros.subtotal,
					tc_keet_nominas_rubros.iva,
					tc_keet_nominas_rubros.total,
				  tc_keet_nominas_rubros.total as costo,
					tc_keet_nominas_rubros.registro     
        from
          tc_keet_nominas_rubros     
        inner join
          tc_keet_nominas_proveedores on tc_keet_nominas_rubros.id_nomina_proveedor = tc_keet_nominas_proveedores.id_nomina_proveedor     
			  inner join
				  tc_keet_contratos_lotes on tc_keet_nominas_rubros.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
        where
          tc_keet_nominas_proveedores.id_nomina= {idNomina}      
          and tc_keet_nominas_proveedores.id_proveedor= {idProveedor}	
				{sortOrder}			
			</select>	
			<select id="destajo">
				select 
				  tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
				  '{nomina}' as nomina,
				  '{nombreCompleto}' as "nombre completo",
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave as contrato,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre as concepto,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
				  tc_keet_contratos_destajos_contratistas.costo,
				  tc_keet_contratos_destajos_contratistas.costo as total,
				  tc_keet_contratos_destajos_contratistas.registro
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				where 
				  tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina}
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}		
				{sortOrder}			
			</select>
			<select id="destajoPersona">
				select 
				  tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
				  tc_keet_contratos_destajos_contratistas.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_contratos_destajos_contratistas.porcentaje,
				  tc_keet_contratos_destajos_contratistas.costo,
				  tc_keet_contratos_destajos_contratistas.costo as total,
				  tc_keet_contratos_destajos_contratistas.registro
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_contratistas.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_contratistas.id_nomina= {idNomina} or tc_keet_contratos_destajos_contratistas.id_nomina is null) 
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				{sortOrder}			
			</select>
			<select id="destajoResidente">
				select 
				  tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente as id_key,
				  tc_keet_contratos_destajos_residentes.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_controles.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_contratos_destajos_residentes.porcentaje,
				  tc_keet_contratos_destajos_residentes.costo,
				  tc_keet_contratos_destajos_residentes.costo as total,
				  tc_keet_contratos_destajos_residentes.registro
				from
				  tc_keet_contratos_destajos_residentes 
				inner join
				  tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= tc_keet_contratos_lotes_residentes.id_contrato_lote_residente
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control= tc_keet_controles.id_control
				inner join
				  tc_keet_rubros on tc_keet_controles.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_residentes.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_residentes.id_nomina= {idNomina} or tc_keet_contratos_destajos_residentes.id_nomina is null) 
				  and tc_keet_contratos_lotes_residentes.id_empresa_persona= {idEmpresaPersona}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				{sortOrder}			
			</select>
			<select id="destajoProveedor">
        select 
				  tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor as id_key,
				  tc_keet_contratos_destajos_proveedores.id_nomina,
          concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_contratos.consecutivo,
				  tc_keet_desarrollos.nombres as desarrollo,
				  tc_keet_contratos.clave,
				  tc_keet_contratos.etapa,
				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  tc_keet_rubros.nombre,
				  tc_keet_contratos_destajos_proveedores.porcentaje,
				  tc_keet_contratos_destajos_proveedores.costo,
				  tc_keet_contratos_destajos_proveedores.costo as total,
				  tc_keet_contratos_destajos_proveedores.registro
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
				inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
				inner join
				  tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
				  tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion= tc_keet_estaciones.id_estacion
				inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
				left join 
          tc_keet_nominas on tc_keet_contratos_destajos_proveedores.id_nomina= tc_keet_nominas.id_nomina
				left join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo 
				where 
				  (tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina} or tc_keet_contratos_destajos_proveedores.id_nomina is null) 
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}		
				  and tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				{sortOrder}			
			</select>				
		</unit>
		<unit id="VistaNominaDto">
			<select id="lazy">
				select
					tc_keet_nominas.id_nomina as id_key,
					tc_keet_nominas.id_nomina,
					tc_mantic_empresas.nombre as nombre_empresa,  
          tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.inicio,
					tc_keet_nominas_periodos.termino,
					tc_keet_nominas_periodos.orden as semana,
					tc_keet_tipos_nominas.nombre as tipo,
					tc_keet_nominas_periodos.corte,
					tc_keet_nominas.id_nomina_estatus,
					tc_keet_nominas_estatus.nombre as estatus,
					tc_keet_nominas.proveedores,
					tc_keet_nominas.total,
					tc_keet_nominas.personas,
					tc_keet_nominas.neto,
				  (tc_keet_nominas.neto+ tc_keet_nominas.total) as global,
				  tc_keet_nominas_estatus.estatus_asociados
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_tipos_nominas on tc_keet_nominas.id_tipo_nomina= tc_keet_tipos_nominas.id_tipo_nomina
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
				  tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				  and {condicion}
				{sortOrder}
			</select>
			<select id="detalle">
				select
					tc_keet_nominas_personas.id_nomina_persona as id_key,
					tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as sucursal,  
				  1 as id_tipo_proceso,
				  tr_mantic_empresa_personal.id_empresa_persona as id_persona_reprocesar,
					'PERSONAL' as tipo,
					tr_mantic_empresa_personal.clave,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ' '), ' ', ifnull(tc_mantic_personas.materno, ' ')) as nombre_completo,
					tc_mantic_personas.apodo,
					tc_keet_nominas_personas.neto as importe,
					tc_mantic_puestos.id_puesto,
					tc_mantic_personas.id_persona
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_personas on tc_keet_nominas.id_nomina= tc_keet_nominas_personas.id_nomina
				inner join 
					tr_mantic_empresa_personal on tc_keet_nominas_personas.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_nominas.id_nomina= {idNomina}
					and (upper(concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', ifnull(tc_mantic_personas.materno, ''), ' ', ifnull(tc_mantic_personas.apodo, ''))) regexp '.*{nombre}.*')
				union all
				select
					tc_keet_nominas_proveedores.id_nomina_proveedor as id_key,
					tc_keet_nominas.id_nomina,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nomina,
				  tc_keet_nominas.id_nomina_estatus,
					tc_mantic_empresas.nombre as sucursal,  
				  2 as id_tipo_proceso,
				  tc_mantic_proveedores.id_proveedor as id_persona_reprocesar,
					'SUBCONTRATISTA' as tipo,
					tc_mantic_proveedores.clave,
					tc_mantic_proveedores.razon_social as nombre_completo,
					tc_mantic_proveedores.rfc as apodo,
					tc_keet_nominas_proveedores.total as importe,
					-1 as id_puesto,
					tc_mantic_proveedores.id_proveedor as id_persona
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_proveedores on tc_keet_nominas.id_nomina= tc_keet_nominas_proveedores.id_nomina
				inner join 
					tc_mantic_proveedores on tc_keet_nominas_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tc_mantic_empresas on tc_keet_nominas.id_empresa= tc_mantic_empresas.id_empresa
				where
					tc_keet_nominas.id_nomina= {idNomina}
					and upper(ifnull(tc_mantic_proveedores.razon_social, '')) regexp '.*{nombre}.*'
				{sortOrder}
			</select>
			<select id="ejercicios">
				select
					distinct(tc_keet_nominas_periodos.ejercicio) as id_key,
					tc_keet_nominas_periodos.ejercicio
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
				  tc_keet_nominas_periodos.ejercicio desc				
			</select>
			<select id="semanas">
				select
					distinct(tc_keet_nominas_periodos.orden) as id_key,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
				  tc_keet_nominas_periodos.orden asc				
			</select>
			<select id="semana">
				select
					max(tc_keet_nominas_periodos.orden) as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3)
			</select>
			<select id="todos">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
			<select id="algunos">
        select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
					tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona not in (
				    select
				      tc_keet_nominas_personas.id_empresa_persona
				    from 
				      tc_keet_nominas_personas 
				    where
				      tc_keet_nominas_personas.id_nomina= {idNomina}
				 )
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave	
			</select>
			<select id="persona">
				select
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.clave,
				  tr_mantic_empresa_personal.sueldo_semanal
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
				order by
					tr_mantic_empresa_personal.id_empresa, tr_mantic_empresa_personal.clave
			</select>
			<select id="ultima">
        select
					tc_keet_nominas.id_nomina as id_key,
				  tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_tipo_nomina,
				  tc_keet_nominas.proveedores,
				  tc_keet_nominas.personas,
				  tc_keet_nominas.total,
				  tc_keet_nominas.neto,
				  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
					tc_keet_nominas_periodos.*,
				  tc_keet_nominas_estatus.id_nomina_estatus,
				  tc_keet_nominas_estatus.nombre as estatus,
				  tc_keet_nominas.observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
				  and tc_keet_nominas.id_nomina_estatus in (1, 2, 3, 4)
				order by
					tc_keet_nominas.id_nomina_estatus desc
			</select>			
			<select id="referencia">
				select      
          tc_keet_nominas.id_nomina as id_key,
          tc_keet_nominas.id_nomina_estatus,
				  tc_keet_nominas_periodos.orden as semana
        from      
          tc_keet_nominas
        inner join
          tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
        where      
				  tc_keet_nominas.id_empresa in ({sucursales})
          and tc_keet_nominas.id_tipo_nomina = 1
			  order by
				   tc_keet_nominas.id_nomina_estatus desc
			</select>
			<select id="activa">
				select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas.id_nomina_estatus in (1, 2, 3)
			</select>
			<select id="anterior">
				select
					-1 as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (4)
			</select>
			<select id="nominas">
        select
					tc_keet_nominas.id_nomina as id_key,
					concat(tc_keet_nominas_periodos.ejercicio, '-', if(tc_keet_nominas_periodos.orden&lt; 10, '0', ''), tc_keet_nominas_periodos.orden) as nombre,
					tc_keet_nominas_periodos.ejercicio,
					tc_keet_nominas_periodos.orden as semana
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				where
					tc_keet_nominas.id_empresa in ({sucursales})
					and tc_keet_nominas.id_tipo_nomina= {idTipoNomina}
					and tc_keet_nominas_periodos.ejercicio&gt;= {ejercicio}
					and tc_keet_nominas.id_nomina_estatus in (1,2,3,4)
				order by
				  nombre desc				
			</select>
			<select id="nomina">
        select
					tc_keet_nominas.id_nomina as id_key,
				  tc_keet_nominas.id_nomina,
				  tc_keet_nominas.id_tipo_nomina,
				  tc_keet_nominas.proveedores,
				  tc_keet_nominas.personas,
				  tc_keet_nominas.total,
				  tc_keet_nominas.neto,
				  tc_keet_nominas.total+ tc_keet_nominas.neto as global,
					tc_keet_nominas_periodos.*,
				  tc_keet_nominas_estatus.id_nomina_estatus,
				  tc_keet_nominas_estatus.nombre as estatus,
				  tc_keet_nominas.observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_nomina= {idNomina}
			</select>
			<select id="complemento">
        select
					-1 as id_key,
				  tc_keet_nominas.id_nomina,
				  2 as id_tipo_nomina,
					tc_keet_nominas_periodos.*,
				  1 as id_nomina_estatus,
				  'INICIADA' as estatus,
				  ' ' as observaciones
				from
					tc_keet_nominas
				inner join 
					tc_keet_nominas_periodos on tc_keet_nominas.id_nomina_periodo= tc_keet_nominas_periodos.id_nomina_periodo
				inner join 
					tc_keet_nominas_estatus on tc_keet_nominas.id_nomina_estatus= tc_keet_nominas_estatus.id_nomina_estatus
				where
					tc_keet_nominas.id_tipo_nomina= 1
					and tc_keet_nominas.id_nomina_estatus in (4)
			</select>
			<select id="proveedor">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor,
				  tc_mantic_proveedores.clave
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
			<select id="proveedores">
				select
					distinct(tc_keet_contratos_lotes_proveedores.id_proveedor) as id_proveedor,
				  tc_mantic_proveedores.clave
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				order by
					tc_keet_contratos_lotes_proveedores.id_proveedor
			</select>
      <select id="incidentes">
			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente and tc_mantic_tipos_incidentes.id_afecta_nomina= 1
			  where
				  tc_mantic_incidentes.id_nomina is null
				  and tc_mantic_incidentes.id_incidente_estatus= 2
				  and tc_mantic_incidentes.id_empresa_persona= {idEmpresaPersona}
			  order by
				  tc_mantic_incidentes.id_tipo_incidente, tc_mantic_incidentes.inicio desc
			</select>			
      <select id="aplicar">
			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
				inner join
 				  tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente= tc_mantic_tipos_incidentes.id_tipo_incidente 
			  where
				  tc_mantic_incidentes.id_nomina is null
				  and tc_mantic_incidentes.id_incidente_estatus= 2
				  and tc_mantic_tipos_incidentes.id_afecta_nomina= 2
			  union all
 			  select
				  tc_mantic_incidentes.*
				from 
				  tc_mantic_incidentes
			  where
				  tc_mantic_incidentes.id_nomina= {idNomina}
				  and tc_mantic_incidentes.id_incidente_estatus= 2			
			</select>	
			<select id="contratista">
        select 
				  tc_keet_contratos_destajos_contratistas.*
				from
				  tc_keet_contratos_destajos_contratistas 
				inner join
				  tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				where 
				  tc_keet_contratos_destajos_contratistas.id_nomina is null
				  and tc_keet_contratos_lotes_contratistas.id_empresa_persona= {idEmpresaPersona}
			</select>
			<select id="agremiados">
				select 
					{idEmpresaPersona} as id_contratista,
					count(*) as agremiados,
					sum(sueldo_semanal) as salarios
				from
					tr_mantic_empresa_personal
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				inner join
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto= tc_mantic_puestos.id_puesto
				where
					tr_mantic_empresa_personal.id_contratista= {idEmpresaPersona}
					and tr_mantic_empresa_personal.id_activo= 1
					and tr_mantic_empresa_personal.id_empresa_persona!= {idEmpresaPersona}				
			</select>	
      <select id="subContratista">
         select 
				  tc_keet_contratos_destajos_proveedores.*
				from
				  tc_keet_contratos_destajos_proveedores 
				inner join
				  tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				where 
				  tc_keet_contratos_destajos_proveedores.id_nomina is null
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}
			</select>
			<select id="ordinaria">
        select
          sum(total) as tuplas
        from (				
				select
					count(*) as total
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
        union all
        select
					count(distinct(tc_keet_contratos_lotes_proveedores.id_proveedor)) as total
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					(tc_keet_contratos_destajos_proveedores.id_nomina is null or tc_keet_contratos_destajos_proveedores.id_nomina= {idNomina})
				) total				
			</select>	
			<select id="complementaria">
        select
          sum(total) as tuplas
        from (				
        select
					count(*) as total
				from
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
					tr_mantic_empresa_personal.id_empresa in ({sucursales})
					and tr_mantic_empresa_personal.id_activo= 1
					and tc_mantic_personas.id_tipo_persona!= 1
				  and tr_mantic_empresa_personal.id_empresa_persona not in (
				    select
				      tc_keet_nominas_personas.id_empresa_persona
				    from 
				      tc_keet_nominas_personas 
				    where
				      tc_keet_nominas_personas.id_nomina= {idNomina}
				)        
			  union all
        select
					count(distinct(tc_keet_contratos_lotes_proveedores.id_proveedor)) as total
				from
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
				  tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor= tc_mantic_proveedores.id_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_nomina is null
				) total				
			</select>
			<select id="rubros">
				select 
				  tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor as id_key,
				  tc_keet_rubros.id_rubro,
				  tc_keet_contratos_lotes.id_contrato_lote,
 				  concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
				  tc_keet_estaciones.codigo,
				  '00111100' as sat,
				  tc_keet_estaciones.nombre,
				  0 as cantidad,
				  round(tc_keet_contratos_destajos_proveedores.costo, 4) as subtotal,
				  round(tc_keet_contratos_destajos_proveedores.costo* 0.16, 4) as iva,
				  round(tc_keet_contratos_destajos_proveedores.costo* 1.16, 4) as total
			  from
				  tc_keet_contratos_lotes_proveedores
			  inner join
				  tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote= tc_keet_contratos_lotes.id_contrato_lote
			  inner join
				  tc_keet_contratos on tc_keet_contratos_lotes.id_contrato= tc_keet_contratos.id_contrato
			  inner join
			    tc_keet_contratos_destajos_proveedores on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor= tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor
			  inner join	 
			    tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion 
        inner join
				  tc_keet_rubros on tc_keet_estaciones.codigo= tc_keet_rubros.codigo
			  where 
			    tc_keet_contratos_destajos_proveedores.id_nomina is null
				  and tc_keet_contratos_lotes_proveedores.id_proveedor= {idProveedor}		
		    order by
			    lote, tc_keet_estaciones.codigo				
			</select>					
		</unit>
		<unit id="VistaContratosLotesMaterialesDto">
			<select id="estaciones">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_materiales
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_materiales.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'
				order by
					tc_keet_materiales.clave
			</select>	
			<select id="material">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where
					tc_keet_materiales.clave like '{clave}%'
				  and tc_keet_materiales.codigo= '{codigo}'
				  and tc_keet_materiales.nivel= 7
				order by
					tc_keet_materiales.clave
			</select>		
      <select id="estacion">
				select
				  tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where
					tc_keet_materiales.clave= '{clave}'
				  and tc_keet_materiales.nivel= {nivel}
				order by
					tc_keet_materiales.clave
			</select>		
			<select id="exportar">
				select
				  tc_keet_materiales.id_material as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_keet_materiales.costo as "costo s/iva",
					tc_mantic_unidades_medidas.clave as "unidad medida",
				  date_format(tc_keet_materiales.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_materiales.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_materiales
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_materiales.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'
					and tc_keet_materiales.nivel> 4
				order by
					tc_keet_materiales.clave
			</select>	
			<select id="buscar">
				select
					tc_keet_temporal.*
				from (
				select
				 1000+ tc_keet_partidas.id_partida as id_key,
				 tc_keet_partidas.codigo,
				 5 as nivel,
				 2 as ultimo
				from
					tc_keet_partidas
				union all
				select
				 2000+ tc_keet_rubros.id_rubro as id_key,
				 tc_keet_rubros.codigo,
				 6 as nivel,
				 2 as ultimo
				from
					tc_keet_rubros
				union all
        select
				 3000+ tc_mantic_articulos.id_articulo as id_key,
				 tc_mantic_articulos_codigos.codigo,
				 7 as nivel,
				 1 as ultimo
				from
          tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo= tc_mantic_articulos_codigos.id_articulo				
				) as tc_keet_temporal
				where
					tc_keet_temporal.codigo= '{codigo}'
			</select>													
		</unit>
		<unit id="VistaContratosLotesDto">
			<select id="buscar">
				select
					tc_keet_temporal.*
				from (
				select
				 1000+ tc_keet_partidas.id_partida as id_key,
				 tc_keet_partidas.codigo,
				 5 as nivel,
				 2 as ultimo
				from
					tc_keet_partidas
				union all
				select
				 2000+ tc_keet_rubros.id_rubro as id_key,
				 tc_keet_rubros.codigo,
				 6 as nivel,
				 1 as ultimo
				from
					tc_keet_rubros
				) as tc_keet_temporal
				where
					tc_keet_temporal.codigo= '{codigo}'
			</select>	
			<select id="estaciones">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*,
					tc_mantic_unidades_medidas.nombre as unidad
				from 
					tc_keet_estaciones
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_estaciones.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_estaciones.clave like '{clave}%'
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="estacion">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*
				from 
					tc_keet_estaciones
				where
					tc_keet_estaciones.clave= '{clave}'
				  and tc_keet_estaciones.nivel= 5
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="concepto">
				select
				  tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.*
				from 
					tc_keet_estaciones
				where
					tc_keet_estaciones.clave like '{clave}%'
				  and tc_keet_estaciones.codigo= '{codigo}'
				  and tc_keet_estaciones.nivel= 6
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="lotes">
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					concat('M', tc_keet_contratos_lotes.manzana, "L", tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.orden
				from 
					tc_keet_contratos
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				where
				  tc_keet_contratos.id_empresa in ({sucursales})
				  and tc_keet_contratos.ejercicio>= {ejercicio}
				  and tc_keet_contratos_lotes.id_contrato_lote_estatus= 1
				order by
				  tc_keet_contratos.ejercicio desc, tc_keet_contratos.clave, tc_keet_contratos_lotes.orden				
			</select>
			<select id="lote">
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
				  tc_keet_contratos_lotes.id_estacion,
					concat('M', tc_keet_contratos_lotes.manzana, "L", tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.inicio,
					tc_keet_contratos_lotes.termino,
					tc_keet_contratos_lotes.orden,
				  tc_keet_prototipos.nombre as prototipo
				from 
					tc_keet_contratos
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join
				  tc_keet_prototipos on tc_keet_contratos_lotes.id_prototipo= tc_keet_prototipos.id_prototipo
				where
				  tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
				order by
				  tc_keet_contratos.ejercicio desc, tc_keet_contratos.clave, tc_keet_contratos_lotes.orden				
			</select>
			<select id="exportar">
				select
				  tc_keet_estaciones.id_estacion as id_key,
				  '{manzana}' as manzana,
				  '{lote}' as lote,
					tc_keet_estaciones.codigo,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.cantidad,
					tc_keet_estaciones.costo as "costo s/iva",
					tc_mantic_unidades_medidas.nombre as "unidad medida",
				  date_format(tc_keet_estaciones.inicio, '%d/%m/%Y') as inicio,
				  date_format(tc_keet_estaciones.termino, '%d/%m/%Y') as termino
				from 
					tc_keet_estaciones
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_estaciones.id_empaque_unidad_medida= tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida= tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_estaciones.clave like '{clave}%'
					and tc_keet_estaciones.nivel> 4
				order by
					tc_keet_estaciones.clave
			</select>	
			<select id="principal">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", ifnull(tc_mantic_domicilios.numero_exterior, ' ')) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
					{condicion}
				order by 
					tc_keet_desarrollos.nombres
			</select>
			<select id="getCoordenadasDesarrollo">
				select 
					tc_keet_desarrollos.id_desarrollo id_key,
					tc_keet_desarrollos.latitud,
          tc_keet_desarrollos.longitud
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where
					tc_keet_proyectos.id_proyecto= {idProyecto}
			</select>
			<select id="residentes">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
					tc_keet_contratos.no_viviendas,
					tc_keet_contratos.etapa,
					tc_keet_contratos.recepcion,
					tc_keet_contratos.aceptacion,
					tc_keet_contratos.arranque,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden,
					tc_keet_contratos.registro,
					tc_keet_proyectos.consecutivo cons_proyecto,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.id_cliente,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_proyectos.ejercicio ejercicio_proyecto,
					tc_keet_proyectos.id_desarrollo,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,    
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", ifnull(tc_mantic_domicilios.numero_exterior, ' ')) domicilio
				from 
					tc_keet_contratos
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente				
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo				
				inner join 
					tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}												
				where
					{condicion}
				order by 
					tc_keet_desarrollos.nombres
			</select>
		</unit>
		<unit id="VistaDiasFeriadosDto">
			<select id="lazy">
				select
					tc_keet_dias_festivos.id_dia_festivo AS id_key,
					tc_keet_dias_festivos.*,
					tc_mantic_empresas.nombre 
				from
					tc_keet_dias_festivos
				inner join 
					tc_mantic_empresas on tc_keet_dias_festivos.id_empresa= tc_mantic_empresas.id_empresa
				where 
					{condicion}
				and 
					tc_keet_dias_festivos.id_empresa in ({idEmpresa})				
				{sortOrder}
			</select>
		</unit>
		<unit id="VistaIncidenciasDto">
			<select id="movimientos">				
				select
					tc_mantic_incidentes_bitacora.id_incidente_bitacora as id_key,
					tc_mantic_incidentes.consecutivo,
					0 as importe,
					tc_mantic_incidentes_bitacora.justificacion,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre,
				  tc_mantic_incidentes_estatus.nombre as estatus,
					tc_mantic_incidentes_bitacora.registro
				from 
					tc_mantic_incidentes_bitacora
				inner join
					tc_mantic_incidentes on tc_mantic_incidentes_bitacora.id_incidente= tc_mantic_incidentes.id_incidente
				inner join
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_bitacora.id_incidente_estatus= tc_mantic_incidentes_estatus.id_incidente_estatus
				inner join
					tc_janal_usuarios on tc_mantic_incidentes_bitacora.id_usuario= tc_janal_usuarios.id_usuario
				inner join
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				where
					tc_mantic_incidentes_bitacora.id_incidente= {idIncidente}
				order by
					tc_mantic_incidentes_bitacora.registro desc				
			</select>		
			<select id="importados">
				select 
					tc_mantic_incidentes_archivos.id_incidente_archivo as id_key,
					tc_mantic_incidentes_archivos.nombre,
					tc_mantic_incidentes_archivos.archivo,
					tc_mantic_incidentes_archivos.ruta,
					tc_mantic_incidentes_archivos.alias,
					tc_mantic_incidentes_archivos.observaciones observacion_archivo,
					tc_mantic_incidentes_archivos.registro,
					tc_mantic_incidentes_archivos.id_tipo_archivo,
					tc_mantic_incidentes.consecutivo,					
					tc_mantic_incidentes.inicio,
					tc_mantic_incidentes.termino,
					tc_mantic_incidentes.ejercicio,					
					tc_mantic_incidentes.orden,					
					tc_mantic_incidentes.observaciones,
					tc_mantic_incidentes.id_usuario,
					tc_mantic_incidentes.registro registro_incidente,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_mantic_tipos_incidentes.nombre tipo_incidente,
					tc_mantic_incidentes_estatus.nombre estatus,					
					tc_mantic_puestos.nombre puesto				
				from 
					tc_mantic_incidentes_archivos
				inner join 
					tc_mantic_incidentes on tc_mantic_incidentes_archivos.id_incidente = tc_mantic_incidentes.id_incidente				
				inner join
					tr_mantic_empresa_personal on tc_mantic_incidentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_mantic_tipos_incidentes on tc_mantic_incidentes.id_tipo_incidente = tc_mantic_tipos_incidentes.id_tipo_incidente
				inner join 
					tc_mantic_incidentes_estatus on tc_mantic_incidentes_estatus.id_incidente_estatus = tc_mantic_incidentes.id_incidente_estatus
				inner join 
					tc_janal_usuarios on tc_mantic_incidentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				left join 
					tc_keet_contratos_personal on tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona
				where 
					tc_keet_contratos_personal.id_contratos_personal = {idContratoPersona}
				  or tr_mantic_empresa_personal.id_empresa_persona = {idEmpresaPersona}												
			</select>
		</unit>
		<unit id="VistaTiposObrasDto">
			<select id="catalogo">
				select
					tc_keet_tipos_obras.id_tipo_obra AS id_key,
					tc_keet_tipos_obras.id_division,
					tc_keet_tipos_obras.clave,
					tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_divisiones.nombre tipo_division
				from
					tc_keet_tipos_obras
				inner join
					tc_keet_divisiones ON tc_keet_tipos_obras.id_division = tc_keet_divisiones.id_division
				order by
					tc_keet_tipos_obras.id_division, tc_keet_tipos_obras.clave
			</select>			
		</unit>
    <unit id="VistaContratosDto">
			<select id="lazy">
				select 
          tc_keet_contratos.id_contrato id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave,
          tc_keet_contratos.no_viviendas,
          tc_keet_contratos.etapa,
          tc_mantic_clientes.razon_social,
					tc_keet_contratos_estatus.id_contrato_estatus,
					tc_keet_contratos_estatus.nombre as estatus,
					tc_keet_contratos_estatus.estatus_asociados,
					tc_keet_contratos.registro,
				  tc_keet_proyectos.clave proyecto
        from 
          tc_keet_contratos
        inner join 
					tc_keet_proyectos on tc_keet_proyectos.id_proyecto= tc_keet_contratos.id_proyecto
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join
          tc_keet_contratos_estatus on tc_keet_contratos_estatus.id_contrato_estatus= tc_keet_contratos.id_contrato_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="contrato">
				select 
          tc_keet_contratos_lotes.id_contrato_lote as id_key,
          tc_keet_contratos.id_contrato,
          tc_keet_contratos.clave as numero,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos.no_viviendas,
          tc_keet_contratos.etapa
        from 
          tc_keet_contratos
        inner join
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato= tc_keet_contratos_lotes.id_contrato
        where
          tc_keet_contratos_lotes.id_contrato= {idContrato}
          and tc_keet_contratos_lotes.orden= {orden}
			</select>	
			<select id="findDesarrollo">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.*
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo}
			</select>
			<select id="personalAsignado">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					{campoLlave} as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,
					(select count(*) total from tc_mantic_incidentes where tc_mantic_incidentes.id_empresa_persona = tc_keet_contratos_personal.id_empresa_persona) total_incidencias,
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
				order by 					
					descripcion
			</select>
			<select id="personalDisponible">
				select
					completo.*
				from(
				select
				  principal.*,
				  concat('[', if(principal.id_contratista is null, principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, ''))), '] [', puesto, '] ', nombre_completo) descripcion
				from(
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista         
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_personal where tc_keet_contratos_personal.id_desarrollo= {idDesarrollo})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				) principal
        left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1				
				) completo			  
				order by 					
					descripcion				
			</select>
			<select id="consulta">
				select
				  principal.*,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) as contratista
			  from (
					select      
						tr_mantic_empresa_personal.id_empresa_persona as id_key,									
						tc_keet_departamentos.nombre departamento,
						tc_mantic_puestos.nombre puesto,
						tr_mantic_empresa_personal.id_activo,
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
						tr_mantic_empresa_personal.id_puesto,
						tr_mantic_empresa_personal.id_departamento,
						tr_mantic_empresa_personal.nss,
						tr_mantic_empresa_personal.id_nomina,
				    tr_mantic_empresa_personal.id_contratista
					from      
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					inner join	
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
					where 
						{condicion}
					order by 
						tc_mantic_puestos.nombre, tc_mantic_personas.nombres
			  ) principal
			  left join
			    tr_mantic_empresa_personal on principal.id_contratista= tr_mantic_empresa_personal.id_empresa_persona
			  left join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				order by 
					principal.departamento, concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')), principal.nombre_completo, principal.puesto
			</select>
			<select id="totales">
				select
				  floor(rand()*(100- 10+ 1)+10) as id_key,
					tr_mantic_empresa_personal.id_empresa, 
					if(tc_keet_desarrollos.descripcion is null, 'SIN DESARROLLO', tc_keet_desarrollos.descripcion) as desarrollo, 
					count(*) as total, 
					sum(if(tr_mantic_empresa_personal.id_activo= 1, 1, 0)) as activos,
					sum(if(tr_mantic_empresa_personal.id_activo= 2, 1, 0)) as no_activos,
          sum(if(tr_mantic_empresa_personal.id_activo= 1 and (tr_mantic_empresa_personal.nss is null or tr_mantic_empresa_personal.nss= ''), 1, 0)) as sin_seguro
				from
					tr_mantic_empresa_personal
				left join
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				left join
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				where
				  {condicion}
				group by
					tr_mantic_empresa_personal.id_empresa, tc_keet_desarrollos.descripcion
				with rollup
			</select>
			<select id="findContratoPersona">
				select      
					tc_keet_contratos_personal.id_contratos_personal as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					
          tc_keet_contratos_personal.*,					
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				inner join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tc_keet_contratos_personal.id_contratos_personal= {idContratoPersona}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="findPersonaAdmin">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tc_mantic_personas.id_persona,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					tc_keet_contratos_personal.id_desarrollo,					
					tc_keet_contratos_personal.id_contratos_personal,					
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo          
        from                
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
				left join 
					tc_keet_contratos_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				left join 
					tc_keet_desarrollos on tc_keet_contratos_personal.id_desarrollo = tc_keet_desarrollos.id_desarrollo
        where 
          tr_mantic_empresa_personal.id_empresa_persona= {idEmpresaPersona}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="byEmpresa">
				select 
					tc_keet_contratos.id_contrato as id_key,
					tc_keet_contratos.*
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_keet_proyectos.id_cliente=tc_mantic_clientes.id_cliente
				where
					tc_mantic_clientes.id_empresa in ({sucursales})
			</select>
			<select id="getEstacionPatron">
				select 
					concat(lpad(tc_mantic_clientes.id_empresa, 3, '0') ,tc_keet_contratos.ejercicio ,lpad(tc_keet_contratos.orden, 3, '0')) patron
				from
					tc_keet_contratos
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_clientes on tc_keet_proyectos.id_cliente=tc_mantic_clientes.id_cliente
				where
					tc_keet_contratos.id_contrato = {idContrato}
			</select>
			<select id="contratistasAsignado">
				select contratistas.* from (
				select      
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          
					1 tipo,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote,
					tc_keet_contratos_lotes_contratistas.id_empresa_persona,
					tc_keet_contratos_lotes_contratistas.observaciones,
					tc_keet_contratos_lotes_contratistas.id_trabajo,
					tc_keet_contratos_lotes_contratistas.id_usuario,
					tc_keet_contratos_lotes_contratistas.registro 
        from      
          tc_keet_contratos_lotes_contratistas
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_contratistas.id_trabajo=2
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres) contratistas
				union
				select subcontratistas.* from (
				select      
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,								
					(select 
						group_concat(tc_keet_departamentos.nombre separator ', ')
					from
						tc_keet_proveedores_departamentos
					inner join
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
					group by
						tc_keet_proveedores_departamentos.id_proveedor				  
					 ) as departamento,
					'SUBCONTRATISTA' puesto,
					tc_mantic_proveedores.id_activo,
					1 id_nomina,
					tc_mantic_proveedores.rfc nss,
					tc_mantic_proveedores.razon_social nombres,
					'' paterno,
					'' materno,					
					tc_mantic_proveedores.rfc,					
					tc_mantic_proveedores.rfc curp,					
					2 tipo,					
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor id_contrato_lote_contratista,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote,
					tc_keet_contratos_lotes_proveedores.id_proveedor id_empresa_persona,
					tc_keet_contratos_lotes_proveedores.observaciones,
					tc_keet_contratos_lotes_proveedores.id_trabajo,
					tc_keet_contratos_lotes_proveedores.id_usuario,
					tc_keet_contratos_lotes_proveedores.registro 
        from     
					tc_keet_contratos_lotes_proveedores
				inner join
					tc_mantic_proveedores	on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
        where 
          tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_proveedores.id_trabajo=2
				and 					
					tc_mantic_proveedores.id_empresa= {idEmpresa}
				  and tc_mantic_proveedores.id_activo= 1
				  and {condicionProveedor}
					and tc_mantic_proveedores.id_subcontratista= 1
				order by
					tc_mantic_proveedores.razon_social
				) subcontratistas
			</select>
			<select id="contratistasDisponible">
				select contratistas.* from (
				select      					
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,					
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					1 tipo
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_lotes_contratistas where tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}				  
				  and {condicion}
					and tc_mantic_puestos.nombre= 'CONTRATISTA'
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres) contratistas
				union
				select subcontratistas.* from (
				select      
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,			
					tc_mantic_proveedores.id_proveedor id_empresa_persona,	
					(select 
							group_concat(tc_keet_departamentos.nombre separator ', ')
						from
							tc_keet_proveedores_departamentos
						inner join
							tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
						where 
							tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
						group by
							tc_keet_proveedores_departamentos.id_proveedor				  
						 ) as departamento,
					'SUBCONTRATISTA' puesto,
					tc_mantic_proveedores.id_activo,
					1 id_nomina,
					tc_mantic_proveedores.rfc nss,
					tc_mantic_proveedores.razon_social nombres,
					'' paterno,
					'' materno,					
					tc_mantic_proveedores.rfc,					
					tc_mantic_proveedores.rfc curp,					
					2 tipo
        from                				
					tc_mantic_proveedores				
        where 
          tc_mantic_proveedores.id_proveedor not in (select id_proveedor from tc_keet_contratos_lotes_proveedores where tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote})            
				  and tc_mantic_proveedores.id_empresa= {idEmpresa}				  
				  and tc_mantic_proveedores.id_subcontratista= 1
				  and {condicionProveedor}
				order by
					tc_mantic_proveedores.razon_social
				) subcontratistas
			</select>
			<select id="residentesDisponible">
				select      					
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,					
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,
					1 tipo
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where 
          tr_mantic_empresa_personal.id_empresa_persona not in (select id_empresa_persona from tc_keet_contratos_lotes_residentes where tc_keet_contratos_lotes_residentes.id_contrato_lote= {idContratoLote})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}				  
				  and {condicion}
					and tc_mantic_puestos.nombre= 'RESIDENTE DE OBRA'
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="residentesAsignado">
				select      
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          
					1 tipo,
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente,
					tc_keet_contratos_lotes_residentes.id_contrato_lote,
					tc_keet_contratos_lotes_residentes.id_empresa_persona,
					tc_keet_contratos_lotes_residentes.observaciones,
					tc_keet_contratos_lotes_residentes.id_trabajo,
					tc_keet_contratos_lotes_residentes.id_usuario,
					tc_keet_contratos_lotes_residentes.registro 
        from      
          tc_keet_contratos_lotes_residentes
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_lotes_residentes.id_contrato_lote= {idContratoLote} and tc_keet_contratos_lotes_residentes.id_trabajo=2
				  and tr_mantic_empresa_personal.id_activo= 1
				  and {condicion}
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>      
			<select id="contratistas">
				select      
					tr_mantic_empresa_personal.id_empresa_persona as id_key,			
					tr_mantic_empresa_personal.id_empresa_persona,
					tc_keet_departamentos.nombre departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp          
        from                				
					tr_mantic_empresa_personal
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        where           
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}				  
				  and {condicion}
					and tc_mantic_puestos.nombre= 'CONTRATISTA'
					and
						(tc_mantic_personas.nombres like '%{nombreEmpleado}%' 
					or
						tc_mantic_personas.paterno like '%{nombreEmpleado}%'
					or
						tc_mantic_personas.materno  like '%{nombreEmpleado}%')
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres
			</select>
			<select id="contratistasSubAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,						
						concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) nombre_completo,
						tc_mantic_puestos.nombre puesto,
						tc_keet_departamentos.nombre departamento,						
						tr_mantic_empresa_personal.id_activo,												
						1 tipo  																																																
					from 
						tr_mantic_empresa_personal
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tr_mantic_empresa_personal.id_empresa in ({idEmpresa})
				  and 
						{condicion}
					and 
						tc_mantic_puestos.nombre= 'CONTRATISTA'
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    						
						tc_mantic_proveedores.razon_social nombre_completo,				
						'SUBCONTRATISTA' puesto,  
						(select 
							group_concat(tc_keet_departamentos.nombre separator ', ')
						from
							tc_keet_proveedores_departamentos
						inner join
							tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
						where 
							tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
						group by
							tc_keet_proveedores_departamentos.id_proveedor				  
						 ) as departamento,
						tc_mantic_proveedores.id_activo,												   										
						2 tipo  
					from 
						tc_mantic_proveedores
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_mantic_proveedores.id_empresa in ({idEmpresa})
				  and 
						{condicion}					
				) principal
				group by
					id_key,					
					nombre_completo,
					puesto,
					departamento,						
					id_activo,											
					tipo
				order by 
					tipo, nombre_completo
			</select>	
		</unit>
    <unit id="VistaPrototiposDto">
			<select id="lazy">
				select 
          tc_keet_prototipos.id_prototipo as id_key,
          tc_keet_prototipos.clave,
          tc_keet_prototipos.nombre,
          tc_keet_prototipos.descripcion,
          tc_keet_prototipos.metros2,
          tc_mantic_clientes.razon_social,
				  tc_keet_prototipos.id_estacion
        from
          tc_keet_prototipos
        inner 
				  join tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_prototipos.id_cliente
        where
          {condicion}
				  {sortOrder}
			</select>	
			<select id="constructivosById">
				select      
					tc_keet_prototipos_constructivos.id_prototipo_constructivo id_key,
					tc_keet_prototipos_constructivos.*,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_prototipos_constructivos
				inner join tc_keet_constructivos on tc_keet_prototipos_constructivos.id_constructivo= tc_keet_constructivos.id_constructivo
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          tc_keet_prototipos_constructivos.id_prototipo= {idPrototipo}
			</select>	
			<select id="constructivosSelect">
				select      
					tc_keet_constructivos.id_constructivo id_key,
					tc_keet_constructivos.nombre descripcion,
					tc_keet_grupos_constructivos.nombre grupo
				from   
				tc_keet_constructivos 
				inner join tc_keet_grupos_constructivos on tc_keet_constructivos.id_grupo_constructivo= tc_keet_grupos_constructivos.id_grupo_constructivo
				where
          {condicion}
				order by
				  tc_keet_grupos_constructivos.nombre, tc_keet_constructivos.nombre
			</select>
		  <select id="getPlanosEspecialidades">
				select 
					tc_keet_planos.id_plano id_key,
					tc_keet_planos.nombre descripcion,
					tc_keet_especialidades.nombre grupo 
				from
					tc_keet_planos
				inner join tc_keet_especialidades on tc_keet_planos.id_especialidad= tc_keet_especialidades.id_especialidad
        where
          {condicion}
				order by
					tc_keet_especialidades.nombre, tc_keet_planos.nombre
			</select>		
		  <select id="importados">
				select
					id_prototipo_archivo id_key,
					tc_keet_prototipos_archivos.nombre,
					tc_keet_prototipos_archivos.archivo,
					tc_keet_prototipos_archivos.ruta,
					tc_keet_prototipos_archivos.alias,
					tc_keet_prototipos_archivos.observaciones,
					tc_keet_prototipos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_prototipos_archivos.id_tipo_archivo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_prototipos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_prototipos_archivos.id_usuarios= tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_planos on tc_keet_prototipos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  id_prototipo= {idPrototipo}
			</select>		
		  <select id="getDias">
				select
					id_prototipo_dia id_key,
					nombre 
				 from
					 tc_keet_prototipos_dias
				 inner join tc_keet_nombres_dias on tc_keet_nombres_dias.id_nombre_dia= tc_keet_prototipos_dias.id_nombre_dia
				where
				  id_prototipo= {idPrototipo}
			</select>		
			<select id="findContrato">
				select 
					tc_keet_prototipos.id_prototipo as id_key,
					tc_keet_prototipos.clave,
					tc_keet_prototipos.nombre,
					tc_keet_prototipos.metros2,
					tc_keet_prototipos.dias_construccion
				from 
					tc_keet_prototipos
				inner join 
					tc_keet_contratos_lotes on tc_keet_prototipos.id_prototipo = tc_keet_contratos_lotes.id_prototipo
				where
					tc_keet_contratos_lotes.id_contrato= {idContrato}
				group by 
					tc_keet_prototipos.id_prototipo,
					tc_keet_prototipos.clave,
					tc_keet_prototipos.nombre,
					tc_keet_prototipos.metros2,
					tc_keet_prototipos.dias_construccion
			</select>
		</unit>
    <unit id="VistaProyectoDto">
			<select id="lazy">
				select 
          tc_keet_proyectos.id_proyecto id_key,
          tc_keet_proyectos.id_proyecto,
          tc_keet_proyectos.clave,
          tc_keet_proyectos.no_viviendas,
          tc_keet_proyectos.etapa,
          tc_mantic_clientes.razon_social,
          tc_keet_desarrollos.nombres desarrollo,
          tc_keet_tipos_obras.nombre tipo_obra,
					tc_keet_proyectos_estatus.id_proyecto_estatus,
					tc_keet_proyectos_estatus.nombre as estatus,
					tc_keet_proyectos_estatus.estatus_asociados,
					tc_keet_proyectos.registro
        from 
          tc_keet_proyectos
        inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_proyectos.id_cliente
        inner join 
					tc_keet_desarrollos on tc_keet_desarrollos.id_desarrollo= tc_keet_proyectos.id_desarrollo
        inner join 
					tc_keet_tipos_obras on tc_keet_tipos_obras.id_tipo_obra= tc_keet_proyectos.id_tipo_obra
        inner join
          tc_keet_proyectos_estatus on tc_keet_proyectos_estatus.id_proyecto_estatus= tc_keet_proyectos.id_proyecto_estatus      
        where
          {condicion}
				{sortOrder}
			</select>	
			<select id="tiposObraPorDivision">
				select 
					tc_keet_tipos_obras.id_tipo_obra id_key,
					tc_keet_tipos_obras.nombre descripcion,
					tc_keet_divisiones.nombre grupo
				from tc_keet_tipos_obras
				inner join tc_keet_divisiones on tc_keet_tipos_obras.id_division= tc_keet_divisiones.id_division
				order by
				  tc_keet_divisiones.nombre, tc_keet_tipos_obras.nombre
			</select>	
		</unit>	
		<unit id="VistaProyectosArchivosDto">
			<select id="importados">
				select
					tc_keet_proyectos_archivos.id_proyecto_archivo id_key,
					tc_keet_proyectos_archivos.nombre,
					tc_keet_proyectos_archivos.archivo,
					tc_keet_proyectos_archivos.ruta,
					tc_keet_proyectos_archivos.alias,
					tc_keet_proyectos_archivos.observaciones,
					tc_keet_proyectos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_proyectos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_proyectos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_proyectos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_proyectos_archivos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_proyectos_generadores.id_proyecto_generador id_key,
					tc_keet_proyectos_generadores.nombre,
					tc_keet_proyectos_generadores.archivo,
					tc_keet_proyectos_generadores.ruta,
					tc_keet_proyectos_generadores.alias,
					tc_keet_proyectos_generadores.observaciones,
					tc_keet_proyectos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_proyectos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_proyectos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_proyectos_generadores.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaProyectosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_proyectos_presupuestos.id_proyecto_presupuesto id_key,
					tc_keet_proyectos_presupuestos.nombre,
					tc_keet_proyectos_presupuestos.archivo,
					tc_keet_proyectos_presupuestos.ruta,
					tc_keet_proyectos_presupuestos.alias,
					tc_keet_proyectos_presupuestos.observaciones,
					tc_keet_proyectos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_proyectos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_proyectos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_proyectos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_proyectos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_proyectos_presupuestos.id_proyecto= {idProyecto}
			</select>
		</unit>		
		<unit id="VistaNombresDiasDto">
			<select id="dias">
				select      
          tc_keet_nombres_dias.id_nombre_dia as id_key,
					tc_keet_nombres_dias.*
        from      
          tc_keet_nombres_dias
				inner join 
					tc_keet_prototipos_dias on tc_keet_nombres_dias.id_nombre_dia = tc_keet_prototipos_dias.id_nombre_dia
        where 
          {condicion} 
			</select>
		</unit>
		<unit id="VistaProveedoresBancosDto">
			<select id="row">
				select 
					principal.*
				from(
				select 
				  tc_keet_proveedores_materiales.id_proveedor_material as id_key,
				  tc_mantic_articulos.id_articulo,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1 and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  '   ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
				  tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,
					tc_keet_proveedores_materiales.id_proveedor,
					tc_keet_proveedores_materiales.id_usuario,
					tc_keet_proveedores_materiales.registro,
					tc_keet_proveedores_materiales.id_proveedor_material
				from 
					tc_keet_proveedores_materiales
				inner join 
					tc_mantic_articulos on tc_keet_proveedores_materiales.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					tc_keet_proveedores_materiales.id_proveedor= {idProveedor}
					) principal 			
				order by 
				  nombre	
			</select>
		</unit>
		<unit id="VistaDesarrollosDto">
			<select id="lazy">
				select
          tc_keet_desarrollos.id_desarrollo as id_key,
          tc_keet_desarrollos.clave,
          tc_keet_desarrollos.nombres,
          tc_keet_desarrollos.registro,
          tc_keet_desarrollos.descripcion,
          tc_mantic_clientes.razon_social,
          concat(tc_mantic_domicilios.calle, ', ', tc_mantic_domicilios.numero_exterior, if(tc_mantic_domicilios.numero_interior is NULL, '', concat(',', tc_mantic_domicilios.numero_interior)), if(tc_mantic_domicilios.codigo_postal is NULL, '', concat(', C.P.', tc_mantic_domicilios.codigo_postal))) domicilio,
					tc_mantic_clientes.id_empresa
        from
          tc_keet_desarrollos
        inner join tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente
        inner join tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio
				where
          {condicion}
		    order by
		      tc_keet_desarrollos.nombres
			</select>	
			<select id="residentes">
				select
					tc_keet_desarrollos.id_desarrollo as id_key,
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_keet_desarrollos.registro,
					tc_keet_desarrollos.descripcion,
					tc_mantic_clientes.razon_social,
					concat(tc_mantic_domicilios.calle, ", ", tc_mantic_domicilios.numero_exterior) domicilio         
				from
					tc_keet_desarrollos         
				inner join
					tc_keet_contratos_personal on tc_keet_desarrollos.id_desarrollo= tc_keet_contratos_personal.id_desarrollo
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona 
				inner join 
					tc_janal_usuarios on tr_mantic_empresa_personal.id_persona = tc_janal_usuarios.id_persona and tr_mantic_empresa_personal.id_persona= {idPersona}
				inner join 
					tc_mantic_clientes on tc_mantic_clientes.id_cliente= tc_keet_desarrollos.id_cliente         
				inner join
					tc_mantic_domicilios  on tc_mantic_domicilios.id_domicilio= tc_keet_desarrollos.id_domicilio     
				where
					{condicion}      
				order by
					tc_keet_desarrollos.nombres				
			</select>			
		</unit>
		<unit id="VistaContratosArchivosDto">
			<select id="importados">
				select
					tc_keet_contratos_archivos.id_contrato_archivo id_key,
					tc_keet_contratos_archivos.nombre,
					tc_keet_contratos_archivos.archivo,
					tc_keet_contratos_archivos.ruta,
					tc_keet_contratos_archivos.alias,
					tc_keet_contratos_archivos.observaciones,
					tc_keet_contratos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_archivos.id_tipo_archivo,
					tc_keet_prototipos.clave clave_prototipo,
					tc_keet_prototipos.nombre nombre_prototipo,
					tc_keet_especialidades.clave clave_especialidad,
					tc_keet_especialidades.nombre nombre_especialidad,
					tc_keet_planos.nombre nombre_plano
				from
					tc_keet_contratos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_prototipos on tc_keet_contratos_archivos.id_prototipo = tc_keet_prototipos.id_prototipo
				inner join 
					tc_keet_planos on tc_keet_contratos_archivos.id_plano = tc_keet_planos.id_plano
				inner join 
					tc_keet_especialidades on tc_keet_planos.id_especialidad = tc_keet_especialidades.id_especialidad
				where
				  tc_keet_contratos_archivos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosGeneradoresDto">
			<select id="importados">
				select
					tc_keet_contratos_generadores.id_contrato_generador id_key,
					tc_keet_contratos_generadores.nombre,
					tc_keet_contratos_generadores.archivo,
					tc_keet_contratos_generadores.ruta,
					tc_keet_contratos_generadores.alias,
					tc_keet_contratos_generadores.observaciones,
					tc_keet_contratos_generadores.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_generadores.id_tipo_archivo,
					tc_keet_tipos_generadores.clave clave_generador,
					tc_keet_tipos_generadores.nombre nombre_generador,
					tc_keet_estaciones.nombre nombre_estacion
				from
					tc_keet_contratos_generadores
				inner join 
					tc_janal_usuarios on tc_keet_contratos_generadores.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_tipos_generadores on tc_keet_contratos_generadores.id_tipo_generador = tc_keet_tipos_generadores.id_tipo_generador
				inner join 
					tc_keet_estaciones on tc_keet_tipos_generadores.id_estacion = tc_keet_estaciones.id_estacion
				where
				  tc_keet_contratos_generadores.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaContratosPresupuestosDto">
			<select id="importados">
				select
					tc_keet_contratos_presupuestos.id_contrato_presupuesto id_key,
					tc_keet_contratos_presupuestos.nombre,
					tc_keet_contratos_presupuestos.archivo,
					tc_keet_contratos_presupuestos.ruta,
					tc_keet_contratos_presupuestos.alias,
					tc_keet_contratos_presupuestos.observaciones,
					tc_keet_contratos_presupuestos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_contratos_presupuestos.id_tipo_archivo,
					tc_keet_tipos_presupuestos.nombre tipo_presupuesto
				from
					tc_keet_contratos_presupuestos
				inner join 
					tc_janal_usuarios on tc_keet_contratos_presupuestos.id_usuarios = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join
					tc_keet_tipos_presupuestos on tc_keet_contratos_presupuestos.id_tipo_presupuesto = tc_keet_tipos_presupuestos.id_tipo_presupuesto
				where
				  tc_keet_contratos_presupuestos.id_contrato= {idContrato}
			</select>
		</unit>		
		<unit id="VistaEstacionesDto">
			<select id="lazy">
				select
					tc_keet_estaciones.id_estacion id_key,
          tc_keet_estaciones.nivel,
          tc_keet_estaciones.clave,
          tc_keet_estaciones.codigo,
					tc_keet_estaciones.nombre,
					tc_keet_estaciones.descripcion,
					tc_keet_estaciones.inicio,
					tc_keet_estaciones.termino,
					tc_keet_estaciones.cantidad,
					tc_keet_estaciones.costo,
					tc_keet_estaciones.ultimo,		
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
          tc_keet_estaciones
				left join tr_mantic_empaque_unidad_medida on tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida= tc_keet_estaciones.id_empaque_unidad_medida
				left join tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				left join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.nivel = {nivel}
		 	  order by
				  tc_keet_estaciones.clave
			</select>		
		</unit>		
		<unit id="VistaEmpaqueUnidadDto">
			<select id="row">
				select
					tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida id_key,
					tc_mantic_empaques.nombre empaque,
					tc_mantic_unidades_medidas.nombre medida
				from
				  tr_mantic_empaque_unidad_medida
				inner join tc_mantic_unidades_medidas on tc_mantic_unidades_medidas.id_unidad_medida= tr_mantic_empaque_unidad_medida.id_unidad_medida
				inner join tc_mantic_empaques on tc_mantic_empaques.id_empaque= tr_mantic_empaque_unidad_medida.id_empaque
		 	  order by
				  tc_mantic_empaques.nombre,
				  tc_mantic_unidades_medidas.nombre
			</select>		
		</unit>	
		<unit id="VistaPrestamosDto">
			<select id="lazy">
				select
					tc_keet_prestamos.id_prestamo id_key,
				  tc_keet_prestamos.id_deudor,
					tc_keet_prestamos.consecutivo folio,
					tc_keet_prestamos.importe,
					tc_keet_prestamos.saldo,
					tc_keet_deudores.saldo saldo_total,
					tc_keet_deudores.limite,
					tc_keet_deudores.disponible,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
					ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) numero_pagos,
					tc_keet_prestamos_estatus.nombre estatus,
				  tc_keet_prestamos_estatus.id_prestamo_estatus
				from
				  tc_keet_prestamos
				inner join 
				  tc_keet_deudores on tc_keet_prestamos.id_deudor= tc_keet_deudores.id_deudor
				inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				inner join 
				  tc_keet_prestamos_estatus on tc_keet_prestamos.id_prestamo_estatus= tc_keet_prestamos_estatus.id_prestamo_estatus
				where
				  {condicion}	
        {sortOrder}	
			</select>
			<select id="importados">
				select
					tc_keet_prestamos_archivos.id_prestamo_archivo id_key,
					tc_keet_prestamos_archivos.nombre,
					tc_keet_prestamos_archivos.archivo,
					tc_keet_prestamos_archivos.ruta,
					tc_keet_prestamos_archivos.alias,
					tc_keet_prestamos_archivos.observaciones,
					tc_keet_prestamos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario,
          tc_keet_prestamos_pagos.consecutivo,
          tc_keet_prestamos_pagos.abono
				from
					tc_keet_prestamos_archivos
				inner join
          tc_keet_prestamos_pagos on tc_keet_prestamos_pagos.id_prestamo_pago= tc_keet_prestamos_archivos.id_prestamo_pago
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
        order by
          tc_keet_prestamos_pagos.registro, tc_keet_prestamos_archivos.registro
			</select>
			<select id="byIdPrestamo">
				select 
				  tc_keet_prestamos.id_prestamo id_key,
          tc_keet_prestamos.importe prestamo,
          tc_keet_prestamos.saldo,
          ifnull(tc_keet_prestamos_pagos.numero_pagos, 0) pagos,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) empleado,
				  disponible,
				  ifnull(tr_mantic_empresa_personal.ingreso, tr_mantic_empresa_personal.contratacion) ingreso,
				  1 numero_prestamos,
				  tc_keet_deudores.id_empresa_persona
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
				where
				  tc_keet_prestamos.id_prestamo= {idPrestamo}
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor id_key,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) empleado,
          sum(tc_keet_prestamos.importe) prestamo,
          tc_keet_deudores.saldo,
          sum(ifnull(tc_keet_prestamos_pagos.numero_pagos, 0)) pagos,
				  count(*) numero_prestamos
				from
				  tc_keet_prestamos
        inner join 
				  tc_keet_deudores on tc_keet_deudores.id_deudor= tc_keet_prestamos.id_deudor
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
        left join 
				  (select count(*) numero_pagos, id_prestamo from tc_keet_prestamos_pagos group by id_prestamo) tc_keet_prestamos_pagos on tc_keet_prestamos.id_prestamo= tc_keet_prestamos_pagos.id_prestamo
        where
          tc_keet_prestamos.id_prestamo_estatus in (1,2)
        and
          tc_keet_deudores.id_deudor= {idDeudor}
        group by
          tc_keet_deudores.id_deudor,
          tc_mantic_personas.nombres, tc_mantic_personas.paterno, tc_mantic_personas.materno,
          tc_keet_deudores.saldo
			</select>
		</unit>	
		<unit id="VistaDeudoresDto">
			<select id="byEmpresa">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner 
				  join tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
			</select>
			<select id="complete">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible
				from
				  tc_keet_deudores
        inner join 
				  tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join 
				  tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				  tr_mantic_empresa_personal.id_empresa in ({sucursales})
				  and tr_mantic_empresa_personal.id_activo= 1 
				  and tc_mantic_personas.id_tipo_persona!= 1
				  and concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) regexp '.*{deudor}.*'
			</select>
			<select id="byIdDeudor">
				select 
				  tc_keet_deudores.id_deudor id_key,
				  tc_keet_deudores.limite,
				  concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) deudor,
				  disponible,
				  ifnull(tr_mantic_empresa_personal.ingreso, tr_mantic_empresa_personal.contratacion) ingreso
				from
				  tc_keet_deudores
        inner join tr_mantic_empresa_personal on tc_keet_deudores.id_empresa_persona= tr_mantic_empresa_personal.id_empresa_persona
				inner join tc_mantic_personas on tr_mantic_empresa_personal.id_persona= tc_mantic_personas.id_persona
				where
				 tc_keet_deudores.id_deudor= {idDeudor}
			</select>
		</unit>	
		<unit id="VistaPrestamosPagosDto">
			<select id="lazy">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos_pagos.id_prestamo= {idPrestamo}
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
		</unit>	
		<unit id="VistaCapturaDestajosDto">
			<select id="evidenciaDestajoContratista">
				select 
					tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista as id_key,
					tc_keet_contratos_destajos_contratistas.*
				from 
					tc_keet_contratos_destajos_contratistas
				inner join
					tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
				where
					tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}
				  and tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista= {idContratoLoteContratista}
				  and tc_keet_contratos_puntos_contratistas.id_punto_paquete= {idPuntoPaquete}
				  and tc_keet_contratos_destajos_contratistas.id_estacion_estatus != {idEstacionEstatus}
			</select>
			<select id="evidenciaDestajoProveedor">
				select 
					tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor as id_key,
					tc_keet_contratos_destajos_proveedores.*
				from 
					tc_keet_contratos_destajos_proveedores
				inner join
					tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
				where
					tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
				and
					tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor= {idContratoLoteProveedor}
				  and tc_keet_contratos_puntos_proveedores.id_punto_paquete= {idPuntoPaquete}
				  and tc_keet_contratos_destajos_proveedores.id_estacion_estatus != {idEstacionEstatus}
			</select>
			<select id="evidenciaDestajoResidente">
				select 
					tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente as id_key,
					tc_keet_contratos_destajos_residentes.*
				from 
					tc_keet_contratos_destajos_residentes
				inner join
					tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
				where
					tc_keet_contratos_destajos_residentes.id_control= {idControl}
				  and tc_keet_contratos_destajos_residentes.id_contrato_lote_residente= {idContratoLoteResidente}
				  and tc_keet_contratos_puntos_residentes.id_punto_paquete= {idPuntoPaquete}
				  and tc_keet_contratos_destajos_residentes.id_control_estatus != {idControlEstatus}
			</select>
			<select id="allImportados">
				select 
					convert(concat(9000,tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo), unsigned integer) as id_key,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					tc_mantic_puestos.nombre puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
				union
				select 
					convert(concat(8000,tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo), unsigned integer) as id_key,					
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 					
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
			</select>
			<select id="allImportadosResidentes">
				select 
					convert(concat(9000,tc_keet_contratos_residentes_archivos.id_contrato_residente_archivo), unsigned integer) as id_key,
					tc_keet_contratos_residentes_archivos.nombre,
					tc_keet_contratos_residentes_archivos.archivo,
					tc_keet_contratos_residentes_archivos.ruta,
					tc_keet_contratos_residentes_archivos.alias,
					tc_keet_contratos_residentes_archivos.observaciones,
					tc_keet_contratos_residentes_archivos.registro,
					tc_keet_contratos_residentes_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_residentes.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_controles.clave consecutivo,
					tc_keet_controles.nombre concepto,					
					tc_mantic_puestos.nombre puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_residentes_archivos
				inner join 
					tc_keet_contratos_destajos_residentes on tc_keet_contratos_residentes_archivos.id_contrato_destajo_residente = tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente
				inner join 
					tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control = tc_keet_controles.id_control
				inner join
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente = tc_keet_contratos_lotes_residentes.id_contrato_lote_residente	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_residentes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_residentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo}
			</select>      
			<select id="allImportadosContratoLote">
				select 
					convert(concat(9000,tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo), unsigned integer) as id_key,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					tc_mantic_puestos.nombre puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_contratistas.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 				
					tc_keet_proyectos.id_desarrollo= {idDesarrollo} and tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
				union
				select 
					convert(concat(8000,tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo), unsigned integer) as id_key,					
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_keet_contratos_lotes on tc_keet_contratos_lotes_proveedores.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
				inner join
					tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
				inner join
					tc_keet_proyectos on tc_keet_contratos.id_proyecto = tc_keet_proyectos.id_proyecto
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 					
					tc_keet_proyectos.id_desarrollo= {idDesarrollo} and tc_keet_contratos_lotes.id_contrato_lote= {idContratoLote}
			</select>
			<select id="importadosContratista">
				select 
					tc_keet_contratos_contratistas_archivos.id_contrato_contratista_archivo as id_key,
					tc_keet_contratos_contratistas_archivos.nombre,
					tc_keet_contratos_contratistas_archivos.archivo,
					tc_keet_contratos_contratistas_archivos.ruta,
					tc_keet_contratos_contratistas_archivos.alias,
					tc_keet_contratos_contratistas_archivos.observaciones,
					tc_keet_contratos_contratistas_archivos.registro,
					tc_keet_contratos_contratistas_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_contratistas.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					tc_mantic_puestos.nombre puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_contratistas_archivos
				inner join 
					tc_keet_contratos_destajos_contratistas on tc_keet_contratos_contratistas_archivos.id_contrato_destajo_contratista = tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_contratistas.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_lote_contratista = tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista	
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_contratistas_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = {idContratoLoteContratista}
				and 
					tc_keet_estaciones.id_estacion= {idEstacion}												
			</select>
			<select id="importadosProveedor">
				select 
					tc_keet_contratos_proveedores_archivos.id_contrato_proveedor_archivo as id_key,
					tc_keet_contratos_proveedores_archivos.nombre,
					tc_keet_contratos_proveedores_archivos.archivo,
					tc_keet_contratos_proveedores_archivos.ruta,
					tc_keet_contratos_proveedores_archivos.alias,
					tc_keet_contratos_proveedores_archivos.observaciones,
					tc_keet_contratos_proveedores_archivos.registro,
					tc_keet_contratos_proveedores_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_proveedores.id_usuario,	
					tc_mantic_proveedores.razon_social nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_estaciones.clave consecutivo,
					tc_keet_estaciones.nombre concepto,					
					'SUBCONTRATISTA' puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_proveedores_archivos
				inner join 
					tc_keet_contratos_destajos_proveedores on tc_keet_contratos_proveedores_archivos.id_contrato_destajo_proveedor = tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor
				inner join 
					tc_keet_estaciones on tc_keet_contratos_destajos_proveedores.id_estacion = tc_keet_estaciones.id_estacion
				inner join
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_lote_proveedor = tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				inner join
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento				
				inner join 
					tc_janal_usuarios on tc_keet_contratos_proveedores_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = {idContratoLoteProveedor}
				and 
					tc_keet_estaciones.id_estacion= {idEstacion}												
			</select>
			<select id="importadosResidente">
				select 
					tc_keet_contratos_residentes_archivos.id_contrato_residente_archivo as id_key,
					tc_keet_contratos_residentes_archivos.nombre,
					tc_keet_contratos_residentes_archivos.archivo,
					tc_keet_contratos_residentes_archivos.ruta,
					tc_keet_contratos_residentes_archivos.alias,
					tc_keet_contratos_residentes_archivos.observaciones,
					tc_keet_contratos_residentes_archivos.registro,
					tc_keet_contratos_residentes_archivos.id_tipo_archivo,					
					tc_keet_contratos_destajos_residentes.id_usuario,	
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) nombre_persona,
					concat(persona_usuario.nombres, ' ', persona_usuario.paterno, ' ', persona_usuario.materno) nombre_usuario,
					tc_keet_controles.clave consecutivo,
					tc_keet_controles.nombre concepto,					
					tc_mantic_puestos.nombre puesto,
					tc_keet_departamentos.nombre especialidad				
				from 
					tc_keet_contratos_residentes_archivos
				inner join 
					tc_keet_contratos_destajos_residentes on tc_keet_contratos_residentes_archivos.id_contrato_destajo_residente = tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente
				inner join 
					tc_keet_controles on tc_keet_contratos_destajos_residentes.id_control = tc_keet_controles.id_control
				inner join
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_destajos_residentes.id_contrato_lote_residente = tc_keet_contratos_lotes_residentes.id_contrato_lote_residente	
				inner join
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona				
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_janal_usuarios on tc_keet_contratos_residentes_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas persona_usuario on tc_janal_usuarios.id_persona = persona_usuario.id_persona
				where 
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente = {idContratoLoteResidente}
				  and tc_keet_controles.id_control= {idControl}												
			</select>      
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>			
			<select id="residentes">
        select 
          tc_keet_departamentos.id_departamento as id_key,
          tc_keet_departamentos.descripcion, 
          tc_keet_departamentos.nombre
        from 
          tc_keet_proyectos
        inner join 
          tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
        inner join 
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
        inner join 
          tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
        inner join 
          tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
        inner join 
          tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
        where 
          tc_keet_proyectos.id_desarrollo={idDesarrollo}
        group by 
          tc_keet_departamentos.id_departamento,
          tc_keet_departamentos.descripcion, 
          tc_keet_departamentos.nombre 
  			order by 
					tc_keet_departamentos.nombre
      </select>			
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
						tc_mantic_puestos.nombre puesto,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						'SUBCONTRATISTA' puesto,  
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>		
      <select id="residentesAsociados">
        select 
          convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
          concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
          tc_mantic_puestos.nombre puesto,
          1 tipo  
        from 
          tc_keet_proyectos
        inner join 
          tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
        inner join 
          tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
        inner join 
          tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
        inner join 
          tr_mantic_empresa_personal on tc_keet_contratos_lotes_residentes.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
        inner join 
          tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
        inner join 
          tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
        inner join 
          tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
        where 
          tc_keet_proyectos.id_desarrollo={idDesarrollo} 
          and tc_keet_departamentos.id_departamento={idDepartamento}
        group by
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno),
          tc_mantic_puestos.nombre
      </select>
			<select id="lotesContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_contratistas.id_empresa_persona={idFigura}
				and 
					{condicion}
			</select>
			<select id="lotesSubContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_proveedores.id_proveedor={idFigura}
				and 
					{condicion}
			</select>
			<select id="lotesResidentes">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_residentes.id_contrato_lote_residente
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_residentes on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_residentes.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
          and tc_keet_contratos_lotes_residentes.id_empresa_persona={idFigura}
				  and {condicion}
			</select>
			<select id="conceptos">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} 
          and (tc_keet_rubros.nombre like upper('%{nombreConcepto}%') 
          or tc_keet_rubros.codigo like upper('%{nombreConcepto}%')) 
          and tc_keet_puntos_grupos.id_extra=2
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.id_estacion_estatus in ({estatus})
				order by 
				  tc_keet_estaciones.clave
			</select>
			<select id="controles">
				select
					tc_keet_controles.id_control as id_key,
					tc_keet_controles.nivel,
					tc_keet_controles.clave,
					tc_keet_controles.id_empaque_unidad_medida,
					tc_keet_controles.id_control_estatus,
					tc_keet_controles.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} 
          and (tc_keet_rubros.nombre like upper('%{nombreConcepto}%') 
          or tc_keet_rubros.codigo like upper('%{nombreConcepto}%'))
          and tc_keet_puntos_grupos.id_extra=2
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.id_control_estatus in ({estatus})
				order by 
				  tc_keet_controles.clave        
      </select>  
			<select id="conceptosExtras">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.id_estacion_estatus in ({estatus})
				order by 
				  tc_keet_estaciones.clave
			</select>
			<select id="controlesExtras">
				select
					tc_keet_controles.id_control as id_key,
					tc_keet_controles.nivel,
					tc_keet_controles.clave,
					tc_keet_controles.id_empaque_unidad_medida,
					tc_keet_controles.id_control_estatus,
					tc_keet_controles.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				  and tc_keet_controles.id_control_estatus in ({estatus})
				order by 
				  tc_keet_controles.clave        
      </select>  
			<select id="totalTrabajosLotes">
				select sum(total) total from (
				select 
					contratistas.*
				from (					
					select 
						1 llave, count(*) total
					from 
						tc_keet_contratos_destajos_contratistas
					where 
						id_estacion in (
							select
								tc_keet_estaciones.id_estacion
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
								where
									tc_keet_estaciones.clave like '{clave}%'
								and 
									id_estacion_estatus != {estatus}
							)
						and 
							{condicionContratista}
						) contratistas
				union
				select 
					proveedores.*
				from (					
					select 
						2 llave, count(*) total
					from 
						tc_keet_contratos_destajos_proveedores
					where 
						id_estacion in (
							select
								tc_keet_estaciones.id_estacion
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
								where
									tc_keet_estaciones.clave like '{clave}%'
								and 
									id_estacion_estatus != {estatus}
							)
						and 
							{condicionProveedor}
				) proveedores) totales
			</select>
			<select id="totalTrabajosLotesResidente">
				select sum(total) total from (
				select 
					contratistas.*
				from (					
					select 
						1 llave, count(*) total
					from 
						tc_keet_contratos_destajos_residentes
					where 
						id_control in (
							select
								tc_keet_controles.id_control
							from(  
								select
									tc_keet_puntos_paquetes.id_punto_grupo,  
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre departamento,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								from 
									tc_keet_puntos_paquetes
								inner join 
									tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
								inner join
									tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
								inner join
									tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
								inner join
									tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
								where
									tc_keet_puntos_grupos.id_departamento= {idDepartamento}
								group by
									tc_keet_puntos_paquetes.id_punto_grupo,   
									tc_keet_puntos_grupos.id_departamento,
									tc_keet_departamentos.nombre,
									tc_keet_puntos_grupos.grupo,
									tc_keet_puntos_grupos.descripcion,
									tc_keet_rubros_grupos.id_rubro_grupo,
									tc_keet_rubros_grupos.id_rubro,
									tc_keet_rubros.codigo,
									tc_keet_rubros.nombre,
									tc_keet_rubros.orden
								) principal
								inner join
									tc_keet_controles on principal.codigo = tc_keet_controles.codigo
								where
									tc_keet_controles.clave like '{clave}%'
								and 
									id_control_estatus != {estatus}
							)
						and 
							{condicion}
						) contratistas
				) totales
			</select>
			<select id="puntosRevision">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_puntos_contratistas ON tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="puntosRevisionControl">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="evidenciaDestajoResidentes">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete not in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="puntosRevisionRechazos">
				select
					rechazos.id_pivote as id_key,  
					tc_keet_puntos_paquetes.id_punto_paquete,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden,
					rechazos.registro,
					rechazos.observaciones,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				inner join(
					select 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
					from(
						select
							convert(concat(9000,tc_keet_contratos_rechazos_proveedores.id_contrato_rechazo_proveedor), unsigned integer) as id_pivote,
							id_punto_paquete, registro, observaciones, id_usuario
						from 
				      tc_keet_contratos_rechazos_proveedores
						union
						select 
							convert(concat(8000,tc_keet_contratos_rechazos_contratistas.id_contrato_rechazo_contratista), unsigned integer) as id_pivote,
							id_punto_paquete, registro, observaciones, id_usuario
						from
							tc_keet_contratos_rechazos_contratistas
					) general
					group by 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
				) rechazos on tc_keet_puntos_paquetes.id_punto_paquete = rechazos.id_punto_paquete
				inner join
					tc_janal_usuarios on rechazos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 					 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_rechazos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_rechazos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_rechazos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_rechazos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="puntosRevisionRechazosControl">
				select
					rechazos.id_pivote as id_key,  
					tc_keet_puntos_paquetes.id_punto_paquete,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden,
					rechazos.registro,
					rechazos.observaciones,
					concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				inner join(
					select 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
					from(
						select 
							convert(concat(8000, tc_keet_contratos_rechazos_residentes.id_contrato_rechazo_residente), unsigned integer) as id_pivote,
							id_punto_paquete, registro, observaciones, id_usuario
						from
							tc_keet_contratos_rechazos_residentes
					) general
					group by 
						id_pivote, id_punto_paquete, registro, observaciones, id_usuario
				) rechazos on tc_keet_puntos_paquetes.id_punto_paquete = rechazos.id_punto_paquete
				inner join
					tc_janal_usuarios on rechazos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 					 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_rechazos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_rechazos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}   
					)
			</select>
			<select id="puntosRechazos">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select
							id_punto_paquete
						from
							tc_keet_contratos_destajos_proveedores
						inner join
							tc_keet_contratos_puntos_proveedores on tc_keet_contratos_destajos_proveedores.id_contrato_destajo_proveedor = tc_keet_contratos_puntos_proveedores.id_contrato_destajo_proveedor
						where
							tc_keet_contratos_destajos_proveedores.id_estacion= {idEstacion}
						union 
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_contratistas
						inner join
							tc_keet_contratos_puntos_contratistas on tc_keet_contratos_destajos_contratistas.id_contrato_destajo_contratista = tc_keet_contratos_puntos_contratistas.id_contrato_destajo_contratista
						where
							tc_keet_contratos_destajos_contratistas.id_estacion= {idEstacion}   
					)
			</select>
			<select id="puntosRechazosResidentes">
				select
					tc_keet_puntos_paquetes.id_punto_paquete as id_key,  
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_puntos_controles.id_punto_control,
					tc_keet_puntos_controles.nombre,
					tc_keet_puntos_controles.factor,
					tc_keet_puntos_controles.orden  
				from
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join 
					tc_keet_puntos_controles on tc_keet_puntos_paquetes.id_punto_control = tc_keet_puntos_controles.id_punto_control
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento} and tc_keet_puntos_paquetes.id_punto_grupo={idPuntoGrupo}
				and 
					tc_keet_puntos_paquetes.id_punto_paquete in (
						select 
							id_punto_paquete
						from 
							tc_keet_contratos_destajos_residentes
						inner join
							tc_keet_contratos_puntos_residentes on tc_keet_contratos_destajos_residentes.id_contrato_destajo_residente = tc_keet_contratos_puntos_residentes.id_contrato_destajo_residente
						where
							tc_keet_contratos_destajos_residentes.id_control= {idControl}
					)		
			</select>
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_estaciones.id_estacion_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				)final
			</select>
			<select id="estatusControlManzanaLote">
				select
					sum(iniciado) as iniciado,
					sum(en_proceso) as en_proceso,
					sum(terminado) as terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) as total
				from(
				select 
					case when tc_keet_controles.id_control_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_controles.id_control_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_controles.id_control_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento={idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_controles.codigo
				where
					tc_keet_controles.clave like '{clave}%'
				) final
			</select>
		</unit>
		<unit id="VistaPuntosControlDto">
			<select id="lazy">
				select 
					tc_keet_puntos_grupos.id_punto_grupo id_key,
					tc_keet_puntos_grupos.descripcion paquete,
					tc_keet_departamentos.descripcion departamento, 
					tc_keet_puntos_grupos.registro,
          ifnull(puntos_control, 0) puntos_control
				from tc_keet_puntos_grupos
					inner join tc_keet_departamentos on tc_keet_departamentos.id_departamento= tc_keet_puntos_grupos.id_departamento
					left join
            (select count(*) puntos_control, id_punto_grupo, group_concat(nombre) nombres from tc_keet_puntos_controles
             inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
             group by id_punto_grupo
            ) tc_keet_puntos_controles on tc_keet_puntos_controles.id_punto_grupo = tc_keet_puntos_grupos.id_punto_grupo
				where
				  {condicion}	
				{sortOrder}	
			</select>
			<select id="persona">
				select
					tc_keet_prestamos_pagos.id_prestamo_pago id_key,
				  tc_keet_prestamos.consecutivo as prestamo,
					tc_keet_prestamos_pagos.consecutivo,
					tc_keet_prestamos_pagos.pago,
					tc_keet_prestamos_pagos.abono,
					tc_keet_prestamos_pagos.abono as abonos,
					tc_keet_prestamos_pagos.cambio,
				  tc_keet_prestamos.saldo,
					tc_keet_prestamos_pagos.observaciones,
					tc_keet_prestamos_pagos.registro,
					concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_prestamos_pagos
				inner join 
				  tc_keet_prestamos on tc_keet_prestamos_pagos.id_prestamo= tc_keet_prestamos.id_prestamo
				inner join 
					tc_janal_usuarios on tc_keet_prestamos_pagos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  tc_keet_prestamos.id_deudor= {idDeudor}
				{sortOrder}	
			</select>
			<select id="getOrdenPuntoControl">
				select 
					max(orden)+1 orden
				from
				  tc_keet_puntos_controles
				inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
				where
				  tc_keet_puntos_paquetes.id_punto_grupo= {idPuntoGrupo}
			</select>
			<select id="getPuntoControlByGrupo">
				select 
				  tc_keet_puntos_controles.id_punto_control id_key,
					tc_keet_puntos_controles.*
				from
				  tc_keet_puntos_controles
				inner join tc_keet_puntos_paquetes on tc_keet_puntos_controles.id_punto_control = tc_keet_puntos_paquetes.id_punto_control
				where
				  tc_keet_puntos_paquetes.id_punto_grupo= {idPuntoGrupo}
			</select>
		</unit>	
		<unit id="VistaRubrosDto">
			<select id="lazy">
				select 
					tc_keet_rubros.id_rubro id_key,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					ifnull(tc_keet_rubros_grupos.paquetes, 0) paquetes,
					tc_mantic_empaques.nombre unidad,
					tc_keet_rubros.registro
				from
					tc_keet_rubros
				left join
					(select count(*) paquetes, id_rubro from tc_keet_rubros_grupos group by id_rubro) tc_keet_rubros_grupos  on tc_keet_rubros_grupos.id_rubro= tc_keet_rubros.id_rubro
				inner join
					tr_mantic_empaque_unidad_medida on tc_keet_rubros.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				where
				  {condicion}	
				{sortOrder}	
			</select>
			<select id="byDepartamentoExtra">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				and 
					tc_keet_puntos_grupos.id_extra= {idExtra}	
				and 
				  tc_keet_rubros.id_rubro not in (
				select					
					principal.id_rubro
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'				
				order by 
				  tc_keet_estaciones.clave)			
			</select>
			<select id="byDepartamentoExtraControles">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				and 
					tc_keet_puntos_grupos.id_extra= {idExtra}	
				and 
				  tc_keet_rubros.id_rubro not in (
				select					
					principal.id_rubro
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento} and tc_keet_puntos_grupos.id_extra=1
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_controles on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_controles.clave like '{clave}%'				
				order by 
				  tc_keet_controles.clave)			
			</select>
			<select id="byRubro">
				select 
					tc_keet_rubros.id_rubro as id_key,
          tc_keet_puntos_grupos.id_punto_grupo,
          tc_keet_rubros.nombre,
          tc_keet_rubros.codigo
        from      
          tc_keet_puntos_grupos
				inner join 
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join 
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
        where 
          tc_keet_rubros.id_rubro= {idRubro}				
			</select>
		</unit>	
		<unit id="VistaGeoreferenciaLotesDto">
			<select id="lotes">				
        select 
					tc_keet_contratos_lotes.id_contrato_lote as id_key,
					tc_keet_contratos_lotes.id_contrato_lote,
				  tc_keet_contratos.id_empresa,
					tc_keet_contratos.consecutivo,
					tc_keet_contratos.clave,
				  tc_keet_contratos_lotes.manzana,
				  tc_keet_contratos_lotes.lote,
					concat('M', tc_keet_contratos_lotes.manzana, "L", tc_keet_contratos_lotes.lote) codigo,
					tc_keet_contratos.etapa,
					tc_keet_contratos.ejercicio,
					tc_keet_contratos.orden as contrato,
					tc_keet_contratos_lotes.orden,
					tc_keet_contratos_lotes.latitud,
					tc_keet_contratos_lotes.longitud
				from 
					tc_keet_contratos_lotes
				inner join 
					tc_keet_contratos on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_proyectos on tc_keet_contratos.id_proyecto= tc_keet_proyectos.id_proyecto
				inner join 
					tc_keet_desarrollos on tc_keet_proyectos.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				where				  
					tc_keet_desarrollos.id_desarrollo= {idDesarrollo} and {condicion}
				and 
					tc_keet_contratos_lotes.latitud is not null and tc_keet_contratos_lotes.longitud is not null
				order by
				  tc_keet_contratos_lotes.manzana, tc_keet_contratos_lotes.lote
			</select>
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_estaciones.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_estaciones.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_estaciones.id_estacion_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro			
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				)final
			</select>
			<select id="residentes">				
				select      
					tc_keet_contratos_personal.id_contratos_personal as id_key,									
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					tc_mantic_puestos.id_puesto,
					tr_mantic_empresa_personal.id_empresa_persona,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
				  concat(tc_mantic_personas.nombres, ' ', ifnull(tc_mantic_personas.paterno, ''), ' ', ifnull(tc_mantic_personas.materno, '')) as nombre_completo,
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          					
					tr_mantic_empresa_personal.id_persona,
					tr_mantic_empresa_personal.id_contratista
        from      
          tc_keet_contratos_personal
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_personal.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_personal.id_desarrollo= {idDesarrollo}
				and 
					tr_mantic_empresa_personal.id_activo= 1
				and 
					tc_mantic_puestos.nombre= 'RESIDENTE DE OBRA'				
			</select>
			<select id="contratistasAsignado">
				select contratistas.* from (
				select      
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					tc_keet_departamentos.nombre departamento,
					tc_keet_departamentos.id_departamento as ids_departamento,
					tc_mantic_puestos.nombre puesto,
					tr_mantic_empresa_personal.id_activo,
					tr_mantic_empresa_personal.id_nomina,
					tr_mantic_empresa_personal.nss,
					tc_mantic_personas.nombres,
					tc_mantic_personas.paterno,
					tc_mantic_personas.materno,					
					tc_mantic_personas.rfc,					
					tc_mantic_personas.curp,					          
					1 tipo,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote,
					tc_keet_contratos_lotes_contratistas.id_empresa_persona,
					tc_keet_contratos_lotes_contratistas.observaciones,
					tc_keet_contratos_lotes_contratistas.id_trabajo,
					tc_keet_contratos_lotes_contratistas.id_usuario,
					tc_keet_contratos_lotes_contratistas.registro 
        from      
          tc_keet_contratos_lotes_contratistas
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona and tc_mantic_personas.id_tipo_persona!= 1
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				inner join	
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto				
        where 
          tc_keet_contratos_lotes_contratistas.id_contrato_lote= {idContratoLote} 
				and tc_keet_contratos_lotes_contratistas.id_trabajo=2
				and tr_mantic_empresa_personal.id_activo= 1				  
				order by 
					tc_mantic_puestos.nombre,
					tc_mantic_personas.nombres) contratistas
				union
				select subcontratistas.* from (
				select      
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,								
					(select 
						group_concat(tc_keet_departamentos.nombre separator ', ')
					from
						tc_keet_proveedores_departamentos
					inner join
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
					group by
						tc_keet_proveedores_departamentos.id_proveedor				  
					 ) as departamento,
					(select 
						group_concat(tc_keet_departamentos.id_departamento separator ',')
					from
						tc_keet_proveedores_departamentos
					inner join
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento= tc_keet_departamentos.id_departamento
					where 
						tc_mantic_proveedores.id_proveedor= tc_keet_proveedores_departamentos.id_proveedor
					group by
						tc_keet_proveedores_departamentos.id_proveedor				  
					 ) as ids_departamento,
					'SUBCONTRATISTA' puesto,
					tc_mantic_proveedores.id_activo,
					1 id_nomina,
					tc_mantic_proveedores.rfc nss,
					tc_mantic_proveedores.razon_social nombres,
					'' paterno,
					'' materno,					
					tc_mantic_proveedores.rfc,					
					tc_mantic_proveedores.rfc curp,					
					2 tipo,					
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor id_contrato_lote_contratista,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote,
					tc_keet_contratos_lotes_proveedores.id_proveedor id_empresa_persona,
					tc_keet_contratos_lotes_proveedores.observaciones,
					tc_keet_contratos_lotes_proveedores.id_trabajo,
					tc_keet_contratos_lotes_proveedores.id_usuario,
					tc_keet_contratos_lotes_proveedores.registro 
        from     
					tc_keet_contratos_lotes_proveedores
				inner join
					tc_mantic_proveedores	on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
        where 
          tc_keet_contratos_lotes_proveedores.id_contrato_lote= {idContratoLote} 
				and tc_keet_contratos_lotes_proveedores.id_trabajo=2				
				and tc_mantic_proveedores.id_activo= 1				  
				and tc_mantic_proveedores.id_subcontratista= 1
				order by
					tc_mantic_proveedores.razon_social
				) subcontratistas
			</select>
			<select id="avances">
				select
					tc_keet_estaciones.id_estacion as id_key,
					tc_keet_estaciones.nivel,
					tc_keet_estaciones.clave,
					tc_keet_estaciones.id_empaque_unidad_medida,
					tc_keet_estaciones.id_estacion_estatus,
					tc_keet_estaciones.costo,
					principal.*
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join 
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				inner join
					tc_keet_departamentos on tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento				
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_departamentos.nombre,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_estaciones on principal.codigo = tc_keet_estaciones.codigo
				where
					tc_keet_estaciones.clave like '{clave}%'
				and
					tc_keet_estaciones.id_estacion_estatus in ({estatus})
				order by 
				  tc_keet_estaciones.clave
			</select>
		</unit>
		<unit id="VistaPartidasDto">
			<select id="lazy">
				select 
					tc_keet_partidas.id_partida id_key,
					tc_keet_partidas.codigo,
					tc_keet_partidas.nombre,
					tc_keet_partidas.registro,
          concat(tc_mantic_personas.nombres,' ', ifnull(tc_mantic_personas.paterno, ''),' ', ifnull(tc_mantic_personas.materno, '')) usuario
				from
					tc_keet_partidas
				inner join 
					tc_janal_usuarios on tc_keet_partidas.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				where
				  {condicion}	
				{sortOrder}	
			</select>
		</unit>	
		<unit id="VistaCapturaMaterialesDto">			
			<select id="conceptosPadre">
				select 
					tc_keet_materiales.id_material as id_key,
					tc_keet_materiales.*
				from 
					tc_keet_materiales
				where 
					clave like '{clave}%' and nivel=5
			</select>
			<select id="conceptos">
				select 
					principal.*,
					(select 
						count(*) 
					from 
						tc_keet_vales
					inner join 
						tc_keet_vales_materiales on tc_keet_vales.id_vale = tc_keet_vales_materiales.id_vale
					where 
						tc_keet_vales_materiales.id_material= principal.id_material and tc_keet_vales.id_tipo_vale=1) total_detalle
				from ( 																				
					select
						tc_keet_materiales.id_material as id_key,
						tc_keet_materiales.id_material,
						tc_keet_materiales.nivel,
						tc_keet_materiales.clave,
						tc_keet_materiales.id_empaque_unidad_medida,
						tc_keet_materiales.id_estacion_estatus,
						tc_keet_materiales.costo,
						tc_keet_materiales.codigo,
						tc_keet_materiales.nombre					
					from(
						select
							tc_keet_puntos_paquetes.id_punto_grupo,  
							tc_keet_puntos_grupos.id_departamento,
							tc_keet_departamentos.nombre departamento,
							tc_keet_puntos_grupos.grupo,
							tc_keet_puntos_grupos.descripcion,
							tc_keet_rubros_grupos.id_rubro_grupo,
							tc_keet_rubros_grupos.id_rubro,
							tc_keet_rubros.codigo,
							tc_keet_rubros.nombre,
							tc_keet_rubros.orden
						from
							tc_keet_puntos_paquetes
						inner join
							tc_keet_puntos_grupos ON tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
						inner join
							tc_keet_rubros_grupos ON tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
						inner join
							tc_keet_rubros ON tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
						inner join
							tc_keet_departamentos ON tc_keet_puntos_grupos.id_departamento = tc_keet_departamentos.id_departamento
						where
							tc_keet_puntos_grupos.id_departamento= {idDepartamento}
						group by
							tc_keet_puntos_paquetes.id_punto_grupo,   
							tc_keet_puntos_grupos.id_departamento,
							tc_keet_departamentos.nombre,
							tc_keet_puntos_grupos.grupo,
							tc_keet_puntos_grupos.descripcion,
							tc_keet_rubros_grupos.id_rubro_grupo,
							tc_keet_rubros_grupos.id_rubro,
							tc_keet_rubros.codigo,
							tc_keet_rubros.nombre,
							tc_keet_rubros.orden
					) rubros
					inner join	
						tc_keet_materiales on rubros.codigo = tc_keet_materiales.codigo
					where
						tc_keet_materiales.clave like '{clave}%'
					and
						tc_keet_materiales.id_estacion_estatus in ({estatus})
					and 
						tc_keet_materiales.nivel=6
				) principal
				order by 
					principal.clave				
			</select>			
			<select id="conceptosRegistrados">
				select 
					principal.*,
					0 total_detalle
				from ( 
					select
						tc_keet_materiales.id_material as id_key,
						tc_keet_materiales.id_material,
						tc_keet_materiales.nivel,
						tc_keet_materiales.clave,
						tc_keet_materiales.id_empaque_unidad_medida,
						tc_keet_materiales.id_estacion_estatus,
						tc_keet_materiales.costo,
						tc_keet_materiales.codigo,
						tc_keet_materiales.nombre					
					from
						tc_keet_materiales
				  inner join 
						tc_keet_vales_materiales on tc_keet_materiales.id_material = tc_keet_vales_materiales.id_material
					where						
						tc_keet_vales_materiales.id_vale= {idVale}
				) principal
				order by 
				  principal.clave
			</select>			
			<select id="materialesClave">
				select 
					principal.*,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.orden= 2 limit 1, 1) as codigo				  
				from(
					select
						tc_mantic_articulos.id_articulo AS id_key,        
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,
						1 cantidad,        
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre unidad_medida,
						'   ' AS origen,
						tc_mantic_articulos.descripcion,				  
						tc_mantic_articulos.precio AS original,
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						CONCAT(IFNULL(tc_mantic_articulos.descuento, '0'), ',', IFNULL(tc_mantic_articulos.extra, '0')) AS porcentajes
					from
						tc_keet_materiales
					inner join 
						tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
					inner join
						tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
					inner join 
						tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
					inner join 
						tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
					where
						tc_keet_materiales.clave like '{clave}%'				
					  and tc_keet_materiales.nivel=7
					  and tc_mantic_articulos.id_familia in ({familias})				
					group by 
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,					
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre,					
						tc_mantic_articulos.descripcion,
						tc_mantic_articulos.precio,				  
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0'))
				) principal
				order by 
				  nombre
			</select>			
			<select id="materialesVariasClave">
				select 
					principal.*,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= principal.id_articulo and tc_mantic_articulos_codigos.orden= 2 limit 1, 1) as codigo				  
				from(
					select
						tc_mantic_articulos.id_articulo AS id_key,        
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,
						sum(tc_keet_materiales.cantidad) cantidad,        
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre unidad_medida,
						'   ' as origen,
						tc_mantic_articulos.descripcion,				  
						tc_mantic_articulos.precio as original,
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes
					from
						tc_keet_materiales
					inner join 
						tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
					inner join
						tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
					inner join 
						tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
					inner join 
						tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
					where
					  tc_keet_materiales.nivel=7
					  and ({condicion})
					group by 
						tc_mantic_articulos.id_articulo,
						tc_keet_materiales.nivel,        
						tc_keet_materiales.id_empaque_unidad_medida,        						
						tc_keet_materiales.nombre,					
						tc_mantic_articulos.precio,
						tc_mantic_unidades_medidas.nombre,					
						tc_mantic_articulos.descripcion,
						tc_mantic_articulos.precio,				  
						tc_mantic_articulos.menudeo,
						tc_mantic_articulos.medio_mayoreo,
						tc_mantic_articulos.mayoreo,
						tc_mantic_articulos.sat,
						tc_mantic_articulos.limite_medio_mayoreo,
						tc_mantic_articulos.limite_mayoreo,
						tc_mantic_articulos.iva,
						tc_mantic_articulos.id_redondear,
						concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0'))
				) principal
				order by 
				  nombre
			</select>			
			<select id="materiales">
				select
					tc_mantic_articulos.id_articulo as id_key,
					tc_keet_materiales.id_material,
					tc_keet_materiales.nivel,
					tc_keet_materiales.clave,
					tc_keet_materiales.id_empaque_unidad_medida,
					tc_keet_materiales.id_estacion_estatus,
					tc_keet_materiales.costo,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.precio,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from
					tc_keet_materiales
				inner join 
					tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'				
				and 
				  tc_keet_materiales.nivel=7
				and 
					tc_keet_materiales.id_material not in (select id_material from tc_keet_vales_detalles where id_material is not null)
				order by 
				  tc_keet_materiales.clave
			</select>			
			<select id="materialesVale">
				select
					tc_mantic_articulos.id_articulo as id_key,
					tc_keet_materiales.id_material,
					tc_keet_materiales.nivel,
					tc_keet_materiales.clave,
					tc_keet_materiales.id_empaque_unidad_medida,
					tc_keet_materiales.id_estacion_estatus,
					tc_keet_materiales.costo,
					tc_keet_materiales.codigo,
					tc_keet_materiales.nombre,
					tc_keet_materiales.cantidad,
					tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.precio,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from
					tc_keet_materiales
				inner join 
					tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_materiales.clave like '{clave}%'				
				and 
				  tc_keet_materiales.nivel=7
				and 
					tc_keet_materiales.id_material not in (select id_material from tc_keet_vales_detalles where id_vale != {idVale} and id_material is not null)
				order by 
				  tc_keet_materiales.clave
			</select>			
			<select id="estatusManzanaLote">
				select
					sum(iniciado) iniciado,
					sum(en_proceso) en_proceso,
					sum(terminado) terminado,
					(sum(iniciado)+sum(en_proceso)+sum(terminado)) total
				from(
				select 
					case when tc_keet_materiales.id_estacion_estatus= 1 then 1 else 0 end iniciado,
					case when tc_keet_materiales.id_estacion_estatus= 2 then 1 else 0 end en_proceso,
					case when tc_keet_materiales.id_estacion_estatus= 3 then 1 else 0 end terminado  
				from(  
				select
					tc_keet_puntos_paquetes.id_punto_grupo,  
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				from 
					tc_keet_puntos_paquetes
				inner join
					tc_keet_puntos_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_puntos_paquetes.id_punto_grupo
				inner join
					tc_keet_rubros_grupos on tc_keet_puntos_grupos.id_punto_grupo = tc_keet_rubros_grupos.id_punto_grupo
				inner join
					tc_keet_rubros on tc_keet_rubros_grupos.id_rubro = tc_keet_rubros.id_rubro
				where
					tc_keet_puntos_grupos.id_departamento= {idDepartamento}
				group by
					tc_keet_puntos_paquetes.id_punto_grupo,   
					tc_keet_puntos_grupos.id_departamento,
					tc_keet_puntos_grupos.grupo,
					tc_keet_puntos_grupos.descripcion,
					tc_keet_rubros_grupos.id_rubro_grupo,
					tc_keet_rubros_grupos.id_rubro,
					tc_keet_rubros.codigo,
					tc_keet_rubros.nombre,
					tc_keet_rubros.orden
				) principal
				inner join
					tc_keet_materiales on principal.codigo = tc_keet_materiales.codigo
				where
					tc_keet_materiales.clave like '{clave}%'
				)final
			</select>
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
						tc_mantic_puestos.nombre puesto,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						'SUBCONTRATISTA' puesto,  
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_departamentos.id_departamento={idDepartamento}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>
			<select id="lotesContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_contratistas.id_empresa_persona={idFigura}
				and 
					{condicion}
			</select>
			<select id="lotesSubContratistas">
				select 
					tc_keet_contratos_lotes.id_contrato_lote id_key,
					tc_keet_contratos_lotes.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.clave clave_contrato,
					tc_keet_contratos.etapa etapa_contrato,
					tc_keet_proyectos.clave clave_proyecto,
					tc_keet_proyectos.etapa etapa_proyecto,
					tc_keet_contratos.orden orden_contrato,
					tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} and tc_keet_contratos_lotes_proveedores.id_proveedor={idFigura}
				and 
					{condicion}
			</select>						
		</unit>
		<unit id="VistaEntregaMaterialesDto">						
			<select id="resumen">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_vale_detalle AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_keet_vales_detalles.cantidad,
					tc_keet_vales_detalles.surtido,					
					tc_keet_vales_detalles.registro,
					tc_keet_vales_detalles.entregado,
					tc_keet_tipos_entregas.nombre tipo_entrega,
					if(tc_keet_vales_detalles.entregado is null, 'PENDIENTE', 'ENTREGADO') estatus,
					tc_mantic_unidades_medidas.nombre unidad_medida
				from 
					tc_keet_vales_detalles				
				inner join
					tc_keet_tipos_entregas ON tc_keet_vales_detalles.id_tipo_entrega = tc_keet_tipos_entregas.id_tipo_entrega
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale}) principal
				order by
					surtido desc
			</select>
			<select id="evidencia">
				select 
				  principal.*,					
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_desarrollo= {idDesarrollo})) stock
				from(
				select
					tc_keet_vales_detalles.id_articulo AS id_key,
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre unidad_medida,
					sum(tc_keet_vales_detalles.precio) precio,
					sum(tc_keet_vales_detalles.cantidad) cantidad,
					sum(tc_keet_vales_detalles.costo) costo,
					sum(tc_keet_vales_detalles.surtido) surtido      
				from
					tc_keet_vales_detalles
				inner join 
					tc_keet_vales_detalles_entrega on tc_keet_vales_detalles.id_vale_detalle = tc_keet_vales_detalles_entrega.id_vale_detalle
				inner join
					tc_mantic_articulos on tc_keet_vales_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where
					tc_keet_vales_detalles.id_vale= {idVale}
				and
				  tc_keet_vales_detalles.entregado is not null 
				and 
				  tc_keet_vales_detalles.id_tipo_entrega != 4
				and 
					tc_keet_vales_detalles_entrega.clave= '{clave}'
				group by					
					tc_keet_vales_detalles.id_vale, 					
					tc_keet_vales_detalles.id_articulo,
					tc_keet_vales_detalles.codigo,
					tc_keet_vales_detalles.nombre,
					tc_mantic_unidades_medidas.nombre) principal
			</select>
			<select id="especialidades">
				select 
					principal.*
				from (
				  select 
					  tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre 
					union
					select 
						tc_keet_departamentos.id_departamento as id_key,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo= {idDesarrollo}
					group by 
						tc_keet_departamentos.id_departamento,
						tc_keet_departamentos.descripcion, 
						tc_keet_departamentos.nombre ) principal
					group by
						id_key,
						nombre,
						descripcion
					order by 
						id_key
			</select>
			<select id="contratista">
				select 
					convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
					tc_keet_departamentos.id_departamento,
					tc_mantic_puestos.nombre puesto,
					1 tipo  
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				inner join 
					tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
				inner join 
					tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
				where 
					tr_mantic_empresa_personal.id_empresa_persona= {id}
			</select>
			<select id="subcontratista">
				select 
					convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
					tc_mantic_proveedores.razon_social nombre_completo,
					tc_keet_departamentos.id_departamento,
					'SUBCONTRATISTA' puesto,  
					2 tipo  
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				inner join 
					tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
				inner join 
					tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
				where 
					tc_mantic_proveedores.id_proveedor={id}
			</select>
			<select id="empleadosAsociados">
				select 
					principal.*
				from (
					select 
						convert(concat(9000,tr_mantic_empresa_personal.id_empresa_persona), unsigned integer) as id_key,
						concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo, 
						tc_keet_departamentos.id_departamento,
						tc_mantic_puestos.nombre puesto,
						1 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
					inner join 
						tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
					inner join 
						tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
					inner join 
						tc_mantic_puestos on tr_mantic_empresa_personal.id_puesto = tc_mantic_puestos.id_puesto
					inner join 
						tc_keet_departamentos on tr_mantic_empresa_personal.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
					union
					select 
						convert(concat(8000,tc_mantic_proveedores.id_proveedor), unsigned integer) as id_key,    
						tc_mantic_proveedores.razon_social nombre_completo,
						tc_keet_departamentos.id_departamento,
						'SUBCONTRATISTA' puesto,  
						2 tipo  
					from 
						tc_keet_proyectos
					inner join 
						tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
					inner join 
						tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
					inner join 
						tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
					inner join 
						tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
					inner join 
						tc_keet_proveedores_departamentos on tc_mantic_proveedores.id_proveedor = tc_keet_proveedores_departamentos.id_proveedor
					inner join 
						tc_keet_departamentos on tc_keet_proveedores_departamentos.id_departamento = tc_keet_departamentos.id_departamento
					where 
						tc_keet_proyectos.id_desarrollo={idDesarrollo}
				) principal
				group by
					id_key,
					nombre_completo,
					puesto,
					tipo
				order by 
					tipo, nombre_completo
			</select>							
			<select id="vales">
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo,
					1 figura,
					tr_mantic_empresa_personal.id_empresa_persona id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = tc_keet_vales.id_contrato_lote_contratista
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					{condicionContratista} and {condicion}
			union
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					tc_mantic_proveedores.razon_social nombre_completo,
					2 figura,
					tc_mantic_proveedores.id_proveedor id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = tc_keet_vales.id_contrato_lote_proveedor
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					{condicionSubcontratista} and {condicion}
			</select>						
			<select id="valesConsecutivo">
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ', tc_mantic_personas.materno) nombre_completo,
					1 figura,
					tr_mantic_empresa_personal.id_empresa_persona id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_contratistas on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_contratistas.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_contratistas.id_contrato_lote_contratista = tc_keet_vales.id_contrato_lote_contratista
				inner join 
					tr_mantic_empresa_personal on tc_keet_contratos_lotes_contratistas.id_empresa_persona=tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					tc_keet_vales.consecutivo like '%{consecutivo}' and {condicion}
			union
				select 
					tc_keet_vales.id_vale as id_key,
					tc_keet_vales.*,
					concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as descripcion_lote,
					tc_keet_contratos.id_contrato,
					tc_keet_contratos_lotes.id_contrato_lote,
					tc_keet_contratos.id_empresa,
					tc_mantic_proveedores.razon_social nombre_completo,
					2 figura,
					tc_mantic_proveedores.id_proveedor id_figura
				from 
					tc_keet_proyectos
				inner join 
					tc_keet_contratos on tc_keet_proyectos.id_proyecto = tc_keet_contratos.id_proyecto
				inner join 
					tc_keet_contratos_lotes on tc_keet_contratos.id_contrato = tc_keet_contratos_lotes.id_contrato
				inner join 
					tc_keet_contratos_lotes_proveedores on tc_keet_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes_proveedores.id_contrato_lote
				inner join 
					tc_keet_vales on tc_keet_contratos_lotes_proveedores.id_contrato_lote_proveedor = tc_keet_vales.id_contrato_lote_proveedor
				inner join 
					tc_mantic_proveedores on tc_keet_contratos_lotes_proveedores.id_proveedor = tc_mantic_proveedores.id_proveedor
				where 
					tc_keet_proyectos.id_desarrollo={idDesarrollo} 
				and 
					tc_keet_vales.consecutivo like '%{consecutivo}' and {condicion}
			</select>						
		</unit>
		<unit id="VistaCajaChicaDto">
			<select id="findDesarrollo">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				and 
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus in (1,2)
			</select>			
			<select id="findCajaChicaCierre">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= {idCajaChicaCierre}				
			</select>			
		</unit>
		<unit id="VistaGastosDto">
			<select id="importados">
				select
					tc_keet_gastos_archivos.id_gasto_archivo id_key,
					tc_keet_gastos_archivos.nombre,
					tc_keet_gastos_archivos.archivo,
					tc_keet_gastos_archivos.ruta,
					tc_keet_gastos_archivos.alias,
					tc_keet_gastos_archivos.registro,
					concat(tc_mantic_personas.nombres,' ',tc_mantic_personas.paterno,' ',tc_mantic_personas.materno) usuario,
					tc_keet_gastos_archivos.id_tipo_archivo,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.importe,
					tc_keet_gastos.articulos
				from
					tc_keet_gastos_archivos
				inner join 
					tc_janal_usuarios on tc_keet_gastos_archivos.id_usuario = tc_janal_usuarios.id_usuario
				inner join 
					tc_mantic_personas on tc_janal_usuarios.id_persona = tc_mantic_personas.id_persona
				inner join
					tc_keet_gastos on tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto
				where
				  tc_keet_gastos_archivos.id_gasto= {idGasto}
			</select>
			<select id="gastos">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.id_empresa,
					tc_keet_gastos.id_caja_chica_cierre,
					tc_keet_gastos.id_empresa_persona,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.ejercicio,
					tc_keet_gastos.orden,
					tc_keet_gastos.articulos,
					tc_keet_gastos.importe,
					tc_keet_gastos.id_abono,
					tc_keet_gastos.id_gasto_estatus,
					tc_keet_gastos.registro
				from
					tc_keet_gastos
				inner join
					tc_keet_gastos_detalles ON tc_keet_gastos.id_gasto = tc_keet_gastos_detalles.id_gasto
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChica}
				and 
					{condicion}
				group by 
					tc_keet_gastos.id_gasto,
					tc_keet_gastos.id_empresa,
					tc_keet_gastos.id_caja_chica_cierre,
					tc_keet_gastos.id_empresa_persona,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.ejercicio,
					tc_keet_gastos.orden,
					tc_keet_gastos.articulos,
					tc_keet_gastos.importe,
					tc_keet_gastos.id_abono,
					tc_keet_gastos.id_gasto_estatus,
					tc_keet_gastos.registro
				order by 
				  tc_keet_gastos.consecutivo desc
			</select>
			<select id="gastosConsecutivo">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.id_empresa,
					tc_keet_gastos.id_caja_chica_cierre,
					tc_keet_gastos.id_empresa_persona,
					tc_keet_gastos.consecutivo,
					tc_keet_gastos.ejercicio,
					tc_keet_gastos.orden,
					tc_keet_gastos.articulos,
					tc_keet_gastos.importe,
					tc_keet_gastos.id_abono,
					tc_keet_gastos.id_gasto_estatus,
					tc_keet_gastos.registro
				from 
					tc_keet_gastos				
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChica}
				and 
					tc_keet_gastos.consecutivo like '%{consecutivo}'				
			</select>
			<select id="conceptos">
				select 
					tc_keet_gastos_detalles.id_gasto_detalle as id_key,
					tc_keet_gastos_detalles.nombre,
					tc_keet_gastos_detalles.codigo,
					tc_keet_gastos_detalles.unidad_medida
				from 
					tc_keet_gastos_detalles				
				where 					
					upper(tc_keet_gastos_detalles.nombre) like upper('%{nombre}%')
			</select>
			<select id="cortes">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				order by 
					tc_keet_cajas_chicas_cierres.consecutivo desc
			</select>			
			<select id="findDesarrolloCajaChica">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_keet_cajas_chicas_cierres.id_caja_chica,
					tc_keet_cajas_chicas_cierres.consecutivo,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_cajas_chicas_cierres.orden,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.acumulado,
					tc_keet_cajas_chicas_cierres.saldo,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.termino,
					(select sum(importe) from tc_keet_gastos where tc_keet_gastos.id_caja_chica_cierre= tc_keet_cajas_chicas_cierres.id_caja_chica_cierre and id_gasto_estatus=1) pendiente
				from
					tc_keet_cajas_chicas
				inner join
					tc_keet_cajas_chicas_cierres on tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_cajas_chicas.id_desarrollo= {idDesarrollo}
				and 
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre= {idCajaChica}
			</select>	
		</unit>
		<unit id="VistaCierresCajasChicasDto">
			<select id="lazy">
				select
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre AS id_key,
					tc_mantic_empresas.nombre sucursal,
					tc_keet_desarrollos.id_desarrollo,
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_keet_cajas_chicas_cierres.ejercicio,
					tc_keet_nominas_periodos.orden semana,
					tc_keet_cajas_chicas_cierres.termino,
					tc_keet_cajas_chicas_cierres.registro,
					tc_keet_cajas_chicas_cierres.saldo inicial,
					tc_keet_cajas_chicas_cierres.acumulado gastado,
					tc_keet_cajas_chicas_cierres.disponible,
					tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus,
					tc_keet_cajas_chicas_cierres_estatus.nombre estatus
				from
					tc_keet_cajas_chicas_cierres
				inner join
					tc_keet_cajas_chicas ON tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				inner join
					tc_keet_nominas_periodos ON tc_keet_cajas_chicas_cierres.id_nomina_periodo = tc_keet_nominas_periodos.id_nomina_periodo
				inner join
					tc_keet_desarrollos ON tc_keet_cajas_chicas.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
				  tc_mantic_clientes on tc_keet_desarrollos.id_cliente = tc_mantic_clientes.id_cliente
				inner join 
					tc_mantic_empresas on tc_mantic_clientes.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tc_keet_cajas_chicas_cierres_estatus ON tc_keet_cajas_chicas_cierres.id_caja_chica_cierre_estatus = tc_keet_cajas_chicas_cierres_estatus.id_caja_chica_cierre_estatus
				where
					{condicion}
				{sortOrder}
			</select>
			<select id="gastos">
				select 
					tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.consecutivo, 
					tc_keet_gastos.importe,
					tc_keet_gastos.articulos,
					tc_keet_gastos.registro,
					tc_keet_gastos.revisado,
					concat(tc_mantic_personas.nombres, ' ',if(tc_mantic_personas.paterno is null, '', tc_mantic_personas.paterno), ' ', if(tc_mantic_personas.materno is null, '', tc_mantic_personas.materno)) residente,
					tc_keet_gastos_estatus.nombre estatus,
					tc_keet_gastos_estatus.id_gasto_estatus,
					if(tc_keet_gastos.id_abono= 1, 'SI', 'NO') abono,
					tc_keet_cajas_chicas.id_desarrollo,
					ifnull((select concat(ruta, archivo) imagen from tc_keet_gastos_archivos where tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto limit 1), '') ruta,
					concat('{pathImage}', ifnull((select concat(ruta, archivo) imagen from tc_keet_gastos_archivos where tc_keet_gastos_archivos.id_gasto = tc_keet_gastos.id_gasto limit 1), '')) imagen
				from 
					tc_keet_gastos
				inner join 
					tr_mantic_empresa_personal on tc_keet_gastos.id_empresa_persona = tr_mantic_empresa_personal.id_empresa_persona
				inner join 
					tc_mantic_personas on tr_mantic_empresa_personal.id_persona = tc_mantic_personas.id_persona
				inner join 
					tc_keet_gastos_estatus on tc_keet_gastos.id_gasto_estatus = tc_keet_gastos_estatus.id_gasto_estatus
				inner join 
				  tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre = tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
				inner join
					tc_keet_cajas_chicas ON tc_keet_cajas_chicas.id_caja_chica = tc_keet_cajas_chicas_cierres.id_caja_chica
				where 
					tc_keet_gastos.id_caja_chica_cierre= {idCajaChicaCierre}
				order by 
				  tc_keet_gastos.consecutivo desc
			</select>			
		</unit>
		<unit id="VistaGastosDetallesDto">
			<select id="detalle">
				select
					tc_keet_gastos_detalles.id_gasto_detalle as id_key,
					tc_keet_gastos_detalles.id_gasto_detalle as id_comodin,
          tc_keet_gastos_detalles.*,
          tc_keet_gastos_detalles.cantidad as cuantos,
          tc_keet_gastos_detalles.cantidad as inicial,
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
					tc_mantic_articulos.menudeo
				from 
					tc_keet_gastos_detalles
				inner join
					tc_mantic_articulos on tc_keet_gastos_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where  
					tc_keet_gastos_detalles.id_gasto= {idGasto}
				order by
					tc_keet_gastos_detalles.registro
			</select>
			<select id="porNombre">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_almacen= {idAlmacen})) stock
				from(
				select 
				  tc_mantic_articulos.id_articulo as id_key,
				  tc_mantic_articulos.id_articulo,
					tc_mantic_articulos.id_articulo as id_comodin,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1 and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and (upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*' or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  '   ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
				  tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,		
				  concat(tc_mantic_articulos.id_empresa, '/', ifnull(tc_mantic_imagenes.archivo, 'sin-foto.png')) as archivo
				from 
					tc_mantic_articulos
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				left join
				  tc_mantic_imagenes on tc_mantic_articulos.id_imagen= tc_mantic_imagenes.id_imagen
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and tc_mantic_articulos.id_articulo_tipo= 1
				  and tc_mantic_articulos.id_vigente= 1
				  and 
				  (
				    upper(tc_mantic_articulos.nombre) regexp '.*{codigo}.*'
				  or
				    tc_mantic_articulos.id_articulo= {idArticulo}
				  )) principal 			
				order by 
				  nombre				
			</select>
			<select id="porCodigo">
				select 
					principal.*,
					(select if(sum(stock) is null, 0, sum(stock)) from tc_mantic_almacenes_articulos where id_articulo= principal.id_articulo and id_almacen in (select id_almacen from tc_mantic_almacenes where id_almacen= {idAlmacen})) stock
				from(
				select 
				  tc_mantic_articulos_codigos.id_articulo_codigo as id_key,
				  tc_mantic_articulos.id_articulo,
				  tc_mantic_articulos.id_articulo as id_comodin,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
				  (select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and (tc_mantic_articulos_codigos.id_proveedor= {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1) and ((upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and (tc_mantic_articulos_codigos.id_proveedor = {idProveedor} and tc_mantic_articulos_codigos.id_principal> 1)) or tc_mantic_articulos.id_articulo= {idArticulo})) as codigo,
				  tc_mantic_articulos.nombre,
				  ' ' as origen,
				  tc_mantic_articulos.descripcion,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.precio as original,
				  tc_mantic_articulos.menudeo,
				  tc_mantic_articulos.medio_mayoreo,
				  tc_mantic_articulos.mayoreo,
					tc_mantic_articulos.sat,
				  tc_mantic_articulos.limite_medio_mayoreo,
				  tc_mantic_articulos.limite_mayoreo,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear,
				  tc_mantic_unidades_medidas.nombre unidad_medida,
				  ifnull(tc_mantic_articulos.extra, '0') as morado,
				  concat(ifnull(tc_mantic_articulos.descuento, '0'), ',', ifnull(tc_mantic_articulos.extra, '0')) as porcentajes,
				  concat(tc_mantic_articulos.id_empresa, '/', ifnull(tc_mantic_imagenes.archivo, 'sin-foto.png')) as archivo
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa								
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				left join
				  tc_mantic_imagenes on tc_mantic_articulos.id_imagen= tc_mantic_imagenes.id_imagen
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and tc_mantic_articulos.id_articulo_tipo= 1
				  and tc_mantic_articulos.id_vigente= 1
				  and (
				      (upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and tc_mantic_articulos_codigos.id_proveedor is null)
				    or
				      (upper(tc_mantic_articulos_codigos.codigo) like '{codigo}%' and tc_mantic_articulos_codigos.id_proveedor = {idProveedor})
			      or	
				      tc_mantic_articulos.id_articulo= {idArticulo}
				   )) principal 			
				order by 
				  propio
			</select>
		</unit>
		<unit id="VistaRequisicionesDesarrolloDto">
			<select id="generales">
				select
					tc_mantic_requisiciones.id_requisicion as id_key,
					tc_mantic_requisiciones.consecutivo,
					tc_keet_desarrollos.nombres as desarrollo,
					tc_mantic_clientes.razon_social as cliente,
					tc_keet_contratos.clave as contrato,
					tc_keet_contratos.etapa,
					tc_keet_prototipos.nombre as prototipo,
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_requisiciones.registro
				from
					tc_mantic_requisiciones
				inner join
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join
					tc_keet_desarrollos on tc_mantic_requisiciones.id_desarrollo= tc_keet_desarrollos.id_desarrollo
				inner join
					tc_mantic_clientes on tc_keet_desarrollos.id_cliente= tc_mantic_clientes.id_cliente
				inner join
					tc_keet_contratos on tc_mantic_requisiciones.id_contrato= tc_keet_contratos.id_contrato
				inner join
					tc_keet_prototipos on tc_mantic_requisiciones.id_prototipo= tc_keet_prototipos.id_prototipo
				where
					tc_mantic_requisiciones.id_requisicion= {idRequisicion}  				
			</select>
			<select id="comparativo">
        select
					tc_mantic_requisiciones_detalles.id_requisicion_detalle as id_key,
					tc_mantic_proveedores.razon_social,
					tc_mantic_requisiciones.consecutivo,  															
					tc_mantic_requisiciones_detalles.codigo,
					tc_mantic_requisiciones_detalles.propio,
					tc_mantic_requisiciones_detalles.nombre,
					tc_mantic_requisiciones_detalles.cantidad,
					tc_mantic_requisiciones_detalles.costo,
					tc_mantic_requisiciones_detalles.iva,
					tc_mantic_requisiciones_detalles.sub_total,
					tc_mantic_requisiciones_detalles.importe,
					tc_mantic_articulos.precio as ultima_compra,
					ifnull(tc_keet_articulos_proveedores.precio_base, 0) as precio_base,
					ifnull(tc_keet_articulos_proveedores.precio_lista, 0) as precio_lista,
					ifnull(tc_keet_articulos_proveedores.precio_especial, 0) as precio_especial,
					if(tc_keet_articulos_proveedores.precio_base is null, 0, tc_mantic_requisiciones_detalles.importe* 100/ tc_keet_articulos_proveedores.precio_base) as porcentaje,
					tc_keet_articulos_proveedores.actualizado,
					ifnull(tr_keet_articulo_proveedor_cliente.precio_convenio, 0) as precio_convenio
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_articulos on tc_mantic_requisiciones_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
			  left join
			    tc_keet_articulos_proveedores on tc_keet_articulos_proveedores.id_articulo = tc_mantic_articulos.id_articulo
			  left join
			    tr_keet_articulo_proveedor_cliente on tc_mantic_requisiciones_detalles.id_articulo = tr_keet_articulo_proveedor_cliente.id_articulo
				where
				  tc_mantic_requisiciones.id_requisicion= {idRequisicion}
				order by
				  tc_mantic_requisiciones_detalles.nombre 
			</select>					
			<select id="exportar">
        select
					tc_mantic_requisiciones_detalles.id_requisicion_detalle as id_key,
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_requisiciones.consecutivo,  															
					tc_mantic_requisiciones_detalles.codigo as "codigo proveedor",
					tc_mantic_requisiciones_detalles.propio as codigo,
					tc_mantic_requisiciones_detalles.nombre,
					tc_mantic_requisiciones_detalles.cantidad,
					tc_mantic_requisiciones_detalles.costo,
					tc_mantic_requisiciones_detalles.iva,
					tc_mantic_requisiciones_detalles.sub_total,
					tc_mantic_requisiciones_detalles.importe as precio
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
				where
				  tc_mantic_requisiciones.id_requisicion= {idRequisicion}
				order by
				  tc_mantic_requisiciones_detalles.nombre  				
			</select>
			<select id="lazy">
        select
					tc_mantic_requisiciones.id_requisicion as id_key,
					tc_mantic_requisiciones.id_empresa,  
					tc_mantic_requisiciones.id_enviar,  
				  tc_mantic_empresas.clave as empresa,  
				  tc_mantic_empresas.nombre as nombre_empresa,  
					tc_mantic_requisiciones.consecutivo,  															
				  tc_mantic_requisiciones_estatus.nombre as estatus,
					tc_mantic_requisiciones.id_requisicion_estatus,
					tc_mantic_requisiciones.registro,
					tc_mantic_requisiciones.observaciones,
					tc_mantic_requisiciones.fecha_pedido,
					tc_mantic_requisiciones.fecha_entregada,
					tc_mantic_requisiciones_estatus.estatus_asociados, 					
					tc_mantic_personas.cuenta,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre,
					tc_keet_desarrollos.clave clave_desarrollo,
					tc_keet_desarrollos.nombres nombre_desarrollo,
					tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.razon_social proveedor
				from 
					tc_mantic_requisiciones				
				inner join 
					tc_mantic_empresas on tc_mantic_requisiciones.id_empresa= tc_mantic_empresas.id_empresa
				inner join 
					tc_mantic_requisiciones_estatus on tc_mantic_requisiciones.id_requisicion_estatus=tc_mantic_requisiciones_estatus.id_requisicion_estatus				
				inner join				
					tc_mantic_personas on tc_mantic_personas.id_persona = tc_mantic_requisiciones.id_solicita
				inner join 
					tc_keet_desarrollos on tc_mantic_requisiciones.id_desarrollo = tc_keet_desarrollos.id_desarrollo
				inner join 
					tc_mantic_requisiciones_detalles on tc_mantic_requisiciones.id_requisicion = tc_mantic_requisiciones_detalles.id_requisicion
				inner join 
					tc_mantic_proveedores on tc_mantic_requisiciones.id_proveedor = tc_mantic_proveedores.id_proveedor
				where
					{condicion}
				group by 
				  tc_mantic_requisiciones.id_requisicion,
					tc_mantic_requisiciones.id_empresa,  
					tc_mantic_requisiciones.id_enviar,  
				  tc_mantic_empresas.clave,  
				  tc_mantic_empresas.nombre,  
					tc_mantic_requisiciones.consecutivo,  															
				  tc_mantic_requisiciones_estatus.nombre,
					tc_mantic_requisiciones.id_requisicion_estatus,
					tc_mantic_requisiciones.registro,
					tc_mantic_requisiciones.observaciones,
					tc_mantic_requisiciones.fecha_pedido,
					tc_mantic_requisiciones.fecha_entregada,
					tc_mantic_requisiciones_estatus.estatus_asociados, 					
					tc_mantic_personas.cuenta,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno),
					tc_keet_desarrollos.clave,
					tc_keet_desarrollos.nombres,
					tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.razon_social
				{sortOrder}
			</select>
			<select id="preciosArticulo">
				select
					tc_mantic_articulos.id_articulo AS id_key,
					tc_mantic_articulos.nombre,
					tc_mantic_articulos.precio precio_compra,
					ifnull(tr_keet_articulo_proveedor_cliente.precio_convenio, 0) precio_convenio,
					ifnull(tc_keet_articulos_proveedores.precio_base, 0) precio_base,
					ifnull(tc_keet_articulos_proveedores.precio_lista, 0) precio_lista,
					ifnull(tc_keet_articulos_proveedores.precio_especial, 0) precio_especial,
					ifnull(presupuesto.presupuesto, 0) precio_presupuesto
				from
					tc_mantic_articulos
				left join 
				  (								
						select						        						
							tc_keet_materiales.codigo,
							(tc_keet_materiales.costo / tc_keet_materiales.cantidad) presupuesto						
						from
							tc_keet_materiales
						inner join 
							tc_mantic_articulos on tc_keet_materiales.codigo = tc_mantic_articulos.codigo
						inner join
							tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida
						inner join 
							tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
						inner join 
							tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
						where
							tc_keet_materiales.clave like '{clave}%'				
						and 
							tc_keet_materiales.nivel=7					
						group by 
							tc_keet_materiales.codigo,
							(tc_keet_materiales.costo / tc_keet_materiales.cantidad) 
					) presupuesto on presupuesto.codigo = tc_mantic_articulos.codigo
				left join
					tr_keet_articulo_proveedor_cliente on tc_mantic_articulos.id_articulo = tr_keet_articulo_proveedor_cliente.id_articulo and tr_keet_articulo_proveedor_cliente.id_proveedor= {idProveedor}
				left join
					tc_keet_articulos_proveedores on tc_mantic_articulos.id_articulo = tc_keet_articulos_proveedores.id_articulo and tc_keet_articulos_proveedores.id_proveedor= {idProveedor}
				where
					tc_mantic_articulos.id_articulo = {idArticulo}
			</select>
		</unit>
		<unit id="VistaTcKeetGastosDto">
			<select id="row">
				select      
          tc_keet_gastos.id_gasto as id_key,
					tc_keet_gastos.*,
					tc_keet_cajas_chicas_cierres.id_caja_chica
        from      
          tc_keet_gastos
				inner join 
					tc_keet_cajas_chicas_cierres on tc_keet_gastos.id_caja_chica_cierre = tc_keet_cajas_chicas_cierres.id_caja_chica_cierre
        where 
          {condicion} 
			</select>
		</unit>
		<unit id="VistaFamiliasProveedoresDto">
			<select id="lazy">
        select      
          tc_keet_ordenes_contratos_lotes.id_orden_contrato_lote as id_key,
          tc_mantic_ordenes_compras.consecutivo,
          tc_mantic_ordenes_compras.total,
          tc_mantic_proveedores.razon_social as proveedor,
          tc_keet_contratos.clave as contrato,
          tc_keet_contratos.etapa,
          tc_keet_contratos.no_viviendas,
          concat('M', tc_keet_contratos_lotes.manzana, 'L', tc_keet_contratos_lotes.lote) as lote,
          tc_keet_contratos_lotes.clave,
          tc_keet_familias.nombre as familia,
          concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) usuario,  
          tc_keet_ordenes_contratos_lotes.registro
        from      
          tc_keet_ordenes_contratos_lotes
        inner join
          tc_mantic_ordenes_compras on tc_keet_ordenes_contratos_lotes.id_orden_compra= tc_mantic_ordenes_compras.id_orden_compra
        inner join
          tc_mantic_proveedores on tc_mantic_ordenes_compras.id_proveedor= tc_mantic_proveedores.id_proveedor
        inner join
          tc_keet_contratos_lotes on tc_keet_ordenes_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
        inner join
          tc_keet_familias on tc_keet_ordenes_contratos_lotes.id_familia = tc_keet_familias.id_familia
        inner join
          tc_janal_usuarios on tc_keet_ordenes_contratos_lotes.id_usuario= tc_janal_usuarios.id_usuario
        inner join
          tc_mantic_personas on tc_mantic_personas.id_persona= tc_janal_usuarios.id_persona
        where      
          tc_keet_contratos.id_contrato = {idContrato}
        order by
           lote, tc_keet_familias.nombre 
      </select>
      <select id="existe">
        select      
          tc_keet_ordenes_contratos_lotes.id_orden_contrato_lote as id_key
        from      
          tc_keet_ordenes_contratos_lotes
        inner join
          tc_keet_contratos_lotes on tc_keet_ordenes_contratos_lotes.id_contrato_lote = tc_keet_contratos_lotes.id_contrato_lote
        inner join
          tc_keet_contratos on tc_keet_contratos_lotes.id_contrato = tc_keet_contratos.id_contrato
        where      
          tc_keet_contratos.id_contrato = {idContrato}
          and tc_keet_ordenes_contratos_lotes.id_familia= {idFamilia}
          and tc_keet_ordenes_contratos_lotes.id_contrato_lote= {idContratoLote}
      </select>
			<select id="row">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
      </select>
			<select id="disponibles">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
				and 
					tc_keet_familias.id_familia not in (select id_familia from tc_keet_ordenes_contratos_lotes where id_contrato_lote in ({contratosLotes}))
      </select>
			<select id="byOrdenCompra">
        select      
          tc_keet_familias.id_familia as id_key,
					tc_keet_familias.*
        from  
					tc_keet_proveedores_familias
				inner join
          tc_keet_familias on tc_keet_proveedores_familias.id_familia = tc_keet_familias.id_familia
        where 
          tc_keet_proveedores_familias.id_proveedor= {idProveedor}
				and 
					tc_keet_familias.id_familia in (select id_familia from tc_keet_ordenes_contratos_lotes where id_orden_compra = {idOrdenCompra})
      </select>
		</unit>
	</dml>    
</process>
