<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
 company KAANA
 project KAJOOL (Control system polls)
 date 05/04/2021
 time 11:30:04 AM
 author Team Developer 2016 <team.developer@kaana.org.mx>
-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                template="/WEB-INF/plantillas/filtro.xhtml">
  <ui:param name="titulo" value="Seguimiento al avance de los contratos" />
  <ui:define name="librerias">
		<script src="https://maps.google.com/maps/api/js?key=AIzaSyBT_SYV5r3kJdT_bO0ijJmNjxqZqhb7xNY" type="text/javascript"></script>
    <h:outputScript library="janal" name="core/jquery.underscore.min-1.3.3.js"/>
		<h:outputScript library="janal" name="echarts/echarts.min-4.2.2.js"/>
		<h:outputScript library="janal" name="echarts/resize-sensor-0.0.1.js"/>
    <h:outputScript library="janal" name="#{kajoolUtilAplicacion.libraryEchart}"/>
    <script type="text/javascript">
			Janal.Control.Echarts.names= {
				items    : {json: {hoy: '#{kajoolContratos.attrs.hoy}', nombreDesarrollo: '#{kajoolContratos.attrs.nombreDesarrollo}', nombreContrato: '#{kajoolContratos.attrs.nombreContrato}'}},
				contratos: {json: #{kajoolContratos.attrs.contratos}},
				lotes    : {json: #{kajoolContratos.attrs.lotes}}
			};
			$(function() {
				 'use strict'			
				 new ResizeSensor($('.dashboard'), function() { jsEcharts.responsive(); });				
			 });
       
       $(document).ready(function () {
         setTimeout("$('#keet-main-header').attr('height', 'inset: 100px;');", 2000);
       });  
       
       function onOffSwitchTable(type, active) {
         if(active) {
           $('#keet-switch-chart-'+ type).removeClass('Container100').addClass('Container50');
           $('#keet-switch-list-'+ type).removeClass('keet-item-hide');
         } // ir
         else {
           $('#keet-switch-chart-'+ type).removeClass('Container50').addClass('Container100');
           $('#keet-switch-list-'+ type).addClass('keet-item-hide');
         } // else  
         jsEcharts.responsive();
       }
    </script>		
    <style type="text/css">
      .keet-chart-title {
        font-weight: normal !important;
        font-size: 16px;
      }
      .keet-chart-footer {
        font-weight: normal !important;
        font-size: 12px;
      }
			.panel-pencil-position {				
				vertical-align: bottom !important					
			}			
      .keet-map-panel { width:100%; height: 390px; display:block; padding-top: 20px;}
      .dashboard .overview-map-box { height: 423px; padding: 0px !important; border: transparent; }  
    </style>
  </ui:define>
  <ui:define name="contenido">
		<pe:remoteCommand name="refreshEChartSingle" process="@this" actionListener="#{kajoolContratos.doRefreshEChartSingle}" oncomplete="janal.desbloquear();">  
			<pe:methodSignature parameters="java.lang.String, java.lang.String"/>  
			<pe:methodParam name="id"/>  
			<pe:methodParam name="group"/>  
		</pe:remoteCommand>
		<pe:remoteCommand name="refreshEChartFrame" process="@this" actionListener="#{kajoolContratos.doRefreshEChartWith}" oncomplete="janal.desbloquear();">  
      <pe:methodSignature parameters="mx.org.kaana.libs.echarts.json.ItemSelected" />  
      <pe:methodParam name="itemSelected">  
        <pe:convertJson />  
      </pe:methodParam>  			
		</pe:remoteCommand>    
    <div class="Container100 dashboard">
      <div class="ContainerIndent">        					
        <div class="Container100 Responsive overview-box">
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <div class="Container100 Responsive Fs18 janal-box-header-blue">
                <i class="fa fa-slack janal-color-blue"></i><p:spacer width="8px" height="1px"/>Información con corte al día de <span id="hoy"/>
              </div>
            </div>
          </div>
        </div>  
      </div>  
      <div class="ContainerIndent">        					
        <div class="Container30 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-city Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Desarrollos disponibles
                </div>
                <p:dataTable lazy="false" id="tabla" var="row" widgetVar="kajoolTable" rowIndexVar="index" value="#{kajoolContratos.desarrollos}" paginator="#{kajoolContratos.desarrollos.size() gt 5}" rowsPerPageTemplate="5" paginatorTemplate="#{Constantes.ICONOS_DE_PAGINA_TABLERO}" emptyMessage="#{Constantes.NO_EXISTEN_REGISTROS}" rows="5" styleClass="janal-content-table" selectionMode="single" selection="#{kajoolContratos.desarrollo}" reflow="true" paginatorPosition="bottom" rowKey="#{row.idKey}">
                  <p:ajax event="rowSelect" process="@this tabla" listener="#{kajoolContratos.doUpdateDesarrolloSelect}" onstart="return janal.bloquear();" oncomplete="janal.desbloquear();"/>
                  <p:ajax event="rowUnselect" process="@this tabla" listener="#{kajoolContratos.doUpdateDesarrolloUnSelect}" onstart="return janal.bloquear();" oncomplete="janal.desbloquear();"/>
                  <p:column styleClass="janal-column-left Responsive">
                    <f:facet name="header">
                      <h:outputText value="Desarrollo"/>
                    </f:facet>
                    <h:outputText value="#{row.nombre}"/>
                  </p:column>                    
                  <p:column styleClass="janal-column-right janal-wid-20 Responsive" >
                    <f:facet name="header">
                      <h:outputText value="Empleados"/>
                    </f:facet>
                    <h:outputText value="#{row.empleados}"/>
                  </p:column>                    
                  <f:facet name="footer">
                    <p:outputLabel value="Total [#{kajoolContratos.desarrollos.size()}] registros"/>
                  </f:facet>
                </p:dataTable>                
              </p:panel>  
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="">.</span>
              </div>   
            </div>
          </div>  
        </div>  
        <div class="Container70 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-file-invoice-dollar Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Contratos por desarrollo
                </div>
                <div class="keet-chart-panel">
                  <div id="contratos" class="keet-chart-panel">
                    Cargando gráficas contratos por desarrollo
                  </div>	
               </div>	              
              </p:panel>						
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="nombreDesarrollo"/>
              </div>   
            </div>
          </div>
        </div>  
      </div>  
      <div class="ContainerIndent">        					
        <div id="keet-switch-chart-lotes" class="Container100 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-cyan">
                  <i class="fa fa-laptop-house Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Lotes del contrato con sus conceptos terminados
                </div>
                <div class="keet-chart-panel">
                  <div id="lotes" class="keet-chart-panel">
                    Cargando gráficas de los lotes del contrato
                  </div>	
                </div>	              
              </p:panel>						
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="nombreContrato"/>
              </div>   
            </div>
          </div>
        </div>  
        <div id="keet-switch-list-lotes" class="Container50 Responsive overview-box keet-item-hide">
          <div class="ContainerIndent card">
            <p:panel styleClass="overview-inner-box">
              <div class="Container100 Responsive keet-chart-title janal-box-title-cyan">
                <i class="fa fa-address-book Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Detalle del lote<i class="fa fa-times-circle Fs16 janal-color-white janal-close-header" onclick="onOffSwitchTable('lotes', false);"></i>
              </div>
              <p:dataTable lazy="true" id="tablaDetalleLotes" var="row" widgetVar="kajoolTableLote" rowIndexVar="index" value="#{kajoolContratos.attrs.tablaDetalleLotes}" paginator="#{kajoolContratos.attrs.tablaDetalleLotes.size() gt 6}" rowsPerPageTemplate="6" paginatorTemplate="#{Constantes.ICONOS_DE_PAGINA_TABLERO}" emptyMessage="#{Constantes.NO_EXISTEN_REGISTROS}" rows="6" styleClass="janal-content-table" reflow="true" paginatorPosition="bottom" rowKey="#{row.idKey}">
                <p:column styleClass="janal-wid-15 janal-column-left Responsive">
                  <f:facet name="header">
                    <h:outputText value="Código"/>
                  </f:facet>
                  <h:outputText value="#{row.codigo}"/>
                </p:column>
                <p:column styleClass="Responsive" >
                  <f:facet name="header">
                    <h:outputText value="Concepto"/>
                  </f:facet>
                  <h:outputText value="#{row.descripcion}"/>
                </p:column>
                <p:column styleClass="janal-wid-18 Responsive" >
                  <f:facet name="header">
                    <h:outputText value="Estatus"/>
                  </f:facet>
                  <h:outputText value="#{row.estatus}"/>
                </p:column>                    
                <f:facet name="footer">
                  <p:outputLabel value="Total [#{kajoolContratos.attrs.tablaDetalleLotes.size()}] registros"/>
                </f:facet>
              </p:dataTable>                
            </p:panel>
            <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
              <span id="nombreLotes"/>
            </div>   
          </div>
        </div>  
      </div>  
      <div class="ContainerIndent">        					
        <div class="Container100 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-map-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-laptop-house Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Estatus de los lote(s) con su georreferencia
                </div>
                <div class="keet-map-panel">
                  <p:gmap id="mapa" widgetVar="wMapa" model="#{kajoolContratos.model}" center="#{kajoolContratos.attrs.coordenadaCentral}" zoom="75" type="TERRAIN" style="width:100%;height:500px" streetView="true">
                    <p:ajax event="overlaySelect" listener="#{kajoolContratos.onMarkerSelect}"/>
                  </p:gmap>						
                </div>  
              </p:panel>
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="nombreContrato"/>
              </div>   
            </div>
          </div>
        </div>  
      </div>
    </div>		
  </ui:define>
</ui:composition>
