<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
 company KAANA
 project KAJOOL (Control system polls)
 date 05/04/2021
 time 11:30:04 AM
 author Team Developer 2016 <team.developer@kaana.org.mx>
-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                template="/WEB-INF/plantillas/filtro.xhtml">
  <ui:param name="titulo" value="Resumen de estimación de obra" />
  <ui:define name="librerias">
		<script src="https://maps.google.com/maps/api/js?key=AIzaSyBT_SYV5r3kJdT_bO0ijJmNjxqZqhb7xNY" type="text/javascript"></script>
    <h:outputScript library="janal" name="core/jquery.underscore.min-1.3.3.js"/>
		<h:outputScript library="janal" name="echarts/echarts.min-4.2.2.js"/>
		<h:outputScript library="janal" name="echarts/resize-sensor-0.0.1.js"/>
    <h:outputScript library="janal" name="#{kajoolUtilAplicacion.libraryEchart}"/>
    <script type="text/javascript">
			Janal.Control.Echarts.names= {
				items    : {json: {hoy: '#{kajoolResumen.attrs.hoy}', contrato: '#{kajoolResumen.attrs.idContrato.nombre}-#{kajoolResumen.attrs.idContrato.etapa}'}},
				confronta: {json: #{kajoolResumen.attrs.confronta}}
			};
			$(function() {
				 'use strict'			
				 new ResizeSensor($('.dashboard'), function() { jsEcharts.responsive(); });				
			 });
       
       $(document).ready(function () {
         setTimeout("$('#keet-main-header').attr('height', 'inset: 100px;');", 2000);
       });  
       
       function onOffSwitchTable(type, active) {
         if(active) {
           $('#keet-switch-chart-'+ type).removeClass('Container100').addClass(type==='mapas'? 'Container80': 'Container50');
           $('#keet-switch-list-'+ type+ ", div.avance-lote").removeClass('keet-item-hide');
         } // ir
         else {
           $('#keet-switch-chart-'+ type).removeClass(type==='mapas'? 'Container80': 'Container50').addClass('Container100');
           $('#keet-switch-list-'+ type+ ', div.avance-lote').addClass('keet-item-hide');
         } // else  
         jsEcharts.responsive();
       }
    </script>		
    <style type="text/css">
      .keet-chart-title { font-weight: normal !important; font-size: 16px; }
      .keet-chart-footer { font-weight: normal !important; font-size: 12px; }
			.panel-pencil-position { vertical-align: bottom !important }			
      .dashboard .keet-map-panel { width:100%; height: 390px; display:block; padding-top: 20px;}
      .dashboard .overview-map-box { height: 423px; padding: 0px !important; border: transparent; }  
      .dashboard .keet-gauge-panel { width:100%; height: 40px; display:block; padding-top: 20px;}
      .dashboard .overview-gauge-box { height: 53px; padding: 0px !important; border: transparent; }  
      .ui-carousel .ui-carousel-header .ui-carousel-header-title {width: 70% !important;}
    </style>
  </ui:define>
  <ui:define name="contenido">
		<pe:remoteCommand name="refreshEChartSingle" process="@this" actionListener="#{kajoolResumen.doRefreshEChartSingle}" oncomplete="janal.desbloquear();">  
			<pe:methodSignature parameters="java.lang.String, java.lang.String"/>  
			<pe:methodParam name="id"/>  
			<pe:methodParam name="group"/>  
		</pe:remoteCommand>
    <pe:remoteCommand name="refreshEChartFrame" process="@this" actionListener="#{kajoolResumen.doRefreshEChartWith}" oncomplete="janal.desbloquear();">  
      <pe:methodSignature parameters="mx.org.kaana.libs.echarts.json.ItemSelected" />  
      <pe:methodParam name="itemSelected">  
        <pe:convertJson />  
      </pe:methodParam>  			
		</pe:remoteCommand>    
   <div class="Container100 dashboard">
      <div class="ContainerIndent">        					
        <div class="Container50 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-city Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Datos del contrato
                </div>
                <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                  <p:outputLabel for="idEmpresa" value="Empresa:" rendered="#{kajoolResumen.attrs.isMatriz}"/>
                  <p:selectOneMenu id="idEmpresa" value="#{kajoolResumen.attrs.idEmpresa}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-100-txt" rendered="#{sessionScope.autentifica.empresa.matriz}" effect="fade" filter="true" filterMatchMode="custom" filterFunction="janal.contains">
                    <p:ajax event="change" listener="#{kajoolResumen.doLoadDesarrollos}" process="@this" update="idDesarrollo idContrato" oncomplete="reloadDesarrollos(); reloadContratos();"/>
                    <f:selectItems value="#{kajoolResumen.attrs.empresas}" var="element" itemValue="#{element}" itemLabel="#{element.clave} #{empty element.nombre or element.nombre eq ''? '': '|'} #{element.nombre}"/>
                    <p:column headerText="Clave">
                      <h:outputText value="#{item.clave}"/>
                    </p:column>
                    <p:column headerText="Nombre">
                      <h:outputText value="#{item.nombre}"/>
                    </p:column>
                  </p:selectOneMenu>
                  <p:outputLabel for="idDesarrollo" value="Obra:"/>
                  <p:selectOneMenu id="idDesarrollo" value="#{kajoolResumen.attrs.idDesarrollo}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-100-txt" effect="fade" filter="true" filterMatchMode="custom" filterFunction="janal.contains">
                    <p:ajax event="change" listener="#{kajoolResumen.doLoadContratos}" update="idContrato" process="@this" onstart="return janal.bloquear();" oncomplete="janal.desbloquear(); reloadContratos();"/>
                    <f:selectItems value="#{kajoolResumen.attrs.desarrollos}" var="element" itemValue="#{element}" itemLabel="#{element.clave} #{empty element.nombres or element.nombres eq ''? '': '|'} #{element.nombres}"/>
                    <p:column headerText="Clave">
                      <h:outputText value="#{item.clave}"/>
                    </p:column> 
                    <p:column headerText="Nombre">
                      <h:outputText value="#{item.nombres}"/>
                    </p:column> 
                  </p:selectOneMenu>	
                  <p:outputLabel for="idContrato" value="Contrato:"/>
                  <p:selectOneMenu id="idContrato" value="#{kajoolResumen.attrs.idContrato}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-100-txt" effect="fade" filter="true" filterMatchMode="custom" filterFunction="janal.contains">
                    <p:ajax event="change" listener="#{kajoolResumen.doLoadData}" process="@this" update="@this" oncomplete="janal.desbloquear()"/>
                    <f:selectItems value="#{kajoolResumen.attrs.contratos}" var="one" itemValue="#{one}" itemLabel="#{one.clave} #{empty one.nombre or one.nombre eq ''? '': '|'} #{one.nombre} #{empty one.etapa or one.etapa eq ''? '': '|'} #{one.etapa}"/>
                    <p:column headerText="Clave">
                      <h:outputText value="#{item.clave}"/>
                    </p:column>   
                    <p:column headerText="Nombre">
                      <h:outputText value="#{item.nombre}"/>
                    </p:column>   
                    <p:column headerText="Etapa">
                      <h:outputText value="#{item.etapa}"/>
                    </p:column>   
                  </p:selectOneMenu>
                  <p:panelGrid columns="2" styleClass="janal-wid-100">
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="Nombre:"/>
                      <p:inputText value="#{kajoolResumen.attrs.idContrato.nombre}" styleClass="janal-wid-90 contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="No. viviendas:"/>
                      <p:inputText value="#{kajoolResumen.attrs.idContrato.noViviendas} viviendas" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:inputText value="Cliente: #{kajoolResumen.attrs.idContrato.razonSocial}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                </p:panelGrid>
              </p:panel>  
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="."/>
                <p:remoteCommand name="reloadDesarrollos" process="@this" update="idDesarrollo @(.contrato)"/>
                <p:remoteCommand name="reloadContratos" process="@this" update="idContrato @(.contrato)"/>
              </div>   
            </div>
          </div>  
        </div>  
        <div class="Container50 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-city Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Montos del contrato
                </div>
                <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                  <p:outputLabel value="Contratado:"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.idContrato.costo}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-80, janal-wid-20">
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="(-) Anticipo:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.idContrato.anticipo}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="."/>
                      <p:inputText value="#{kajoolResumen.attrs.idContrato.porcentajeAnticipo}%" styleClass="janal-column-center janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-80, janal-wid-20">
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="Fondo garantía:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.idContrato.fondoGarantia}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="."/>
                      <p:inputText value="#{kajoolResumen.attrs.idContrato.porcentajeFondo}%" styleClass="janal-color-blue janal-column-center janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:outputLabel value="Total a estimar:"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.idContrato.total}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:inputText value="Vence el fondo de garantía: #{kajoolResumen.attrs.idContrato.vence}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                </p:panelGrid>  
              </p:panel>						
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="."/>
              </div>   
            </div>
          </div>
        </div>  
      </div>  
      <div class="ContainerIndent">        					
        <div class="Container50 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-red">
                  <i class="fa fa-city Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>
                  <p:outputLabel value="Datos del avance semana #{kajoolResumen.attrs.idNomina.semana}" styleClass="contrato"/>
                </div>
                <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                  <p:outputLabel value="Periodo:"/>
                  <p:inputText value="#{kajoolResumen.attrs.idNomina.inicio} al #{kajoolResumen.attrs.idNomina.termino}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-80, janal-wid-20">
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="(-) Amortización de anticipo:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.idNomina.anticipo}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="."/>
                      <p:inputText value="#{kajoolResumen.attrs.idNomina.porcentajeAnticipo}%" styleClass="janal-column-center janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-80, janal-wid-20">
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="(-) Retención del fondo garantía:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.idNomina.fondoGarantia}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100">
                      <p:outputLabel value="."/>
                      <p:inputText value="#{kajoolResumen.attrs.idNomina.porcentajeFondo}%" styleClass="janal-color-blue janal-column-center janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:outputLabel value="Total estimado a la semana #{kajoolResumen.attrs.idNomina.semana}:" styleClass="contrato"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.idNomina.importe}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:inputText value="Otras retenciones: $ #{kajoolResumen.attrs.idNomina.retenciones}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                </p:panelGrid>  
              </p:panel>			
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="."/>
              </div>   
            </div>  
          </div>  
        </div>  
        <div class="Container50 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-box">
                <div class="Container100 Responsive keet-chart-title janal-box-title-red">
                  <i class="fa fa-city Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Datos acumulados del contrato
                </div>
                <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                  <p:outputLabel value="Total estimado:"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.acumulado.estimado}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:outputLabel value="Total amortizado de anticipo:"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.acumulado.anticipo}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:outputLabel value="Total retenido de fondo garantía:"/>
                  <p:inputText value="$ #{kajoolResumen.attrs.acumulado.fondoGarantia}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                  <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100">
                    <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                      <p:outputLabel value="Total facturado:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.acumulado.facturado}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                    <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                      <p:outputLabel value="Total pagado:"/>
                      <p:inputText value="$ #{kajoolResumen.attrs.acumulado.pagado}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                    </p:panelGrid>  
                  </p:panelGrid>  
                  <p:inputText value="Total vencido: $ #{kajoolResumen.attrs.acumulado.vencido}" styleClass="janal-wid-100-txt contrato" readonly="true"/>
                </p:panelGrid>  
              </p:panel>			              
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="."/>
              </div>   
            </div>  
          </div>  
        </div>  
      </div>  
      <div class="ContainerIndent">        
        <div class="Container100 Responsive overview-box">					
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <p:panel styleClass="overview-inner-chart">
                <div class="Container100 Responsive keet-chart-title janal-box-title-purple">
                  <i class="fa fa-file-invoice-dollar Fs16 janal-color-orange"></i><p:spacer width="8px" height="1px"/>Gráfico de lo facturado contra lo pagado
                </div>
                <div class="keet-chart-panel-box">
                  <div id="confronta" class="keet-chart-panel-box">
                    Cargando gráficas ...
                  </div>	
                </div>	              
              </p:panel>						
              <div class="Container100 Responsive TexAlCenter janal-color-black keet-chart-footer">
                <span id="contrato"/>
              </div>   
            </div>  
          </div>  
        </div>  
      </div>  
      <div class="ContainerIndent">        					
        <div class="Container100 Responsive overview-box">
					<div class="Container100 Responsive">					
						<div class="ContainerIndent card">
              <div class="Container100 Responsive Fs14 janal-column-right janal-color-black">
                <i class=""></i><p:spacer width="8px" height="1px"/>Estado de cuenta por contrato al día <span id="hoy"/>
              </div>
            </div>
          </div>
        </div>  
      </div>  
    </div>		
		<p:notificationBar id="lockDownloadBackup" position="top" effect="slide" styleClass="jana-bar-top" widgetVar="downloadBackup" effectSpeed="slow">
			<span title="Cerrar" style="position: absolute; top: 10px; right: 80px; cursor: pointer;" onclick="PF('downloadBackup').hide();"><i class="fa fa-lg fa-close"/></span>
			<p:panelGrid layout="grid" columns="1" style="background: transparent;">
				<h:outputText value="Administrador Web" styleClass="Fs20"/>
				<p:spacer height="3px"/>
				<h:outputText value="#{kajoolResumen.attrs.messageBackup}" escape="false" styleClass="Fs14"/>
			</p:panelGrid>
		</p:notificationBar>
  </ui:define>
</ui:composition>
