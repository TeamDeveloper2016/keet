<?xml version="1.0" encoding="ISO-8859-1" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                template="/WEB-INF/plantillas/accion.xhtml">
	<ui:param name="titulo" value="#{keetCatalogosContratosAccion.attrs.nombreAccion} al catálogo de contratos" />
	<ui:define name="librerias">
		<script src="https://maps.google.com/maps/api/js?key=AIzaSyBT_SYV5r3kJdT_bO0ijJmNjxqZqhb7xNY" type="text/javascript"></script>
		<script type="text/javascript">
      //<![CDATA[
			Janal.Control.fields = {
				'contenedorGrupos\\:clave'  : {validaciones: 'requerido|texto', mascara: 'libre', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:nombre' : {validaciones: 'requerido|texto', mascara: 'libre', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:permiso': {validaciones: 'texto', mascara: 'libre', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:noViviendas': {validaciones: 'requerido|entero', mascara: 'libre', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:etapa'  : {validaciones: 'requerido|texto', mascara: 'libre', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:costo'  : {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:materiales': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:destajos': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:subcontratados': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:porElDia': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:administrativos': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:maquinaria': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:indirecto': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:utilidad': {validaciones: 'flotante', mascara: 'libre'},
				'contenedorGrupos\\:idProyecto': {validaciones: 'requerido', mascara: 'libre'},
        'contenedorGrupos\\:entidad'  : {validaciones: 'requerido', mascara: 'libre', grupo: 'domicilio'},
        'contenedorGrupos\\:municipio': {validaciones: 'requerido', mascara: 'libre', grupo: 'domicilio'},
        'contenedorGrupos\\:localidad': {validaciones: 'requerido', mascara: 'libre', grupo: 'domicilio'},
        'contenedorGrupos\\:cp'             : {validaciones: 'requerido', mascara: 'cinco-digitos', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:calle'          : {validaciones: 'requerido', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:exterior'       : {validaciones: 'libre', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:interior'       : {validaciones: 'libre', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:asentamiento'   : {validaciones: 'requerido', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:entreCalle'     : {validaciones: 'libre', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:otraCalle'      : {validaciones: 'libre', mascara: 'libre', grupo: 'domicilio', formatos: 'cambiar-mayusculas'},
				'contenedorGrupos\\:porcentajeAnticipo': {validaciones: 'requerido|mayor-igual({"cuanto": 0})', mascara: 'libre'},
				'contenedorGrupos\\:anticipo'       : {validaciones: 'requerido|mayor-igual({"cuanto": 0})', mascara: 'libre'},
				'contenedorGrupos\\:porcentajeFondo': {validaciones: 'requerido|mayor-igual({"cuanto": 0})', mascara: 'libre'},
				'contenedorGrupos\\:fondoGarantia'  : {validaciones: 'requerido|mayor-igual({"cuanto": 0})', mascara: 'libre'},
				'contenedorGrupos\\:idTipoMedioPago': {validaciones: 'libre', mascara: 'libre'},
        'contenedorGrupos\\:deposito'       : {validaciones: 'fecha', mascara: 'libre', formatos: 'cambiar-mayusculas'},
        'contenedorGrupos\\:pagare'         : {validaciones: 'libre', mascara: 'libre', formatos: 'cambiar-mayusculas'},
        'porcentaje': {multiple: '$', validaciones: 'flotante|mayor-igual({"cuanto": 0})', mascara: 'libre', formatos: 'sat', grupo: 'general'},
        'nombre'    : {multiple: '$', validaciones: 'texto', mascara: 'libre', formatos: 'cambiar-mayusculas', grupo: 'general'},
        'limite'    : {multiple: '$', validaciones: 'flotante|mayor-igual({"cuanto": 0})', mascara: 'libre', formatos: 'sat', grupo: 'general'}
			};

			fieldsDomicilio ={
				'calleBusqueda': {validaciones: 'requerido', mascara: 'libre', grupo: 'dialogo', formatos: 'cambiar-mayusculas'}
			};

			$(document).ready(function () {
				janal.readingMode('#{keetCatalogosContratosAccion.attrs.nombreAccion}');
        
        $(document).on('keydown', '.key-calculos-event', function(e) {
          var VK_ENTER= 13;
          var key     = e.keyCode? e.keyCode: e.which;
          janal.console('accion.keydown [key-buscados-event]: '+ key);   
          if(key === VK_ENTER) {
            var event = jQuery.Event("change");
            event.keyCode= key;
            event.which  = key;
            $(this).trigger(event);
          } // if  
        }); // on
			});		
			
			var currentMarker;
			
			function initLocalization() {								
				if ("geolocation" in navigator) { 
					navigator.geolocation.getCurrentPosition(function(position){ 
						var lat, lon;
						lat= position.coords.latitude.toString();
						lon= position.coords.longitude.toString();												
						PF('wMapa').getMap().setCenter(new google.maps.LatLng(lat,lon));
						currentMarker = new google.maps.Marker({
              position: new google.maps.LatLng(lat, lon),
							icon:'#{request.contextPath}/javax.faces.resource/icon/mapa/janal-red.png.jsf?ln=janal'
            });                 						
						PF('wMapa').addOverlay(currentMarker);					
						updateInitGeo(lat,lon);						
						updateGeoreferencia(lat,lon);						
					}); // navigator
				} // if
				else {
					console.log("Browser doesn't support geolocation!");
				} // else				
			} // initLocalization
			
			function existLocalization(lat, lon) {								
				if ("geolocation" in navigator){ 															
					PF('wMapa').getMap().setCenter(new google.maps.LatLng(lat,lon));
					currentMarker = new google.maps.Marker({
						position: new google.maps.LatLng(lat, lon),
						icon:'#{request.contextPath}/javax.faces.resource/icon/mapa/janal-green.png.jsf?ln=janal'
					});                 						
					PF('wMapa').addOverlay(currentMarker);											
					updateGeoreferencia(lat, lon);
				} // if
				else {
					console.log("Browser doesn't support geolocation!");
				} // else				
			} // existLocalization
			
			function updateLocalization(lat, lon) {								
			  currentMarker.setMap(null);
				// PF('wMapa').getMap().setCenter(new google.maps.LatLng(lat,lon));
				currentMarker= new google.maps.Marker({
          position: new google.maps.LatLng(lat, lon),
					icon:'#{request.contextPath}/javax.faces.resource/icon/mapa/janal-green.png.jsf?ln=janal'
        });                 						
				PF('wMapa').addOverlay(currentMarker);						
				updateGeoreferencia(lat, lon);
			} // updateLocalization						
			
			function updateGeoreferencia(lat, lon) {
				$('#contenedorGrupos\\:coordenadas').text('@'+ lat+ ','+ lon);				
				$('#contenedorGrupos\\:coordenadas').val('@'+ lat+ ','+ lon);				
			} // updateGeoreferencia	
			
			function processGeo(){
				janal.bloquear();
				blurPointSelect($('#contenedorGrupos\\:coordenadas').val());
				return true;
			} // processGeo
      
      function valida(input, max, name) {
        var value= $(input).val();
        janal.console('accion.valida: '+ name+ ' '+ max+ ' value: '+ value+ ' es flotante '+ janal.isDouble(value));
        janal.clean();
        if(!janal.isDouble(value))
          $(input).val('0');
        else {
          var val= parseFloat(value, 10).toFixed(2);
          if(val> max && max>= 0) {
            janal.warn(name, 'El porcetaje máximo permitido para '+ name+ ' es de '+ max+ '%');
            $(input).val(max);
          } // if  
        } // else  
        return true;
      }      
      //]]>
		</script>
	</ui:define>
	<ui:define name="contenido">
		<pe:remoteCommand name="updateInitGeo" process="@this contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.doInitGeo}">  
			<pe:methodSignature parameters="java.lang.String, java.lang.String"/>  
			<pe:methodParam name="latitud"/>  
			<pe:methodParam name="longitud"/>  
		</pe:remoteCommand>		
		<pe:remoteCommand name="blurPointSelect" process="@this contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.onBlurPointSelect}">  
			<pe:methodSignature parameters="java.lang.String"/>  
			<pe:methodParam name="geo"/>  			
		</pe:remoteCommand>		
		<div class="ui-grid ui-grid-responsive" style="overflow-y:hidden;">
			<div class="ui-grid-row janal-grid-row">
				<div class="ui-grid-col-12">
					<p:tabView id="contenedorGrupos" widgetVar="pestanias">						
            <p:ajax event="tabChange" process="@this" update="tabla" listener="#{keetCatalogosContratosAccion.doTabChange}" oncomplete="janal.refresh();"/>
            <p:tab title="Control" rendered="#{keetCatalogosContratosAccion.attrs.visualizar}">
							<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                <p:outputLabel for="comentarios" value="Observaciones del contrato:"/>
                <p:inputTextarea id="comentarios" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.attrs.comentarios}" rows="6" readonly="true" />
              </p:panelGrid>  
            </p:tab>  
            <p:tab title="General">							
							<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                <p:outputLabel for="clave" value="Clave:"/>
								<p:inputText id="clave" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.clave}" />											
  							<p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100">
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="nombre" value="Nombre:"/>
                    <p:inputText id="nombre" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.nombre}" />
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="etapa" value="Etapa:"/>
                    <p:inputText id="etapa" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.etapa}" />								
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="permiso" value="No permiso:"/>
                    <p:inputText id="permiso" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.permiso}" />
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="noViviendas" value="No. viviendas"/>
                    <p:inputNumber id="noViviendas" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.noViviendas}"/>
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="inicio" value="Inicio:"/>
                    <p:calendar id="inicio" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt janal-column-center" value="#{keetCatalogosContratosAccion.contrato.contrato.inicio}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="termino" value="Termino:"/>
                    <p:calendar id="termino" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt janal-column-center" value="#{keetCatalogosContratosAccion.contrato.contrato.termino}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>
                </p:panelGrid>
  							<p:panelGrid columns="3" layout="grid" styleClass="janal-wid-100">
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="recepcion" value="Recepción:"/>
                    <p:calendar id="recepcion" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt janal-column-center" value="#{keetCatalogosContratosAccion.contrato.contrato.recepcion}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="aceptacion" value="Aceptación:"/>
                    <p:calendar id="aceptacion" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt janal-column-center" value="#{keetCatalogosContratosAccion.contrato.contrato.aceptacion}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>
	    						<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                    <p:outputLabel for="arranque" value="Arranque:"/>
                    <p:calendar id="arranque" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt janal-column-center" value="#{keetCatalogosContratosAccion.contrato.contrato.arranque}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>
                </p:panelGrid>
								<p:separator/>
								<p:outputLabel for="idProyecto" value="Proyecto:"/>
                <p:selectOneMenu id="idProyecto" value="#{keetCatalogosContratosAccion.contrato.contrato.ikProyecto}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-99" effect="fade" filter="true" filterMatchMode="custom" filterFunction="janal.contains" editable="false" disabled="true">
									<f:selectItems value="#{keetCatalogosContratosAccion.attrs.proyectos}" var="element" itemValue="#{element}" itemLabel="#{element.clave}" />
									<p:column headerText="Nombre">
										<h:outputText value="#{item.clave}"/>
									</p:column>   
								</p:selectOneMenu>
              </p:panelGrid>
						</p:tab>		
						<p:tab id="tabCostos" title="Costos">	
							<p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
								<p:outputLabel for="costo" value="Prespuestado:"/>
								<p:inputNumber id="costo" value="#{keetCatalogosContratosAccion.contrato.contrato.costo}" inputStyleClass="janal-wid-100-txt janal-color-blue" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                  <p:ajax event="change" process="@this" update="@(.anticipo) @(.fondo) @(.calculos)" listener="#{keetCatalogosContratosAccion.doUpdateCosto}"/>
                </p:inputNumber>  
								<p:separator/>
                <p:fieldset legend="Desglose de lo presupuestado:">
                  <p:outputLabel for="materiales" value="Materiales:"/>
                  <p:inputNumber id="materiales" value="#{keetCatalogosContratosAccion.contrato.contrato.materiales}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                    <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                  </p:inputNumber>  
                  <p:fieldset legend="Costos de mano de obra:">
      							<p:panelGrid columns="3" layout="grid" styleClass="janal-wid-100">
                      <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                        <p:outputLabel for="destajos" value="Por destajo:"/>
                        <p:inputNumber id="destajos" value="#{keetCatalogosContratosAccion.contrato.contrato.destajos}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                          <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                        </p:inputNumber>  
                      </p:panelGrid>  
                      <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                        <p:outputLabel for="subcontratados" value="Por subcontrato:"/>
                        <p:inputNumber id="subcontratados" value="#{keetCatalogosContratosAccion.contrato.contrato.subcontratados}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                          <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                        </p:inputNumber>  
                      </p:panelGrid>  
                      <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                        <p:outputLabel for="porElDia" value="De personal por el día:"/>
                        <p:inputNumber id="porElDia" value="#{keetCatalogosContratosAccion.contrato.contrato.porElDia}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                          <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                        </p:inputNumber>  
                      </p:panelGrid>  
                    </p:panelGrid>  
                  </p:fieldset>                  
                  <p:panelGrid columns="4" layout="grid" styleClass="janal-wid-100">
                    <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                      <p:outputLabel for="administrativos" value="Administrativos:"/>
                      <p:inputNumber id="administrativos" value="#{keetCatalogosContratosAccion.contrato.contrato.administrativos}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                      <p:outputLabel for="maquinaria" value="Maquinaria:"/>
                      <p:inputNumber id="maquinaria" value="#{keetCatalogosContratosAccion.contrato.contrato.maquinaria}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                      <p:outputLabel for="indirecto" value="Indirectos:"/>
                      <p:inputNumber id="indirecto" value="#{keetCatalogosContratosAccion.contrato.contrato.indirecto}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                    <p:panelGrid columns="1" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
                      <p:outputLabel for="utilidad" value="Utilidad:"/>
                      <p:inputNumber id="utilidad" value="#{keetCatalogosContratosAccion.contrato.contrato.utilidad}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this" update="@(.total)" listener="#{keetCatalogosContratosAccion.doUpdateGlobal}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                  </p:panelGrid>  
                </p:fieldset>                  
								<p:outputLabel value="Suma del desglose de lo presupuestado:"/>
                <p:inputNumber value="#{keetCatalogosContratosAccion.attrs.total}" styleClass="total" inputStyleClass="janal-wid-100-txt janal-color-blue" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p" readonly="true"/>
								<p:outputLabel value="Presupuesto - suma del desglose de lo presupuestado:"/>
                <p:inputNumber value="#{keetCatalogosContratosAccion.attrs.diferencia}" styleClass="total" inputStyleClass="janal-wid-100-txt janal-color-blue" converter="javax.faces.Double" decimalPlaces="2" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p" readonly="true"/>
              </p:panelGrid>
            </p:tab>  
						<p:tab id="tabSiembra" title="Siembra">	
							<p:remoteCommand name="executeGeo" oncomplete="initLocalization();"/>
							<p:remoteCommand name="executeExistGeo" process="@this contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.doExistGeo}"/>														
              <p:dataTable id="tablaLotes" lazy="false" widgetVar="wTablaLotes" rowIndexVar="index" var="lote" value="#{keetCatalogosContratosAccion.contrato.contrato.lotes}" rows="200" rowsPerPageTemplate="80" paginator="true" reflow="true" rowKey="#{lote.key}" emptyMessage="#{Constantes.NO_EXISTEN_REGISTROS}" styleClass="paginated style-panel" paginatorPosition="bottom" rowStyleClass="#{keetCatalogosContratosAccion.toColor(lote)}">
								<p:column headerText="Clave" class="janal-wid-8">										
									<p:inputText value="#{lote.clave}" styleClass="janal-wid-100-txt"/>
								</p:column>	
								<p:column headerText="Prototipo" class="janal-wid-10">										
									<p:selectOneMenu value="#{lote.idPrototipo}" styleClass="janal-wid-100-txt" converter="janal.convertidor.EnteroLargo">
										<f:selectItems value="#{keetCatalogosContratosAccion.prototipos}"/>
										<p:ajax event="change" listener="#{keetCatalogosContratosAccion.contrato.contrato.doCalculateFecha(lote)}" process="@this tablaLotes" update="tablaLotes @(.prototipo)" />										
									</p:selectOneMenu>			
								</p:column>	                  
								<p:column headerText="Fecha inicio" class="janal-wid-8">										
									<p:calendar id="fechaInicial" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-94" value="#{lote.inicio}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode" >
										<p:ajax event="dateSelect" listener="#{keetCatalogosContratosAccion.contrato.contrato.doCalculateFecha(lote)}" process="@this tablaLotes" update="fechaTermino @(.prototipo)"/>
									</p:calendar>
								</p:column>
								<p:column headerText="Dias de construccion" class="janal-wid-8">										
									<p:inputText value="#{lote.diasConstruccion}" styleClass="janal-wid-100-txt prototipo"/>
								</p:column>
								<p:column headerText="Fecha termino" class="janal-wid-8">										
									<p:calendar id="fechaTermino" styleClass="janal-wid-100-txt prototipo" inputStyleClass="janal-wid-94" value="#{lote.termino}" pattern="dd/MM/yyyy" locale="mx"/>
								</p:column>
								<p:column headerText="Manzana" class="janal-wid-8">										
									<p:inputText value="#{lote.manzana}" styleClass="janal-wid-100-txt"/>
								</p:column>
								<p:column headerText="Lote" class="janal-wid-8">										
									<p:inputText value="#{lote.lote}" styleClass="janal-wid-100-txt"/>
								</p:column>	
								<p:column headerText="Tipo de fachada" class="janal-wid-10">										
									<p:selectOneMenu value="#{lote.idTipoFachada}" styleClass="janal-wid-100-txt" converter="janal.convertidor.EnteroLargo">
										<f:selectItems value="#{keetCatalogosContratosAccion.fachadas}"/>										
									</p:selectOneMenu>			
								</p:column>	                  
                <p:column headerText="Atributos" rendered="false">	
									<p:inputText value="#{lote.atributos}" styleClass="janal-wid-100-txt"/>
								</p:column>								
								<p:column headerText="Calle">										
									<p:inputText value="#{lote.calle}" styleClass="janal-wid-100-txt"/>
								</p:column>								
								<p:column headerText="Costo" class="janal-wid-15">										
									<p:inputNumber value="#{lote.costo}" inputStyleClass="janal-wid-100-txt" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                    <p:ajax event="change" process="@this contenedorGrupos:costo" update="@this contenedorGrupos:costo" listener="#{keetCatalogosContratosAccion.doCalculateCosto}"/>
                  </p:inputNumber>  
								</p:column>								
								<p:column headerText="Geo" class="janal-wid-col-20">																				
									<h:graphicImage library="janal" name="icon/semaforos/#{lote.georeferencia}.png"/>
								</p:column>	
								<p:column class="janal-wid-col-80 janal-column-center">										
									<p:commandButton icon="fa fa-map-marker" title="Georeferencia" process="contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.doGeoreferencia(lote)}" update="contenedorGrupos" oncomplete="PF('pestanias').select(2);"/>
									<p:commandButton update="tablaLotes" icon="fa fa-close" title="Eliminar" action="#{keetCatalogosContratosAccion.contrato.contrato.doRemoveLote}">
										<f:setPropertyActionListener value="#{lote}" target="#{keetCatalogosContratosAccion.contrato.contrato.loteSeleccion}" />
									</p:commandButton>
								</p:column>
								<f:facet name="footer">
									<p:commandButton actionListener="#{keetCatalogosContratosAccion.contrato.contrato.doAddLote}" process="@this tablaLotes" update="tablaLotes" icon="fa fa-plus" oncomplete="janal.refresh();"/>						
								</f:facet>
							</p:dataTable>															
						</p:tab>	
						<p:tab id="panelGeoreferencia" title="Georeferencia" rendered="#{keetCatalogosContratosAccion.attrs.mostrarGeo}">
							<p:outputLabel value="Manzana:"/>
							<p:inputText value="#{keetCatalogosContratosAccion.attrs.loteGeoreferencia.manzana}" styleClass="janal-wid-100-txt" readonly="true"/>
							<p:outputLabel value="Lote:"/>
							<p:inputText value="#{keetCatalogosContratosAccion.attrs.loteGeoreferencia.lote}" styleClass="janal-wid-100-txt" readonly="true"/>
							<p:outputLabel value="Coordenada:"/>
							<p:inputText id="coordenadas" styleClass="janal-wid-100-txt">
								<p:ajax event="blur" onstart="return processGeo();" oncomplete="janal.desbloquear();"/>
							</p:inputText>
							<br/>
							<div class="janal-line-button">
								<div class="lg-pantalla janal-column-right">
									<p:commandButton value="Aceptar" iconPos="left" styleClass="janal-text-white" accesskey="z" icon="fa fa-map-marker" process="@this contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.doAceptarGeo}" update="contenedorGrupos" oncomplete="PF('pestanias').select(1);"/>										
									<p:commandButton value="Cancelar" iconPos="left" styleClass="janal-text-white" accesskey="c" icon="fa fa-close" actionListener="#{keetCatalogosContratosAccion.doCancelarGeo}" update="contenedorGrupos" oncomplete="PF('pestanias').select(1);"/>
								</div>
								<div class="xs-pantalla janal-column-right">
									<p:commandButton title="Aceptar cambios" iconPos="left" styleClass="janal-text-whit" accesskey="z" icon="fa fa-map-marker" process="@this contenedorGrupos" actionListener="#{keetCatalogosContratosAccion.doAceptarGeo}" update="contenedorGrupos" oncomplete="PF('pestanias').select(1);"/>										
									<p:commandButton title="Cancelar cambios" iconPos="left" styleClass="janal-text-white" accesskey="c" icon="fa fa-close" actionListener="#{keetCatalogosContratosAccion.doCancelarGeo}" update="contenedorGrupos" oncomplete="PF('pestanias').select(1);"/>
								</div>
							</div>									
							<p:gmap id="mapa" widgetVar="wMapa" center="21.8818,-102.291" zoom="75" type="TERRAIN" style="width:100%;height:500px" rendered="#{keetCatalogosContratosAccion.attrs.mostrarGeo}" streetView="true" styleClass="style-panel">
								<p:ajax event="pointSelect" listener="#{keetCatalogosContratosAccion.onPointSelect}"/>
							</p:gmap>	
						</p:tab>
						<p:tab title="Ordenar siembra" rendered="false">	
							<p:orderList id="loteOrden" var="loteOrden"  value="#{keetCatalogosContratosAccion.contrato.contrato.lotes}"  itemValue="M#{loteOrden.manzana}-L#{loteOrden.lote}" controlsLocation="none" >
								<p:ajax event="select" listener="#{keetCatalogosContratosAccion.onSelect}"/>
								<p:ajax event="reorder" listener="#{keetCatalogosContratosAccion.onReorder}" />
								<f:facet name="caption">Orden de priroidad de los lotes</f:facet>
								<p:column>
									<h:outputLabel rendered="#{loteOrden.mostar}"  value="M#{loteOrden.manzana}-L#{loteOrden.lote}" />
								</p:column>
							</p:orderList>
						</p:tab>	
            <p:tab id="tabDomicilio" title="Domicilio">	
              <p:panelGrid id="formularioDomicilio" columns="2" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-10, janal-wid-90">
                <p:outputLabel for="domicilio" value="Domicilio:"/>
                <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-96, janal-wid-col-38">
                  <p:selectOneMenu id="domicilio" value="#{keetCatalogosContratosAccion.contrato.domicilio.domicilio}" styleClass="janal-wid-100-txt" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" converter="janal.convertidor.Entity">									
                    <p:ajax event="change" listener="#{keetCatalogosContratosAccion.doLoadAtributos}" process="@this domicilio" update="contenedorGrupos:formularioDomicilio" onstart="return janal.bloquear();" oncomplete="janal.desbloquear();"/>										
                    <f:selectItems value="#{keetCatalogosContratosAccion.attrs.domicilios}" var="element" itemValue="#{element}" itemLabel="#{element.domicilio}"/>
                    <p:column  styleClass="janal-column-left janal-wid-col-150">
                      <h:outputText value="#{item.entidad}"/>
                    </p:column>   										
                    <p:column  styleClass="janal-column-left">
                      <h:outputText value="#{item.calle}"/>
                    </p:column>   
                    <p:column styleClass="janal-column-right janal-wid-col-50">
                      <h:outputText value="#{item.numeroExterior}"/>
                    </p:column>  										
                    <p:column styleClass="janal-column-left janal-wid-col-250">
                      <h:outputText value="#{item.asentamiento}"/>
                    </p:column>  
                  </p:selectOneMenu>	
                  <p:commandButton process="@this" update="dialogoDomicilios" icon="fa fa-search" onstart="return janal.bloquear();" oncomplete="PF('dlgDomicilios').show();" title="Buscar domicilio" style="float: right !important"/>						
                </p:panelGrid>
                <p:outputLabel for="entidad" value="Entidad:"/>
                <p:selectOneMenu id="entidad" value="#{keetCatalogosContratosAccion.contrato.domicilio.idEntidad}" styleClass="janal-wid-100-txt" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" converter="janal.convertidor.Entity">									
                  <p:ajax event="change" listener="#{keetCatalogosContratosAccion.doLoadMunicipios}" process="@this" update="contenedorGrupos:formularioDomicilio" onstart="return janal.bloquear();" oncomplete="janal.refresh();janal.desbloquear();reloadMunicipio();reloadLocalidad();janal.alignCp();"/>
                  <f:selectItems value="#{keetCatalogosContratosAccion.attrs.entidades}" var="element" itemValue="#{element}" itemLabel="#{element.descripcion}"/>
                  <p:column  styleClass="janal-column-center">
                    <h:outputText value="#{item.clave}"/>
                  </p:column>   
                  <p:column styleClass="janal-column-left">
                    <h:outputText value="#{item.descripcion}"/>
                  </p:column>  
                </p:selectOneMenu>								
                <p:outputLabel for="municipio" value="Municipio:"/>
                <p:selectOneMenu id="municipio" value="#{keetCatalogosContratosAccion.contrato.domicilio.idMunicipio}" styleClass="janal-wid-100-txt" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" converter="janal.convertidor.Entity">									
                  <p:ajax event="change" listener="#{keetCatalogosContratosAccion.doLoadLocalidades}" process="@this" update="contenedorGrupos:formularioDomicilio" onstart="return janal.bloquear();" oncomplete="janal.refresh();janal.desbloquear();reloadLocalidad();janal.alignCp();"/>
                  <f:selectItems value="#{keetCatalogosContratosAccion.attrs.municipios}" var="element" itemValue="#{element}" itemLabel="#{element.descripcion}"/>
                  <p:column  styleClass="janal-column-center">
                    <h:outputText value="#{item.clave}"/>
                  </p:column>   
                  <p:column styleClass="janal-column-left">
                    <h:outputText value="#{item.descripcion}"/>
                  </p:column>  
                </p:selectOneMenu>								
                <p:outputLabel for="localidad" value="Localidad:"/>
                <p:selectOneMenu id="localidad" value="#{keetCatalogosContratosAccion.contrato.domicilio.localidad}" styleClass="janal-wid-100-txt" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" converter="janal.convertidor.Entity">									
                  <!--p:ajax event="change" listener="#{keetCatalogosContratosAccion.doLoadCodigosPostales}" process="@this" update="contenedorGrupos:formularioDomicilio" onstart="return janal.bloquear();" oncomplete="janal.refresh();janal.desbloquear();"/-->
                  <f:selectItems value="#{keetCatalogosContratosAccion.attrs.localidades}" var="element" itemValue="#{element}" itemLabel="#{element.descripcion}"/>
                  <p:column  styleClass="janal-column-center">
                    <h:outputText value="#{item.clave}"/>
                  </p:column>   
                  <p:column styleClass="janal-column-left">
                    <h:outputText value="#{item.descripcion}"/>
                  </p:column>  
                </p:selectOneMenu>																	
                <p:outputLabel for="cp" value="Código postal:"/>                  
                <p:inputText id="cp" placeholder="Ejemplo: 20284" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.codigoPostal}">
                  <p:ajax event="blur" listener="#{keetCatalogosContratosAccion.doLookForCodigoPostal}" process="@this" onstart="return janal.bloquear();" oncomplete="janal.desbloquear();"/>
                </p:inputText>  
                <p:outputLabel for="calle" value="Calle:"/>
                <p:inputText id="calle" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.calle}" />
                <p:outputLabel for="exterior" value="Número exterior:"/>
                <p:inputText id="exterior" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.numeroExterior}" />
                <p:outputLabel for="interior" value="Número interior:"/>
                <p:inputText id="interior" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.numeroInterior}"/>	
                <p:outputLabel for="asentamiento" value="Colonia:"/>
                <p:inputText id="asentamiento" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.asentamiento}"/>	
                <p:outputLabel for="entreCalle" value="Entre calle:"/>
                <p:inputText id="entreCalle" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.entreCalle}"/>	
                <p:outputLabel for="otraCalle" value="Y calle:"/>
                <p:inputText id="otraCalle" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.domicilio.ycalle}"/>	
                <p:outputLabel for="tipoDomicilio" value="Tipo domicilio:"/>
                <p:selectOneMenu id="tipoDomicilio" value="#{keetCatalogosContratosAccion.contrato.domicilio.idTipoDomicilio}" styleClass="janal-wid-100-txt">									
                  <f:selectItems value="#{keetCatalogosContratosAccion.attrs.tiposDomicilios}"/>
                </p:selectOneMenu>	
                <p:outputLabel for="principal" value="Principal:"/>
                <p:selectBooleanCheckbox id="principal" value="#{keetCatalogosContratosAccion.contrato.domicilio.principal}" styleClass="janal-wid-100-txt" />                    
              </p:panelGrid>
              <p:remoteCommand name="simpleProcess" actionListener="#{keetCatalogosContratosAccion.doLoadItemsDomicilio}" process="@this contenedorGrupos"/>
              <p:remoteCommand name="reloadMunicipio" process="@this" update="contenedorGrupos:municipio"/>
              <p:remoteCommand name="reloadLocalidad" process="@this" update="contenedorGrupos:localidad"/>
            </p:tab>  
						<p:tab id="tabAnticipo" title="Anticipo">	
							<p:panelGrid id="anticipos" columns="1" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-100-txt">
 							  <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100">
                  <p:fieldset legend="Importe del anticipo:">
                    <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100" columnClasses="janal-column-center, janal-column-center">
                      <p:inputNumber id="porcentajeAnticipo" value="#{keetCatalogosContratosAccion.contrato.contrato.porcentajeAnticipo}" inputStyleClass="janal-wid-100-txt janal-column-center anticipo" converter="javax.faces.Double" decimalPlaces="2" minValue="0" maxValue="100" emptyValue="zero" symbol=" %" symbolPosition="s">
                        <p:ajax event="change" process="@this contenedorGrupos:costo" update="contenedorGrupos:anticipo @(.anticipo)" listener="#{keetCatalogosContratosAccion.doCalculateAnticipo(true)}"/>
                      </p:inputNumber>  
                      <p:inputNumber id="anticipo" value="#{keetCatalogosContratosAccion.contrato.contrato.anticipo}" inputStyleClass="janal-wid-100-txt janal-column-center janal-color-blue anticipo" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this contenedorGrupos:porcentajeAnticipo" update="contenedorGrupos:porcentajeAnticipo @(.anticipo)" listener="#{keetCatalogosContratosAccion.doCalculateAnticipo(false)}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                  </p:fieldset>
                  <p:fieldset legend="Fondo de garantía:">
                    <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100" columnClasses="janal-column-center, janal-column-center">
                      <p:inputNumber id="porcentajeFondo" value="#{keetCatalogosContratosAccion.contrato.contrato.porcentajeFondo}" inputStyleClass="janal-wid-100-txt janal-column-center fondo" converter="javax.faces.Double" decimalPlaces="2" minValue="0" maxValue="100" emptyValue="zero" symbol=" %" symbolPosition="s">
                        <p:ajax event="change" process="@this contenedorGrupos:fondoGarantia" update="contenedorGrupos:fondoGarantia @(.fondo)" listener="#{keetCatalogosContratosAccion.doCalculateFondoGarantia(true)}"/>
                      </p:inputNumber>  
                      <p:inputNumber id="fondoGarantia" value="#{keetCatalogosContratosAccion.contrato.contrato.fondoGarantia}" inputStyleClass="janal-wid-100-txt janal-column-center janal-color-blue fondo" converter="javax.faces.Double" decimalPlaces="2" minValue="0" decimalSeparator="." thousandSeparator="," emptyValue="zero" symbol="$ " symbolPosition="p">
                        <p:ajax event="change" process="@this contenedorGrupos:porcentajeFondo" update="contenedorGrupos:porcentajeFondo  @(.fondo)" listener="#{keetCatalogosContratosAccion.doCalculateFondoGarantia(false)}"/>
                      </p:inputNumber>  
                    </p:panelGrid>  
                  </p:fieldset>
                </p:panelGrid>  
                <p:separator/>
                <p:outputLabel for="vence" value="Vencimiento del fondo de garantía:"/>
                <p:calendar id="vence" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.vence}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                <p:outputLabel for="idTipoMedioPago" value="Medio de pago:"/>
                <p:selectOneMenu id="idTipoMedioPago" value="#{keetCatalogosContratosAccion.contrato.contrato.ikTipoMedioPago}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-100-txt" effect="fade" filter="true" filterMatchMode="custom" filterFunction="janal.contains">
                  <p:ajax event="change" process="@this contenedorGrupos:costo" listener="#{keetCatalogosContratosAccion.doCheckMedioPago}" update="contenedorGrupos:anticipos @(.banco)"/>
                  <f:selectItems value="#{keetCatalogosContratosAccion.attrs.tiposMediosPagos}" var="element" itemValue="#{element}" itemLabel="#{element.nombre}"/>
                  <p:column headerText="Clave">
                    <h:outputText value="#{item.clave}"/>
                  </p:column>   
                  <p:column headerText="Nombre">
                    <h:outputText value="#{item.nombre}"/>
                  </p:column>   
                </p:selectOneMenu>
                <p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100">
                  <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                    <p:outputLabel for="idBanco" value="Banco:" styleClass="banco" rendered="#{keetCatalogosContratosAccion.attrs.mostrarBanco}"/>
                    <p:selectOneMenu id="idBanco" value="#{keetCatalogosContratosAccion.contrato.contrato.ikBanco}" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" styleClass="janal-wid-100-txt banco" converter="janal.convertidor.Entity" rendered="#{keetCatalogosContratosAccion.attrs.mostrarBanco}">
                      <f:selectItems value="#{keetCatalogosContratosAccion.attrs.bancos}" var="element" itemValue="#{element}" itemLabel="#{element.nombre}"/>										
                      <p:column headerText="Nombre">
                        <h:outputText value="#{item.nombre}"/>
                      </p:column>   
                      <p:column headerText="Razón social">
                        <h:outputText value="#{item.razonSocial}"/>
                      </p:column>   
                    </p:selectOneMenu>              
                  </p:panelGrid>  
                  <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                    <p:outputLabel for="referencia" value="Referencia:" styleClass="banco" rendered="#{keetCatalogosContratosAccion.attrs.mostrarBanco}"/>
                    <p:inputText id="referencia" styleClass="janal-wid-100-txt banco" value="#{keetCatalogosContratosAccion.contrato.contrato.referencia}" rendered="#{keetCatalogosContratosAccion.attrs.mostrarBanco}"/>
                  </p:panelGrid>  
                  <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                    <p:outputLabel for="deposito" value="Fecha de deposito:"/>
                    <p:calendar id="deposito" styleClass="janal-wid-100-txt" inputStyleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.deposito}" mode="popup" pattern="dd/MM/yyyy" locale="mx" effect="explode"/>
                  </p:panelGrid>  
                  <p:panelGrid columns="1" layout="grid" styleClass="janal-wid-100">
                    <p:outputLabel for="pagare" value="No pagare:" styleClass="janal-color-blue"/>
                    <p:inputText id="pagare" styleClass="janal-wid-100-txt" value="#{keetCatalogosContratosAccion.contrato.contrato.pagare}" />
                  </p:panelGrid>  
                </p:panelGrid>  
              </p:panelGrid>  
            </p:tab>  
						<p:tab id="tabRetenciones" title="Retenciones">	
              <p:dataTable id="tabla" widgetVar="tabla" var="row" value="#{keetCatalogosContratosAccion.contrato.contrato.retenciones}" emptyMessage="#{Constantes.NO_EXISTEN_REGISTROS}" rows="10000" paginatorTemplate="#{Constantes.ICONOS_DE_PAGINACION}" rowsPerPageTemplate="10000, 100001" paginator="#{keetCatalogosContratosAccion.contrato.contrato.retenciones.size() gt 7}" rowIndexVar="index" reflow="true" paginatorPosition="bottom" rowKey="#{row.idContratoRetencion}" style="#{keetCatalogosContratosAccion.contrato.contrato.retenciones ne null and keetCatalogosContratosAccion.contrato.contrato.retenciones.size() gt 0}">
                <f:facet name="header">
                  <div style="display: flex;">
                    <p:outputLabel value="Retenciones asociadas al contrato" styleClass="janal-text-white"/>
                  </div>  
                </f:facet>  
                <p:column styleClass="janal-column-center MarAuto Responsive janal-wid-3">
									<f:facet name="header">
										<h:outputText value="Activos"/>
									</f:facet>
                  <p:selectBooleanCheckbox value="#{row['activo']}" disabled="#{row['idTipoRetencion'] lt 3}">
                    <p:ajax event="change" process="@this tabla" listener="#{keetCatalogosContratosAccion.doUpdateAccion(row)}"/>
                  </p:selectBooleanCheckbox>  
                </p:column>  
                <p:column styleClass="MarAuto Responsive janal-wid-2">
									<f:facet name="header">
										<h:outputText value="No."/>
									</f:facet>
                  <p:outputLabel value="#{index+ 1}"/>
                </p:column>  
                <p:column styleClass="MarAuto Responsive">
									<f:facet name="header">
										<h:outputText value="Nombre"/>
									</f:facet>
                  <h:outputText value="#{row['nombre']}" rendered="#{row['idTipoRetencion'] lt 3}"/>
                  <p:inputText id="nombre" value="#{row['nombre']}" styleClass="janal-wid-99 calculos" rendered="#{row['idTipoRetencion'] gt 2}">
                    <p:ajax event="change" process="@this tabla" listener="#{keetCatalogosContratosAccion.doUpdateAccion(row)}"/>
                  </p:inputText>
								</p:column>					
								<p:column styleClass="janal-column-center MarAuto Responsive janal-wid-6">
									<f:facet name="header">
										<h:outputText value="Porcentaje"/>
									</f:facet>
                  <p:inputText id="porcentaje" value="#{row['porcentaje']}" styleClass="janal-wid-90 calculos key-calculos-event janal-column-center #{row['idTipoRetencion'] eq 1? 'anticipo': row['idTipoRetencion'] eq 1? 'fondo': ''}" disabled="#{row['idTipoRetencion'] lt 3}">
                    <p:ajax event="change" process="@this tabla" update="@(.calculos)" listener="#{keetCatalogosContratosAccion.doRowUpdateCuenta(row, true)}" onstart="return valida('#contenedorGrupos\\:tabla\\:#{index}\\:porcentaje', #{row['limite']}, '#{row['nombre']}');" oncomplete="janal.refresh();" />
                  </p:inputText>
								</p:column>											
								<p:column styleClass="janal-column-center MarAuto Responsive janal-wid-5">
									<f:facet name="header">
										<h:outputText value="Limite %"/>
									</f:facet>
                  <p:inputText id="limite" value="#{row['limite']}" styleClass="janal-wid-90 calculos key-calculos-event janal-column-center">
                    <p:ajax event="change" process="@this tabla" update="@(.calculos)" listener="#{keetCatalogosContratosAccion.doUpdateAccion(row)}" onstart="return valida('#contenedorGrupos\\:tabla\\:#{index}\\:limite', 30, '#{row['nombre']}');" oncomplete="janal.refresh();"/>
                  </p:inputText>
                </p:column>
								<p:column styleClass="janal-column-right MarAuto Responsive janal-wid-8">
									<f:facet name="header">
										<h:outputText value="Importe"/>
									</f:facet>
                  <p:outputLabel value="#{row['importe']}" styleClass="janal-wid-95 calculos janal-column-center janal-color-blue #{row['idTipoRetencion'] eq 1? 'anticipo': row['idTipoRetencion'] eq 1? 'fondo': ''}"/>
								</p:column>																				
								<f:facet name="footer">
									<p:outputLabel value="Total [#{keetCatalogosContratosAccion.contrato.contrato.retenciones.size()}] registros"/>
								</f:facet>
							</p:dataTable>                  
            </p:tab>  
					</p:tabView>
				</div>
			</div>
		</div>		
	</ui:define>    
	<ui:define name="acciones">
		<div class="lg-pantalla">
			<p:commandButton id="aceptar" value="Aceptar" icon="fa fa-check" accesskey="a"  process="@form" action="#{keetCatalogosContratosAccion.doAceptar}" onstart="return janal.execute()" oncomplete="janal.desbloquear()"/>
			<p:commandButton id="cancelar" value="Cancelar" icon="fa fa-close" accesskey="r" process="@this" action="#{keetCatalogosContratosAccion.doCancelar}" ajax="false" onstart="janal.bloquear()" oncomplete="janal.desbloquear()"/>
		</div>		
		<div class="xs-pantalla">
			<p:commandButton id="aceptarIcon" title="Aceptar" icon="fa fa-check" process="@form" action="#{keetCatalogosContratosAccion.doAceptar}" onstart="return janal.execute()" oncomplete="janal.desbloquear()"/>
			<p:commandButton id="cancelarIcon" title="Cancelar" icon="fa fa-close" process="@this" action="#{keetCatalogosContratosAccion.doCancelar}" ajax="false" onstart="janal.bloquear()" oncomplete="janal.desbloquear()"/>
		</div>		
	</ui:define>
	<ui:define name="dialogos">
		<p:dialog id="dialogoDomicilios" widgetVar="dlgDomicilios" header="Busqueda de domicilio:" resizable="false" closable="false" responsive="true" width="60%" onHide="janal.restore();janal.refresh();" onShow="janal.change('formDialogoDomicilios', fieldsDomicilio);janal.refresh();">
			<h:form id="formDialogoDomicilios" prependId="false">
				<h:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-col-130, janal-wid-98 janal-column-right">
					<p:outputLabel for="calleBusqueda" value="Calle:"/>
  				<h:panelGrid columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-98, janal-wid-col-38">
  					<p:inputText id="calleBusqueda" value="#{keetCatalogosContratosAccion.attrs.calle}" styleClass="janal-wid-100-txt"/>
	  				<p:commandButton icon="fa fa-search" actionListener="#{keetCatalogosContratosAccion.doBusquedaDomicilios}" process="@this calleBusqueda" update="domiciliosBusqueda totalResultados" onstart="return janal.partial('dialogo')"/>
					</h:panelGrid>
					<p:outputLabel for="domiciliosBusqueda" value="Domicilio:"/>
					<p:selectOneMenu id="domiciliosBusqueda" value="#{keetCatalogosContratosAccion.domicilioBusqueda}" styleClass="janal-wid-100-txt" filter="true" filterMatchMode="custom" filterFunction="janal.contains" var="item" converter="janal.convertidor.Entity">									
						<f:selectItems value="#{keetCatalogosContratosAccion.attrs.domiciliosBusqueda}" var="element" itemValue="#{element}" itemLabel="#{element.domicilio}"/>
						<p:column  styleClass="janal-column-left janal-wid-col-150">
							<h:outputText value="#{item.entidad}"/>
						</p:column>   										
						<p:column  styleClass="janal-column-left">
							<h:outputText value="#{item.calle}"/>
						</p:column>   
						<p:column styleClass="janal-column-right janal-wid-col-50">
							<h:outputText value="#{item.numeroExterior}"/>
						</p:column>  										
						<p:column styleClass="janal-column-left janal-wid-col-250">
							<h:outputText value="#{item.asentamiento}"/>
						</p:column>  
					</p:selectOneMenu>
					<p:spacer/>
					<p:outputLabel id="totalResultados" value="Total [#{keetCatalogosContratosAccion.attrs.resultados}]"/>
				</h:panelGrid>
				<hr class="ui-widget-content"/>
				<div class="janal-line-button">
					<p:commandButton id="aceptarBusqueda" icon="fa fa-check" process="@this dialogoDomicilios domiciliosBusqueda" update="contenedorGrupos:formularioDomicilio" value="Aceptar" action="#{keetCatalogosContratosAccion.doAsignaDomicilio}" onstart="PF('dlgDomicilios').hide();" oncomplete="janal.desbloquear();janal.refresh();janal.alignCp();"/>
					<p:commandButton value="Cancelar" icon="fa fa-remove" onstart="PF('dlgDomicilios').hide();" oncomplete="janal.desbloquear();"/>
				</div>
			</h:form>
		</p:dialog>
	</ui:define>  
</ui:composition>
